<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HEGEMON - Global Intelligence Network</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #050508; color: #fff; overflow: hidden; height: 100vh; }
    .app { display: flex; height: 100vh; }
    .globe-container { flex: 1; position: relative; }
    #globe { width: 100%; height: 100%; }

    .header { position: absolute; top: 0; left: 0; right: 320px; z-index: 10; padding: 16px 20px; background: transparent; }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 26px; font-weight: 800; color: #06b6d4; letter-spacing: 2px; }
    .logo-sub { font-size: 11px; color: #94a3b8; margin-top: 2px; letter-spacing: 3px; font-weight: 600; }
    .header-right { position: absolute; top: 16px; right: 340px; display: flex; align-items: center; gap: 16px; z-index: 15; }
    .live { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #22c55e; font-weight: 700; }
    .live-dot { width: 7px; height: 7px; background: #22c55e; border-radius: 50%; animation: pulse 1.5s infinite; box-shadow: 0 0 8px #22c55e; }
    @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
    .date { font-size: 12px; color: #f3f4f6; font-weight: 600; }

    .watchlist { position: absolute; top: 80px; left: 16px; z-index: 10; background: rgba(10,10,15,0.95); backdrop-filter: blur(12px); padding: 14px; border-radius: 10px; border: 1px solid #1f2937; width: 200px; max-height: 320px; overflow-y: auto; }
    .watchlist::-webkit-scrollbar { width: 4px; }
    .watchlist::-webkit-scrollbar-thumb { background: #374151; border-radius: 2px; }
    .watchlist-title { font-size: 9px; color: #ef4444; font-weight: 700; letter-spacing: 1px; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .watchlist-title::before { content:''; width:6px; height:6px; background:#ef4444; border-radius:50%; animation: pulse 1s infinite; }
    .watchlist-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #1f293766; cursor: pointer; font-size: 10px; transition: all 0.15s; }
    .watchlist-item:hover { padding-left: 6px; background: #1f293733; }
    .wl-country { color: #e5e7eb; }
    .wl-risk { font-size: 8px; padding: 2px 5px; border-radius: 3px; font-weight: 600; text-transform: uppercase; }

    .legend { position: absolute; bottom: 16px; left: 16px; z-index: 10; background: rgba(10,10,15,0.95); backdrop-filter: blur(12px); padding: 12px 14px; border-radius: 10px; border: 1px solid #1f2937; }
    .legend-title { font-size: 9px; color: #9ca3af; font-weight: 600; letter-spacing: 1px; margin-bottom: 8px; }
    .legend-items { display: flex; flex-direction: column; gap: 4px; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 10px; color: #d1d5db; text-transform: uppercase; font-weight: 500; }
    .legend-icon { width: 10px; height: 10px; border-radius: 50%; }

    .globe-controls { position: absolute; bottom: 16px; right: 340px; z-index: 10; display: flex; gap: 8px; }
    .globe-toggle { background: rgba(10,10,15,0.95); backdrop-filter: blur(12px); padding: 8px 12px; border-radius: 8px; border: 1px solid #1f2937; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 9px; color: #9ca3af; font-weight: 600; letter-spacing: 0.5px; transition: all 0.2s; }
    .globe-toggle:hover { border-color: #374151; color: #e5e7eb; }
    .globe-toggle.active { border-color: #06b6d4; color: #06b6d4; }
    .toggle-icon { width: 14px; height: 14px; }

    .stats { position: absolute; bottom: 16px; left: 230px; z-index: 10; display: flex; gap: 8px; }
    .stat-card { background: rgba(10,10,15,0.95); backdrop-filter: blur(12px); padding: 10px 14px; border-radius: 10px; border: 1px solid #1f2937; text-align: center; min-width: 70px; cursor: pointer; transition: all 0.2s; }
    .stat-card:hover { border-color: #374151; transform: translateY(-2px); }

    .stat-popup { position: absolute; bottom: 80px; left: 230px; z-index: 25; background: rgba(10,10,15,0.98); backdrop-filter: blur(12px); padding: 16px; border-radius: 12px; border: 1px solid #1f2937; width: 300px; max-height: 350px; overflow-y: auto; display: none; }
    .stat-popup.active { display: block; }
    .stat-popup::-webkit-scrollbar { width: 4px; }
    .stat-popup::-webkit-scrollbar-thumb { background: #374151; border-radius: 2px; }
    .stat-popup-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #1f2937; }
    .stat-popup-title { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
    .stat-popup-close { background: none; border: none; color: #6b7280; cursor: pointer; font-size: 24px; padding: 8px; min-width: 44px; min-height: 44px; }
    .stat-popup-close:hover { color: #fff; }
    .stat-popup-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #1f293755; cursor: pointer; font-size: 10px; transition: all 0.15s; }
    .stat-popup-item:hover { padding-left: 6px; background: #1f293733; }
    .stat-value { font-size: 18px; font-weight: 700; }
    .stat-label { font-size: 7px; color: #6b7280; margin-top: 2px; letter-spacing: 0.5px; text-transform: uppercase; }

    .country-tooltip { position: fixed; z-index: 1000; background: rgba(10,10,15,0.98); backdrop-filter: blur(12px); padding: 10px 14px; border-radius: 8px; border: 1px solid #374151; pointer-events: none; display: none; max-width: 250px; }
    .tooltip-name { font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .tooltip-risk { font-size: 9px; padding: 2px 6px; border-radius: 3px; font-weight: 600; text-transform: uppercase; }
    .tooltip-hint { font-size: 9px; color: #6b7280; margin-top: 4px; }
    .tooltip-region { font-size: 9px; color: #9ca3af; margin-top: 2px; }

    .sidebar { width: 320px; background: #0a0a0d; border-left: 1px solid #1f2937; display: flex; flex-direction: column; }
    .tabs { display: flex; flex-wrap: wrap; border-bottom: 1px solid #1f2937; }
    .tab { flex: 1; min-width: 12%; padding: 10px 1px; font-size: 7px; font-weight: 600; background: none; border: none; color: #6b7280; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; letter-spacing: 0; text-transform: uppercase; }
    .tab:hover { color: #9ca3af; }
    .tab.active { color: #06b6d4; border-bottom-color: #06b6d4; }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 12px; }
    .sidebar-content::-webkit-scrollbar { width: 5px; }
    .sidebar-content::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }

    .card { background: #0d0d12; border: 1px solid #1f293755; border-radius: 8px; padding: 10px; margin-bottom: 6px; cursor: pointer; transition: all 0.15s; }
    .card:hover { border-color: #374151; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .card-cat { font-size: 8px; padding: 2px 5px; border-radius: 3px; font-weight: 600; text-transform: uppercase; }
    .card-cat.high { background: #7f1d1d; color: #fca5a5; }
    .card-cat.medium { background: #374151; color: #9ca3af; }
    /* Category color coding */
    .card-cat.CONFLICT { background: #7f1d1d; color: #fca5a5; }
    .card-cat.CRISIS { background: #9a3412; color: #fdba74; }
    .card-cat.SECURITY { background: #7c2d12; color: #fed7aa; }
    .card-cat.ECONOMY { background: #166534; color: #86efac; }
    .card-cat.POLITICS { background: #1e40af; color: #93c5fd; }
    .card-cat.DIPLOMACY { background: #5b21b6; color: #c4b5fd; }
    .card-cat.TECH { background: #0e7490; color: #67e8f9; }
    .card-cat.CLIMATE { background: #065f46; color: #6ee7b7; }
    .card-cat.WORLD { background: #374151; color: #d1d5db; }
    .card-time { font-size: 8px; color: #6b7280; }
    .card-headline { font-size: 10px; color: #e5e7eb; line-height: 1.4; }
    .card-source { font-size: 8px; color: #6b7280; margin-top: 4px; }
    .card-source a { color: #06b6d4; text-decoration: none; }

    .event-header { display: flex; align-items: center; gap: 6px; margin-bottom: 2px; }
    .event-dot { width: 6px; height: 6px; border-radius: 50%; }
    .event-country { font-size: 11px; font-weight: 600; color: #f3f4f6; }
    .event-risk { font-size: 8px; padding: 2px 5px; border-radius: 3px; margin-left: auto; font-weight: 600; text-transform: uppercase; }
    .event-title { font-size: 9px; color: #9ca3af; margin-left: 12px; }

    .forecast-card { background: linear-gradient(135deg, #0d1117 0%, #0f0f18 100%); border: 1px solid #1f293777; border-radius: 10px; padding: 14px; margin-bottom: 10px; }
    .forecast-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .forecast-icon { font-size: 24px; }
    .forecast-region { font-size: 11px; font-weight: 700; color: #e5e7eb; }
    .forecast-risk { font-size: 8px; padding: 2px 6px; border-radius: 4px; font-weight: 600; margin-left: auto; text-transform: uppercase; }
    .forecast-current { font-size: 10px; color: #9ca3af; line-height: 1.5; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #1f293755; }
    .forecast-prediction { background: #0a0a0f; border-radius: 6px; padding: 10px; border-left: 3px solid #f97316; }
    .forecast-prediction-title { font-size: 8px; color: #f97316; font-weight: 600; margin-bottom: 4px; letter-spacing: 1px; }
    .forecast-prediction-text { font-size: 10px; color: #d1d5db; line-height: 1.5; }
    .forecast-indicators { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
    .forecast-indicator { font-size: 8px; padding: 2px 6px; border-radius: 4px; background: #1f293755; color: #9ca3af; }
    .forecast-indicator.up { background: #7f1d1d33; color: #fca5a5; }
    .forecast-indicator.down { background: #14532d33; color: #86efac; }
    .forecast-indicator.stable { background: #1e3a5f33; color: #93c5fd; }

    .election-card { background: #0d0d14; border: 1px solid #1f293755; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; }
    .election-card:hover { border-color: #374151; }
    .election-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .election-flag { font-size: 18px; }
    .election-country { font-size: 12px; font-weight: 600; color: #e5e7eb; }
    .election-date { font-size: 9px; color: #06b6d4; margin-left: auto; font-weight: 600; }
    .election-type { font-size: 10px; color: #9ca3af; margin-bottom: 4px; }
    .election-stakes { font-size: 10px; color: #6b7280; line-height: 1.4; }

    .risk-catastrophic { background: #7f1d1d; color: #fca5a5; }
    .risk-extreme { background: #78350f; color: #fcd34d; }
    .risk-severe { background: #713f12; color: #fde047; }
    .risk-stormy { background: #5b21b6; color: #c4b5fd; }
    .risk-cloudy { background: #1e3a5f; color: #93c5fd; }
    .risk-clear { background: #14532d; color: #86efac; }

    /* Dynamic risk system styles */
    .risk-toast { position: fixed; bottom: 20px; right: 20px; background: #1f2937; border: 1px solid #374151; border-radius: 10px; padding: 12px 18px; z-index: 200; font-size: 11px; color: #e5e7eb; opacity: 0; transform: translateY(10px); transition: all 0.3s; pointer-events: none; max-width: 320px; }
    .risk-toast.active { opacity: 1; transform: translateY(0); }

    /* Sanctions section styles */
    .sanctions-section { margin-top: 16px; }
    .sanctions-toggle { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 10px 12px; background: #0d0d14; border: 1px solid #1f293755; border-radius: 8px; transition: background 0.15s; }
    .sanctions-toggle:hover { background: #111827; }
    .sanctions-toggle-left { display: flex; align-items: center; gap: 8px; }
    .sanctions-toggle-title { font-size: 10px; color: #06b6d4; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
    .sanctions-severity { font-size: 8px; padding: 2px 6px; border-radius: 3px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; }
    .sanctions-severity.heavy { background: #7f1d1d; color: #fca5a5; }
    .sanctions-severity.moderate { background: #78350f; color: #fcd34d; }
    .sanctions-severity.limited { background: #713f12; color: #fde047; }
    .sanctions-severity.none { background: #14532d; color: #86efac; }
    .sanctions-chevron { color: #6b7280; font-size: 12px; transition: transform 0.2s; }
    .sanctions-chevron.open { transform: rotate(180deg); }
    .sanctions-body { overflow: hidden; max-height: 0; transition: max-height 0.3s ease-out; }
    .sanctions-body.open { max-height: 2000px; transition: max-height 0.5s ease-in; }
    .sanctions-inner { padding: 10px 0 0; }
    .sanctions-group-title { font-size: 9px; color: #9ca3af; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin: 10px 0 6px; padding-left: 2px; }
    .sanctions-group-title:first-child { margin-top: 0; }
    .sanction-item { background: #0d0d14; border: 1px solid #1f293755; border-radius: 6px; padding: 8px 10px; margin-bottom: 6px; }
    .sanction-header { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
    .sanction-by { font-size: 10px; font-weight: 600; color: #e5e7eb; }
    .sanction-year { font-size: 9px; color: #6b7280; margin-left: auto; }
    .sanction-reason { font-size: 10px; color: #9ca3af; line-height: 1.4; }
    .sanctions-none { font-size: 10px; color: #6b7280; font-style: italic; padding: 6px 0; }

    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }
    .modal { background: #0a0a0f; border: 1px solid #1f2937; border-radius: 16px; width: 90%; max-width: 600px; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column; }
    .modal-header { padding: 20px; border-bottom: 1px solid #1f2937; display: flex; align-items: center; gap: 12px; }
    .modal-flag { font-size: 32px; }
    .modal-titles { flex: 1; }
    .modal-title { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .modal-risk { font-size: 10px; padding: 3px 8px; border-radius: 4px; font-weight: 600; }
    .modal-subtitle { font-size: 12px; color: #9ca3af; margin-top: 4px; }
    .modal-close { background: none; border: none; color: #6b7280; font-size: 28px; cursor: pointer; padding: 12px; min-width: 44px; min-height: 44px; }
    .modal-close:hover { color: #fff; }
    .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
    .modal-body::-webkit-scrollbar { width: 5px; }
    .modal-body::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }

    .section-title { font-size: 10px; color: #06b6d4; font-weight: 600; letter-spacing: 1px; margin: 16px 0 10px; text-transform: uppercase; }
    .section-title:first-child { margin-top: 0; }
    .facts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .fact { background: #0d0d14; padding: 10px; border-radius: 8px; border: 1px solid #1f293755; }
    .fact-label { font-size: 9px; color: #6b7280; margin-bottom: 4px; text-transform: uppercase; }
    .fact-value { font-size: 12px; color: #e5e7eb; font-weight: 600; }

    .analysis-block { background: #0d0d14; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #374151; }
    .analysis-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .analysis-num { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
    .analysis-num.n1 { background: #7f1d1d; color: #fca5a5; }
    .analysis-num.n2 { background: #1e3a5f; color: #93c5fd; }
    .analysis-num.n3 { background: #713f12; color: #fde047; }
    .analysis-title { font-size: 11px; font-weight: 600; color: #e5e7eb; }
    .analysis-text { font-size: 11px; color: #9ca3af; line-height: 1.6; }

    .news-item { background: #0d0d14; border-radius: 8px; padding: 10px; margin-bottom: 8px; border: 1px solid #1f293755; }
    .news-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .news-bias { width: 8px; height: 8px; border-radius: 50%; }
    .news-source { font-size: 10px; font-weight: 600; color: #e5e7eb; }
    .news-time { font-size: 9px; color: #6b7280; margin-left: auto; }
    .news-headline { font-size: 11px; color: #d1d5db; line-height: 1.5; }
    .news-link { font-size: 9px; color: #06b6d4; text-decoration: none; display: inline-block; margin-top: 6px; }

    /* Breaking News Banner */
    .breaking-banner { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: linear-gradient(90deg, #7f1d1d 0%, #991b1b 50%, #7f1d1d 100%); padding: 8px 20px; display: none; animation: bannerPulse 2s infinite; }
    .breaking-banner.active { display: flex; align-items: center; justify-content: center; gap: 12px; }
    body.banner-active .app { padding-top: 36px; }
    body.banner-active .header { top: 36px; }
    body.banner-active .watchlist { top: 116px; }
    .breaking-label { background: #fff; color: #7f1d1d; font-size: 9px; font-weight: 800; padding: 3px 8px; border-radius: 3px; letter-spacing: 1px; }
    .breaking-text { font-size: 12px; font-weight: 600; color: #fff; }
    .breaking-close { background: none; border: none; color: #fca5a5; cursor: pointer; font-size: 18px; margin-left: auto; }
    @keyframes bannerPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.9; } }

    /* Risk Trend Chart */
    .trend-chart { display: flex; align-items: flex-end; gap: 2px; height: 30px; margin-top: 8px; }
    .trend-bar { width: 4px; border-radius: 2px; transition: height 0.3s; }
    .trend-up { background: linear-gradient(to top, #ef4444, #fca5a5); }
    .trend-down { background: linear-gradient(to top, #22c55e, #86efac); }
    .trend-stable { background: linear-gradient(to top, #6b7280, #9ca3af); }
    .trend-label { font-size: 8px; color: #6b7280; margin-top: 4px; }

    /* Country News Section in Modal */
    .country-news-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid #1f2937; }
    .country-news-title { font-size: 10px; font-weight: 700; color: #06b6d4; letter-spacing: 1px; margin-bottom: 10px; }
    .country-news-loading { font-size: 11px; color: #6b7280; text-align: center; padding: 20px; }

    /* Newsletter Styles */
    .newsletter-header { background: linear-gradient(135deg, #0d1117 0%, #1a1a2e 100%); border: 1px solid #1f2937; border-radius: 12px; padding: 16px; margin-bottom: 14px; }
    .newsletter-title { font-size: 13px; font-weight: 700; color: #06b6d4; letter-spacing: 1px; margin-bottom: 4px; }
    .newsletter-meta { font-size: 9px; color: #6b7280; display: flex; align-items: center; gap: 12px; }
    .newsletter-status { display: flex; align-items: center; gap: 4px; }
    .newsletter-status.live { color: #22c55e; }
    .newsletter-status.pending { color: #f59e0b; }
    .newsletter-region { background: #0d0d14; border: 1px solid #1f293777; border-radius: 10px; padding: 14px; margin-bottom: 10px; }
    .newsletter-region-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #1f293755; }
    .newsletter-region-name { font-size: 11px; font-weight: 700; color: #e5e7eb; letter-spacing: 0.5px; }
    .newsletter-region-count { font-size: 9px; color: #6b7280; margin-left: auto; }
    .newsletter-summary { font-size: 10px; color: #9ca3af; line-height: 1.6; margin-bottom: 10px; }
    .newsletter-stories { display: flex; flex-direction: column; gap: 6px; }
    .newsletter-story { background: #0a0a0f; border-radius: 6px; padding: 8px 10px; border-left: 2px solid #374151; }
    .newsletter-story.high { border-left-color: #ef4444; }
    .newsletter-story.medium { border-left-color: #f97316; }
    .newsletter-story-headline { font-size: 10px; color: #d1d5db; line-height: 1.4; }
    .newsletter-story-meta { font-size: 8px; color: #6b7280; margin-top: 4px; display: flex; gap: 8px; }
    /* countdown styles removed â€” countdown is now inline in the header */

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .globe-container { height: 50vh; }
      .sidebar { width: 100%; height: 50vh; border-left: none; border-top: 1px solid #1f2937; }
      .header { right: 0; padding: 10px 12px; }
      .header-right { right: 12px; top: 12px; }
      .logo { font-size: 20px; }
      .logo-sub { font-size: 9px; }
      .watchlist { display: none; }
      .legend { bottom: auto; top: 70px; left: 10px; padding: 8px; }
      .legend-title { font-size: 7px; }
      .legend-item { font-size: 8px; }
      .globe-controls { right: auto; left: 10px; bottom: 70px; top: auto; }
      .globe-toggle { padding: 5px 8px; font-size: 7px; }
      .toggle-icon { width: 10px; height: 10px; }
      .toggle-text { display: none; }
      .stats { bottom: 10px; left: 10px; right: 10px; gap: 6px; }
      .stat-card { padding: 8px 10px; }
      .stat-value { font-size: 16px; }
      .stat-label { font-size: 6px; }
      .stat-popup { position: fixed; bottom: auto; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 320px; max-height: 60vh; }
      .tabs { flex-wrap: nowrap; overflow-x: auto; }
      .tab { min-width: auto; padding: 8px 10px; font-size: 7px; white-space: nowrap; }
      .modal { width: 95%; max-height: 85vh; margin: 10px; }
      .modal-header { padding: 12px; }
      .modal-title { font-size: 16px; }
      .modal-body { padding: 12px; }
      .breaking-banner { padding: 6px 10px; }
      .breaking-text { font-size: 10px; }
    }

    @media (max-width: 480px) {
      .header-right { right: 10px; top: 10px; gap: 10px; }
      .live { font-size: 9px; }
      .date { font-size: 10px; }
      .legend { display: none; }
      .globe-controls { left: 10px; bottom: 65px; }
      .globe-toggle { padding: 4px 6px; }
      .toggle-icon { width: 12px; height: 12px; }
      .globe-container { height: 45vh; }
      .sidebar { height: 55vh; }
    }
  </style>
</head>
<body>
<!-- Breaking News Banner -->
<div class="breaking-banner" id="breakingBanner">
  <span class="breaking-label">BREAKING</span>
  <span class="breaking-text" id="breakingText"></span>
  <button class="breaking-close" onclick="closeBanner()">&times;</button>
</div>

<div class="app">
  <div class="globe-container">
    <div id="globeLoader" style="position:absolute;top:0;left:0;width:100%;height:100%;background:#070710;display:flex;align-items:center;justify-content:center;z-index:10;transition:opacity 0.8s ease;">
      <div style="text-align:center;">
        <div style="width:40px;height:40px;border:3px solid #1f2937;border-top:3px solid #06b6d4;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px;"></div>
        <div style="font-size:10px;color:#6b7280;letter-spacing:1px;">LOADING GLOBE</div>
      </div>
    </div>
    <style>@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style>
    <div id="globe"></div>
    <div class="header">
      <div class="header-content">
        <div>
          <div class="logo">HEGEMON</div>
          <div class="logo-sub">GLOBAL INTELLIGENCE NETWORK</div>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="live"><div class="live-dot"></div>LIVE</div>
      <div class="date" id="currentDate"></div>
    </div>

    <div class="watchlist" id="watchlist"></div>

    <div class="legend">
      <div class="legend-title">RISK LEVELS</div>
      <div class="legend-items">
        <div class="legend-item"><div class="legend-icon" style="background:#dc2626"></div>Catastrophic</div>
        <div class="legend-item"><div class="legend-icon" style="background:#f97316"></div>Extreme</div>
        <div class="legend-item"><div class="legend-icon" style="background:#eab308"></div>Severe</div>
        <div class="legend-item"><div class="legend-icon" style="background:#8b5cf6"></div>Stormy</div>
        <div class="legend-item"><div class="legend-icon" style="background:#3b82f6"></div>Cloudy</div>
        <div class="legend-item"><div class="legend-icon" style="background:#22c55e"></div>Clear</div>
      </div>
    </div>

    <div class="globe-controls">
      <button class="globe-toggle active" id="rotateToggle" onclick="toggleRotation()">
        <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2v4m0 12v4M2 12h4m12 0h4m-5.66-5.66l-2.83 2.83m-5.66 5.66l-2.83 2.83m0-11.32l2.83 2.83m5.66 5.66l2.83 2.83"/>
        </svg>
        <span class="toggle-text">AUTO-ROTATE</span>
      </button>
    </div>

    <div class="stats">
      <div class="stat-card" onclick="showStatPopup('critical')"><div class="stat-value" style="color:#ef4444" id="statCritical">0</div><div class="stat-label">Critical</div></div>
      <div class="stat-card" onclick="showStatPopup('high')"><div class="stat-value" style="color:#f97316" id="statHigh">0</div><div class="stat-label">High Risk</div></div>
      <div class="stat-card" onclick="showStatPopup('stable')"><div class="stat-value" style="color:#22c55e" id="statStable">0</div><div class="stat-label">Stable</div></div>
      <div class="stat-card" onclick="showStatPopup('all')"><div class="stat-value" style="color:#06b6d4" id="statTotal">0</div><div class="stat-label">Countries</div></div>
    </div>

    <div class="stat-popup" id="statPopup">
      <div class="stat-popup-header">
        <span class="stat-popup-title" id="statPopupTitle">Countries</span>
        <button class="stat-popup-close" onclick="closeStatPopup()">&times;</button>
      </div>
      <div id="statPopupContent"></div>
    </div>
  </div>

  <div class="sidebar">
    <div class="tabs">
      <button class="tab active" data-tab="daily">Articles</button><button class="tab" data-tab="newsletter">Brief</button><button class="tab" data-tab="elections">Elections</button><button class="tab" data-tab="forecast">Forecast</button><button class="tab" data-tab="horizon">Horizon</button><button class="tab" data-tab="search">Search</button>
    </div>
    <div id="newsTimestamp" style="font-size:9px;color:#6b7280;padding:4px 16px;background:#0a0a0f;border-bottom:1px solid #1f2937;">Loading live news...</div>
    <div class="sidebar-content" id="sidebarContent"></div>
  </div>
</div>

<div class="country-tooltip" id="tooltip"></div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-flag" id="modalFlag"></span>
      <div class="modal-titles">
        <div class="modal-title"><span id="modalTitle"></span><span class="modal-risk" id="modalRisk"></span></div>
        <div class="modal-subtitle" id="modalSubtitle"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
// Risk colors
const RISK_COLORS = {
  catastrophic: { hex: '#dc2626', glow: 0xff3333 },
  extreme: { hex: '#f97316', glow: 0xff6600 },
  severe: { hex: '#eab308', glow: 0xffcc00 },
  stormy: { hex: '#8b5cf6', glow: 0x8855ff },
  cloudy: { hex: '#3b82f6', glow: 0x3388ff },
  clear: { hex: '#22c55e', glow: 0x22cc55 }
};

const BIAS_COLORS = { 'left': '#3b82f6', 'center-left': '#60a5fa', 'center': '#a3a3a3', 'center-right': '#f97316', 'right': '#ef4444' };

// COMPREHENSIVE COUNTRY DATABASE WITH FULL ANALYSIS AND NEWS
const COUNTRIES = {
  // ==================== CATASTROPHIC ====================
  'Ukraine': { lat: 48.38, lng: 31.17, flag: 'ðŸ‡ºðŸ‡¦', risk: 'catastrophic', region: 'Eastern Europe', pop: '37M', gdp: '$160B', leader: 'Volodymyr Zelenskyy', title: 'Active War Zone',
    analysis: {
      what: 'Russia launched a full-scale invasion in February 2022, marking the largest military conflict in Europe since World War II. The war has evolved into a grinding war of attrition, with both sides suffering hundreds of thousands of casualties. Ukraine has lost approximately 20% of its territory, including Crimea (annexed in 2014) and portions of the Donbas region. Western nations have provided over $200 billion in military and economic aid, including advanced weapons systems like HIMARS, Patriot missiles, and F-16 fighter jets. Critical infrastructure has been systematically targeted, causing widespread power outages and civilian displacement, with millions of Ukrainians becoming refugees across Europe.',
      why: 'This conflict has fundamentally reshaped European security architecture and revitalized NATO, prompting Finland and Sweden to join the alliance. Global energy markets were thrown into chaos as Europe scrambled to reduce dependence on Russian gas, accelerating the green energy transition. Food security became a global concern as Ukraineâ€”one of the world\'s largest grain exportersâ€”saw its agricultural output disrupted, affecting food prices in Africa and the Middle East. The outcome will define the international order for decades: whether territorial conquest through military force remains viable in the 21st century.',
      next: 'Multiple scenarios remain possible: a frozen conflict similar to Korea, with a ceasefire but no peace treaty; a negotiated settlement involving territorial compromises; continued attritional warfare lasting years; or potential escalation involving NATO directly. Key factors to watch include: Western political will, ammunition production capacity on both sides, Ukrainian mobilization challenges, and Russian economic resilience.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Heavy fighting reported along eastern front lines', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '3h ago', headline: 'Winter energy crisis tests Ukrainian resilience', url: '#' },
      { source: 'WSJ', bias: 'center-right', time: '6h ago', headline: 'Pentagon announces new $800M aid package', url: '#' },
      { source: 'AP', bias: 'center', time: '8h ago', headline: 'Zelenskyy addresses European Parliament', url: '#' }
    ]
  },

  'Russia': { lat: 61.52, lng: 105.32, flag: 'ðŸ‡·ðŸ‡º', risk: 'catastrophic', region: 'Eastern Europe', pop: '144M', gdp: '$1.78T', leader: 'Vladimir Putin', title: 'Active Aggressor',
    analysis: {
      what: 'Russia is conducting the largest military operation since World War II, deploying hundreds of thousands of troops in Ukraine. The country faces unprecedented Western sanctionsâ€”over 16,000 individual measuresâ€”targeting its financial system, energy exports, technology imports, and oligarch assets. Despite predictions of economic collapse, Russia has adapted through shadow fleet oil sales, trade rerouting via China and India, and massive military-industrial mobilization. Domestically, Putin has consolidated authoritarian control, crushing opposition (Navalny died in prison), suppressing independent media, and criminalizing anti-war speech. Military casualties are estimated at 300,000+ killed and wounded.',
      why: 'Russia possesses the world\'s largest nuclear arsenal and a permanent UN Security Council seat. The invasion has shattered the post-Cold War European security order. Russia\'s energy leverage over Europe reshaped global energy markets. The conflict has pushed Russia into deeper partnership with China, Iran, and North Korea, potentially forming a new axis challenging Western hegemony. Russian disinformation and election interference continue to destabilize democracies worldwide.',
      next: 'Russia appears committed to a long war, having shifted to a war economy with 40% of the budget dedicated to defense. Putin likely calculates that Western resolve will fade. Potential scenarios include: continued slow territorial gains; a negotiated settlement; domestic instability if casualties become unsustainable; or dangerous escalation including tactical nuclear threats.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Russian economy shows resilience despite sanctions', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Moscow increases military production targets for 2026', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '7h ago', headline: 'Ruble stabilizes as oil revenues recover', url: '#' }
    ]
  },

  'Gaza': { lat: 31.35, lng: 34.31, flag: 'ðŸ‡µðŸ‡¸', risk: 'catastrophic', region: 'Middle East', pop: '2.1M', gdp: '$1.7B', leader: 'Hamas', title: 'Humanitarian Crisis',
    analysis: {
      what: 'Following Hamas\'s October 7, 2023 attack on Israelâ€”which killed approximately 1,200 Israelis and took 250 hostagesâ€”Israel launched a massive military campaign in Gaza. The operation has resulted in catastrophic destruction, with over 35,000 Palestinians killed according to Gaza health authorities. Nearly 2 million people have been displaced, with most facing severe food insecurity. The UN has warned of famine conditions. Critical infrastructure including hospitals, schools, and water systems has been devastated. Hostage negotiations have produced limited exchanges but many captives remain in Gaza.',
      why: 'This conflict has the highest potential to ignite a wider regional war since the 1973 Yom Kippur War. Iran-backed Hezbollah has engaged in cross-border fighting with Israel, and Houthi rebels in Yemen have attacked Red Sea shipping, disrupting 12% of global trade. The humanitarian catastrophe has inflamed public opinion across the Muslim world and strained US relations with Arab allies. The long-term governance of Gaza remains unresolved.',
      next: 'Multiple trajectories are possible: expanded regional war if Israel strikes Iran or Hezbollah launches major attacks; a fragile ceasefire; prolonged low-intensity conflict; or international intervention for post-war governance. Key variables include hostage negotiations, Hezbollah\'s calculations, Iranian decision-making, and US policy.'
    },
    news: [
      { source: 'Al Jazeera', bias: 'left', time: '1h ago', headline: 'UN warns famine conditions spreading in northern Gaza', url: '#' },
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Ceasefire talks resume in Cairo with US mediation', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '5h ago', headline: 'Humanitarian aid deliveries remain severely restricted', url: '#' }
    ]
  },

  'Sudan': { lat: 12.86, lng: 30.22, flag: 'ðŸ‡¸ðŸ‡©', risk: 'catastrophic', region: 'Africa', pop: '46M', gdp: '$34B', leader: 'Disputed', title: 'Civil War',
    analysis: {
      what: 'Civil war erupted in April 2023 between the Sudanese Armed Forces (SAF) led by General al-Burhan and the paramilitary Rapid Support Forces (RSF) led by Hemedti. Fighting has devastated Khartoum and spread across the country, particularly in Darfur where ethnic violence has resurged. Over 15,000 people have been killed and 10+ million displacedâ€”the world\'s largest displacement crisis. Mass killings, sexual violence, and ethnic cleansing have been documented. Famine conditions are spreading with hospitals non-functional.',
      why: 'Sudan\'s collapse threatens to destabilize the entire Horn of Africa and Sahel region. The RSF has links to Wagner Group/Russia and receives UAE support, while SAF has Egyptian and Iranian backingâ€”making this a proxy battlefield. Sudan controls strategic Red Sea coastline and Nile water resources critical to Egypt. The humanitarian catastrophe rivals Yemen and Gaza in severity but receives far less attention.',
      next: 'Neither side appears capable of decisive military victory, suggesting prolonged conflict. The country may fragment into competing zones of control. Without sustained international pressure and humanitarian access, mass starvation is likely. Long-term scenarios include partition, failed state status, or exhaustion-driven negotiations.'
    },
    news: [
      { source: 'UN News', bias: 'center', time: '2h ago', headline: 'Famine officially declared in Darfur camps', url: '#' },
      { source: 'Reuters', bias: 'center', time: '4h ago', headline: 'RSF advances on key eastern city', url: '#' },
      { source: 'AP', bias: 'center', time: '8h ago', headline: 'Millions face starvation as aid blocked', url: '#' }
    ]
  },

  'Myanmar': { lat: 21.92, lng: 95.96, flag: 'ðŸ‡²ðŸ‡²', risk: 'catastrophic', region: 'Southeast Asia', pop: '54M', gdp: '$65B', leader: 'Military Junta', title: 'Civil Resistance War',
    analysis: {
      what: 'Since the February 2021 military coup that overthrew the elected government of Aung San Suu Kyi, Myanmar has descended into civil war. Armed resistance groupsâ€”including ethnic armies and newly formed People\'s Defense Forcesâ€”have gained significant territory against the junta. The military has lost control of large swathes of border regions. Over 2 million people are internally displaced. The junta has responded with airstrikes on civilians, village burnings, and mass executions. The economy has collapsed with widespread poverty.',
      why: 'Myanmar\'s instability creates refugee flows into Thailand, Bangladesh, and India. The country is a major corridor for drug trafficking (methamphetamine, heroin). China has significant economic interests and influence over ethnic armies. The conflict tests ASEAN\'s non-interference principle and regional stability. A junta collapse could create power vacuums exploited by various armed groups.',
      next: 'The junta is losing ground but unlikely to collapse quickly given Chinese support. Resistance forces are gaining but lack coordination for final victory. Watch for: territorial shifts, military defections, Chinese mediation attempts, and humanitarian access. A federal democratic transition remains the opposition\'s goal but faces enormous obstacles.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Resistance forces capture key border town', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '6h ago', headline: 'Military airstrikes kill dozens in Sagaing', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '9h ago', headline: 'Junta struggles to maintain territorial control', url: '#' }
    ]
  },

  'Yemen': { lat: 15.55, lng: 48.52, flag: 'ðŸ‡¾ðŸ‡ª', risk: 'catastrophic', region: 'Middle East', pop: '33M', gdp: '$21B', leader: 'Disputed', title: 'Ongoing Civil War',
    analysis: {
      what: 'Yemen\'s civil war began in 2014 when Houthi rebels seized the capital Sanaa. A Saudi-led coalition intervened in 2015 but failed to defeat the Houthis. The war has killed over 150,000 people and created the world\'s worst humanitarian crisis, with 21 million needing aid. Since October 2023, Houthis have attacked Red Sea shipping in solidarity with Gaza, using drones and missiles to strike commercial vessels. US and UK have conducted airstrikes on Houthi positions in response.',
      why: 'Houthi attacks have disrupted 12% of global trade passing through the Red Sea, forcing ships to reroute around Africa. This increases shipping costs and delivery times worldwide. Yemen is a proxy battleground between Iran (backing Houthis) and Saudi Arabia. The conflict destabilizes the Arabian Peninsula and threatens global energy infrastructure. Failure to resolve it perpetuates humanitarian suffering.',
      next: 'Saudi Arabia has sought de-escalation and China brokered Saudi-Iran talks, but Houthi attacks complicate peace efforts. Watch for: Red Sea shipping disruptions, US military responses, Saudi-Houthi negotiations, and humanitarian conditions. A comprehensive peace deal remains elusive as Houthis have strengthened their position.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Houthis claim missile strike on cargo ship in Red Sea', url: '#' },
      { source: 'AP', bias: 'center', time: '4h ago', headline: 'US conducts new airstrikes on Houthi positions', url: '#' },
      { source: 'Al Jazeera', bias: 'left', time: '7h ago', headline: 'UN warns of worsening famine conditions', url: '#' }
    ]
  },

  'Haiti': { lat: 18.97, lng: -72.29, flag: 'ðŸ‡­ðŸ‡¹', risk: 'catastrophic', region: 'Caribbean', pop: '11.6M', gdp: '$20B', leader: 'Transitional Council', title: 'Gang Violence Crisis',
    analysis: {
      what: 'Haiti has collapsed into gang rule following the 2021 assassination of President MoÃ¯se. Armed gangs now control 80% of Port-au-Prince, the capital. Gang violence has killed thousands and displaced over 700,000 people. The state has effectively ceased to functionâ€”hospitals are closed, schools shuttered, and police overwhelmed. A Kenya-led multinational security mission began deploying in 2024 but faces enormous challenges. A transitional council governs with little actual power.',
      why: 'Haiti\'s collapse creates migration pressure toward the US, Dominican Republic, and Caribbean nations. It demonstrates how quickly state failure can occur. The country is a transit point for drug trafficking. International intervention efforts have repeatedly failed, raising questions about effective responses to fragile states. Regional stability in the Caribbean is affected.',
      next: 'The Kenyan-led mission is under-resourced and faces well-armed gangs. Without dramatic intervention, gang consolidation will continue. Watch for: security mission effectiveness, gang coordination, migration flows, and humanitarian access. Long-term recovery requires dismantling gang networks and rebuilding institutions from scratchâ€”a generational project.'
    },
    news: [
      { source: 'AP', bias: 'center', time: '2h ago', headline: 'Gang violence surges despite international mission', url: '#' },
      { source: 'Reuters', bias: 'center', time: '5h ago', headline: 'Thousands flee Port-au-Prince as fighting intensifies', url: '#' },
      { source: 'Miami Herald', bias: 'center', time: '8h ago', headline: 'Kenya deploys additional troops to Haiti', url: '#' }
    ]
  },

  'Afghanistan': { lat: 33.94, lng: 67.71, flag: 'ðŸ‡¦ðŸ‡«', risk: 'extreme', region: 'Central Asia', pop: '41M', gdp: '$14B', leader: 'Taliban', title: 'Humanitarian Crisis',
    analysis: {
      what: 'The Taliban seized power in August 2021 as US forces withdrew after 20 years of war. The regime has imposed strict Islamic law, banning girls from secondary education and women from most employment. The economy has collapsed with international sanctions and frozen assets. Over 23 million people face acute hunger. ISIS-K conducts attacks against the Taliban and minorities. Resistance movements exist but pose no serious threat to Taliban control.',
      why: 'Afghanistan remains a potential terrorist safe havenâ€”Al-Qaeda leader Zawahiri was killed there in 2022. The humanitarian crisis creates refugee pressure on Pakistan and Iran. Women\'s rights rollback is the most severe in the world. Drug production (opium, methamphetamine) fuels regional trafficking. Neighboring countries face spillover instability.',
      next: 'Taliban rule appears consolidated despite international isolation. No recognition from major powers is likely given women\'s rights abuses. Watch for: humanitarian conditions, terrorist activity, refugee flows, and any internal Taliban splits. The population faces grinding poverty with no improvement in sight.'
    },
    news: [
      { source: 'UN News', bias: 'center', time: '3h ago', headline: 'Millions face starvation as winter approaches', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '6h ago', headline: 'Taliban expands restrictions on women', url: '#' },
      { source: 'Reuters', bias: 'center', time: '10h ago', headline: 'ISIS-K claims attack in Kabul province', url: '#' }
    ]
  },

  'DRC': { lat: -4.04, lng: 21.76, flag: 'ðŸ‡¨ðŸ‡©', risk: 'extreme', region: 'Africa', pop: '99M', gdp: '$65B', leader: 'FÃ©lix Tshisekedi', title: 'Eastern Conflict',
    analysis: {
      what: 'The eastern Democratic Republic of Congo has been engulfed in conflict for decades, but violence has escalated dramatically since 2022. The M23 rebel group, backed by Rwanda, has seized significant territory near Goma. Over 100 armed groups operate in the region. Nearly 7 million people are internally displacedâ€”more than any other country. Massacres, sexual violence, and child soldier recruitment are widespread. The Congolese army is ineffective despite UN peacekeeping presence.',
      why: 'DRC holds vast mineral wealth critical to global technologyâ€”cobalt for batteries, coltan for electronics, gold, and diamonds. Armed groups control many mining operations, fueling conflict. Rwanda\'s involvement creates regional tensions. The humanitarian crisis is among the world\'s worst but receives little attention. Instability affects all neighboring countries.',
      next: 'Regional diplomatic efforts have failed to stop fighting. Rwanda denies supporting M23 despite overwhelming evidence. Watch for: M23 advances, regional mediation attempts, UN mission changes, and humanitarian access. Without addressing Rwanda\'s role and governance failures, conflict will continue indefinitely.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'M23 rebels advance toward strategic city', url: '#' },
      { source: 'UN News', bias: 'center', time: '5h ago', headline: 'Displacement reaches record 7 million', url: '#' },
      { source: 'AP', bias: 'center', time: '9h ago', headline: 'UN peacekeepers ordered to withdraw', url: '#' }
    ]
  },

  'Somalia': { lat: 5.15, lng: 46.20, flag: 'ðŸ‡¸ðŸ‡´', risk: 'extreme', region: 'Africa', pop: '18M', gdp: '$8B', leader: 'Hassan Sheikh Mohamud', title: 'Al-Shabaab Threat',
    analysis: {
      what: 'Somalia has lacked effective central government since 1991. Al-Shabaab, an Al-Qaeda affiliate, controls large rural areas and conducts devastating attacks including car bombings in Mogadishu. President Hassan Sheikh Mohamud launched a major offensive against the group in 2022 with initial success, but Al-Shabaab has regrouped. Drought and famine have killed thousands. Clan politics complicate governance. The African Union mission is drawing down.',
      why: 'Al-Shabaab threatens regional stability, conducting attacks in Kenya and elsewhere. Somalia\'s coast is strategic for global shipping (Gulf of Aden). Failed state status makes it a potential terrorist haven. Climate change-induced drought creates humanitarian emergencies. Piracy, though reduced, can resurge.',
      next: 'The government offensive has stalled and Al-Shabaab remains potent. Watch for: AU troop withdrawal impacts, Al-Shabaab attacks, drought conditions, and clan reconciliation efforts. Building effective state institutions remains the fundamental challenge.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Al-Shabaab car bomb kills dozens in Mogadishu', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Drought displaces thousands more families', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '10h ago', headline: 'Government forces clash with militants in south', url: '#' }
    ]
  },

  // ==================== EXTREME ====================
  'Israel': { lat: 31.05, lng: 34.85, flag: 'ðŸ‡®ðŸ‡±', risk: 'extreme', region: 'Middle East', pop: '9.5M', gdp: '$525B', leader: 'Benjamin Netanyahu', title: 'Regional Conflict',
    analysis: {
      what: 'Israel is conducting its largest military operation since 1973 following Hamas\'s October 7, 2023 attack. Ground operations in Gaza have been extensive but costly. Hezbollah engages in daily cross-border fire in the north, displacing 80,000 Israelis. Netanyahu\'s coalition includes far-right ministers pushing controversial policies. Domestic protests over judicial reform paused during war but tensions remain. The economy has been strained by mobilizing 300,000 reservists.',
      why: 'Israel is the US\'s closest Middle East ally, receiving $3.8 billion annually in military aid. The conflict tests US diplomatic influence and its ability to balance Israeli security with humanitarian concerns. Regional escalation could draw in Iran and trigger oil price spikes. Israeli technology is globally integrated. The Palestinian question shapes Muslim world politics.',
      next: 'Post-war Gaza governance remains unresolved. Watch for: Hezbollah escalation, Iran confrontation, hostage negotiations, Netanyahu coalition stability, and US policy shifts. Long-term scenarios range from expanded regional war to an imposed peace framework.'
    },
    news: [
      { source: 'Times of Israel', bias: 'center-right', time: '1h ago', headline: 'IDF expands operations in central Gaza', url: '#' },
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Hezbollah exchanges fire intensify on northern border', url: '#' },
      { source: 'Haaretz', bias: 'center-left', time: '6h ago', headline: 'Protests resume over hostage deal delays', url: '#' }
    ]
  },

  'Taiwan': { lat: 23.70, lng: 120.96, flag: 'ðŸ‡¹ðŸ‡¼', risk: 'extreme', region: 'East Asia', pop: '24M', gdp: '$790B', leader: 'Lai Ching-te', title: 'Cross-Strait Tensions',
    analysis: {
      what: 'Cross-strait tensions have reached their highest level in decades. China has dramatically increased military activity around Taiwan with near-daily air defense zone incursions and naval exercises simulating blockade scenarios. President Lai Ching-te continues the DPP\'s pro-sovereignty stance. Taiwan has accelerated defense spending, extended conscription, and acquired advanced US weapons including F-16s and Harpoon missiles. TSMC manufactures over 90% of the world\'s most advanced semiconductors.',
      why: 'Taiwan represents the most dangerous potential flashpoint for great-power conflict. A Chinese invasion would likely trigger US intervention, risking war between nuclear powers. The global economy would face catastrophic disruptionâ€”semiconductor shortages would halt production of everything from smartphones to weapons. Japan, South Korea, and the Philippines would be directly affected. Taiwan represents an ideological contest: prosperous democracy versus CCP authoritarianism.',
      next: 'Full-scale invasion unlikely before 2027 as China builds capability. However, "gray zone" coercionâ€”blockades, cyber attacksâ€”could occur sooner. Watch for: Chinese military exercises, US arms sales, Japanese posture changes. The 2027-2030 window is considered particularly dangerous.'
    },
    news: [
      { source: 'Nikkei', bias: 'center', time: '2h ago', headline: 'China conducts largest Taiwan Strait exercises this year', url: '#' },
      { source: 'Reuters', bias: 'center', time: '4h ago', headline: 'Taiwan scrambles jets as PLA aircraft approach', url: '#' },
      { source: 'SCMP', bias: 'center-right', time: '8h ago', headline: 'Beijing warns against "Taiwan independence" moves', url: '#' }
    ]
  },

  'Iran': { lat: 32.43, lng: 53.69, flag: 'ðŸ‡®ðŸ‡·', risk: 'extreme', region: 'Middle East', pop: '87M', gdp: '$388B', leader: 'Ali Khamenei', title: 'Regional Proxy Conflicts',
    analysis: {
      what: 'Iran orchestrates a network of proxy forces: Hezbollah in Lebanon, Hamas in Gaza, Houthis in Yemen, and militias in Iraq and Syria. The nuclear program has advanced significantlyâ€”Iran enriches uranium to 60% purity with enough material for multiple bombs if further enriched. The JCPOA collapsed after US withdrawal in 2018. The regime brutally suppressed the "Woman, Life, Freedom" protests, killing hundreds. Supreme Leader Khamenei (85) faces succession questions.',
      why: 'Iran\'s nuclear threshold status could trigger regional proliferation (Saudi Arabia, Turkey, Egypt). Iranian proxies can strike Israel, disrupt Gulf shipping, and destabilize Arab governments. Houthi attacks have disrupted 12% of global trade. Iran\'s alliance with Russia (providing drones for Ukraine) and China challenges Western interests. The risk of direct Israel-Iran war has never been higher.',
      next: 'Nuclear breakout remains possible if Iran decides benefits outweigh costs. Watch for: IAEA reports, proxy escalation, oil smuggling enforcement, and succession maneuvering. Israel has conducted covert sabotage and may strike nuclear facilities if diplomacy fails.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'IAEA reports further uranium enrichment progress', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Iran-backed militias strike US base in Iraq', url: '#' },
      { source: 'FT', bias: 'center', time: '8h ago', headline: 'Tehran signals openness to nuclear talks', url: '#' }
    ]
  },

  'North Korea': { lat: 40.34, lng: 127.51, flag: 'ðŸ‡°ðŸ‡µ', risk: 'extreme', region: 'East Asia', pop: '26M', gdp: '$18B', leader: 'Kim Jong Un', title: 'Nuclear Threats',
    analysis: {
      what: 'North Korea has conducted record numbers of missile tests, including ICBMs theoretically capable of reaching the US mainland. The nuclear arsenal is estimated at 50+ warheads and growing. Kim Jong Un has declared South Korea a "hostile state" and abandoned reunification as a goal. Military cooperation with Russia has deepened, with North Korea providing ammunition for the Ukraine war in exchange for technology. The population faces chronic food insecurity under strict totalitarian control.',
      why: 'North Korea\'s nuclear weapons threaten South Korea, Japan, and potentially the US. Proliferation risk is highâ€”Pyongyang has sold missile technology to Iran and others. Military miscalculation could trigger catastrophic war on the Korean Peninsula. The regime\'s brutality makes it among the world\'s worst human rights situations. US troops and alliance commitments in the region are directly affected.',
      next: 'Denuclearization appears impossible given Kim\'s survival calculus. Watch for: weapons tests (especially nuclear), US-ROK exercises, Russia military cooperation, and any provocations. Crisis management rather than resolution is the realistic focus.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'North Korea fires ballistic missile toward Sea of Japan', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Kim Jong Un inspects new missile submarine', url: '#' },
      { source: 'Yonhap', bias: 'center', time: '9h ago', headline: 'Seoul condemns latest DPRK weapons test', url: '#' }
    ]
  },

  'Syria': { lat: 34.80, lng: 38.99, flag: 'ðŸ‡¸ðŸ‡¾', risk: 'extreme', region: 'Middle East', pop: '22M', gdp: '$9B', leader: 'Ahmad al-Sharaa', title: 'Post-Assad Transition',
    analysis: {
      what: 'Syria\'s civil war, which began in 2011, has largely frozen with Assad controlling about 70% of territory backed by Russia and Iran. The northeast remains under Kurdish-led SDF control with US military presence. Idlib province is held by rebel groups. The economy has collapsed under sanctions and war damage. Over half the pre-war population has been displaced. Israel regularly strikes Iranian targets in Syria. The country produces most of the world\'s captagon (amphetamines).',
      why: 'Syria hosts Russian and Iranian military bases, projecting their power into the Mediterranean and toward Israel. The refugee crisis reshaped European politics. Assad\'s survival demonstrates how authoritarian regimes can outlast international pressure. Drug trafficking destabilizes neighbors. Reconstruction would require massive investment no one will provide while Assad remains.',
      next: 'Frozen conflict is the likely indefinite state. Watch for: Israeli strikes on Iranian assets, US troop presence debates, Kurdish autonomy negotiations, and normalization efforts by Arab states. Meaningful reconstruction or refugee return appears impossible.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Israeli airstrikes target Iranian positions near Damascus', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'UN warns of worsening humanitarian conditions', url: '#' },
      { source: 'Al Jazeera', bias: 'left', time: '9h ago', headline: 'Earthquake recovery stalls amid sanctions', url: '#' }
    ]
  },

  'Lebanon': { lat: 33.85, lng: 35.86, flag: 'ðŸ‡±ðŸ‡§', risk: 'extreme', region: 'Middle East', pop: '5.5M', gdp: '$22B', leader: 'Joseph Aoun', title: 'State Collapse',
    analysis: {
      what: 'Lebanon has experienced economic collapse since 2019â€”the currency lost 98% of its value, banks froze deposits, and the middle class was wiped out. The Beirut port explosion in 2020 killed 200+ and destroyed large areas. Political paralysis left the country without a president for two years. Hezbollah, more powerful than the state, has engaged in cross-border fighting with Israel since October 2023, risking full-scale war. Essential services barely function.',
      why: 'Lebanon sits on the Israel-Hezbollah fault lineâ€”full war would be devastating for the region. Hezbollah possesses 150,000+ rockets that can hit any Israeli city. Lebanon\'s collapse creates refugee outflows and regional instability. It demonstrates the consequences of sectarian governance and corruption. The banking crisis has implications for regional finance.',
      next: 'Full Israel-Hezbollah war remains a serious risk depending on Gaza developments. Watch for: escalation triggers, ceasefire negotiations, economic deterioration, and political reform efforts. Recovery requires reforms that entrenched elites resist.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Hezbollah and Israel exchange heavy fire on border', url: '#' },
      { source: 'AP', bias: 'center', time: '4h ago', headline: 'New president faces daunting economic challenges', url: '#' },
      { source: 'FT', bias: 'center', time: '7h ago', headline: 'IMF deal stalls amid political deadlock', url: '#' }
    ]
  },

  'Mali': { lat: 17.57, lng: -4.00, flag: 'ðŸ‡²ðŸ‡±', risk: 'extreme', region: 'Africa', pop: '22M', gdp: '$19B', leader: 'Military Junta', title: 'Wagner/Jihadi Conflict',
    analysis: {
      what: 'Mali has been ruled by a military junta since 2020/2021 coups. French forces withdrew after a decade fighting jihadists, replaced by Russian Wagner Group mercenaries. Jihadi groups (linked to Al-Qaeda and ISIS) control vast northern territories. Wagner forces have been implicated in massacres of civilians. The junta has allied with Russia, expelled Western diplomats, and postponed elections indefinitely. Conflict has displaced millions.',
      why: 'Mali is the epicenter of Sahel instability spreading across West Africa. Wagner presence expands Russian influence in Africa. Jihadi expansion threatens coastal West African states. Migration flows toward Europe originate here. Gold mining finances armed groups. The French withdrawal marks a strategic shift in Africa.',
      next: 'The junta appears stable but faces jihadi resurgence. Watch for: territorial control changes, Wagner activities, refugee flows, and relations with neighbors. Without addressing governance and development, conflict will persist.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Jihadi attack kills dozens in central Mali', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'UN mission completes withdrawal from country', url: '#' },
      { source: 'France24', bias: 'center-left', time: '10h ago', headline: 'Wagner forces accused of civilian massacres', url: '#' }
    ]
  },

  'Burkina Faso': { lat: 12.24, lng: -1.56, flag: 'ðŸ‡§ðŸ‡«', risk: 'extreme', region: 'Africa', pop: '22M', gdp: '$19B', leader: 'Ibrahim TraorÃ©', title: 'Jihadi Violence',
    analysis: {
      what: 'Burkina Faso has suffered two coups since 2022 as the military seized power amid security failures. Captain Ibrahim TraorÃ©, the world\'s youngest head of state at 35, expelled French forces and turned to Russia. Jihadi groups now control roughly 40% of the territory. Over 2 million people are displaced. Massacres occur regularly in rural areas. The junta has conscripted volunteers for self-defense.',
      why: 'Burkina Faso\'s collapse accelerates the spread of Sahel instability toward coastal states like Ghana and CÃ´te d\'Ivoire. It demonstrates the limits of military responses to jihadi insurgency. Russian influence expands at French expense. Humanitarian crisis creates migration pressure. Gold mining areas are contested.',
      next: 'The junta faces a worsening security situation despite Russian support. Watch for: territorial losses to jihadists, humanitarian conditions, coup risk, and regional spillover. State collapse is a real possibility.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Jihadi fighters seize town in northern region', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Displacement crisis worsens amid fighting', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '9h ago', headline: 'Military government extends emergency rule', url: '#' }
    ]
  },

  'Niger': { lat: 17.61, lng: 8.08, flag: 'ðŸ‡³ðŸ‡ª', risk: 'extreme', region: 'Africa', pop: '26M', gdp: '$15B', leader: 'Military Junta', title: 'Coup Government',
    analysis: {
      what: 'A military coup in July 2023 overthrew Niger\'s elected president, ending the last democracy in the Sahel. The junta expelled French and US forces, aligned with Mali and Burkina Faso, and turned toward Russia. ECOWAS threatened intervention but backed down. Jihadi groups are expanding in the southeast. The population is among the world\'s poorest with severe food insecurity.',
      why: 'Niger was a key Western partner for counterterrorism in the Sahelâ€”its loss is a major strategic setback. US drone base and French forces repositioned. Russian influence expands in a uranium-rich country. The coup demonstrates fragility of democracy in the region. Regional instability affects migration routes to Europe.',
      next: 'The junta appears consolidated with regional support. Watch for: jihadi expansion, Russian military presence, humanitarian conditions, and ECOWAS relations. Return to civilian rule appears unlikely near-term.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Junta deepens ties with Russia and Iran', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'US completes military withdrawal', url: '#' },
      { source: 'France24', bias: 'center-left', time: '10h ago', headline: 'Jihadi attacks increase in southeast', url: '#' }
    ]
  },

  // ==================== SEVERE ====================
  'China': { lat: 35.86, lng: 104.20, flag: 'ðŸ‡¨ðŸ‡³', risk: 'severe', region: 'East Asia', pop: '1.4B', gdp: '$17.7T', leader: 'Xi Jinping', title: 'Economic Slowdown',
    analysis: {
      what: 'China faces its most serious economic challenges in decades. The property sectorâ€”30% of GDPâ€”is in crisis with major developers defaulting. Youth unemployment exceeded 20% before data publication stopped. Consumer confidence has collapsed. Deflation concerns have emerged. Local government debt is dangerous. Xi Jinping has consolidated unprecedented power while cracking down on tech giants and civil society. US-China tensions have intensified with semiconductor export controls.',
      why: 'As the world\'s second-largest economy and largest trading nation, China\'s slowdown ripples globally. A hard landing could trigger global recession. Geopolitically, China\'s tech ambitions and military modernization pose the primary strategic challenge to US hegemony. Taiwan remains the most dangerous flashpoint. China\'s support for Russia and growing influence in the Global South reshape the international order.',
      next: 'Expect gradual stimulus rather than a "bazooka" response. Property will drag for years. Watch for: social stability, consumption shifts, tech self-sufficiency, and Taiwan Strait activity. US-China tensions will remain contentious. Demographic decline poses long-term challenges.'
    },
    news: [
      { source: 'FT', bias: 'center', time: '1h ago', headline: 'Beijing announces largest stimulus package since 2008', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '3h ago', headline: 'Property sector woes deepen despite government support', url: '#' },
      { source: 'Reuters', bias: 'center', time: '6h ago', headline: 'US expands chip export restrictions to more Chinese firms', url: '#' },
      { source: 'WSJ', bias: 'center-right', time: '9h ago', headline: 'Consumer spending remains weak ahead of Lunar New Year', url: '#' }
    ]
  },

  'Venezuela': { lat: 6.42, lng: -66.59, flag: 'ðŸ‡»ðŸ‡ª', risk: 'extreme', region: 'South America', pop: '28M', gdp: '$92B', leader: 'Delcy RodrÃ­guez (Acting)', title: 'Post-Maduro Transition',
    analysis: {
      what: 'US forces captured Maduro in January 2026, removing him to face narco-terrorism charges in New York. Delcy RodrÃ­guez was sworn in as acting president. Military and police have pledged loyalty to the interim government. The situation remains volatile as Venezuela navigates an unprecedented political transition.',
      why: 'Venezuela has the world\'s largest proven oil reserves. The Maduro capture has created a power vacuum. Over 7 million Venezuelans have fled the country. US intervention has major implications for regional stability and great power competition.',
      next: 'Watch for: stability of RodrÃ­guez government, potential opposition return, US-Venezuela negotiations, and whether democratic transition occurs. Chavista loyalists may resist change.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Opposition leader calls for renewed protests', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Thousands more flee to Colombia amid crackdown', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '8h ago', headline: 'Oil production edges up despite sanctions', url: '#' }
    ]
  },

  'Pakistan': { lat: 30.38, lng: 69.35, flag: 'ðŸ‡µðŸ‡°', risk: 'severe', region: 'South Asia', pop: '231M', gdp: '$350B', leader: 'Shehbaz Sharif', title: 'Economic & Political Crisis',
    analysis: {
      what: 'Pakistan faces severe economic crisis with inflation above 30%, IMF bailouts, and depleted foreign reserves. Former PM Imran Khan was jailed on multiple charges his supporters call politically motivated. The military remains the ultimate power broker, engineering Khan\'s removal and subsequent elections. Terrorism has resurged with TTP attacks from Afghanistan. Climate disasters (2022 floods killed 1,700) add to challenges.',
      why: 'Pakistan is a nuclear-armed state of 230 millionâ€”instability has global implications. Taliban-controlled Afghanistan enables cross-border terrorism. Pakistan\'s relations with India remain tense. Its economic crisis affects regional trade. The military\'s political role undermines democratic consolidation.',
      next: 'IMF conditionality will impose painful reforms. Watch for: economic indicators, Khan\'s legal battles, military-civilian relations, and terrorism. Structural reform is needed but politically difficult.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'IMF approves next loan tranche after reforms', url: '#' },
      { source: 'Dawn', bias: 'center', time: '5h ago', headline: 'Imran Khan faces new charges in prison', url: '#' },
      { source: 'AP', bias: 'center', time: '8h ago', headline: 'Terrorist attack kills soldiers near Afghan border', url: '#' }
    ]
  },

  'Bangladesh': { lat: 23.68, lng: 90.36, flag: 'ðŸ‡§ðŸ‡©', risk: 'severe', region: 'South Asia', pop: '170M', gdp: '$460B', leader: 'Muhammad Yunus', title: 'Post-Revolution',
    analysis: {
      what: 'Mass student protests in 2024 toppled long-ruling PM Sheikh Hasina, who fled to India. Nobel laureate Muhammad Yunus leads an interim government tasked with reforms and new elections. The transition is fragile with political tensions high. The garment industry (80% of exports) faces pressure. Rohingya refugee camps host 1 million people. Relations with India are complicated.',
      why: 'Bangladesh is a garment manufacturing powerhouse supplying global brandsâ€”instability disrupts supply chains. It hosts the largest refugee camp in the world. Climate change threatens this low-lying nation of 170 million. Democratic transition success or failure will influence regional politics.',
      next: 'The interim government must navigate between political factions while reforming institutions. Watch for: election timeline, Hasina\'s influence from exile, economic stability, and India relations. Successful transition is uncertain.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Interim government announces reform roadmap', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '6h ago', headline: 'Garment workers protest over wages', url: '#' },
      { source: 'AP', bias: 'center', time: '9h ago', headline: 'Yunus meets international donors for support', url: '#' }
    ]
  },

  'Turkey': { lat: 38.96, lng: 35.24, flag: 'ðŸ‡¹ðŸ‡·', risk: 'severe', region: 'Middle East', pop: '85M', gdp: '$906B', leader: 'Recep ErdoÄŸan', title: 'Economic Crisis',
    analysis: {
      what: 'Turkey faces severe economic crisis with inflation exceeding 60%, currency collapse, and unorthodox monetary policy that deterred investment. ErdoÄŸan won 2023 elections despite the economy, consolidating power further. Relations with the West are strained over S-400 missiles, Syria policy, and NATO enlargement. Devastating earthquakes in 2023 killed 50,000+. Kurdish conflict continues.',
      why: 'Turkey controls the Bosphorus straits critical to Black Sea shipping. It\'s a NATO ally but often at odds with Western interests. Turkey hosts 4 million Syrian refugees affecting European migration. Its drone technology is globally significant. ErdoÄŸan\'s balancing between Russia and the West creates uncertainty.',
      next: 'Orthodox economic policy has begun with rate hikes but pain will continue. Watch for: inflation trajectory, ErdoÄŸan\'s health/succession, NATO relations, and Kurdish peace prospects. Structural reform is needed but ErdoÄŸan resists liberalization.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Central bank raises rates to combat inflation', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Lira stabilizes after policy shift', url: '#' },
      { source: 'AP', bias: 'center', time: '8h ago', headline: 'ErdoÄŸan meets Putin for talks on Ukraine grain deal', url: '#' }
    ]
  },

  'Egypt': { lat: 26.82, lng: 30.80, flag: 'ðŸ‡ªðŸ‡¬', risk: 'severe', region: 'North Africa', pop: '105M', gdp: '$387B', leader: 'Abdel Fattah el-Sisi', title: 'Economic Crisis',
    analysis: {
      what: 'Egypt faces severe foreign currency shortage, forcing multiple devaluations and IMF intervention. Inflation has hit 35%+. Sisi has built megaprojects (new capital city) while debt ballooned. The military controls much of the economy. Repression of dissent is severe with tens of thousands of political prisoners. Gaza conflict has strained relations with Israel while Egypt controls the Rafah crossing.',
      why: 'Egypt controls the Suez Canalâ€”12% of global trade. Its 105 million people make it the Arab world\'s most populous country. It\'s a key US ally receiving $1.3 billion in annual military aid. Stability matters for Libya, Sudan, and Gaza. Water disputes with Ethiopia over the Nile dam are serious.',
      next: 'UAE investment has provided relief but structural problems remain. Watch for: currency stability, IMF conditions, Gaza spillover, and Nile negotiations. Economic discontent poses medium-term risk to regime stability.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Egypt secures new IMF agreement amid crisis', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Suez Canal revenues drop due to Houthi attacks', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '8h ago', headline: 'UAE investment helps stabilize pound', url: '#' }
    ]
  },

  'Argentina': { lat: -38.42, lng: -63.62, flag: 'ðŸ‡¦ðŸ‡·', risk: 'severe', region: 'South America', pop: '46M', gdp: '$641B', leader: 'Javier Milei', title: 'Economic Crisis',
    analysis: {
      what: 'Argentina has suffered chronic economic crisis with inflation exceeding 200%â€”the world\'s highest. Libertarian President Javier Milei, elected in 2023, is implementing radical austerity: massive spending cuts, devaluation, and deregulation. Poverty has spiked to 50%+. Protests are frequent but Milei retains support among those desperate for change. IMF debt is being restructured.',
      why: 'Argentina is South America\'s second-largest economy with major agricultural exports. Milei\'s experiment tests whether shock therapy can break chronic inflation. His alignment with the US and Israel marks a regional shift. Lithium reserves make Argentina important for battery supply chains.',
      next: 'Milei faces the challenge of maintaining support through painful adjustment. Watch for: inflation trends, social unrest, congressional support, and investment flows. Success would validate radical reform; failure could bring backlash.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Milei announces new round of spending cuts', url: '#' },
      { source: 'FT', bias: 'center', time: '4h ago', headline: 'Inflation shows first signs of slowing', url: '#' },
      { source: 'AP', bias: 'center', time: '7h ago', headline: 'Thousands protest austerity measures in Buenos Aires', url: '#' }
    ]
  },

  'Nigeria': { lat: 9.08, lng: 8.68, flag: 'ðŸ‡³ðŸ‡¬', risk: 'severe', region: 'Africa', pop: '223M', gdp: '$477B', leader: 'Bola Tinubu', title: 'Security Crisis',
    analysis: {
      what: 'Nigeria faces multiple security crises: Boko Haram insurgency in the northeast, banditry in the northwest, separatist agitation in the southeast, and farmer-herder conflicts across the middle belt. President Tinubu removed fuel subsidies causing prices to triple, sparking hardship. The economy struggles with oil theft reducing production, high inflation, and unemployment. Kidnapping for ransom is endemic.',
      why: 'Nigeria is Africa\'s most populous country (223 million) and largest economy. It\'s a major oil producer though output has declined. Instability affects the entire West African region. The country is critical for regional peacekeeping. Diaspora remittances are globally significant.',
      next: 'Tinubu faces immense challenges with few resources. Watch for: security situation in each region, economic reforms, oil production recovery, and 2027 election positioning. Structural decline continues without major reforms.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Bandit attack kills dozens in northwest state', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Protests over rising fuel costs spread', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '8h ago', headline: 'Central bank raises rates to fight inflation', url: '#' }
    ]
  },

  'Ethiopia': { lat: 9.15, lng: 40.49, flag: 'ðŸ‡ªðŸ‡¹', risk: 'severe', region: 'Africa', pop: '126M', gdp: '$126B', leader: 'Abiy Ahmed', title: 'Post-War Tensions',
    analysis: {
      what: 'The 2020-2022 Tigray war killed an estimated 600,000 peopleâ€”one of the deadliest conflicts this century. A ceasefire holds but tensions remain with Eritrean troops still present. Ethnic conflicts continue in Amhara and Oromia regions. PM Abiy Ahmed, once a Nobel Peace laureate, is now accused of authoritarianism. The economy struggles with debt and inflation. A new Red Sea access deal with Somaliland has angered Somalia.',
      why: 'Ethiopia is Africa\'s second most populous country and a regional power. The Grand Ethiopian Renaissance Dam affects Egypt\'s water supply. Instability affects the entire Horn of Africa. It was a key US partner on counterterrorism. The country\'s trajectory matters for 126 million people.',
      next: 'Post-war reconciliation is incomplete and ethnic tensions persist. Watch for: Tigray integration, regional conflicts, dam negotiations, and economic reforms. Abiy faces the challenge of holding together a fractious federation.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Fighting continues in Amhara region', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Somalia protests Ethiopia port deal', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '9h ago', headline: 'Tigray reconstruction faces funding shortfall', url: '#' }
    ]
  },

  'Iraq': { lat: 33.22, lng: 43.68, flag: 'ðŸ‡®ðŸ‡¶', risk: 'severe', region: 'Middle East', pop: '44M', gdp: '$270B', leader: 'Mohammed al-Sudani', title: 'Fragile Stability',
    analysis: {
      what: 'Iraq has achieved relative stability after years of war against ISIS. But Iran-backed militias hold significant power, sometimes attacking US forces. PM al-Sudani governs through a coalition including these militias. Oil revenues provide budget but corruption is endemic. Kurdistan region tensions persist. Basic services remain inadequate. Political dysfunction continues with parliament often paralyzed.',
      why: 'Iraq is OPEC\'s second-largest producer and vital to global energy supply. It\'s a key arena for US-Iran competition. Stability affects Syria, Jordan, and the Gulf. ISIS could resurge if governance fails. Iranian influence challenges US interests.',
      next: 'The current stability is fragile and dependent on oil prices. Watch for: US-militia tensions, Kurdistan disputes, service delivery, and ISIS remnants. Without addressing corruption and governance, Iraq cannot achieve its potential.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Iran-backed militia attacks US base', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Oil revenues boost budget amid price rise', url: '#' },
      { source: 'Al Jazeera', bias: 'left', time: '8h ago', headline: 'Protests demand better services in Basra', url: '#' }
    ]
  },

  // Continue with more countries...
  'Libya': { lat: 26.34, lng: 17.23, flag: 'ðŸ‡±ðŸ‡¾', risk: 'severe', region: 'North Africa', pop: '7M', gdp: '$41B', leader: 'Divided', title: 'Civil Conflict',
    analysis: {
      what: 'Libya remains divided between rival governments in Tripoli (west) and Benghazi (east) since the 2011 overthrow of Gaddafi. Armed militias control territory across the country. Oil production fluctuates based on conflict. Turkey backs the western government while Russia, Egypt, and UAE support the east. Migration from sub-Saharan Africa flows through Libya toward Europe. Elections remain blocked.',
      why: 'Libya has Africa\'s largest proven oil reserves. It\'s the main departure point for Mediterranean migration to Europe. Russian Wagner forces operate in the east, expanding Moscow\'s African presence. Instability affects neighbors Tunisia, Egypt, and Niger.',
      next: 'Unification efforts have repeatedly failed. Watch for: oil production disruptions, election attempts, foreign interference, and migration flows. Partition is increasingly the de facto reality.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Oil production halted amid militia clashes', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'UN envoy pushes for delayed elections', url: '#' }
    ]
  },

  'Algeria': { lat: 28.03, lng: 1.66, flag: 'ðŸ‡©ðŸ‡¿', risk: 'stormy', region: 'North Africa', pop: '45M', gdp: '$190B', leader: 'Abdelmadjid Tebboune', title: 'Post-Bouteflika Era',
    analysis: {
      what: 'Algeria is Africa\'s largest country by area. The 2019 Hirak protests forced out longtime leader Bouteflika, but the military-backed system remains. President Tebboune governs with limited reform. Press freedom is restricted and opposition activists face prosecution. The economy depends heavily on oil and gas exports to Europe.',
      why: 'Algeria is a major gas supplier to Europe, gaining leverage after Russia\'s invasion of Ukraine. It has tense relations with Morocco over Western Sahara. The country is a key player in Sahel security. Youth unemployment and housing shortages fuel discontent.',
      next: 'Watch for: energy deals with Europe, Western Sahara tensions with Morocco, and whether political space opens or further restricts.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '4h ago', headline: 'Gas exports to Europe increase amid energy crunch', url: '#' },
      { source: 'Al Jazeera', bias: 'center-left', time: '8h ago', headline: 'Opposition figures call for political reforms', url: '#' }
    ]
  },

  'Tunisia': { lat: 33.89, lng: 9.54, flag: 'ðŸ‡¹ðŸ‡³', risk: 'severe', region: 'North Africa', pop: '12M', gdp: '$47B', leader: 'Kais Saied', title: 'Democratic Backsliding',
    analysis: {
      what: 'President Kais Saied has dismantled Tunisia\'s democracyâ€”the only success of the Arab Springâ€”by suspending parliament, rewriting the constitution, and jailing opponents. The economy is in crisis requiring IMF intervention. Migration to Europe has surged. Critics and journalists face prosecution. The opposition is fragmented and suppressed.',
      why: 'Tunisia\'s democratic collapse is a cautionary tale for the region. Migration pressure affects Europe. Economic failure creates instability near Libya. The country was seen as proof that Arab democracy was possible.',
      next: 'Saied appears secure despite economic failure. Watch for: IMF negotiations, repression levels, migration flows, and any protest emergence. Democratic reversal appears unlikely near-term.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'IMF talks stall over subsidy reforms', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Opposition figures arrested in crackdown', url: '#' }
    ]
  },

  'Ecuador': { lat: -1.83, lng: -78.18, flag: 'ðŸ‡ªðŸ‡¨', risk: 'severe', region: 'South America', pop: '18M', gdp: '$107B', leader: 'Daniel Noboa', title: 'Gang Violence Surge',
    analysis: {
      what: 'Ecuador has experienced explosive gang violence, transforming from one of Latin America\'s safest countries to among its most dangerous. Drug trafficking organizations have taken over prisons and cities. The murder rate has quadrupled since 2018. Young President Daniel Noboa declared a state of emergency and deployed the military. A TV station was stormed live on air by gunmen.',
      why: 'Ecuador\'s collapse shows how quickly drug trafficking can destabilize a country. It\'s now a major cocaine transit point between Colombia and the US/Europe. Regional crime networks are interconnected. Tourism has collapsed.',
      next: 'Noboa faces gangs that may be more powerful than the state. Watch for: violence levels, military effectiveness, prison control, and whether cartels can be pushed back. The country\'s future hangs in the balance.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Gang attacks continue despite military deployment', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Noboa extends state of emergency', url: '#' }
    ]
  },

  'Georgia': { lat: 42.32, lng: 43.36, flag: 'ðŸ‡¬ðŸ‡ª', risk: 'severe', region: 'Caucasus', pop: '3.7M', gdp: '$25B', leader: 'Salome Zourabichvili', title: 'Pro-Russia Turn',
    analysis: {
      what: 'Georgia\'s ruling Georgian Dream party has shifted toward Russia, passing a "foreign agents" law modeled on Russian legislation and cracking down on protests. The EU froze Georgia\'s membership candidacy. Mass protests erupted but were suppressed. President Zourabichvili opposes the government but has limited power. The 2024 elections were disputed.',
      why: 'Georgia was a pro-Western success story in the post-Soviet spaceâ€”its reversal is significant. It borders Russia, which occupies 20% of its territory. The shift affects the South Caucasus corridor between Europe and Asia.',
      next: 'The government appears committed to its pro-Russia turn despite public opposition. Watch for: protest dynamics, EU relations, Russian influence, and any political change. Democratic backsliding continues.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'EU freezes Georgia membership talks', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Opposition protests continue in Tbilisi', url: '#' }
    ]
  },

  'Armenia': { lat: 40.07, lng: 45.04, flag: 'ðŸ‡¦ðŸ‡²', risk: 'severe', region: 'Caucasus', pop: '2.8M', gdp: '$20B', leader: 'Nikol Pashinyan', title: 'Post-Karabakh Crisis',
    analysis: {
      what: 'Armenia suffered a devastating defeat in the 2020 Nagorno-Karabakh war and lost the territory entirely in 2023 when Azerbaijan seized it, forcing 100,000 Armenians to flee. PM Pashinyan faces anger over the losses. Relations with Russia have soured as Moscow failed to protect Armenia. The country is pivoting toward the West. Azerbaijan may push for further concessions.',
      why: 'The Karabakh outcome shows the limits of Russian security guaranteesâ€”significant for other post-Soviet states. Armenia\'s Western pivot could reshape South Caucasus geopolitics. The humanitarian crisis of displaced Karabakh Armenians is ongoing.',
      next: 'Armenia faces an emboldened Azerbaijan and uncertain Russian support. Watch for: border negotiations, peace treaty prospects, domestic politics, and Western integration. The country is in strategic transition.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Armenia-Azerbaijan peace talks resume', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Karabakh refugees struggle to rebuild', url: '#' }
    ]
  },

  'Belarus': { lat: 53.71, lng: 27.95, flag: 'ðŸ‡§ðŸ‡¾', risk: 'severe', region: 'Eastern Europe', pop: '9M', gdp: '$73B', leader: 'Lukashenko', title: 'Russian Ally',
    analysis: {
      what: 'Alexander Lukashenko brutally suppressed 2020 protests against his disputed election, remaining in power with Russian support. Belarus has become a Russian military platform, hosting troops and allowing invasion of Ukraine from its territory. Western sanctions are severe. Opposition leaders are jailed or exiled. The economy is propped up by Russian subsidies.',
      why: 'Belarus is effectively a Russian satellite state on NATO\'s border. It hosts Russian nuclear weapons. The country\'s airspace and territory are used against Ukraine. Opposition to Lukashenko represents potential future instability.',
      next: 'Lukashenko appears secure as long as Russia supports him. Watch for: his health (age 70), succession planning, Russian demands, and Ã©migrÃ© opposition activities. True independence seems impossible while Russia is strong.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Belarus extends military cooperation with Russia', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Opposition leader sentenced to 18 years', url: '#' }
    ]
  },

  'Moldova': { lat: 47.41, lng: 28.37, flag: 'ðŸ‡²ðŸ‡©', risk: 'severe', region: 'Eastern Europe', pop: '2.6M', gdp: '$15B', leader: 'Maia Sandu', title: 'Russia Pressure',
    analysis: {
      what: 'Pro-European President Maia Sandu faces Russian destabilization efforts including: support for separatist Transnistria, energy blackmail, disinformation campaigns, and alleged coup plots. Moldova gained EU candidate status but faces challenges implementing reforms. The Transnistria region hosts Russian troops. Economic dependence on remittances makes the country vulnerable.',
      why: 'Moldova is a frontline state in the Russia-West confrontation, sandwiched between Ukraine and NATO member Romania. Its EU integration would be a strategic defeat for Moscow. Russian troops in Transnistria are 50km from Odesa.',
      next: 'Sandu won reelection despite Russian interference but faces continued pressure. Watch for: EU integration progress, Transnistria negotiations, Russian hybrid attacks, and energy security. The country\'s Western path is contested.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Moldova accuses Russia of election interference', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'EU approves next step in membership talks', url: '#' }
    ]
  },

  'Cuba': { lat: 21.52, lng: -77.78, flag: 'ðŸ‡¨ðŸ‡º', risk: 'severe', region: 'Caribbean', pop: '11M', gdp: '$107B', leader: 'DÃ­az-Canel', title: 'Economic Crisis',
    analysis: {
      what: 'Cuba faces its worst economic crisis since the 1990s "Special Period." Food and medicine shortages are severe. Power blackouts are frequent. Inflation has surged. Mass protests in 2021 were suppressed with hundreds jailed. Migration to the US has surged to record levels. The government blames US sanctions while critics cite mismanagement.',
      why: 'Cuba\'s crisis drives record migration to the US, a major political issue. The country\'s trajectory affects Latin American left politics. US-Cuba relations remain frozen. The island\'s location gives it strategic significance.',
      next: 'The regime appears stable despite the crisis, but emigration provides a safety valve. Watch for: economic conditions, migration flows, any political opening, and US policy changes. Significant reform seems unlikely under current leadership.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Power grid collapses again leaving millions without electricity', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Record number of Cubans reach US border', url: '#' }
    ]
  },

  'Nicaragua': { lat: 12.87, lng: -85.21, flag: 'ðŸ‡³ðŸ‡®', risk: 'severe', region: 'Central America', pop: '7M', gdp: '$15B', leader: 'Daniel Ortega', title: 'Authoritarian Rule',
    analysis: {
      what: 'Daniel Ortega has transformed Nicaragua into a family dictatorship. Opposition leaders have been jailed or exiled. NGOs and media have been shut down. The Catholic Church is persecuted with bishops imprisoned. Elections are shams. The country has aligned with Russia, China, and Iran. Thousands have fled.',
      why: 'Nicaragua\'s authoritarian consolidation is complete, joining Cuba and Venezuela as regional dictatorships. Its alignment with US adversaries is concerning. Migration affects Central American stability. Democratic norms in the region are weakened.',
      next: 'Ortega faces no serious internal challenge. Watch for: succession planning (his wife is VP), relations with adversaries, migration trends, and regional responses. The dictatorship appears durable.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Ortega expels more NGOs from country', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Catholic bishop sentenced to 26 years', url: '#' }
    ]
  },

  // STORMY COUNTRIES
  'United States': { lat: 37.09, lng: -95.71, flag: 'ðŸ‡ºðŸ‡¸', risk: 'stormy', region: 'North America', pop: '335M', gdp: '$25.5T', leader: 'Donald Trump', title: 'Political Polarization',
    analysis: {
      what: 'America remains deeply polarized, with partisan divisions affecting nearly every aspect of governance. The economy has shown resilienceâ€”avoiding recession, with low unemployment and cooling inflationâ€”but high interest rates and housing costs strain households. Immigration has surged at the southern border. Foreign policy is stretched across multiple crises: supporting Ukraine, navigating Middle East turmoil, competing with China. Congress remains gridlocked with narrow margins.',
      why: 'As the world\'s largest economy (25% of global GDP), dominant military power, and linchpin of the Western alliance, American decisions reverberate globally. US commitment to Ukraine is essential for European security. The US-China relationship will shape the 21st-century order. Dollar hegemony underpins the global financial system.',
      next: 'The 2026 midterm elections will determine Congressional control and set the trajectory for 2028. Key issues include economy, immigration, and foreign policy. Watch for: Ukraine aid commitment, China policy, government shutdowns, and Supreme Court decisions.'
    },
    news: [
      { source: 'AP', bias: 'center', time: '1h ago', headline: 'Congress debates border security package', url: '#' },
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Fed signals steady rates through spring', url: '#' },
      { source: 'WSJ', bias: 'center-right', time: '5h ago', headline: 'Economy adds 200,000 jobs in latest report', url: '#' },
      { source: 'NYT', bias: 'center-left', time: '7h ago', headline: 'Immigration debate dominates Capitol Hill', url: '#' }
    ]
  },

  'France': { lat: 46.23, lng: 2.21, flag: 'ðŸ‡«ðŸ‡·', risk: 'stormy', region: 'Western Europe', pop: '68M', gdp: '$2.8T', leader: 'Emmanuel Macron', title: 'Political Fragmentation',
    analysis: {
      what: 'France faces political fragmentation with Macron\'s centrist coalition weakened and both the far-right (Le Pen) and far-left (MÃ©lenchon) gaining ground. Snap elections in 2024 produced a hung parliament. Pension reform protests showed deep social discontent. The economy struggles with high debt and sluggish growth. Immigration and security remain divisive issues.',
      why: 'France is the EU\'s second-largest economy and a nuclear power with global reach. French politics shape EU direction. Macron has pushed European strategic autonomy. Far-right gains would significantly impact EU and NATO.',
      next: 'Macron is a lame duck until 2027 elections. Watch for: coalition stability, Le Pen\'s positioning, economic reforms, and EU leadership role. Political uncertainty will persist.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Government survives no-confidence vote', url: '#' },
      { source: 'Le Monde', bias: 'center-left', time: '5h ago', headline: 'Budget negotiations stall in parliament', url: '#' },
      { source: 'FT', bias: 'center', time: '8h ago', headline: 'France faces EU pressure over deficit', url: '#' }
    ]
  },

  'Germany': { lat: 51.17, lng: 10.45, flag: 'ðŸ‡©ðŸ‡ª', risk: 'stormy', region: 'Western Europe', pop: '84M', gdp: '$4.2T', leader: 'Olaf Scholz', title: 'Economic Transition',
    analysis: {
      what: 'Germany faces structural economic challenges as its industrial modelâ€”based on cheap Russian energy and exports to Chinaâ€”unravels. The economy has stagnated. Energy transition costs are high. The coalition government is fractious. The far-right AfD has surged to second place in polls. Immigration remains divisive.',
      why: 'Germany is Europe\'s largest economy and the EU\'s de facto leader. German industry is central to European supply chains. Its energy transition affects climate goals. Political shifts here reshape the entire EU.',
      next: 'Elections in 2025 will likely bring political change. Watch for: economic indicators, AfD\'s trajectory, coalition dynamics, and EU positioning. Germany is at an inflection point.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Industrial output falls for third straight month', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Coalition tensions rise over budget', url: '#' },
      { source: 'DW', bias: 'center', time: '8h ago', headline: 'AfD leads polls in eastern states', url: '#' }
    ]
  },

  'Brazil': { lat: -14.24, lng: -51.93, flag: 'ðŸ‡§ðŸ‡·', risk: 'stormy', region: 'South America', pop: '215M', gdp: '$1.9T', leader: 'Lula da Silva', title: 'Amazon & Politics',
    analysis: {
      what: 'President Lula returned to power in 2023 after defeating Bolsonaro, whose supporters stormed government buildings. Amazon deforestation has declined under Lula\'s policies. The economy is growing moderately with inflation controlled. But political polarization remains intense and Bolsonaro retains significant support despite legal troubles.',
      why: 'Brazil is the world\'s largest rainforest nationâ€”its Amazon policies affect global climate. It\'s Latin America\'s largest economy. Lula has sought to rebuild Brazil\'s global diplomatic role. Political stability here affects the entire region.',
      next: 'Lula faces challenges balancing environmental goals with development. Watch for: Amazon policy, economic performance, Bolsonaro\'s legal fate, and 2026 election positioning. Polarization will persist.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Amazon deforestation hits five-year low', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Bolsonaro charged in coup investigation', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '8h ago', headline: 'Central bank signals rate cuts ahead', url: '#' }
    ]
  },

  'Mexico': { lat: 23.63, lng: -102.55, flag: 'ðŸ‡²ðŸ‡½', risk: 'stormy', region: 'North America', pop: '130M', gdp: '$1.3T', leader: 'Claudia Sheinbaum', title: 'Cartel Violence',
    analysis: {
      what: 'Mexico faces entrenched cartel violence with over 30,000 homicides annually. President Sheinbaum, the first female president, continues her predecessor\'s "hugs not bullets" approach despite criticism. Fentanyl trafficking to the US dominates bilateral relations. Nearshoring is boosting manufacturing as companies leave China. Democratic institutions face pressure.',
      why: 'Mexico is the US\'s largest trading partner and shares a 2,000-mile border. Migration and drug trafficking are central to US politics. Nearshoring makes Mexico increasingly important to supply chains. Instability would directly affect the US.',
      next: 'Sheinbaum must address security while maintaining economic growth. Watch for: cartel violence, US relations, nearshoring investment, and judicial reforms. The relationship with the US will remain complex.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Cartel violence surges in Sinaloa state', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'US presses Mexico on fentanyl trafficking', url: '#' },
      { source: 'WSJ', bias: 'center-right', time: '8h ago', headline: 'Manufacturers flock to Mexico amid nearshoring boom', url: '#' }
    ]
  },

  'India': { lat: 20.59, lng: 78.96, flag: 'ðŸ‡®ðŸ‡³', risk: 'stormy', region: 'South Asia', pop: '1.4B', gdp: '$3.4T', leader: 'Narendra Modi', title: 'Rising Power',
    analysis: {
      what: 'India is the world\'s fastest-growing major economy and most populous country. PM Modi won a third term but with reduced majority, requiring coalition partners. Hindu nationalism has risen, with concerns about Muslim minority treatment. Relations with China remain tense after border clashes. India is courted by both the US and Russia.',
      why: 'India is a crucial swing state in great power competitionâ€”both the US and China seek its partnership. Its massive market and young population offer economic potential. It\'s a nuclear power and major military force. Indian diaspora is globally influential.',
      next: 'Modi must balance growth with inclusion while navigating between great powers. Watch for: economic reforms, religious tensions, China border, and strategic alignments. India\'s trajectory will shape this century.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'India GDP growth exceeds expectations', url: '#' },
      { source: 'AP', bias: 'center', time: '4h ago', headline: 'Modi meets with US officials on defense ties', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '7h ago', headline: 'Religious tensions flare in multiple states', url: '#' }
    ]
  },

  'South Korea': { lat: 35.91, lng: 127.77, flag: 'ðŸ‡°ðŸ‡·', risk: 'stormy', region: 'East Asia', pop: '52M', gdp: '$1.7T', leader: 'Yoon Suk Yeol', title: 'Political Crisis',
    analysis: {
      what: 'President Yoon Suk Yeol shocked the nation by declaring martial law in December 2024, quickly reversed after parliamentary opposition. He faces impeachment proceedings. Political polarization is intense. Relations with Japan have improved but North Korean threats persist. The economy faces headwinds from China slowdown affecting exports.',
      why: 'South Korea is a major economy, technological powerhouse (Samsung, semiconductors), and crucial US ally. It hosts 28,000 US troops facing North Korea. Political instability affects regional security. Korean pop culture has global reach.',
      next: 'Yoon\'s political survival is uncertain. Watch for: impeachment proceedings, early elections, North Korea policy, and US alliance management. A political transition may occur.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Impeachment vote scheduled amid protests', url: '#' },
      { source: 'Yonhap', bias: 'center', time: '4h ago', headline: 'Constitutional court weighs martial law legality', url: '#' },
      { source: 'AP', bias: 'center', time: '7h ago', headline: 'Mass demonstrations continue nationwide', url: '#' }
    ]
  },

  // More STORMY countries
  'Saudi Arabia': { lat: 23.89, lng: 45.08, flag: 'ðŸ‡¸ðŸ‡¦', risk: 'stormy', region: 'Middle East', pop: '36M', gdp: '$1.1T', leader: 'MBS', title: 'Vision 2030',
    analysis: {
      what: 'Crown Prince Mohammed bin Salman (MBS) is rapidly transforming Saudi Arabia through Vision 2030â€”diversifying away from oil dependence. Megaprojects like NEOM ($500B futuristic city), sports investments (LIV Golf, Newcastle FC), and entertainment liberalization mark dramatic changes. But the murder of journalist Khashoggi, Yemen war involvement, and suppression of dissent continue. Oil production decisions heavily influence global energy markets.',
      why: 'Saudi Arabia is the world\'s swing oil producer, able to influence global prices. It controls Islam\'s holiest sites. MBS\'s regional policiesâ€”Yemen war, Qatar blockade (now ended), Abraham Accords negotiationsâ€”reshape the Middle East. The kingdom\'s sovereign wealth fund is one of the world\'s largest, acquiring global assets.',
      next: 'Vision 2030\'s success is uncertain given oil price volatility and ambitious spending. Watch for: oil production decisions, normalization with Israel (paused after Gaza), succession dynamics, and social reform pace. The transformation is real but faces significant headwinds.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'OPEC+ maintains production cuts amid demand concerns', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'NEOM faces delays and cost overruns', url: '#' }
    ]
  },

  'South Africa': { lat: -30.56, lng: 22.94, flag: 'ðŸ‡¿ðŸ‡¦', risk: 'stormy', region: 'Africa', pop: '60M', gdp: '$399B', leader: 'Ramaphosa', title: 'Coalition Government',
    analysis: {
      what: 'The ANC lost its majority for the first time since 1994, forced into coalition with the DA and others. President Ramaphosa continues but with weakened mandate. The economy struggles with load shedding (power cuts), high unemployment (32%), and infrastructure decay. Crime is severe. Corruption scandals have eroded trust.',
      why: 'South Africa is Africa\'s most industrialized economy and a regional anchor. Its trajectory affects the entire southern African region. The country\'s stance on Russia and Palestine puts it at odds with Western allies. Its financial markets are Africa\'s most developed.',
      next: 'The coalition government faces the challenge of reform while maintaining stability. Watch for: power crisis resolution, economic reforms, corruption prosecutions, and coalition dynamics. The country is at an inflection point.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Load shedding eases as new power plants come online', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Coalition tensions flare over cabinet posts', url: '#' }
    ]
  },

  'Kenya': { lat: -0.02, lng: 37.91, flag: 'ðŸ‡°ðŸ‡ª', risk: 'stormy', region: 'Africa', pop: '54M', gdp: '$113B', leader: 'William Ruto', title: 'Protests & Debt',
    analysis: {
      what: 'Mass youth-led protests in 2024 forced President Ruto to withdraw a controversial tax bill and reshuffle his cabinet. The economy is strained by high debt servicing costsâ€”nearly half of revenue goes to debt payments. Kenya leads the Haiti security mission despite domestic challenges. Tech sector ("Silicon Savannah") remains a bright spot.',
      why: 'Kenya is East Africa\'s largest economy and a key US security partner in the region. It\'s a hub for regional business and technology. The youth protest movement could inspire similar actions across Africa. Kenya\'s debt distress mirrors broader emerging market challenges.',
      next: 'Ruto faces the difficult balance of fiscal reform versus public anger. Watch for: debt restructuring, protest dynamics, Haiti mission progress, and 2027 election positioning. The government\'s reform agenda faces significant headwinds.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Kenya secures debt relief from creditors', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Youth activists maintain pressure on government', url: '#' }
    ]
  },

  'Colombia': { lat: 4.57, lng: -74.30, flag: 'ðŸ‡¨ðŸ‡´', risk: 'stormy', region: 'South America', pop: '52M', gdp: '$314B', leader: 'Gustavo Petro', title: 'Peace Process',
    analysis: {
      what: 'President Petro, Colombia\'s first leftist leader, has pursued "total peace"â€”negotiations with multiple armed groups. Results are mixed: talks with ELN guerrillas have stalled, while some groups have demobilized. Coca production remains at record levels. Relations with the US are strained. Economic reforms have been controversial.',
      why: 'Colombia is the world\'s largest cocaine producer. Its stability affects the entire region. The country hosts 2+ million Venezuelan refugees. US-Colombia relations are historically close but now tested. The peace process outcome will determine security for decades.',
      next: 'Petro\'s ambitious agenda faces congressional opposition and armed group intransigence. Watch for: peace negotiations, coca policy, economic reforms, and 2026 elections. The country\'s direction depends on peace process success.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'ELN peace talks resume after breakdown', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Coca production hits new record despite eradication efforts', url: '#' }
    ]
  },

  'Peru': { lat: -9.19, lng: -75.02, flag: 'ðŸ‡µðŸ‡ª', risk: 'stormy', region: 'South America', pop: '34M', gdp: '$242B', leader: 'Dina Boluarte', title: 'Political Instability',
    analysis: {
      what: 'Peru has cycled through multiple presidents in recent years amid political chaos. President Boluarte faces very low approval after taking power when Castillo was impeached and arrested for attempting a self-coup. Protests killed dozens. Mining remains the economic backbone but faces social opposition. Corruption scandals have touched virtually every political figure.',
      why: 'Peru is the world\'s second-largest copper producer, critical for the energy transition. Political instability deters investment in a resource-rich country. Regional drug trafficking flows through Peru. The pattern of presidential dysfunction weakens democratic institutions.',
      next: 'Boluarte will likely serve until 2026 elections but with minimal legitimacy. Watch for: mining investment, social conflicts, corruption prosecutions, and electoral dynamics. Structural political reform seems unlikely.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Mining protests block major copper operations', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Boluarte approval ratings hit new low', url: '#' }
    ]
  },

  'Thailand': { lat: 15.87, lng: 100.99, flag: 'ðŸ‡¹ðŸ‡­', risk: 'stormy', region: 'Southeast Asia', pop: '70M', gdp: '$495B', leader: 'Paetongtarn', title: 'Political Uncertainty',
    analysis: {
      what: 'Thailand\'s politics remain turbulent despite a new government led by Paetongtarn Shinawatra, daughter of exiled former PM Thaksin. The progressive Move Forward party was dissolved by constitutional court despite winning the most seats. The military and monarchy retain enormous influence. Economic growth has lagged regional peers. Tourism has recovered post-COVID.',
      why: 'Thailand is Southeast Asia\'s second-largest economy and a major tourist destination. The monarchy is deeply revered but succession creates uncertainty. The country\'s position between US and China shapes regional dynamics. Its political instability (19 coups since 1932) affects investment.',
      next: 'The Shinawatra-linked government faces military and conservative establishment skepticism. Watch for: coalition stability, economic reforms, lÃ¨se-majestÃ© prosecutions, and relations with progressive opposition. Another political disruption cannot be ruled out.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'New government faces constitutional court challenges', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '5h ago', headline: 'Tourism revenues approach pre-COVID levels', url: '#' }
    ]
  },

  'Philippines': { lat: 12.88, lng: 121.77, flag: 'ðŸ‡µðŸ‡­', risk: 'stormy', region: 'Southeast Asia', pop: '115M', gdp: '$404B', leader: 'Marcos Jr', title: 'China Tensions',
    analysis: {
      what: 'President Marcos Jr has shifted from his predecessor Duterte\'s China-friendly stance, strengthening US alliance ties amid South China Sea tensions. Chinese vessels regularly confront Philippine boats at disputed reefs. The Visiting Forces Agreement with the US was renewed, and new base access granted. A rift has developed between Marcos and VP Sara Duterte (daughter of the former president).',
      why: 'The Philippines sits on critical South China Sea shipping lanes where $3 trillion in trade passes annually. It\'s a key US ally hosting military facilities. The confrontational dynamics with China could escalate to armed conflict. The large overseas Filipino worker population sends significant remittances.',
      next: 'Tensions with China will likely persist and potentially escalate. Watch for: South China Sea incidents, US military cooperation, Marcos-Duterte political split, and economic development. The country is increasingly on the frontline of US-China competition.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Chinese vessels block Philippine boats at disputed reef', url: '#' },
      { source: 'AP', bias: 'center', time: '4h ago', headline: 'US announces new military cooperation package', url: '#' }
    ]
  },

  'Hungary': { lat: 47.16, lng: 19.50, flag: 'ðŸ‡­ðŸ‡º', risk: 'stormy', region: 'Eastern Europe', pop: '10M', gdp: '$188B', leader: 'Viktor OrbÃ¡n', title: 'Democratic Backsliding',
    analysis: {
      what: 'PM Viktor OrbÃ¡n has built what he calls "illiberal democracy"â€”concentrating power, capturing media, and undermining judicial independence. Hungary regularly clashes with the EU over rule of law, blocking Ukraine aid and migration policies. OrbÃ¡n maintains close ties with Putin and has visited Moscow. The economy struggles with high inflation and EU funding freezes.',
      why: 'Hungary demonstrates democratic backsliding within the EU, challenging the bloc\'s values. Its veto power blocks EU decisions on Ukraine and other issues. OrbÃ¡n is a model for right-wing populists globally. Hungary\'s position complicates NATO unity.',
      next: 'OrbÃ¡n appears secure domestically but faces increasing EU isolation. Watch for: EU funding negotiations, Ukraine policy, and any opposition consolidation. Hungary will continue to be the EU\'s most difficult member.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'EU freezes more funds over rule of law concerns', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'OrbÃ¡n blocks joint EU statement on Ukraine', url: '#' }
    ]
  },

  'Serbia': { lat: 44.02, lng: 21.01, flag: 'ðŸ‡·ðŸ‡¸', risk: 'stormy', region: 'Balkans', pop: '7M', gdp: '$63B', leader: 'Aleksandar VuÄiÄ‡', title: 'Kosovo Tensions',
    analysis: {
      what: 'President VuÄiÄ‡ maintains strong grip on power with control over media and institutions. Serbia refuses to recognize Kosovo\'s independence and tensions remain high, including recent violent incidents. The country seeks EU membership but won\'t align with sanctions on Russia. It has close ties with both Russia and China while negotiating with the West.',
      why: 'Serbia\'s relations with Kosovo are a potential flashpoint in Europe. Its balancing act between East and West complicates regional integration. Weapons flowing from Serbia have appeared in various conflicts. The country is key to Balkan stability.',
      next: 'The Kosovo issue appears intractable without significant compromise. Watch for: Kosovo-Serbia negotiations, EU accession progress, and Russian influence. VuÄiÄ‡ will try to maintain his balancing act indefinitely.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'EU-mediated talks with Kosovo make limited progress', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Serbia maintains neutrality on Russia sanctions', url: '#' }
    ]
  },

  'El Salvador': { lat: 13.79, lng: -88.90, flag: 'ðŸ‡¸ðŸ‡»', risk: 'stormy', region: 'Central America', pop: '6.5M', gdp: '$33B', leader: 'Nayib Bukele', title: 'Gang Crackdown',
    analysis: {
      what: 'President Bukele has achieved dramatic reduction in gang violence through a state of emergency, mass arrests (80,000+), and harsh conditions that have drawn human rights criticism. Homicides dropped from world\'s highest to among lowest in the Americas. He won reelection overwhelmingly despite constitutional concerns. Bitcoin adoption as legal tender has been rocky.',
      why: 'Bukele\'s gang suppression model is being watched by other violence-plagued countries. His popularity despite authoritarian methods challenges democratic norms. The Bitcoin experiment tests cryptocurrency\'s viability as national currency. Migration from El Salvador significantly affects the US.',
      next: 'Bukele faces the challenge of sustaining security gains and economic development. Watch for: human rights concerns, economic indicators, Bitcoin project, and whether the security model is replicable. His approach is a test case for the region.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Homicide rate remains at historic low', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Human rights groups condemn prison conditions', url: '#' }
    ]
  },

  'Sri Lanka': { lat: 7.87, lng: 80.77, flag: 'ðŸ‡±ðŸ‡°', risk: 'stormy', region: 'South Asia', pop: '22M', gdp: '$75B', leader: 'Anura Kumara', title: 'Economic Recovery',
    analysis: {
      what: 'Sri Lanka experienced complete economic collapse in 2022â€”defaulting on debt, running out of fuel and medicine, and seeing the president flee the country amid mass protests. A new leftist president won elections promising reform. IMF bailout conditions are being implemented with painful austerity. Tourism is recovering slowly.',
      why: 'Sri Lanka\'s collapse was a warning about debt distress in developing countries. Its strategic location in the Indian Ocean makes it important to India and China (which built the controversial Hambantota port). The recovery\'s success will influence how other struggling nations are treated.',
      next: 'The new government must balance IMF conditions with public patience. Watch for: economic indicators, tourism recovery, debt restructuring, and India-China competition. Recovery will be long and painful but appears on track.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'IMF approves next bailout tranche', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Tourism arrivals show steady recovery', url: '#' }
    ]
  },

  'Bolivia': { lat: -16.29, lng: -63.59, flag: 'ðŸ‡§ðŸ‡´', risk: 'stormy', region: 'South America', pop: '12M', gdp: '$44B', leader: 'Luis Arce', title: 'Political Divisions',
    analysis: {
      what: 'Bolivia faces political division between President Arce and his former mentor Evo Morales, splitting the ruling MAS party. A failed coup attempt in 2024 (or what critics called a staged event) added confusion. Economic challenges mount as natural gas revenues decline. Indigenous politics remain central. Lithium reserves offer potential.',
      why: 'Bolivia has among the world\'s largest lithium reserves, crucial for battery production. The MAS movement\'s internal conflict affects regional left politics. The country demonstrates tensions between democratic norms and populist movements.',
      next: 'The Arce-Morales split will dominate politics heading toward 2025 elections. Watch for: economic conditions, lithium development, and political violence risk. The outcome will shape Bolivia\'s direction for years.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Morales announces presidential bid despite controversy', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Natural gas exports continue decline', url: '#' }
    ]
  },

  'Guyana': { lat: 4.86, lng: -58.93, flag: 'ðŸ‡¬ðŸ‡¾', risk: 'stormy', region: 'South America', pop: '0.8M', gdp: '$15B', leader: 'Irfaan Ali', title: 'Oil Boom',
    analysis: {
      what: 'Guyana has experienced the world\'s fastest economic growth due to massive offshore oil discoveriesâ€”expected to produce over 1 million barrels per day by 2027. This tiny country of 800,000 people faces the challenge of managing sudden wealth. Venezuela claims two-thirds of Guyana\'s territory (Essequibo) and has made threatening moves.',
      why: 'Guyana\'s oil boom is one of the most dramatic economic transformations in history. The Venezuela territorial dispute could escalate to conflict. How Guyana manages its windfall will be studied as a development case. Caribbean stability is affected.',
      next: 'The key challenge is using oil wealth wisely to avoid the "resource curse." Watch for: Venezuela tensions, governance quality, infrastructure development, and wealth distribution. The country\'s transformation is just beginning.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Oil production exceeds projections', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Venezuela continues military posturing on border', url: '#' }
    ]
  },

  // ==================== CLOUDY COUNTRIES ====================
  'United Kingdom': { lat: 55.38, lng: -3.44, flag: 'ðŸ‡¬ðŸ‡§', risk: 'cloudy', region: 'Western Europe', pop: '67M', gdp: '$3.1T', leader: 'Keir Starmer', title: 'Post-Brexit Adjustment',
    analysis: {
      what: 'Labour\'s Keir Starmer won a landslide election in 2024, ending 14 years of Conservative rule. He inherits an economy still adjusting to Brexit with sluggish growth, strained public services, and high debt. Relations with Europe are being reset, though not rejoining the EU. Immigration policy and small boat crossings remain contentious.',
      why: 'The UK is Europe\'s second-largest economy and a permanent UN Security Council member. Its global financial center status continues despite Brexit. The "special relationship" with the US remains important. The UK is a key NATO contributor.',
      next: 'Starmer faces the challenge of delivering change with limited fiscal room. Watch for: economic growth, EU relationship, immigration policy, and public service reform. The honeymoon period will be tested quickly.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Starmer announces EU cooperation initiatives', url: '#' },
      { source: 'BBC', bias: 'center-left', time: '5h ago', headline: 'NHS waiting lists remain at record levels', url: '#' }
    ]
  },

  'Italy': { lat: 41.87, lng: 12.57, flag: 'ðŸ‡®ðŸ‡¹', risk: 'cloudy', region: 'Western Europe', pop: '59M', gdp: '$2.1T', leader: 'Giorgia Meloni', title: 'Right-Wing Government',
    analysis: {
      what: 'PM Giorgia Meloni leads the most right-wing government since WWII, but has proven more pragmatic than fearedâ€”maintaining EU relations and supporting Ukraine. Economic growth is modest. Debt remains very high at 140% of GDP. Migration from Africa is a central issue. Her Brothers of Italy party has post-fascist roots.',
      why: 'Italy is the eurozone\'s third-largest economyâ€”its debt levels affect European financial stability. Meloni\'s pragmatism has surprised observers and influences how other right-wing leaders govern. Italian migration policy affects EU-wide approaches. Italy is a key NATO member.',
      next: 'Meloni\'s popularity has held but economic challenges persist. Watch for: debt dynamics, migration deals, EU relations, and coalition stability. Italy demonstrates right-wing governance within EU constraints.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Meloni meets EU leaders on migration deal', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Italian bonds stable despite high debt', url: '#' }
    ]
  },

  'Poland': { lat: 51.92, lng: 19.15, flag: 'ðŸ‡µðŸ‡±', risk: 'cloudy', region: 'Eastern Europe', pop: '38M', gdp: '$688B', leader: 'Donald Tusk', title: 'Democratic Recovery',
    analysis: {
      what: 'PM Donald Tusk returned to power in 2023, ending 8 years of PiS rule that had eroded judicial independence and clashed with the EU. The new government is working to restore rule of law and unlock frozen EU funds. Poland hosts millions of Ukrainian refugees and is a major defense spender. Relations with the EU are normalizing.',
      why: 'Poland is the largest Central European economy and NATO\'s eastern anchor. It borders Ukraine and Russia\'s Kaliningrad exclave. Its democratic recovery is significant for EU cohesion. Poland has become a major military power with 4% of GDP defense spending.',
      next: 'Tusk faces the challenge of reforming captured institutions while maintaining stability. Watch for: judicial reforms, EU funding, Ukraine support, and relations with President Duda. Democratic restoration is a long process.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'EU releases frozen funds after reform progress', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Poland hosts major NATO exercises near Belarus border', url: '#' }
    ]
  },

  'Spain': { lat: 40.46, lng: -3.75, flag: 'ðŸ‡ªðŸ‡¸', risk: 'cloudy', region: 'Western Europe', pop: '48M', gdp: '$1.4T', leader: 'Pedro SÃ¡nchez', title: 'Coalition Politics',
    analysis: {
      what: 'PM SÃ¡nchez leads a fragile minority government dependent on regional parties including Catalan separatists. An amnesty for Catalan independence leaders was passed amid controversy. The economy has performed better than eurozone peers. Housing affordability is a growing issue. Devastating floods in Valencia highlighted climate vulnerabilities.',
      why: 'Spain is the eurozone\'s fourth-largest economy. The Catalan independence issue creates precedent for separatist movements elsewhere. Spanish is spoken by 500+ million people globally. Tourism makes Spain a major European destination.',
      next: 'SÃ¡nchez\'s coalition is unstable and could collapse. Watch for: Catalan negotiations, economic performance, housing protests, and snap election risk. The government\'s survival is not assured.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Catalan amnesty law faces constitutional challenge', url: '#' },
      { source: 'El PaÃ­s', bias: 'center-left', time: '5h ago', headline: 'Housing protests spread to major cities', url: '#' }
    ]
  },

  'Netherlands': { lat: 52.13, lng: 5.29, flag: 'ðŸ‡³ðŸ‡±', risk: 'cloudy', region: 'Western Europe', pop: '18M', gdp: '$991B', leader: 'Dick Schoof', title: 'Right-Wing Shift',
    analysis: {
      what: 'Geert Wilders\' far-right PVV won elections but couldn\'t form government directlyâ€”a coalition with moderate parties installed technocrat PM Schoof. The government has adopted the toughest asylum policy in Dutch history. Economic concerns include housing shortage and agricultural transition. The Netherlands remains Europe\'s largest port.',
      why: 'The Netherlands is a major EU economy and home to Rotterdam, Europe\'s largest port. Its political shift rightward reflects broader European trends. Dutch agriculture and tech sectors are globally significant. Shell and other major multinationals are headquartered there.',
      next: 'The coalition\'s stability will be tested by Wilders\' ambitions and policy compromises. Watch for: asylum policy implementation, EU relations, and farmer protests. The rightward shift may continue.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Government announces strictest asylum rules in history', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Dutch ports see record trade volumes', url: '#' }
    ]
  },

  'Indonesia': { lat: -0.79, lng: 113.92, flag: 'ðŸ‡®ðŸ‡©', risk: 'cloudy', region: 'Southeast Asia', pop: '277M', gdp: '$1.3T', leader: 'Prabowo', title: 'New Leadership',
    analysis: {
      what: 'New President Prabowo Subianto, a former general once accused of human rights abuses, won elections with Jokowi\'s backing. He has announced ambitious programs including free school meals. Indonesia is building a new capital (Nusantara) in Borneo. The economy grows steadily with nickel processing driving investment. Democratic backsliding concerns exist.',
      why: 'Indonesia is the world\'s fourth most populous country and ASEAN\'s largest economy. It has vast mineral resources crucial for batteries (nickel, cobalt). The country\'s stability affects Southeast Asian regional dynamics. Its moderate Islam influences global Muslim communities.',
      next: 'Prabowo\'s leadership style and policies are still being defined. Watch for: democratic institutions, economic policy, environmental concerns (deforestation), and foreign policy direction. The transition marks a significant shift.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Prabowo announces major infrastructure investments', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '5h ago', headline: 'Nickel processing attracts Chinese investment', url: '#' }
    ]
  },

  'Vietnam': { lat: 14.06, lng: 108.28, flag: 'ðŸ‡»ðŸ‡³', risk: 'cloudy', region: 'Southeast Asia', pop: '100M', gdp: '$409B', leader: 'TÃ´ LÃ¢m', title: 'Manufacturing Hub',
    analysis: {
      what: 'Vietnam has emerged as a major manufacturing hub, benefiting from supply chain diversification away from China. GDP growth exceeds 6% annually. A sweeping anti-corruption campaign has reshuffled leadership including the president. The one-party communist state maintains stability while gradually opening the economy.',
      why: 'Vietnam is one of the fastest-growing economies and a key beneficiary of "China+1" supply chain strategies. Major tech companies (Samsung, Apple suppliers) have significant operations there. The country balances relations with the US and China despite historical conflicts with both.',
      next: 'Manufacturing growth should continue as companies diversify from China. Watch for: US-Vietnam relations, anti-corruption campaign impacts, and infrastructure development. Vietnam\'s rise as a manufacturing power will accelerate.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Manufacturing exports hit new record', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '5h ago', headline: 'Apple expands supplier operations in Vietnam', url: '#' }
    ]
  },

  'Japan': { lat: 36.20, lng: 138.25, flag: 'ðŸ‡¯ðŸ‡µ', risk: 'clear', region: 'East Asia', pop: '125M', gdp: '$4.2T', leader: 'Sanae Takaichi', title: 'Defense Buildup',
    analysis: {
      what: 'Japan has undertaken its most significant defense transformation since WWII, doubling military spending and acquiring counterstrike capabilities in response to China and North Korea. New PM Ishiba has pushed for even more, including a potential Asian NATO. The economy has finally exited decades of deflation with wages rising. Demographic decline (population shrinking by 500,000/year) poses long-term challenges.',
      why: 'Japan is the world\'s third-largest economy and crucial US ally. Its defense buildup reshapes Asian security dynamics. Japanese technology and manufacturing remain globally important. Yen weakness has affected global currency markets.',
      next: 'The defense transformation will continue as regional tensions persist. Watch for: China relations, US alliance management, economic normalization, and demographic policies. Japan is becoming a more "normal" military power.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Defense budget reaches record levels', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '4h ago', headline: 'Wages show sustained growth for first time in decades', url: '#' }
    ]
  },

  'Canada': { lat: 56.13, lng: -106.35, flag: 'ðŸ‡¨ðŸ‡¦', risk: 'clear', region: 'North America', pop: '40M', gdp: '$2.1T', leader: 'Mark Carney', title: 'Stable Democracy',
    analysis: {
      what: 'Canada has experienced political transition with new Liberal leadership. Relations with the US have been tested by trade tensions and border security debates. Housing affordability remains a major domestic issue with prices among the world\'s highest. Immigration levels are high but face public skepticism. The country is a major energy producer.',
      why: 'Canada is America\'s largest trading partner and close ally. Its energy resources (oil sands, hydropower) are globally significant. Canadian stability contrasts with US polarization. Arctic sovereignty is increasingly important as ice melts.',
      next: 'Trade relations with the US will be the dominant concern. Watch for: US tariff threats, housing policy, immigration levels, and energy sector development. Canadian-US relations face unusual uncertainty.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'New government faces US trade pressure', url: '#' },
      { source: 'Globe and Mail', bias: 'center', time: '5h ago', headline: 'Housing starts increase as prices moderate', url: '#' }
    ]
  },

  'Australia': { lat: -25.27, lng: 133.78, flag: 'ðŸ‡¦ðŸ‡º', risk: 'clear', region: 'Oceania', pop: '26M', gdp: '$1.7T', leader: 'Anthony Albanese', title: 'AUKUS Partner',
    analysis: {
      what: 'Australia is implementing the AUKUS agreement to acquire nuclear-powered submarines, the largest defense investment in its history. Relations with China have thawed after years of tension, though strategic competition continues. The economy benefits from mining exports but faces housing affordability challenges. Labor government balances alliance commitments with regional engagement.',
      why: 'Australia is a key US ally in the Indo-Pacific, hosting military facilities and participating in the Quad. Its mineral exports (iron ore, lithium, coal) are globally crucial, especially for China. The AUKUS submarines represent a major shift in regional military balance.',
      next: 'The AUKUS implementation faces technical and political challenges. Watch for: China relations, submarine program progress, Pacific Island engagement, and domestic politics. Australia\'s strategic importance will grow.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'AUKUS submarine construction begins', url: '#' },
      { source: 'ABC', bias: 'center-left', time: '5h ago', headline: 'Trade with China reaches new highs', url: '#' }
    ]
  },

  'Singapore': { lat: 1.35, lng: 103.82, flag: 'ðŸ‡¸ðŸ‡¬', risk: 'clear', region: 'Southeast Asia', pop: '6M', gdp: '$424B', leader: 'Lawrence Wong', title: 'Leadership Transition',
    analysis: {
      what: 'Singapore has completed its leadership transition from Lee Hsien Loong to Lawrence Wong, only the fourth prime minister since independence. The city-state remains Southeast Asia\'s financial hub with one of the world\'s highest GDPs per capita. It balances relations with the US and China while maintaining authoritarian political control. Housing costs and inequality are domestic concerns.',
      why: 'Singapore is a global financial center and trading hub. Its political stability model influences regional governance. The country\'s port is among the world\'s busiest. Singapore\'s policies on technology and finance set regional standards.',
      next: 'Wong must maintain Singapore\'s success while addressing inequality and political expectations. Watch for: US-China positioning, financial sector developments, and any political liberalization. The city-state\'s model will be tested.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Singapore GDP growth exceeds forecasts', url: '#' },
      { source: 'Straits Times', bias: 'center-right', time: '5h ago', headline: 'PM Wong outlines new housing initiatives', url: '#' }
    ]
  },

  'UAE': { lat: 23.42, lng: 53.85, flag: 'ðŸ‡¦ðŸ‡ª', risk: 'clear', region: 'Middle East', pop: '10M', gdp: '$509B', leader: 'Mohamed bin Zayed', title: 'Regional Hub',
    analysis: {
      what: 'The UAE has emerged as the Middle East\'s business and logistics hub, with Dubai hosting global events and Abu Dhabi investing massively through sovereign wealth funds. It signed the Abraham Accords normalizing relations with Israel. Energy transition investments are significant. The country maintains influence through strategic investments and regional diplomacy.',
      why: 'The UAE is a major global investor through funds like ADIA and Mubadala. Dubai is a global aviation and tourism hub. The country bridges East and West commercially. Its regional influence extends through investments, media, and military interventions.',
      next: 'Economic diversification will continue as oil importance declines. Watch for: regional diplomatic role, investment patterns, and post-MBZ succession planning. The UAE model of authoritarian modernization will be tested.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'UAE sovereign fund announces major tech investments', url: '#' },
      { source: 'Bloomberg', bias: 'center-right', time: '5h ago', headline: 'Dubai real estate prices continue rising', url: '#' }
    ]
  },

  'Switzerland': { lat: 46.82, lng: 8.23, flag: 'ðŸ‡¨ðŸ‡­', risk: 'clear', region: 'Western Europe', pop: '9M', gdp: '$808B', leader: 'Federal Council', title: 'Neutral & Stable',
    analysis: {
      what: 'Switzerland has navigated the Ukraine war while maintaining modified neutralityâ€”adopting EU sanctions despite its neutral status. The banking sector faced upheaval with Credit Suisse\'s collapse and forced merger with UBS. Relations with the EU remain complex with no framework agreement. The direct democracy system continues to function well.',
      why: 'Switzerland is a global financial center and headquarters for many international organizations. Its neutrality has been a cornerstone of European diplomacy. Swiss technology and pharmaceutical sectors are globally significant. The country\'s stability attracts wealth from worldwide.',
      next: 'EU relations and neutrality policy will continue to evolve post-Ukraine. Watch for: banking sector stability, EU framework negotiations, and any neutrality debates. Switzerland\'s model faces 21st-century pressures.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Swiss banks report strong profits after consolidation', url: '#' },
      { source: 'SWI', bias: 'center', time: '5h ago', headline: 'EU talks resume on bilateral framework', url: '#' }
    ]
  },

  'Norway': { lat: 60.47, lng: 8.47, flag: 'ðŸ‡³ðŸ‡´', risk: 'clear', region: 'Northern Europe', pop: '5M', gdp: '$579B', leader: 'Jonas StÃ¸re', title: 'Energy Superpower',
    analysis: {
      what: 'Norway has benefited enormously from high energy prices following Russia\'s invasion of Ukraine, with gas exports to Europe surging. The sovereign wealth fund (world\'s largest at $1.6 trillion) continues to grow. NATO\'s northern flank has increased importance. Arctic sovereignty is a growing focus. The country debates its role as a fossil fuel exporter amid climate concerns.',
      why: 'Norway is Europe\'s largest gas supplier since Russia\'s decline. Its sovereign wealth fund\'s investments affect global markets. The country\'s Arctic expertise is increasingly valuable. Norway\'s NATO role has gained importance.',
      next: 'The tension between fossil fuel wealth and climate goals will intensify. Watch for: energy policy, Arctic developments, NATO contributions, and sovereign fund decisions. Norway\'s choices have outsized global impact.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Sovereign wealth fund reaches new record high', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Norway gas exports stabilize European energy markets', url: '#' }
    ]
  },

  // More CLOUDY countries
  'Malaysia': { lat: 4.21, lng: 101.98, flag: 'ðŸ‡²ðŸ‡¾', risk: 'cloudy', region: 'Southeast Asia', pop: '34M', gdp: '$407B', leader: 'Anwar Ibrahim', title: 'Coalition Politics',
    analysis: {
      what: 'PM Anwar Ibrahim leads a unity government after decades of waiting for power. The economy is stable with electronics and palm oil exports. Political coalitions remain fragile with ethnic and religious tensions. The 1MDB corruption scandal continues to echo. Malaysia balances relations with China and Western powers.',
      why: 'Malaysia controls the Strait of Malacca, one of the world\'s busiest shipping lanes. It\'s a major electronics manufacturing hub. The country\'s multiethnic balance influences regional politics. Palm oil exports affect global food and fuel markets.',
      next: 'Anwar must maintain coalition unity while addressing economic inequality. Watch for: coalition stability, ethnic relations, and China engagement. Malaysia\'s political direction remains uncertain.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Electronics exports drive economic growth', url: '#' },
      { source: 'Nikkei', bias: 'center', time: '5h ago', headline: 'Coalition partners debate economic policy', url: '#' }
    ]
  },

  'Romania': { lat: 45.94, lng: 24.97, flag: 'ðŸ‡·ðŸ‡´', risk: 'cloudy', region: 'Eastern Europe', pop: '19M', gdp: '$301B', leader: 'Disputed', title: 'NATO Frontline',
    analysis: {
      what: 'Romania faces political uncertainty after a far-right candidate won the first round of presidential elections before it was annulled over alleged Russian interference. The country is a key NATO member bordering Ukraine, hosting US troops and missile defense. Economic growth has been strong but faces fiscal challenges.',
      why: 'Romania is on NATO\'s eastern flank, directly bordering Ukraine and Moldova. It hosts major US military facilities. The Black Sea coast is strategically important. Romanian politics serve as a bellwether for Russian influence operations in the EU.',
      next: 'The political crisis will take time to resolve with new elections. Watch for: Russian interference, NATO posture, and EU relations. Romania\'s stability matters for regional security.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Constitutional court schedules new elections', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'NATO reinforces Black Sea presence', url: '#' }
    ]
  },

  'Greece': { lat: 39.07, lng: 21.82, flag: 'ðŸ‡¬ðŸ‡·', risk: 'cloudy', region: 'Southern Europe', pop: '10M', gdp: '$219B', leader: 'Mitsotakis', title: 'Economic Recovery',
    analysis: {
      what: 'Greece has achieved remarkable recovery after its debt crisis, with investment-grade credit restored and tourism booming. PM Mitsotakis won a strong mandate for continued reforms. Relations with Turkey remain tense over maritime boundaries and Cyprus. Wildfires have become more devastating with climate change.',
      why: 'Greece\'s recovery from near-default is a success story for eurozone crisis management. The country occupies strategic position at Europe\'s southeastern corner. Greek-Turkish tensions affect NATO cohesion. Tourism is vital to the Mediterranean economy.',
      next: 'Economic momentum should continue but structural challenges remain. Watch for: Turkey relations, migration pressures, and climate impacts. Greece has turned a corner but faces ongoing challenges.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Tourism revenues exceed pre-pandemic levels', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Greece repays more crisis-era debt early', url: '#' }
    ]
  },

  'Sweden': { lat: 60.13, lng: 18.64, flag: 'ðŸ‡¸ðŸ‡ª', risk: 'cloudy', region: 'Northern Europe', pop: '10M', gdp: '$585B', leader: 'Ulf Kristersson', title: 'NATO Member',
    analysis: {
      what: 'Sweden ended over 200 years of neutrality by joining NATO in 2024, a historic shift prompted by Russia\'s invasion of Ukraine. The right-wing government relies on far-right support while maintaining centrist policies. Gang violence has become a major concern with shootings and bombings. The economy is stable with strong tech sector.',
      why: 'Sweden\'s NATO membership fundamentally changes Baltic Sea security dynamics. The country\'s defense industry (Saab) is globally significant. Sweden\'s experience with gang violence offers lessons for other countries. Nordic cooperation is strengthening.',
      next: 'NATO integration will deepen while addressing domestic security. Watch for: military investments, gang violence response, and Russia relations. Sweden\'s security posture has been transformed.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Sweden hosts first NATO exercises since joining', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Gang violence crackdown shows mixed results', url: '#' }
    ]
  },

  'Finland': { lat: 61.92, lng: 25.75, flag: 'ðŸ‡«ðŸ‡®', risk: 'cloudy', region: 'Northern Europe', pop: '6M', gdp: '$281B', leader: 'Petteri Orpo', title: 'New NATO Member',
    analysis: {
      what: 'Finland joined NATO in 2023, ending decades of "Finlandization" following Russia\'s invasion of Ukraine. This doubled NATO\'s border with Russia. The economy faces challenges with Nokia\'s decline and low growth. The right-wing coalition government has implemented budget cuts. Border security with Russia has required enhanced measures.',
      why: 'Finland\'s 1,340km border with Russia is NATO\'s longest. Finnish military capabilities and Arctic expertise are significant NATO additions. The country\'s transformation shows how Russia\'s aggression has backfired. Nordic defense cooperation has intensified.',
      next: 'NATO integration and border security will remain priorities. Watch for: Russia relations, Arctic developments, and economic reforms. Finland\'s strategic position has gained new importance.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Finland reinforces eastern border defenses', url: '#' },
      { source: 'YLE', bias: 'center', time: '5h ago', headline: 'Government announces new defense investments', url: '#' }
    ]
  },

  'Austria': { lat: 47.52, lng: 14.55, flag: 'ðŸ‡¦ðŸ‡¹', risk: 'cloudy', region: 'Western Europe', pop: '9M', gdp: '$471B', leader: 'Karl Nehammer', title: 'Far-Right Gains',
    analysis: {
      what: 'The far-right FPÃ– won elections in 2024 but has struggled to form a government due to other parties refusing to coalition. Austria maintains neutrality while being surrounded by NATO members. The economy depends heavily on trade with Germany. Immigration and Russia relations are divisive issues.',
      why: 'Austria\'s political shifts reflect broader European far-right trends. The country\'s neutrality creates complications for European defense. Austrian banking has historical ties to Eastern Europe. The country is a transit point for migration.',
      next: 'Government formation remains challenging. Watch for: coalition negotiations, Russia policy, and migration debates. Austria\'s political direction is uncertain.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Coalition talks continue amid deadlock', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Far-right gains reshape political landscape', url: '#' }
    ]
  },

  'Chile': { lat: -35.68, lng: -71.54, flag: 'ðŸ‡¨ðŸ‡±', risk: 'cloudy', region: 'South America', pop: '19M', gdp: '$301B', leader: 'Gabriel Boric', title: 'Constitutional Reform',
    analysis: {
      what: 'President Boric leads a left-wing government that has struggled to deliver promised reforms after two constitutional referendums failed. The economy is stable but growth is weak. Migration from Venezuela and Haiti has strained services. Chile remains the world\'s largest copper producer with lithium reserves gaining importance.',
      why: 'Chile is critical to the global copper supply, essential for electrification and green energy. Its lithium reserves are among the world\'s largest. The country has been Latin America\'s most stable economy. Chilean political shifts influence regional trends.',
      next: 'Boric faces challenging path to 2025 midterms. Watch for: mining policy, constitutional debates, and economic performance. Chile\'s reform agenda has stalled but stability continues.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Copper prices boost fiscal revenues', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Lithium nationalization debate continues', url: '#' }
    ]
  },

  'Morocco': { lat: 31.79, lng: -7.09, flag: 'ðŸ‡²ðŸ‡¦', risk: 'cloudy', region: 'North Africa', pop: '37M', gdp: '$132B', leader: 'King Mohammed VI', title: 'Western Sahara',
    analysis: {
      what: 'Morocco has gained international recognition for its sovereignty over Western Sahara, including from the US and increasingly from European states. The economy is diversifying into automotive and aerospace manufacturing. The 2023 earthquake killed nearly 3,000 and recovery continues. Relations with Algeria remain frozen.',
      why: 'Morocco controls key Atlantic shipping lanes and is Africa\'s gateway to Europe. Its Western Sahara claim affects regional dynamics. The country is a major agricultural exporter to Europe. Morocco\'s stability contrasts with regional turmoil.',
      next: 'Western Sahara recognition momentum may continue. Watch for: EU relations, economic development, and Algeria tensions. Morocco is consolidating its regional position.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'France recognizes Morocco Western Sahara sovereignty', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Earthquake reconstruction proceeds', url: '#' }
    ]
  },

  'Senegal': { lat: 14.50, lng: -14.45, flag: 'ðŸ‡¸ðŸ‡³', risk: 'cloudy', region: 'Africa', pop: '18M', gdp: '$28B', leader: 'Bassirou Faye', title: 'Democratic Transition',
    analysis: {
      what: 'Senegal achieved a remarkable democratic transition when opposition candidate Bassirou Faye won the presidency after his predecessor\'s attempt to delay elections failed. The new government promises anti-corruption reforms. Oil and gas production is beginning. The country remains West Africa\'s most stable democracy.',
      why: 'Senegal\'s democratic transition is a positive example for Africa amid coups elsewhere. New oil/gas revenues could transform the economy. The country is a key regional partner for the West. Senegal hosts significant foreign investment.',
      next: 'The new government must deliver on reform promises while managing oil wealth. Watch for: governance reforms, oil production ramp-up, and regional influence. Senegal\'s success matters for African democracy.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'New government launches anti-corruption probe', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'First oil exports begin from offshore fields', url: '#' }
    ]
  },

  'Tanzania': { lat: -6.37, lng: 34.89, flag: 'ðŸ‡¹ðŸ‡¿', risk: 'cloudy', region: 'Africa', pop: '65M', gdp: '$76B', leader: 'Samia Hassan', title: 'Stable Growth',
    analysis: {
      what: 'President Samia Hassan, Africa\'s only female head of state, has reversed her predecessor\'s controversial policies including COVID denialism. The economy grows steadily with tourism and mining driving development. Democratic space remains constrained but has improved. Tanzania mediates regional conflicts.',
      why: 'Tanzania is one of Africa\'s largest and most stable countries. It hosts refugees from multiple neighboring conflicts. The country\'s tourism (Serengeti, Zanzibar) is globally significant. Tanzania mediates in DRC and other regional disputes.',
      next: 'Gradual reform and economic growth should continue. Watch for: 2025 elections, mining development, and regional diplomatic role. Tanzania is quietly becoming more influential.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Tourism revenues reach new record', url: '#' },
      { source: 'AP', bias: 'center', time: '5h ago', headline: 'Tanzania hosts regional peace talks', url: '#' }
    ]
  },

  // More CLEAR countries
  'New Zealand': { lat: -40.90, lng: 174.89, flag: 'ðŸ‡³ðŸ‡¿', risk: 'clear', region: 'Oceania', pop: '5M', gdp: '$247B', leader: 'Christopher Luxon', title: 'Stable',
    analysis: {
      what: 'The center-right government elected in 2023 has reversed some previous progressive policies while maintaining overall stability. The economy faces challenges from high interest rates and housing costs. New Zealand maintains close ties with Australia through AUKUS adjacent arrangements. Pacific Islands engagement remains important.',
      why: 'New Zealand punches above its weight diplomatically, particularly in Pacific Islands affairs. Its agricultural exports are globally significant. The country is part of Five Eyes intelligence sharing. New Zealand\'s clean image supports tourism and exports.',
      next: 'Economic challenges will dominate domestic politics. Watch for: housing policy, Pacific engagement, and China relations. New Zealand remains stable and well-governed.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Interest rates begin to ease as inflation falls', url: '#' },
      { source: 'RNZ', bias: 'center', time: '6h ago', headline: 'Pacific partnerships strengthened', url: '#' }
    ]
  },

  'Denmark': { lat: 56.26, lng: 9.50, flag: 'ðŸ‡©ðŸ‡°', risk: 'clear', region: 'Northern Europe', pop: '6M', gdp: '$395B', leader: 'Mette Frederiksen', title: 'Greenland Focus',
    analysis: {
      what: 'Denmark has faced increased attention due to US interest in Greenland, which it governs. PM Frederiksen has firmly rejected any sale while increasing defense spending for Greenland. The economy is strong with major pharmaceutical and shipping industries. Denmark leads in wind energy and green transition.',
      why: 'Greenland\'s strategic location and resources (rare earths, oil) have gained geopolitical importance. Denmark controls key Arctic approaches. Danish shipping giant Maersk is globally significant. The country\'s renewable energy expertise is exported worldwide.',
      next: 'Greenland\'s status will remain in focus given Arctic competition. Watch for: US relations, Arctic defense investments, and Greenland autonomy debates. Denmark\'s small size belies its strategic importance.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Denmark increases Greenland defense spending', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Pharmaceutical exports drive trade surplus', url: '#' }
    ]
  },

  'Greenland': { lat: 71.71, lng: -42.60, flag: 'ðŸ‡¬ðŸ‡±', risk: 'stormy', region: 'Arctic / North Atlantic', pop: '57K', gdp: '$3.1B', leader: 'MÃºte B. Egede', title: 'Arctic Sovereignty Dispute',
    analysis: {
      what: 'Greenland, an autonomous territory of Denmark, has become a focal point of US foreign policy under President Trump, who has repeatedly expressed interest in acquiring the island. Prime Minister MÃºte Egede has pushed back firmly, stating Greenland is not for sale while simultaneously advancing the independence debate. Denmark has responded by increasing defense spending in the Arctic and strengthening its military presence on the island.',
      why: 'Greenland sits at the intersection of several major geopolitical trends. The Arctic is opening up due to climate change, creating new shipping routes between Asia and Europe that could reshape global trade. The island holds vast untapped mineral deposits including rare earth elements critical to technology and defense manufacturing. Its geographic position also makes it strategically important for missile defense and North Atlantic monitoring. As competition between the US, China, and Russia intensifies in the Arctic, Greenland\'s status has moved from a diplomatic curiosity to a serious geopolitical question.',
      next: 'The independence movement in Greenland is accelerating, with Egede\'s government exploring options for full sovereignty from Denmark. Watch for continued US pressure, potential Chinese investment bids for mining operations, NATO Arctic defense expansion, and the outcome of Greenland\'s internal constitutional discussions. The island\'s future will be shaped by the broader Arctic great power competition.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Trump renews call for US acquisition of Greenland', url: '#' },
      { source: 'BBC', bias: 'center', time: '6h ago', headline: 'Greenland PM rejects sale talk, pushes independence', url: '#' },
      { source: 'Financial Times', bias: 'center', time: '1d ago', headline: 'Rare earth deposits fuel Arctic geopolitical competition', url: '#' }
    ]
  },

  'Ireland': { lat: 53.14, lng: -7.69, flag: 'ðŸ‡®ðŸ‡ª', risk: 'clear', region: 'Western Europe', pop: '5M', gdp: '$533B', leader: 'Simon Harris', title: 'Tech Hub',
    analysis: {
      what: 'Ireland is a major European tech hub, hosting headquarters for Apple, Google, Microsoft, and others drawn by low corporate taxes. GDP figures are distorted by multinational accounting but genuine prosperity is high. Housing and healthcare face serious challenges. Relations with Britain have stabilized post-Brexit.',
      why: 'Ireland\'s tax policies have made it crucial to global tech and pharmaceutical supply chains. The border with Northern Ireland affects UK-EU relations. Irish-American ties influence US politics. Dublin has emerged as a post-Brexit financial center alternative.',
      next: 'Pressure on corporate tax arrangements will continue. Watch for: housing crisis, corporate tax changes, and EU relations. Ireland\'s economic model faces challenges but remains robust.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Apple announces expanded Irish operations', url: '#' },
      { source: 'Irish Times', bias: 'center', time: '5h ago', headline: 'Housing crisis dominates political agenda', url: '#' }
    ]
  },

  'Portugal': { lat: 39.40, lng: -8.22, flag: 'ðŸ‡µðŸ‡¹', risk: 'clear', region: 'Western Europe', pop: '10M', gdp: '$252B', leader: 'LuÃ­s Montenegro', title: 'Stable',
    analysis: {
      what: 'Portugal has achieved strong economic recovery, attracting digital nomads and investment. Tourism is booming, sometimes to excess. The center-right government faces challenges from housing costs and public services. Relations with former colonies in Africa remain important. Renewable energy progress is significant.',
      why: 'Portugal has become a model for economic recovery and tech-friendly policies. The country is strategically located for Atlantic shipping. Portuguese language connects 260 million speakers globally. Tourism and real estate have transformed the economy.',
      next: 'Balancing growth with livability is the key challenge. Watch for: housing policy, public service reform, and tourism management. Portugal\'s success story faces sustainability questions.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '2h ago', headline: 'Tourism arrivals set new record', url: '#' },
      { source: 'FT', bias: 'center', time: '5h ago', headline: 'Housing affordability measures debated', url: '#' }
    ]
  },

  'Qatar': { lat: 25.35, lng: 51.18, flag: 'ðŸ‡¶ðŸ‡¦', risk: 'clear', region: 'Middle East', pop: '3M', gdp: '$221B', leader: 'Sheikh Tamim', title: 'Diplomatic Hub',
    analysis: {
      what: 'Qatar has emerged as a crucial diplomatic mediator, hosting Hamas political office and facilitating Gaza negotiations. The country is the world\'s largest LNG exporter, benefiting from energy crisis. Post-World Cup infrastructure remains. Relations with neighbors have normalized after the 2017 blockade.',
      why: 'Qatar is the world\'s largest LNG exporter, crucial to European and Asian energy security. Its diplomatic role in conflicts from Gaza to Afghanistan is significant. Al Jazeera provides influential media reach. The sovereign wealth fund is a major global investor.',
      next: 'Diplomatic and energy roles will continue expanding. Watch for: Gaza mediation, LNG contracts, and regional positioning. Qatar\'s small size and enormous influence create unique dynamics.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '1h ago', headline: 'Qatar mediates new phase of Gaza talks', url: '#' },
      { source: 'FT', bias: 'center', time: '4h ago', headline: 'LNG exports reach record levels', url: '#' }
    ]
  },

  'Costa Rica': { lat: 9.75, lng: -83.75, flag: 'ðŸ‡¨ðŸ‡·', risk: 'clear', region: 'Central America', pop: '5M', gdp: '$69B', leader: 'Rodrigo Chaves', title: 'Stable Democracy',
    analysis: {
      what: 'Costa Rica remains Central America\'s most stable democracy with no military since 1948. The economy is diverse with tech, medical devices, and tourism. Environmental leadership continues with 99% renewable electricity. Relations with Nicaragua are strained. Social services face funding pressures.',
      why: 'Costa Rica is a model of stability and environmental leadership in a troubled region. It hosts significant international institutions. Ecotourism leadership offers lessons for conservation. The country\'s development model contrasts with neighbors.',
      next: 'Maintaining the Costa Rican model faces fiscal challenges. Watch for: environmental policy, regional migration, and economic diversification. Costa Rica\'s exceptionalism faces tests.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Tech exports drive economic growth', url: '#' },
      { source: 'Tico Times', bias: 'center', time: '6h ago', headline: 'Renewable energy investments continue', url: '#' }
    ]
  },

  'Uruguay': { lat: -32.52, lng: -55.77, flag: 'ðŸ‡ºðŸ‡¾', risk: 'clear', region: 'South America', pop: '3.5M', gdp: '$71B', leader: 'Lacalle Pou', title: 'Stable Democracy',
    analysis: {
      what: 'Uruguay remains South America\'s most stable and democratic country with strong institutions and low corruption. The economy depends on agriculture and services. Progressive social policies (marijuana legalization, abortion rights) continue. The small population limits influence but enables nimble governance.',
      why: 'Uruguay is a model of stability and good governance for Latin America. Its banking system attracts regional deposits. Progressive policies influence debates elsewhere. The country maintains good relations across the political spectrum.',
      next: 'Presidential elections in 2024 resulted in change. Watch for: economic policy, regional relations, and social policies. Uruguay\'s stability should continue regardless of who governs.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'New government maintains fiscal discipline', url: '#' },
      { source: 'El Observador', bias: 'center', time: '6h ago', headline: 'Agricultural exports strong despite drought', url: '#' }
    ]
  },

  'Botswana': { lat: -22.33, lng: 24.68, flag: 'ðŸ‡§ðŸ‡¼', risk: 'clear', region: 'Africa', pop: '2.6M', gdp: '$19B', leader: 'Duma Boko', title: 'Stable Democracy',
    analysis: {
      what: 'Botswana achieved a peaceful transfer of power in 2024 electionsâ€”rare in African history. The economy depends on diamond mining with De Beers partnership. Governance is among Africa\'s best with low corruption. Wildlife conservation is a major focus. Diversification away from diamonds remains a challenge.',
      why: 'Botswana is Africa\'s longest continuous democracy and governance model. Diamond revenues have funded development. The country\'s wildlife tourism is globally significant. Botswana shows that resource wealth can support good governance.',
      next: 'The new government must diversify the economy as diamond demand evolves. Watch for: economic reforms, conservation policy, and democratic consolidation. Botswana\'s success story should continue.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'New government outlines diversification plans', url: '#' },
      { source: 'AP', bias: 'center', time: '6h ago', headline: 'Diamond sector faces global demand changes', url: '#' }
    ]
  },

  // Remaining countries with brief analysis
  'Estonia': { lat: 58.60, lng: 25.01, flag: 'ðŸ‡ªðŸ‡ª', risk: 'cloudy', region: 'Baltic', pop: '1.4M', gdp: '$38B', leader: 'Kristen Michal', title: 'Digital Pioneer',
    analysis: {
      what: 'Estonia is a digital governance pioneer with e-residency programs and online voting. As a NATO frontline state bordering Russia, defense is paramount. The economy is tech-focused with high digital adoption. Russian minority relations require careful management.',
      why: 'Estonia demonstrates how small states can leverage technology. Its border with Russia makes it NATO\'s northeastern anchor. Cybersecurity expertise is globally recognized. The country hosts NATO cyber defense center.',
      next: 'Digital leadership and security focus will continue. Watch for: Russia relations, tech sector growth, and NATO posture.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Estonia increases defense spending to 3.5% of GDP', url: '#' }
    ]
  },

  'Latvia': { lat: 56.88, lng: 24.60, flag: 'ðŸ‡±ðŸ‡»', risk: 'cloudy', region: 'Baltic', pop: '1.9M', gdp: '$41B', leader: 'Evika SiliÅ†a', title: 'NATO Frontline',
    analysis: {
      what: 'Latvia is a NATO frontline state with significant Russian-speaking minority. Defense spending has increased dramatically. The economy is recovering from energy price shocks. Democratic institutions are solid. The country hosts NATO battlegroup.',
      why: 'Latvia\'s strategic position between Russia and NATO makes it crucial to alliance defense. Managing ethnic Russian population while countering Russian influence is challenging. Baltic cooperation is strengthening.',
      next: 'Security will remain the dominant concern. Watch for: defense investments, integration policies, and NATO presence.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'NATO reinforces Baltic air patrols', url: '#' }
    ]
  },

  'Lithuania': { lat: 55.17, lng: 23.88, flag: 'ðŸ‡±ðŸ‡¹', risk: 'cloudy', region: 'Baltic', pop: '2.8M', gdp: '$70B', leader: 'Ingrida Å imonytÄ—', title: 'Belarus Border',
    analysis: {
      what: 'Lithuania has taken a strong stance against Belarus and Russia, hosting opposition figures and breaking with China over Taiwan. The economy is growing despite regional tensions. The Suwalki Gap (land connection to NATO) is a strategic vulnerability.',
      why: 'Lithuania\'s position adjacent to Russian exclave Kaliningrad and Belarus makes it NATO\'s most exposed member. Its principled foreign policy has made it a target for authoritarian pressure. The country is vocal on human rights.',
      next: 'Strategic exposure will continue requiring allied attention. Watch for: Belarus border situation, China relations, and defense buildup.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'US troops reinforce Suwalki corridor', url: '#' }
    ]
  },

  'Czech Republic': { lat: 49.82, lng: 15.47, flag: 'ðŸ‡¨ðŸ‡¿', risk: 'clear', region: 'Eastern Europe', pop: '10M', gdp: '$290B', leader: 'Petr Fiala', title: 'Stable',
    analysis: {
      what: 'The Czech Republic is among Central Europe\'s most stable democracies with strong institutions. The economy is manufacturing-heavy, integrated with German supply chains. Support for Ukraine has been strong. Housing costs are a domestic concern.',
      why: 'The Czech economy is closely tied to German industry, especially automotive. Prague is a major tourism and business center. The country\'s pro-Western stance is firm. Arms supplies to Ukraine have been significant.',
      next: 'Stability and EU integration will continue. Watch for: economic performance, elections, and continued Ukraine support.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Czech ammunition initiative for Ukraine expands', url: '#' }
    ]
  },

  'Belgium': { lat: 50.50, lng: 4.47, flag: 'ðŸ‡§ðŸ‡ª', risk: 'clear', region: 'Western Europe', pop: '12M', gdp: '$582B', leader: 'Alexander De Croo', title: 'EU Capital',
    analysis: {
      what: 'Belgium hosts EU and NATO headquarters, giving it outsized international importance. Complex federal structure divides Dutch and French-speaking regions. The economy is diverse with pharmaceuticals and chemicals prominent. Governance is often complicated by linguistic politics.',
      why: 'Brussels is effectively the capital of Europe, hosting major institutions. Belgium\'s port of Antwerp is among Europe\'s largest. The country\'s internal divisions mirror broader European tensions. Intelligence services track terrorist threats.',
      next: 'Belgium\'s role as institutional host will continue. Watch for: federal politics, economic performance, and EU developments.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'EU summit addresses Ukraine support', url: '#' }
    ]
  },

  'Croatia': { lat: 45.10, lng: 15.20, flag: 'ðŸ‡­ðŸ‡·', risk: 'clear', region: 'Southern Europe', pop: '4M', gdp: '$71B', leader: 'Andrej PlenkoviÄ‡', title: 'Eurozone Member',
    analysis: {
      what: 'Croatia joined the eurozone and Schengen in 2023, completing EU integration. Tourism drives the economy, particularly along the Adriatic coast. Relations with Serbia and Bosnia require management. Emigration to Western Europe is a demographic challenge.',
      why: 'Croatia\'s EU integration path is complete, making it a model for Western Balkan aspirants. Its Adriatic coast is strategically and economically important. The country bridges Central Europe and the Balkans.',
      next: 'Building on EU integration will be the focus. Watch for: tourism, demographics, and regional relations.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Eurozone membership boosts tourism investment', url: '#' }
    ]
  },

  'Slovenia': { lat: 46.15, lng: 14.99, flag: 'ðŸ‡¸ðŸ‡®', risk: 'clear', region: 'Southern Europe', pop: '2M', gdp: '$62B', leader: 'Robert Golob', title: 'Stable',
    analysis: {
      what: 'Slovenia is among Europe\'s most developed post-communist states. The economy is export-oriented with pharmaceuticals and automotive. Progressive social policies include same-sex marriage. Brief populist interlude under JanÅ¡a has ended.',
      why: 'Slovenia shows successful EU integration path. The country bridges Germanic and Slavic Europe. Its stability contrasts with Balkan neighbors. The port of Koper serves landlocked Central Europe.',
      next: 'Continued stability and development. Watch for: economic performance and EU engagement.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Slovenia leads EU renewable energy growth', url: '#' }
    ]
  },

  'Luxembourg': { lat: 49.82, lng: 6.13, flag: 'ðŸ‡±ðŸ‡º', risk: 'clear', region: 'Western Europe', pop: '0.7M', gdp: '$87B', leader: 'Luc Frieden', title: 'Financial Hub',
    analysis: {
      what: 'Luxembourg has the world\'s highest GDP per capita, driven by financial services. It hosts major EU institutions including the European Court of Justice. Tax policies have faced criticism but remain attractive. The tiny country punches above its weight.',
      why: 'Luxembourg is a major financial center with trillions in managed assets. Its EU institutional role gives influence. The country demonstrates how small states can thrive. Space industry ambitions are growing.',
      next: 'Financial services dominance will continue despite pressure. Watch for: tax policy changes and EU relations.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Luxembourg fund industry reaches new highs', url: '#' }
    ]
  },

  'Oman': { lat: 21.47, lng: 55.98, flag: 'ðŸ‡´ðŸ‡²', risk: 'clear', region: 'Middle East', pop: '5M', gdp: '$104B', leader: 'Sultan Haitham', title: 'Neutral Mediator',
    analysis: {
      what: 'Oman maintains neutrality in regional conflicts, often serving as a diplomatic back channel. Sultan Haitham continues modernization while preserving stability. The economy is diversifying from oil through tourism and logistics. Relations with all regional powers are maintained.',
      why: 'Oman\'s neutrality makes it invaluable for diplomacyâ€”US-Iran talks often use Omani channels. The Strait of Hormuz gives strategic importance. The country balances Saudi, Iranian, and Western relationships uniquely.',
      next: 'Mediating role will continue to be valuable. Watch for: economic diversification, succession stability, and diplomatic initiatives.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Oman facilitates regional dialogue', url: '#' }
    ]
  },

  'Iceland': { lat: 64.96, lng: -19.02, flag: 'ðŸ‡®ðŸ‡¸', risk: 'clear', region: 'Northern Europe', pop: '0.4M', gdp: '$27B', leader: 'Bjarni Benediktsson', title: 'Volcanic Activity',
    analysis: {
      what: 'Iceland has experienced significant volcanic activity with eruptions near GrindavÃ­k. The economy is driven by tourism, fishing, and geothermal energy. NATO member hosting US facilities. Financial recovery from 2008 crisis is complete.',
      why: 'Iceland controls strategic North Atlantic approaches. Its renewable energy model is globally studied. Fishing rights remain important. Volcanic activity affects global aviation.',
      next: 'Managing volcanic risks while maintaining tourism growth. Watch for: geological activity and Arctic positioning.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Volcanic activity continues near GrindavÃ­k', url: '#' }
    ]
  },

  'Malta': { lat: 35.94, lng: 14.38, flag: 'ðŸ‡²ðŸ‡¹', risk: 'clear', region: 'Mediterranean', pop: '0.5M', gdp: '$18B', leader: 'Robert Abela', title: 'Stable',
    analysis: {
      what: 'Malta is a prosperous island nation with gaming, financial services, and tourism. EU membership has brought growth. Governance concerns exist around citizenship sales and journalist murder investigation. Mediterranean migration routes affect the island.',
      why: 'Malta\'s strategic Mediterranean position has historical and current importance. Its gaming and fintech sectors are significant. The country hosts NATO naval facilities.',
      next: 'Continued prosperity with governance questions. Watch for: migration pressures and rule of law concerns.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Malta gaming sector continues growth', url: '#' }
    ]
  },

  'Mongolia': { lat: 46.86, lng: 103.85, flag: 'ðŸ‡²ðŸ‡³', risk: 'clear', region: 'East Asia', pop: '3.4M', gdp: '$17B', leader: 'KhÃ¼relsÃ¼kh', title: 'Stable Democracy',
    analysis: {
      what: 'Mongolia is a rare democracy sandwiched between Russia and China. Mining (copper, coal) drives the economy but creates environmental concerns. "Third neighbor" policy seeks ties with US, Japan, South Korea. Traditional nomadic culture persists alongside modernization.',
      why: 'Mongolia\'s democracy in a challenging neighborhood is remarkable. Its mineral resources are vast. The country provides a buffer between great powers. Traditional practices offer cultural heritage.',
      next: 'Balancing great power relations while developing resources. Watch for: mining development, democratic resilience, and neighbor relations.'
    },
    news: [
      { source: 'Reuters', bias: 'center', time: '3h ago', headline: 'Mining exports drive economic growth', url: '#' }
    ]
  },
  'Jamaica': { lat: 18.11, lng: -77.30, flag: 'ðŸ‡¯ðŸ‡²', risk: 'cloudy', region: 'Caribbean', pop: '3M', gdp: '$17B', leader: 'Holness', title: 'Tourism Economy', analysis: { what: 'Jamaica faces high crime rates and gang violence despite being a popular tourist destination. The economy relies heavily on tourism, remittances, and bauxite mining.', why: 'Jamaica is culturally influential globally through music and sports. Its strategic Caribbean location matters for US interests.', next: 'Addressing crime while growing tourism. Watch for: anti-gang initiatives and economic diversification.' }, news: [{ source: 'Jamaica Observer', bias: 'center', time: '4h ago', headline: 'Tourism numbers continue recovery', url: '#' }] },
  'Dominican Republic': { lat: 18.74, lng: -70.16, flag: 'ðŸ‡©ðŸ‡´', risk: 'cloudy', region: 'Caribbean', pop: '11M', gdp: '$114B', leader: 'Abinader', title: 'Growing Economy', analysis: { what: 'The Dominican Republic has one of the fastest-growing economies in Latin America. Tourism and free trade zones drive growth. Haitian migration creates social tensions.', why: 'Strong growth makes it a regional success story. Relations with Haiti affect regional stability.', next: 'Sustaining growth while managing migration. Watch for: Haitian border issues and tourism development.' }, news: [{ source: 'Reuters', bias: 'center', time: '5h ago', headline: 'Economic growth outpaces regional average', url: '#' }] },
  'Trinidad and Tobago': { lat: 10.69, lng: -61.22, flag: 'ðŸ‡¹ðŸ‡¹', risk: 'cloudy', region: 'Caribbean', pop: '1.4M', gdp: '$28B', leader: 'Rowley', title: 'Energy Exporter', analysis: { what: 'Trinidad and Tobago is the Caribbean\'s largest oil and gas producer. The economy is heavily dependent on energy exports. Crime and gang violence are growing concerns.', why: 'Energy resources make it relatively wealthy for the region. Venezuelan migration has increased.', next: 'Diversifying beyond energy while addressing crime.' }, news: [{ source: 'Reuters', bias: 'center', time: '6h ago', headline: 'Energy sector drives budget surplus', url: '#' }] },
  'Bahamas': { lat: 25.03, lng: -77.40, flag: 'ðŸ‡§ðŸ‡¸', risk: 'clear', region: 'Caribbean', pop: '400K', gdp: '$14B', leader: 'Davis', title: 'Tourism Hub', analysis: { what: 'The Bahamas economy depends almost entirely on tourism and financial services. Climate change and hurricanes pose existential threats to the low-lying islands.', why: 'Proximity to US makes it a major tourist destination. Climate vulnerability is among the highest globally.', next: 'Building climate resilience while growing tourism.' }, news: [{ source: 'Tribune', bias: 'center', time: '4h ago', headline: 'Cruise tourism hits record numbers', url: '#' }] },
  'Barbados': { lat: 13.19, lng: -59.54, flag: 'ðŸ‡§ðŸ‡§', risk: 'clear', region: 'Caribbean', pop: '288K', gdp: '$6B', leader: 'Mottley', title: 'Climate Advocate', analysis: { what: 'Barbados became a republic in 2021. PM Mottley is a global voice on climate finance and debt restructuring for developing nations.', why: 'Mottley\'s climate advocacy gives it outsized influence. The Bridgetown Initiative on climate finance has global impact.', next: 'Leading climate finance reform efforts.' }, news: [{ source: 'Barbados Today', bias: 'center', time: '5h ago', headline: 'Climate finance initiative gains support', url: '#' }] },
  'Guatemala': { lat: 15.78, lng: -90.23, flag: 'ðŸ‡¬ðŸ‡¹', risk: 'stormy', region: 'Central America', pop: '17M', gdp: '$95B', leader: 'ArÃ©valo', title: 'Democratic Transition', analysis: { what: 'President ArÃ©valo took office in 2024 after attempts to block his inauguration. Corruption remains endemic. Guatemala is a major source of US-bound migration.', why: 'Democratic backsliding threatened but was resisted. Migration flows affect US politics.', next: 'Testing whether reforms can succeed against entrenched interests.' }, news: [{ source: 'Reuters', bias: 'center', time: '4h ago', headline: 'New president pushes anti-corruption agenda', url: '#' }] },
  'Honduras': { lat: 14.08, lng: -87.21, flag: 'ðŸ‡­ðŸ‡³', risk: 'stormy', region: 'Central America', pop: '10M', gdp: '$32B', leader: 'Castro', title: 'Reform Efforts', analysis: { what: 'President Xiomara Castro is the first female president, elected on anti-corruption platform. Gang violence remains severe.', why: 'High violence drives migration northward. China switch affects regional geopolitics.', next: 'Reducing violence and corruption.' }, news: [{ source: 'Reuters', bias: 'center', time: '5h ago', headline: 'Government announces anti-gang measures', url: '#' }] },
  'Belize': { lat: 17.19, lng: -88.50, flag: 'ðŸ‡§ðŸ‡¿', risk: 'cloudy', region: 'Central America', pop: '430K', gdp: '$3.3B', leader: 'BriceÃ±o', title: 'Diverse Nation', analysis: { what: 'Belize is the only English-speaking Central American country. Tourism and agriculture drive the economy apply.', why: 'Barrier reef is a major tourist attraction and environmental concern.', next: 'Protecting environment while growing economy.' }, news: [{ source: 'Amandala', bias: 'center', time: '6h ago', headline: 'Reef conservation efforts intensify', url: '#' }] },
  'Panama': { lat: 9.10, lng: -79.40, flag: 'ðŸ‡µðŸ‡¦', risk: 'cloudy', region: 'Central America', pop: '4.4M', gdp: '$77B', leader: 'Mulino', title: 'Canal State', analysis: { what: 'The Panama Canal is essential to global trade. Drought has restricted canal capacity. Darien Gap migration surges.', why: 'Canal disruptions affect global supply chains. Darien migration is a humanitarian crisis.', next: 'Managing water resources and migration.' }, news: [{ source: 'Reuters', bias: 'center', time: '4h ago', headline: 'Canal drought restrictions continue', url: '#' }] },
  'Paraguay': { lat: -23.44, lng: -58.44, flag: 'ðŸ‡µðŸ‡¾', risk: 'cloudy', region: 'South America', pop: '7M', gdp: '$44B', leader: 'PeÃ±a', title: 'Landlocked Nation', analysis: { what: 'Paraguay is landlocked and dependent on hydroelectric exports. Soy and beef are major exports. The country maintains relations with Taiwan.', why: 'Hydroelectric partnership with Brazil is significant. Taiwan recognition makes it geopolitically notable.', next: 'Balancing development and environment.' }, news: [{ source: 'ABC', bias: 'center', time: '5h ago', headline: 'Hydroelectric exports boost revenues', url: '#' }] },
  'Suriname': { lat: 3.92, lng: -56.03, flag: 'ðŸ‡¸ðŸ‡·', risk: 'cloudy', region: 'South America', pop: '620K', gdp: '$4B', leader: 'Santokhi', title: 'Oil Potential', analysis: { what: 'Major offshore oil discoveries could transform Suriname\'s economy. The former Dutch colony is ethnically diverse.', why: 'Oil discoveries make it potentially wealthy. Democratic transition from Bouterse era is important.', next: 'Managing potential oil wealth responsibly.' }, news: [{ source: 'Starnieuws', bias: 'center', time: '6h ago', headline: 'Oil development plans advance', url: '#' }] },
  'Albania': { lat: 41.33, lng: 19.82, flag: 'ðŸ‡¦ðŸ‡±', risk: 'cloudy', region: 'Europe', pop: '2.8M', gdp: '$23B', leader: 'Rama', title: 'EU Aspirant', analysis: { what: 'Albania is pursuing EU membership and has made reforms. Tourism is growing. Organized crime and corruption remain challenges.', why: 'EU accession process drives reforms. Strategic location on Adriatic.', next: 'Continuing EU accession path.' }, news: [{ source: 'Exit News', bias: 'center', time: '5h ago', headline: 'EU integration talks continue', url: '#' }] },
  'North Macedonia': { lat: 41.51, lng: 21.75, flag: 'ðŸ‡²ðŸ‡°', risk: 'cloudy', region: 'Europe', pop: '2.1M', gdp: '$15B', leader: 'Siljanovska-Davkova', title: 'NATO Member', analysis: { what: 'Joined NATO in 2020 after name change agreement with Greece. EU membership blocked by Bulgaria over historical disputes.', why: 'Name dispute resolution was historic achievement. EU path blocked creates frustration.', next: 'Resolving Bulgaria dispute for EU path.' }, news: [{ source: 'MIA', bias: 'center', time: '6h ago', headline: 'EU membership negotiations stalled', url: '#' }] },
  'Montenegro': { lat: 42.44, lng: 19.26, flag: 'ðŸ‡²ðŸ‡ª', risk: 'cloudy', region: 'Europe', pop: '620K', gdp: '$7B', leader: 'MilatoviÄ‡', title: 'NATO Member', analysis: { what: 'Montenegro joined NATO in 2017 and seeks EU membership. Russian influence and investment has been significant.', why: 'NATO membership despite Russian pressure was notable. EU frontrunner in Western Balkans.', next: 'Advancing EU accession while managing influences.' }, news: [{ source: 'Vijesti', bias: 'center', time: '5h ago', headline: 'EU accession talks progress', url: '#' }] },
  'Kosovo': { lat: 42.57, lng: 20.90, flag: 'ðŸ‡½ðŸ‡°', risk: 'stormy', region: 'Europe', pop: '1.8M', gdp: '$10B', leader: 'Osmani', title: 'Disputed Territory', analysis: { what: 'Kosovo declared independence from Serbia in 2008 but is not universally recognized. Tensions with Serbia remain high.', why: 'Serbia-Kosovo tensions risk regional instability. Recognition dispute affects international participation.', next: 'Normalizing Serbia relations remains key.' }, news: [{ source: 'Prishtina Insight', bias: 'center', time: '4h ago', headline: 'EU-mediated talks with Serbia resume', url: '#' }] },
  'Bosnia and Herzegovina': { lat: 43.92, lng: 17.68, flag: 'ðŸ‡§ðŸ‡¦', risk: 'stormy', region: 'Europe', pop: '3.2M', gdp: '$28B', leader: 'BeÄ‡iroviÄ‡', title: 'Complex State', analysis: { what: 'Bosnia\'s Dayton Agreement structure creates dysfunction. Republika Srpska leader Dodik threatens secession.', why: 'Secession threats risk renewed conflict. EU path blocked by political dysfunction.', next: 'Preventing further fragmentation.' }, news: [{ source: 'Klix', bias: 'center', time: '5h ago', headline: 'Political tensions remain high', url: '#' }] },
  'Cyprus': { lat: 35.17, lng: 33.36, flag: 'ðŸ‡¨ðŸ‡¾', risk: 'cloudy', region: 'Europe', pop: '1.3M', gdp: '$32B', leader: 'Christodoulides', title: 'Divided Island', analysis: { what: 'Cyprus remains divided between Greek south and Turkish-occupied north. Reunification talks have repeatedly failed.', why: 'Division affects EU-Turkey relations. Gas discoveries in eastern Mediterranean raise stakes.', next: 'Reunification prospects remain dim.' }, news: [{ source: 'Cyprus Mail', bias: 'center', time: '6h ago', headline: 'Reunification talks show no progress', url: '#' }] },
  'Bulgaria': { lat: 42.73, lng: 25.49, flag: 'ðŸ‡§ðŸ‡¬', risk: 'cloudy', region: 'Europe', pop: '6.5M', gdp: '$100B', leader: 'Zhelezkov', title: 'EU Member', analysis: { what: 'Bulgaria has faced repeated political instability with multiple elections. Corruption remains endemic.', why: 'Poorest EU member struggles with rule of law. Russian influence historically significant.', next: 'Achieving political stability.' }, news: [{ source: 'Novinite', bias: 'center', time: '5h ago', headline: 'Political negotiations continue', url: '#' }] },
  'Slovakia': { lat: 48.67, lng: 19.70, flag: 'ðŸ‡¸ðŸ‡°', risk: 'cloudy', region: 'Europe', pop: '5.4M', gdp: '$133B', leader: 'Fico', title: 'EU Dissent', analysis: { what: 'PM Fico returned to power with pro-Russian rhetoric and opposition to Ukraine aid. Assassination attempt in 2024 shocked the country.', why: 'Breaking EU consensus on Ukraine matters. Rule of law concerns affect EU relations.', next: 'Watching democratic trajectory.' }, news: [{ source: 'SME', bias: 'center', time: '4h ago', headline: 'Government faces EU criticism', url: '#' }] },
  'Cameroon': { lat: 5.95, lng: 10.15, flag: 'ðŸ‡¨ðŸ‡²', risk: 'severe', region: 'Africa', pop: '28M', gdp: '$46B', leader: 'Biya', title: 'Anglophone Crisis', analysis: { what: 'President Biya has ruled since 1982. Anglophone regions face violent separatist conflict.', why: 'Anglophone crisis has killed thousands and displaced millions. Biya\'s age creates succession uncertainty.', next: 'Succession planning is overdue.' }, news: [{ source: 'Journal du Cameroun', bias: 'center', time: '5h ago', headline: 'Anglophone crisis continues', url: '#' }] },
  'Chad': { lat: 15.45, lng: 18.73, flag: 'ðŸ‡¹ðŸ‡©', risk: 'severe', region: 'Africa', pop: '18M', gdp: '$13B', leader: 'DÃ©by', title: 'Military Rule', analysis: { what: 'Mahamat DÃ©by took power after his father was killed in 2021. The country hosts French and US military bases.', why: 'Strategic importance for Sahel counterterrorism is high. Refugee flows from Sudan add pressure.', next: 'Watching promised democratic transition.' }, news: [{ source: 'Alwihda', bias: 'center', time: '6h ago', headline: 'Transition government extends timeline', url: '#' }] },
  'Central African Republic': { lat: 6.61, lng: 20.94, flag: 'ðŸ‡¨ðŸ‡«', risk: 'extreme', region: 'Africa', pop: '5M', gdp: '$2.5B', leader: 'TouadÃ©ra', title: 'Wagner Presence', analysis: { what: 'CAR has been in civil war since 2012. Russian Wagner forces support the government and exploit resources.', why: 'Wagner expansion model was tested here. Humanitarian crisis affects most of population.', next: 'Continued instability likely.' }, news: [{ source: 'RFI', bias: 'center', time: '5h ago', headline: 'Security situation remains fragile', url: '#' }] },
  'Republic of Congo': { lat: -4.27, lng: 15.28, flag: 'ðŸ‡¨ðŸ‡¬', risk: 'stormy', region: 'Africa', pop: '6M', gdp: '$13B', leader: 'Sassou Nguesso', title: 'Oil State', analysis: { what: 'President Sassou Nguesso has ruled for most of the period since 1979. Oil revenue dominates but benefits few.', why: 'Oil dependence creates boom-bust cycles. Chinese debt is significant.', next: 'Managing oil decline and debt.' }, news: [{ source: 'AFP', bias: 'center', time: '6h ago', headline: 'Oil production declines continue', url: '#' }] },
  'Gabon': { lat: -0.80, lng: 11.61, flag: 'ðŸ‡¬ðŸ‡¦', risk: 'stormy', region: 'Africa', pop: '2.4M', gdp: '$21B', leader: 'Oligui Nguema', title: 'Post-Coup Transition', analysis: { what: 'Military coup in 2023 ended the Bongo family\'s 56-year rule. Junta promises democratic transition.', why: 'Coup shows fragility of dynastic rule in Africa. Transition timeline uncertain.', next: 'Watching promised democratization.' }, news: [{ source: 'Gabon Review', bias: 'center', time: '5h ago', headline: 'Transition government announces reforms', url: '#' }] },
  'Equatorial Guinea': { lat: 1.65, lng: 10.27, flag: 'ðŸ‡¬ðŸ‡¶', risk: 'stormy', region: 'Africa', pop: '1.7M', gdp: '$12B', leader: 'Obiang', title: 'Oil Dictatorship', analysis: { what: 'Teodoro Obiang has ruled since 1979, making him the world\'s longest-ruling president. Oil wealth benefits the elite.', why: 'Extreme inequality despite oil wealth is stark. Human rights abuses are severe.', next: 'Continued authoritarian rule expected.' }, news: [{ source: 'EG Justice', bias: 'center', time: '6h ago', headline: 'Human rights concerns persist', url: '#' }] },
  'Eritrea': { lat: 15.33, lng: 38.93, flag: 'ðŸ‡ªðŸ‡·', risk: 'severe', region: 'Africa', pop: '3.6M', gdp: '$2.3B', leader: 'Isaias', title: 'Isolated State', analysis: { what: 'Eritrea is one of the world\'s most repressive states with no elections since independence. Indefinite military conscription drives mass emigration.', why: 'Tigray involvement showed regional destabilization capacity. No constitution or independent media.', next: 'Continued isolation and repression likely.' }, news: [{ source: 'Eritrea Hub', bias: 'center', time: '5h ago', headline: 'International isolation continues', url: '#' }] },
  'Djibouti': { lat: 11.59, lng: 43.15, flag: 'ðŸ‡©ðŸ‡¯', risk: 'cloudy', region: 'Africa', pop: '1M', gdp: '$4B', leader: 'Guelleh', title: 'Strategic Port', analysis: { what: 'Djibouti hosts military bases from US, France, China, Japan, and others. Its port handles most of Ethiopia\'s trade.', why: 'Strategic location at Bab el-Mandeb strait is vital. Chinese base was their first overseas.', next: 'Maintaining strategic balancing act.' }, news: [{ source: 'La Nation', bias: 'center', time: '6h ago', headline: 'Port expansion plans announced', url: '#' }] },
  'Rwanda': { lat: -1.94, lng: 29.87, flag: 'ðŸ‡·ðŸ‡¼', risk: 'stormy', region: 'Africa', pop: '14M', gdp: '$14B', leader: 'Kagame', title: 'Development Model', analysis: { what: 'Rwanda has achieved remarkable development under Kagame but with authoritarian control. The country is accused of backing M23 rebels in DRC.', why: 'Development success comes with democratic concerns. DRC involvement risks regional war.', next: 'Balancing development and rights.' }, news: [{ source: 'The New Times', bias: 'center', time: '5h ago', headline: 'Economic growth continues', url: '#' }] },
  'Burundi': { lat: -3.37, lng: 29.36, flag: 'ðŸ‡§ðŸ‡®', risk: 'severe', region: 'Africa', pop: '13M', gdp: '$3B', leader: 'Ndayishimiye', title: 'Post-Crisis State', analysis: { what: 'Burundi faced political crisis in 2015. Current President has slightly eased repression. Extreme poverty persists.', why: 'Ethnic tensions mirror Rwanda\'s history. Among world\'s poorest countries.', next: 'Gradual opening or renewed repression.' }, news: [{ source: 'Iwacu', bias: 'center', time: '6h ago', headline: 'Government eases some restrictions', url: '#' }] },
  'Uganda': { lat: 1.37, lng: 32.29, flag: 'ðŸ‡ºðŸ‡¬', risk: 'stormy', region: 'Africa', pop: '48M', gdp: '$50B', leader: 'Museveni', title: 'Long-Term Rule', analysis: { what: 'Museveni has ruled since 1986. Anti-LGBTQ law drew international sanctions. Oil production is beginning.', why: 'Anti-LGBTQ law affected aid and investment. Young population could drive unrest.', next: 'Succession planning for aging ruler.' }, news: [{ source: 'Daily Monitor', bias: 'center', time: '5h ago', headline: 'Oil production ramp-up continues', url: '#' }] },
  'South Sudan': { lat: 6.88, lng: 31.31, flag: 'ðŸ‡¸ðŸ‡¸', risk: 'extreme', region: 'Africa', pop: '11M', gdp: '$4B', leader: 'Kiir', title: 'Failed State', analysis: { what: 'The world\'s newest country has been in civil war most of its existence. Peace deal has not been fully implemented.', why: 'Humanitarian crisis affects millions. State barely functions outside capital.', next: 'Elections repeatedly delayed.' }, news: [{ source: 'Radio Tamazuj', bias: 'center', time: '4h ago', headline: 'Elections delayed again', url: '#' }] },
  'Mauritania': { lat: 18.09, lng: -15.98, flag: 'ðŸ‡²ðŸ‡·', risk: 'cloudy', region: 'Africa', pop: '5M', gdp: '$10B', leader: 'Ghazouani', title: 'Sahel Stability', analysis: { what: 'Mauritania has avoided the coups and jihadi violence affecting neighbors. Growing gas production could transform economy.', why: 'Relative stability in unstable region is notable. Gas potential could be transformative.', next: 'Maintaining stability amid regional turmoil.' }, news: [{ source: 'Sahara MÃ©dias', bias: 'center', time: '6h ago', headline: 'Gas development plans advance', url: '#' }] },
  'Gambia': { lat: 13.44, lng: -16.69, flag: 'ðŸ‡¬ðŸ‡²', risk: 'cloudy', region: 'Africa', pop: '2.7M', gdp: '$2.4B', leader: 'Barrow', title: 'Democratic Transition', analysis: { what: 'Gambia transitioned from Jammeh\'s dictatorship in 2017 after he refused to accept election defeat.', why: 'Democratic transition was remarkable. Truth and reconciliation process ongoing.', next: 'Consolidating democracy.' }, news: [{ source: 'The Point', bias: 'center', time: '5h ago', headline: 'Truth commission releases findings', url: '#' }] },
  'Guinea': { lat: 9.95, lng: -9.70, flag: 'ðŸ‡¬ðŸ‡³', risk: 'stormy', region: 'Africa', pop: '14M', gdp: '$21B', leader: 'Doumbouya', title: 'Military Junta', analysis: { what: 'Military coup in 2021 overthrew President CondÃ©. Massive bauxite and iron ore reserves attract Chinese investment.', why: 'Mining resources make it strategically important. Democratic transition timeline is unclear.', next: 'Watching promised transition.' }, news: [{ source: 'Guinee7', bias: 'center', time: '6h ago', headline: 'Opposition protests face crackdown', url: '#' }] },
  'Guinea-Bissau': { lat: 11.86, lng: -15.60, flag: 'ðŸ‡¬ðŸ‡¼', risk: 'stormy', region: 'Africa', pop: '2.1M', gdp: '$2B', leader: 'EmbalÃ³', title: 'Narco State', analysis: { what: 'Guinea-Bissau is a major cocaine transit point to Europe. Political instability and coup attempts are frequent.', why: 'Drug trafficking corrupts state institutions. Among world\'s poorest countries.', next: 'Breaking the instability cycle.' }, news: [{ source: 'RFI', bias: 'center', time: '5h ago', headline: 'Drug trafficking concerns persist', url: '#' }] },
  'Sierra Leone': { lat: 8.48, lng: -13.23, flag: 'ðŸ‡¸ðŸ‡±', risk: 'cloudy', region: 'Africa', pop: '8.6M', gdp: '$4.5B', leader: 'Bio', title: 'Post-War Recovery', analysis: { what: 'Sierra Leone has rebuilt since the brutal civil war ended in 2002. 2023 election was disputed by opposition.', why: 'Post-war stability shows recovery is possible. Development indicators remain very low.', next: 'Resolving political tensions.' }, news: [{ source: 'Awoko', bias: 'center', time: '6h ago', headline: 'Post-election tensions ease', url: '#' }] },
  'Liberia': { lat: 6.43, lng: -9.43, flag: 'ðŸ‡±ðŸ‡·', risk: 'cloudy', region: 'Africa', pop: '5.4M', gdp: '$4B', leader: 'Boakai', title: 'New Leadership', analysis: { what: 'Joseph Boakai won 2023 election, defeating incumbent Weah. Founded by freed American slaves, Liberia has US ties.', why: 'Peaceful transfer of power was democratic milestone. US historical ties are unique in Africa.', next: 'New government faces development challenges.' }, news: [{ source: 'Front Page Africa', bias: 'center', time: '5h ago', headline: 'New government announces priorities', url: '#' }] },
  'Ivory Coast': { lat: 7.54, lng: -5.55, flag: 'ðŸ‡¨ðŸ‡®', risk: 'cloudy', region: 'Africa', pop: '29M', gdp: '$80B', leader: 'Ouattara', title: 'Economic Leader', analysis: { what: 'Ivory Coast is the world\'s largest cocoa producer and West Africa\'s largest economy.', why: 'Economic importance to region is significant. Cocoa industry faces sustainability challenges.', next: 'Managing succession and economic growth.' }, news: [{ source: 'Abidjan.net', bias: 'center', time: '6h ago', headline: 'Economic growth remains strong', url: '#' }] },
  'Togo': { lat: 6.17, lng: 1.23, flag: 'ðŸ‡¹ðŸ‡¬', risk: 'stormy', region: 'Africa', pop: '9M', gdp: '$9B', leader: 'GnassingbÃ©', title: 'Dynasty Rule', analysis: { what: 'The GnassingbÃ© family has ruled since 1967. Constitutional changes in 2024 extended presidential power.', why: 'Dynastic rule shows authoritarian persistence. Democratic space is very limited.', next: 'Continued family rule expected.' }, news: [{ source: 'Togo First', bias: 'center', time: '5h ago', headline: 'Constitutional changes implemented', url: '#' }] },
  'Benin': { lat: 9.31, lng: 2.32, flag: 'ðŸ‡§ðŸ‡¯', risk: 'cloudy', region: 'Africa', pop: '13M', gdp: '$19B', leader: 'Talon', title: 'Democratic Backslide', analysis: { what: 'Once a democratic model, Benin has seen backsliding under President Talon. Opposition leaders imprisoned or exiled.', why: 'Democratic decline in former model is concerning. Opposition space has shrunk dramatically.', next: 'Watching political trajectory.' }, news: [{ source: 'La Nation', bias: 'center', time: '6h ago', headline: 'Economic reforms continue', url: '#' }] },
  'Ghana': { lat: 7.95, lng: -1.02, flag: 'ðŸ‡¬ðŸ‡­', risk: 'cloudy', region: 'Africa', pop: '34M', gdp: '$79B', leader: 'Mahama', title: 'Democratic Model', analysis: { what: 'Ghana is considered one of Africa\'s most stable democracies. Economic crisis led to IMF bailout.', why: 'Democratic stability makes it regional anchor. Peaceful elections are regular occurrence.', next: 'Economic recovery under new government.' }, news: [{ source: 'GhanaWeb', bias: 'center', time: '5h ago', headline: 'New government tackles economic crisis', url: '#' }] },
  'Cape Verde': { lat: 15.12, lng: -23.61, flag: 'ðŸ‡¨ðŸ‡»', risk: 'clear', region: 'Africa', pop: '600K', gdp: '$2.5B', leader: 'Neves', title: 'Island Democracy', analysis: { what: 'Cape Verde is one of Africa\'s most stable democracies. Tourism drives the economy.', why: 'Democratic stability is exemplary for region. Geographic isolation limits options.', next: 'Diversifying tourism-dependent economy.' }, news: [{ source: 'A Semana', bias: 'center', time: '6h ago', headline: 'Tourism sector expands', url: '#' }] },
  'Madagascar': { lat: -18.77, lng: 46.87, flag: 'ðŸ‡²ðŸ‡¬', risk: 'stormy', region: 'Africa', pop: '30M', gdp: '$16B', leader: 'Rajoelina', title: 'Biodiversity Hotspot', analysis: { what: 'Madagascar has unique biodiversity found nowhere else. Deforestation threatens endemic species. Poverty is widespread.', why: 'Environmental destruction is irreversible loss. Unique wildlife draws conservation attention.', next: 'Balancing development and conservation.' }, news: [{ source: 'L\'Express de Madagascar', bias: 'center', time: '5h ago', headline: 'Conservation challenges continue', url: '#' }] },
  'Mauritius': { lat: -20.35, lng: 57.55, flag: 'ðŸ‡²ðŸ‡º', risk: 'clear', region: 'Africa', pop: '1.3M', gdp: '$15B', leader: 'Ramgoolam', title: 'Success Story', analysis: { what: 'Mauritius transformed from sugar monoculture to diversified economy with tourism, textiles, and financial services.', why: 'Economic success model for small islands. Democratic stability is exceptional for region.', next: 'Sustaining economic diversification.' }, news: [{ source: 'L\'Express', bias: 'center', time: '6h ago', headline: 'Financial sector continues growth', url: '#' }] },
  'Seychelles': { lat: -4.68, lng: 55.49, flag: 'ðŸ‡¸ðŸ‡¨', risk: 'clear', region: 'Africa', pop: '100K', gdp: '$1.7B', leader: 'Ramkalawan', title: 'Tourism Paradise', analysis: { what: 'Seychelles has the highest GDP per capita in Africa. Tourism and fishing drive the economy.', why: 'Economic success shows small state potential. Environmental vulnerability is extreme.', next: 'Adapting to climate change.' }, news: [{ source: 'Seychelles News Agency', bias: 'center', time: '5h ago', headline: 'Marine conservation efforts expand', url: '#' }] },
  'Malawi': { lat: -13.97, lng: 33.79, flag: 'ðŸ‡²ðŸ‡¼', risk: 'cloudy', region: 'Africa', pop: '21M', gdp: '$14B', leader: 'Chakwera', title: 'Landlocked Struggle', analysis: { what: 'Malawi overturned a fraudulent election in 2020, a democratic milestone. The landlocked country is one of the world\'s poorest.', why: 'Election overturn was remarkable democratic moment. Poverty and underdevelopment are severe.', next: 'Building on democratic gains.' }, news: [{ source: 'Nyasa Times', bias: 'center', time: '6h ago', headline: 'Government pushes development agenda', url: '#' }] },
  'Zambia': { lat: -15.39, lng: 28.32, flag: 'ðŸ‡¿ðŸ‡²', risk: 'cloudy', region: 'Africa', pop: '20M', gdp: '$29B', leader: 'Hichilema', title: 'Copper Economy', analysis: { what: 'Zambia defaulted on debt in 2020. New president Hichilema is pursuing reforms and debt restructuring.', why: 'Debt restructuring tests international mechanisms. Copper demand for green transition is rising.', next: 'Managing debt and copper opportunity.' }, news: [{ source: 'Lusaka Times', bias: 'center', time: '5h ago', headline: 'Debt restructuring advances', url: '#' }] },
  'Zimbabwe': { lat: -19.02, lng: 29.15, flag: 'ðŸ‡¿ðŸ‡¼', risk: 'stormy', region: 'Africa', pop: '16M', gdp: '$35B', leader: 'Mnangagwa', title: 'Economic Crisis', analysis: { what: 'Zimbabwe continues to face economic crisis with hyperinflation. Lithium resources attract interest.', why: 'Economic collapse has devastated population. Elections are not free or fair.', next: 'Economic stabilization remains elusive.' }, news: [{ source: 'NewsDay', bias: 'center', time: '6h ago', headline: 'Economic challenges persist', url: '#' }] },
  'Mozambique': { lat: -18.67, lng: 35.53, flag: 'ðŸ‡²ðŸ‡¿', risk: 'severe', region: 'Africa', pop: '33M', gdp: '$20B', leader: 'Nyusi', title: 'Insurgency Threat', analysis: { what: 'Mozambique faces ISIS-linked insurgency in gas-rich Cabo Delgado. Massive LNG projects are delayed by insecurity.', why: 'Gas resources could transform economy if security achieved. Election violence shows political fragility.', next: 'Security situation determines gas future.' }, news: [{ source: 'Club of Mozambique', bias: 'center', time: '5h ago', headline: 'Security concerns affect gas projects', url: '#' }] },
  'Namibia': { lat: -22.96, lng: 18.49, flag: 'ðŸ‡³ðŸ‡¦', risk: 'clear', region: 'Africa', pop: '2.6M', gdp: '$14B', leader: 'Nandi-Ndaitwah', title: 'Stable Democracy', analysis: { what: 'Namibia is one of Africa\'s most stable democracies. First female president elected in 2024.', why: 'Democratic stability is exemplary. First female president is milestone.', next: 'New leadership era begins.' }, news: [{ source: 'The Namibian', bias: 'center', time: '6h ago', headline: 'New president outlines priorities', url: '#' }] },
  'Angola': { lat: -11.20, lng: 17.87, flag: 'ðŸ‡¦ðŸ‡´', risk: 'stormy', region: 'Africa', pop: '36M', gdp: '$118B', leader: 'LourenÃ§o', title: 'Oil Giant', analysis: { what: 'Angola is Africa\'s second-largest oil producer. President LourenÃ§o has pursued anti-corruption campaign.', why: 'Oil revenues haven\'t reduced poverty. Economic diversification urgently needed.', next: 'Managing oil decline and debt.' }, news: [{ source: 'Club-K', bias: 'center', time: '5h ago', headline: 'Anti-corruption campaign continues', url: '#' }] },
  'Jordan': { lat: 31.95, lng: 35.93, flag: 'ðŸ‡¯ðŸ‡´', risk: 'cloudy', region: 'Middle East', pop: '11M', gdp: '$51B', leader: 'Abdullah II', title: 'Regional Stability', analysis: { what: 'Jordan hosts millions of refugees from neighboring conflicts. Water scarcity is critical.', why: 'Refugee burden is enormous for resources. Strategic importance for regional stability.', next: 'Managing scarce resources amid regional turmoil.' }, news: [{ source: 'Jordan Times', bias: 'center', time: '5h ago', headline: 'Water conservation measures intensify', url: '#' }] },
  'Kuwait': { lat: 29.38, lng: 47.99, flag: 'ðŸ‡°ðŸ‡¼', risk: 'clear', region: 'Middle East', pop: '4.3M', gdp: '$165B', leader: 'Mishal', title: 'Oil Wealth', analysis: { what: 'Kuwait has massive oil wealth and relatively open politics for the Gulf. Parliament often clashes with government.', why: 'Oil reserves ensure continued wealth. More political freedom than Gulf neighbors.', next: 'Managing oil transition and political tensions.' }, news: [{ source: 'Kuwait Times', bias: 'center', time: '6h ago', headline: 'Budget projects oil revenue growth', url: '#' }] },
  'Bahrain': { lat: 26.23, lng: 50.59, flag: 'ðŸ‡§ðŸ‡­', risk: 'cloudy', region: 'Middle East', pop: '1.5M', gdp: '$46B', leader: 'Hamad', title: 'Small Kingdom', analysis: { what: 'Bahrain crushed Arab Spring protests in 2011 with Saudi help. Sunni monarchy rules over Shia majority.', why: 'Sectarian tensions simmer beneath surface. US Navy Fifth Fleet headquartered here.', next: 'Managing sectarian balance and economic transition.' }, news: [{ source: 'GDN Online', bias: 'center', time: '5h ago', headline: 'Financial sector expansion continues', url: '#' }] },
  'Kazakhstan': { lat: 48.02, lng: 66.92, flag: 'ðŸ‡°ðŸ‡¿', risk: 'cloudy', region: 'Central Asia', pop: '20M', gdp: '$260B', leader: 'Tokayev', title: 'Energy Giant', analysis: { what: 'Kazakhstan is Central Asia\'s largest economy with vast oil and mineral resources. 2022 unrest required Russian intervention.', why: 'Energy resources make it strategically important. Balancing Russia and West is challenging.', next: 'Navigating between great powers.' }, news: [{ source: 'Astana Times', bias: 'center', time: '6h ago', headline: 'Oil exports to Europe increase', url: '#' }] },
  'Uzbekistan': { lat: 41.38, lng: 64.59, flag: 'ðŸ‡ºðŸ‡¿', risk: 'cloudy', region: 'Central Asia', pop: '36M', gdp: '$92B', leader: 'Mirziyoyev', title: 'Opening Up', analysis: { what: 'Uzbekistan has liberalized significantly since 2016. Cotton forced labor has been reduced.', why: 'Reform trajectory contrasts with neighbors. Largest Central Asian population.', next: 'Sustaining reform momentum.' }, news: [{ source: 'Kun.uz', bias: 'center', time: '5h ago', headline: 'Economic reforms attract investment', url: '#' }] },
  'Turkmenistan': { lat: 38.97, lng: 59.56, flag: 'ðŸ‡¹ðŸ‡²', risk: 'stormy', region: 'Central Asia', pop: '6.5M', gdp: '$60B', leader: 'Berdimuhamedow', title: 'Isolated State', analysis: { what: 'Turkmenistan is one of the world\'s most repressive and isolated states. Massive gas reserves but only exports to China.', why: 'Gas dependence on China is total. Reliable information barely exists.', next: 'Continued isolation likely.' }, news: [{ source: 'Chronicles of Turkmenistan', bias: 'center', time: '6h ago', headline: 'Economic situation unclear', url: '#' }] },
  'Tajikistan': { lat: 38.86, lng: 71.28, flag: 'ðŸ‡¹ðŸ‡¯', risk: 'stormy', region: 'Central Asia', pop: '10M', gdp: '$12B', leader: 'Rahmon', title: 'Authoritarian Rule', analysis: { what: 'President Rahmon has ruled since 1994. Taliban control of Afghanistan border raises security concerns.', why: 'Border with Taliban Afghanistan is risk. Remittances from Russia crucial.', next: 'Managing Afghanistan spillover risks.' }, news: [{ source: 'Asia-Plus', bias: 'center', time: '5h ago', headline: 'Border security measures increase', url: '#' }] },
  'Kyrgyzstan': { lat: 41.20, lng: 74.77, flag: 'ðŸ‡°ðŸ‡¬', risk: 'stormy', region: 'Central Asia', pop: '7M', gdp: '$12B', leader: 'Japarov', title: 'Populist Rule', analysis: { what: 'Kyrgyzstan has had multiple revolutions. Border clashes with Tajikistan are recurring.', why: 'Most open society in Central Asia now closing. Border disputes risk regional stability.', next: 'Political trajectory uncertain.' }, news: [{ source: 'Kloop', bias: 'center', time: '6h ago', headline: 'Border tensions with Tajikistan continue', url: '#' }] },
  'Nepal': { lat: 28.39, lng: 84.12, flag: 'ðŸ‡³ðŸ‡µ', risk: 'cloudy', region: 'South Asia', pop: '30M', gdp: '$42B', leader: 'Oli', title: 'Himalayan Nation', analysis: { what: 'Nepal transitioned from monarchy to republic in 2008. Caught between China and India.', why: 'Strategic location between giants shapes policy. Hydropower potential is vast.', next: 'Balancing China-India relations.' }, news: [{ source: 'Kathmandu Post', bias: 'center', time: '5h ago', headline: 'Government navigates regional pressures', url: '#' }] },
  'Bhutan': { lat: 27.51, lng: 90.43, flag: 'ðŸ‡§ðŸ‡¹', risk: 'clear', region: 'South Asia', pop: '780K', gdp: '$3B', leader: 'Tshering', title: 'Happiness Index', analysis: { what: 'Bhutan measures Gross National Happiness alongside GDP. The Buddhist kingdom has carefully managed modernization.', why: 'Alternative development model draws attention. Carbon negative country.', next: 'Maintaining unique development path.' }, news: [{ source: 'Kuensel', bias: 'center', time: '6h ago', headline: 'Happiness indicators remain stable', url: '#' }] },
  'Maldives': { lat: 3.20, lng: 73.22, flag: 'ðŸ‡²ðŸ‡»', risk: 'cloudy', region: 'South Asia', pop: '520K', gdp: '$7B', leader: 'Muizzu', title: 'Climate Frontline', analysis: { what: 'The Maldives faces existential threat from rising seas. New president shifted toward China from India.', why: 'Climate vulnerability is extreme. India-China competition plays out here.', next: 'Adapting to climate change or relocating.' }, news: [{ source: 'Maldives Independent', bias: 'center', time: '5h ago', headline: 'Climate adaptation projects advance', url: '#' }] },
  'Cambodia': { lat: 12.57, lng: 104.99, flag: 'ðŸ‡°ðŸ‡­', risk: 'stormy', region: 'Southeast Asia', pop: '17M', gdp: '$32B', leader: 'Hun Manet', title: 'Dynastic Succession', analysis: { what: 'Hun Sen ruled for 38 years before handing power to son Hun Manet. Opposition is crushed.', why: 'Dynastic succession consolidates family power. Democratic space has vanished.', next: 'Continued authoritarian rule under new generation.' }, news: [{ source: 'VOD', bias: 'center', time: '6h ago', headline: 'New leader consolidates power', url: '#' }] },
  'Laos': { lat: 17.97, lng: 102.63, flag: 'ðŸ‡±ðŸ‡¦', risk: 'stormy', region: 'Southeast Asia', pop: '7.5M', gdp: '$15B', leader: 'Sonexay', title: 'Debt Trapped', analysis: { what: 'Laos has massive Chinese debt from infrastructure projects. The communist state is one of few remaining.', why: 'Debt trap diplomacy concerns are real. Hydropower creates regional dependencies.', next: 'Managing unsustainable debt.' }, news: [{ source: 'Vientiane Times', bias: 'center', time: '5h ago', headline: 'Debt management discussions continue', url: '#' }] },
  'Brunei': { lat: 4.54, lng: 114.73, flag: 'ðŸ‡§ðŸ‡³', risk: 'clear', region: 'Southeast Asia', pop: '450K', gdp: '$18B', leader: 'Hassanal Bolkiah', title: 'Oil Sultanate', analysis: { what: 'Brunei is an absolute monarchy with oil wealth. Sultan has ruled since 1967.', why: 'Oil wealth enables generous welfare state. Sharia law implementation drew criticism.', next: 'Diversifying before oil runs out.' }, news: [{ source: 'Borneo Bulletin', bias: 'center', time: '6h ago', headline: 'Economic diversification efforts continue', url: '#' }] },
  'Timor-Leste': { lat: -8.87, lng: 125.73, flag: 'ðŸ‡¹ðŸ‡±', risk: 'cloudy', region: 'Southeast Asia', pop: '1.4M', gdp: '$3B', leader: 'Ramos-Horta', title: 'Young Nation', analysis: { what: 'Asia\'s youngest nation gained independence from Indonesia in 2002 after brutal occupation.', why: 'Nation-building from trauma is ongoing. Petroleum fund management is crucial.', next: 'Preparing for post-oil economy.' }, news: [{ source: 'Tatoli', bias: 'center', time: '5h ago', headline: 'ASEAN membership talks advance', url: '#' }] },
  'Papua New Guinea': { lat: -6.31, lng: 143.96, flag: 'ðŸ‡µðŸ‡¬', risk: 'stormy', region: 'Oceania', pop: '10M', gdp: '$32B', leader: 'Marape', title: 'Resource Rich', analysis: { what: 'PNG has vast natural resources but limited development. Tribal violence has increased dramatically.', why: 'Resource wealth hasn\'t reduced poverty. Strategic competition between China and West.', next: 'Managing resources and violence.' }, news: [{ source: 'Post-Courier', bias: 'center', time: '6h ago', headline: 'Tribal violence concerns grow', url: '#' }] },
  'Fiji': { lat: -17.71, lng: 178.07, flag: 'ðŸ‡«ðŸ‡¯', risk: 'cloudy', region: 'Oceania', pop: '930K', gdp: '$5B', leader: 'Rabuka', title: 'Pacific Hub', analysis: { what: 'Fiji has had multiple coups but returned to democracy. Climate change threatens low-lying areas.', why: 'Pacific regional leadership role is significant. Democratic stability improving.', next: 'Leading Pacific climate advocacy.' }, news: [{ source: 'Fiji Times', bias: 'center', time: '5h ago', headline: 'Climate conference preparations advance', url: '#' }] },
  'Solomon Islands': { lat: -9.43, lng: 160.02, flag: 'ðŸ‡¸ðŸ‡§', risk: 'stormy', region: 'Oceania', pop: '720K', gdp: '$1.6B', leader: 'Manele', title: 'China Pivot', analysis: { what: 'Solomon Islands switched to China in 2019 and signed security pact. Ethnic tensions led to 2021 riots.', why: 'China security pact alarmed Australia and US. Strategic location in Pacific.', next: 'Managing great power competition.' }, news: [{ source: 'Solomon Star', bias: 'center', time: '6h ago', headline: 'Infrastructure projects advance', url: '#' }] },
  'Vanuatu': { lat: -15.38, lng: 166.96, flag: 'ðŸ‡»ðŸ‡º', risk: 'cloudy', region: 'Oceania', pop: '330K', gdp: '$1B', leader: 'Kalsakau', title: 'Climate Vulnerable', analysis: { what: 'Vanuatu is extremely vulnerable to cyclones. The country sought ICJ advisory opinion on climate obligations.', why: 'Climate legal action sets precedent. Cyclone vulnerability is extreme.', next: 'Leading climate litigation efforts.' }, news: [{ source: 'Vanuatu Daily Post', bias: 'center', time: '5h ago', headline: 'Climate adaptation measures expand', url: '#' }] },
  'Samoa': { lat: -13.83, lng: -171.76, flag: 'ðŸ‡¼ðŸ‡¸', risk: 'clear', region: 'Oceania', pop: '220K', gdp: '$800M', leader: 'Fiame', title: 'Stable Nation', analysis: { what: 'Samoa has stable democracy and strong cultural traditions. First female PM elected in 2021.', why: 'First female PM was milestone. Cultural traditions remain strong.', next: 'Maintaining stability and culture.' }, news: [{ source: 'Samoa Observer', bias: 'center', time: '6h ago', headline: 'Cultural preservation efforts continue', url: '#' }] },
  'Tonga': { lat: -21.18, lng: -175.20, flag: 'ðŸ‡¹ðŸ‡´', risk: 'clear', region: 'Oceania', pop: '106K', gdp: '$500M', leader: 'Tupou VI', title: 'Pacific Kingdom', analysis: { what: 'Tonga is the only Pacific monarchy. 2022 volcanic eruption caused major damage.', why: 'Volcanic eruption showed extreme vulnerability. Monarchy is constitutionally evolving.', next: 'Recovering from natural disaster.' }, news: [{ source: 'Matangi Tonga', bias: 'center', time: '5h ago', headline: 'Post-eruption reconstruction continues', url: '#' }] },
  'Kiribati': { lat: 1.87, lng: -157.36, flag: 'ðŸ‡°ðŸ‡®', risk: 'severe', region: 'Oceania', pop: '130K', gdp: '$200M', leader: 'Maamau', title: 'Sinking Nation', analysis: { what: 'Kiribati faces existential threat from sea level rise. Government purchased land in Fiji for potential relocation.', why: 'Nation may become uninhabitable within decades. Climate frontline state.', next: 'Planning for potential national relocation.' }, news: [{ source: 'Pacific Islands Report', bias: 'center', time: '6h ago', headline: 'Sea level rise accelerates', url: '#' }] },
  'Marshall Islands': { lat: 7.13, lng: 171.18, flag: 'ðŸ‡²ðŸ‡­', risk: 'cloudy', region: 'Oceania', pop: '60K', gdp: '$270M', leader: 'Heine', title: 'Nuclear Legacy', analysis: { what: 'The Marshall Islands suffers from legacy of US nuclear testing. Compact of Free Association with US provides funding.', why: 'Nuclear testing legacy creates ongoing health issues. Climate vulnerability extreme.', next: 'Addressing nuclear legacy and climate.' }, news: [{ source: 'Marshall Islands Journal', bias: 'center', time: '5h ago', headline: 'Compact negotiations continue', url: '#' }] },
  'Micronesia': { lat: 6.89, lng: 158.22, flag: 'ðŸ‡«ðŸ‡²', risk: 'cloudy', region: 'Oceania', pop: '115K', gdp: '$400M', leader: 'Simina', title: 'Island Federation', analysis: { what: 'The Federated States of Micronesia has Compact of Free Association with US.', why: 'Strategic location for US Pacific presence. Climate change threatens low islands.', next: 'Implementing renewed US compact.' }, news: [{ source: 'Kaselehlie Press', bias: 'center', time: '6h ago', headline: 'US compact implementation begins', url: '#' }] },
  'Palau': { lat: 7.51, lng: 134.58, flag: 'ðŸ‡µðŸ‡¼', risk: 'clear', region: 'Oceania', pop: '18K', gdp: '$280M', leader: 'Whipps Jr.', title: 'Marine Sanctuary', analysis: { what: 'Palau created one of world\'s largest marine sanctuaries. Maintains Taiwan recognition.', why: 'Marine conservation is globally significant. US military access expanding.', next: 'Balancing conservation and development.' }, news: [{ source: 'Island Times', bias: 'center', time: '5h ago', headline: 'Marine sanctuary expansion proposed', url: '#' }] },
  'Nauru': { lat: -0.52, lng: 166.93, flag: 'ðŸ‡³ðŸ‡·', risk: 'cloudy', region: 'Oceania', pop: '11K', gdp: '$150M', leader: 'Adeang', title: 'Smallest Republic', analysis: { what: 'Nauru depleted its phosphate resources and now hosts Australian migrant detention center.', why: 'Cautionary tale of resource depletion. Australian detention arrangement is controversial.', next: 'Finding sustainable economic path.' }, news: [{ source: 'Pacific Islands Report', bias: 'center', time: '6h ago', headline: 'Economic diversification efforts continue', url: '#' }] },
  'Tuvalu': { lat: -7.48, lng: 179.20, flag: 'ðŸ‡¹ðŸ‡»', risk: 'severe', region: 'Oceania', pop: '11K', gdp: '$60M', leader: 'Teo', title: 'Disappearing Nation', analysis: { what: 'Tuvalu will likely be submerged by rising seas this century. Australia offered residency rights.', why: 'Most vulnerable nation to climate change. Digital revenue from .tv domain is creative solution.', next: 'Preserving nationhood amid disappearance.' }, news: [{ source: 'Pacific Islands Report', bias: 'center', time: '5h ago', headline: 'Australia migration agreement implemented', url: '#' }] },
  'Andorra': { lat: 42.51, lng: 1.52, flag: 'ðŸ‡¦ðŸ‡©', risk: 'clear', region: 'Europe', pop: '80K', gdp: '$3.4B', leader: 'Xavier Espot', title: 'Pyrenees Microstate', analysis: { what: 'Andorra is a small principality between France and Spain. Tourism and banking drive the economy. Not an EU member but uses the euro.', why: 'Tax haven status attracts business. Ski tourism is major industry.', next: 'Maintaining economic model amid international tax reforms.' }, news: [{ source: 'Diari d\'Andorra', bias: 'center', time: '6h ago', headline: 'Tourism season exceeds expectations', url: '#' }] },
  'Antigua and Barbuda': { lat: 17.06, lng: -61.80, flag: 'ðŸ‡¦ðŸ‡¬', risk: 'cloudy', region: 'Caribbean', pop: '100K', gdp: '$2B', leader: 'Gaston Browne', title: 'Island Paradise', analysis: { what: 'Antigua and Barbuda depends heavily on tourism. Hurricane Irma devastated Barbuda in 2017.', why: 'Climate vulnerability threatens island nations. Citizenship by investment program draws attention.', next: 'Building climate resilience.' }, news: [{ source: 'Antigua Observer', bias: 'center', time: '5h ago', headline: 'Tourism recovery continues', url: '#' }] },
  'Comoros': { lat: -11.65, lng: 43.33, flag: 'ðŸ‡°ðŸ‡²', risk: 'stormy', region: 'Africa', pop: '900K', gdp: '$1.3B', leader: 'Azali Assoumani', title: 'Island Instability', analysis: { what: 'Comoros has experienced numerous coups since independence. The island nation claims Mayotte, held by France.', why: 'Political instability undermines development. Mayotte dispute affects French relations.', next: 'Achieving political stability.' }, news: [{ source: 'Al-Watwan', bias: 'center', time: '6h ago', headline: 'Political tensions remain', url: '#' }] },
  'Dominica': { lat: 15.42, lng: -61.35, flag: 'ðŸ‡©ðŸ‡²', risk: 'cloudy', region: 'Caribbean', pop: '72K', gdp: '$600M', leader: 'Roosevelt Skerrit', title: 'Nature Isle', analysis: { what: 'Dominica markets itself as the Nature Isle of the Caribbean. Hurricane Maria caused catastrophic damage in 2017.', why: 'Climate resilience building is essential. Eco-tourism potential is significant.', next: 'Building back better from hurricanes.' }, news: [{ source: 'Dominica News Online', bias: 'center', time: '5h ago', headline: 'Climate resilience projects advance', url: '#' }] },
  'Eswatini': { lat: -26.52, lng: 31.47, flag: 'ðŸ‡¸ðŸ‡¿', risk: 'stormy', region: 'Africa', pop: '1.2M', gdp: '$5B', leader: 'King Mswati III', title: 'Absolute Monarchy', analysis: { what: 'Eswatini (formerly Swaziland) is Africa\'s last absolute monarchy. Pro-democracy protests in 2021 were met with violence.', why: 'Democratic demands challenge royal control. HIV prevalence among world\'s highest.', next: 'Managing reform pressure.' }, news: [{ source: 'Swazi Observer', bias: 'center', time: '6h ago', headline: 'Economic reforms announced', url: '#' }] },
  'Grenada': { lat: 12.12, lng: -61.67, flag: 'ðŸ‡¬ðŸ‡©', risk: 'clear', region: 'Caribbean', pop: '125K', gdp: '$1.3B', leader: 'Dickon Mitchell', title: 'Spice Isle', analysis: { what: 'Grenada is known for nutmeg production. The US invaded in 1983. Tourism now dominates the economy.', why: 'Tourism recovery post-COVID was strong. Climate vulnerability remains concern.', next: 'Diversifying beyond tourism.' }, news: [{ source: 'NOW Grenada', bias: 'center', time: '5h ago', headline: 'Tourism numbers continue growth', url: '#' }] },
  'Lesotho': { lat: -29.61, lng: 28.23, flag: 'ðŸ‡±ðŸ‡¸', risk: 'stormy', region: 'Africa', pop: '2.3M', gdp: '$2.5B', leader: 'Sam Matekane', title: 'Mountain Kingdom', analysis: { what: 'Lesotho is completely surrounded by South Africa. Water exports to SA are vital. Political instability and poverty persist.', why: 'Unique geographic situation creates dependencies. High HIV rates affect population.', next: 'Reducing South Africa dependence.' }, news: [{ source: 'Lesotho Times', bias: 'center', time: '6h ago', headline: 'Water project expansion planned', url: '#' }] },
  'Liechtenstein': { lat: 47.17, lng: 9.55, flag: 'ðŸ‡±ðŸ‡®', risk: 'clear', region: 'Europe', pop: '40K', gdp: '$7B', leader: 'Prince Hans-Adam II', title: 'Alpine Microstate', analysis: { what: 'Liechtenstein is one of the world\'s wealthiest countries per capita. Banking and manufacturing drive economy.', why: 'Financial services attract international business. Swiss customs union provides stability.', next: 'Maintaining prosperity.' }, news: [{ source: 'Vaterland', bias: 'center', time: '5h ago', headline: 'Financial sector remains strong', url: '#' }] },
  'Monaco': { lat: 43.73, lng: 7.42, flag: 'ðŸ‡²ðŸ‡¨', risk: 'clear', region: 'Europe', pop: '40K', gdp: '$8.6B', leader: 'Prince Albert II', title: 'Luxury Enclave', analysis: { what: 'Monaco is the world\'s most densely populated country. No income tax attracts the ultra-wealthy. Famous for Grand Prix and casinos.', why: 'Tax haven status attracts global elite. Environmental initiatives under Prince Albert.', next: 'Balancing growth with limited space.' }, news: [{ source: 'Monaco Tribune', bias: 'center', time: '6h ago', headline: 'Real estate prices reach new highs', url: '#' }] },
  'San Marino': { lat: 43.94, lng: 12.46, flag: 'ðŸ‡¸ðŸ‡²', risk: 'clear', region: 'Europe', pop: '34K', gdp: '$1.9B', leader: 'Captains Regent', title: 'Oldest Republic', analysis: { what: 'San Marino claims to be the world\'s oldest republic, founded in 301 AD. Surrounded entirely by Italy.', why: 'Historical significance draws tourists. Unique dual head of state system.', next: 'Maintaining independence and traditions.' }, news: [{ source: 'San Marino RTV', bias: 'center', time: '5h ago', headline: 'Tourism contributes to growth', url: '#' }] },
  'Sao Tome and Principe': { lat: 0.33, lng: 6.73, flag: 'ðŸ‡¸ðŸ‡¹', risk: 'cloudy', region: 'Africa', pop: '225K', gdp: '$600M', leader: 'Carlos Vila Nova', title: 'Gulf of Guinea Islands', analysis: { what: 'Sao Tome and Principe are islands in the Gulf of Guinea. Offshore oil potential could transform the economy.', why: 'Oil prospects attract international interest. Small size limits development options.', next: 'Managing potential oil wealth.' }, news: [{ source: 'Tela Non', bias: 'center', time: '6h ago', headline: 'Oil exploration continues', url: '#' }] },
  'Saint Kitts and Nevis': { lat: 17.36, lng: -62.78, flag: 'ðŸ‡°ðŸ‡³', risk: 'clear', region: 'Caribbean', pop: '55K', gdp: '$1.1B', leader: 'Terrance Drew', title: 'Federation', analysis: { what: 'Saint Kitts and Nevis is a two-island federation. Tourism and citizenship by investment drive economy.', why: 'Citizenship program attracts wealthy applicants. Sugar industry ended in 2005.', next: 'Diversifying economic base.' }, news: [{ source: 'SKN Vibes', bias: 'center', time: '5h ago', headline: 'Citizenship program reforms announced', url: '#' }] },
  'Saint Lucia': { lat: 13.91, lng: -60.98, flag: 'ðŸ‡±ðŸ‡¨', risk: 'clear', region: 'Caribbean', pop: '180K', gdp: '$2.1B', leader: 'Philip Pierre', title: 'Volcanic Beauty', analysis: { what: 'Saint Lucia is known for its twin Pitons volcanic spires. Tourism dominates the economy. Banana exports have declined.', why: 'Tourism is primary revenue source. Climate vulnerability threatens future.', next: 'Developing sustainable tourism.' }, news: [{ source: 'St. Lucia Times', bias: 'center', time: '6h ago', headline: 'Tourism arrivals exceed targets', url: '#' }] },
  'Saint Vincent and the Grenadines': { lat: 13.25, lng: -61.20, flag: 'ðŸ‡»ðŸ‡¨', risk: 'cloudy', region: 'Caribbean', pop: '110K', gdp: '$900M', leader: 'Ralph Gonsalves', title: 'Volcanic Islands', analysis: { what: 'La SoufriÃ¨re volcano erupted in 2021 causing evacuations. Tourism and agriculture drive economy.', why: 'Volcanic activity poses ongoing risk. Post-eruption recovery ongoing.', next: 'Rebuilding after volcanic eruption.' }, news: [{ source: 'iWitness News', bias: 'center', time: '5h ago', headline: 'Volcanic monitoring continues', url: '#' }] }
};
// RECENT ELECTION RESULTS
const RECENT_ELECTIONS = [
  { flag: 'ðŸ‡¯ðŸ‡µ', country: 'Japan', date: 'Feb 2026', type: 'Snap Election', winner: 'Sanae Takaichi - LDP (Right Wing)', result: 'LDP wins majority', summary: 'First female PM. Nationalist conservative takes power after snap election landslide.' },
  { flag: 'ðŸ‡µðŸ‡¹', country: 'Portugal', date: 'Jan 2026', type: 'Presidential Election', winner: 'Ana Gomes - PS (Left Wing)', result: 'Leftist victory', summary: 'Defeated far-right surge. Chega party gains but falls short.' },
  { flag: 'ðŸ‡¹ðŸ‡­', country: 'Thailand', date: 'Jan 2026', type: 'Senate Elections', winner: 'Move Forward (Left Wing)', result: 'Progressive gains', summary: 'Reformist senators elected. Military influence declining.' }
];

// UPCOMING ELECTIONS DATA
const ELECTIONS = [
  { flag: 'ðŸ‡§ðŸ‡©', country: 'Bangladesh', date: 'Feb 2026', type: 'General Election', stakes: 'First election since Gen-Z protests ousted PM Hasina. New political era begins.' },
  { flag: 'ðŸ‡»ðŸ‡³', country: 'Vietnam', date: 'Mar 2026', type: 'Legislative Elections', stakes: 'Communist Party to affirm control. Economic reform direction at stake.' },
  { flag: 'ðŸ‡¦ðŸ‡º', country: 'Australia', date: 'May 2026', type: 'Federal Election', stakes: 'Labor seeks second term. Cost of living and housing key issues.' },
  { flag: 'ðŸ‡¨ðŸ‡´', country: 'Colombia', date: 'May 2026', type: 'Presidential Election', stakes: 'Petro barred from re-election. Test of Latin America\'s left turn.' },
  { flag: 'ðŸ‡±ðŸ‡§', country: 'Lebanon', date: 'May 2026', type: 'Parliamentary Election', stakes: 'First test for new government. Hezbollah\'s role in question post-Gaza war.' },
  { flag: 'ðŸ‡®ðŸ‡±', country: 'Israel', date: 'Oct 2026', type: 'General Election', stakes: 'Netanyahu coalition faces pressure. Could trigger early if budget fails.' },
  { flag: 'ðŸ‡­ðŸ‡º', country: 'Hungary', date: 'Oct 2026', type: 'Parliamentary Election', stakes: 'Orban faces toughest challenge from Tisza Party. EU relations at stake.' },
  { flag: 'ðŸ‡§ðŸ‡¦', country: 'Bosnia', date: 'Oct 2026', type: 'General Elections', stakes: 'Ethnic tensions persist. Serb separatism and EU path in balance.' },
  { flag: 'ðŸ‡§ðŸ‡·', country: 'Brazil', date: 'Oct 2026', type: 'General Elections', stakes: 'Lula vs Bolsonaro family rematch. Democracy and Amazon at stake.' },
  { flag: 'ðŸ‡ºðŸ‡¸', country: 'United States', date: 'Nov 2026', type: 'Midterm Elections', stakes: 'Control of Congress at stake. All 435 House seats and 35 Senate seats.' },
  { flag: 'ðŸ‡«ðŸ‡·', country: 'France', date: 'Apr 2027', type: 'Presidential Election', stakes: 'Macron term-limited. Le Pen favored amid political fragmentation.' },
  { flag: 'ðŸ‡°ðŸ‡·', country: 'South Korea', date: 'Mar 2027', type: 'Presidential Election', stakes: 'Political crisis aftermath. Conservative vs progressive showdown.' }
];

// FORECASTS DATA
const FORECASTS = [
  { region: 'Eastern Europe', risk: 'catastrophic', current: 'Active warfare continues in Ukraine with no ceasefire in sight. Western support remains crucial but faces domestic political challenges.', forecast: 'Expect continued attritional warfare through winter. Watch for potential diplomatic windows in Q2 2026 as ammunition constraints affect both sides.', indicators: [{ text: 'Conflict Intensity', dir: 'up' }, { text: 'Western Unity', dir: 'down' }, { text: 'Negotiations', dir: 'stable' }] },
  { region: 'Middle East', risk: 'extreme', current: 'Multi-front regional tensions involving Israel, Iran, and proxy forces. Humanitarian crisis in Gaza continues.', forecast: 'High risk of wider escalation. Iran nuclear timeline accelerating. Watch for Hezbollah calculus and US election impact on policy.', indicators: [{ text: 'Escalation Risk', dir: 'up' }, { text: 'Diplomacy', dir: 'down' }, { text: 'Oil Prices', dir: 'up' }] },
  { region: 'East Asia', risk: 'severe', current: 'Taiwan Strait tensions elevated. North Korea missile tests continue. US-China competition intensifying.', forecast: 'Near-term conflict unlikely but risks rising. Semiconductor decoupling accelerates. Watch for military incidents in South China Sea.', indicators: [{ text: 'Military Activity', dir: 'up' }, { text: 'Trade Ties', dir: 'down' }, { text: 'Tech War', dir: 'up' }] },
  { region: 'Sahel Africa', risk: 'extreme', current: 'Military coups across region. Wagner/Africa Corps presence expanding. Jihadi groups gaining ground.', forecast: 'Further destabilization likely. Western influence declining. Watch for spillover effects into coastal West Africa.', indicators: [{ text: 'Instability', dir: 'up' }, { text: 'Terrorism', dir: 'up' }, { text: 'Migration', dir: 'up' }] },
  { region: 'Global Economy', risk: 'stormy', current: 'Mixed signals with inflation cooling but debt concerns rising. China slowdown affects global growth.', forecast: 'Soft landing increasingly likely in US/EU. China structural challenges persist. Watch for emerging market debt crises.', indicators: [{ text: 'Inflation', dir: 'down' }, { text: 'Growth', dir: 'stable' }, { text: 'Debt Risk', dir: 'up' }] },
  { region: 'Climate Hotspots', risk: 'severe', current: 'Record temperatures, extreme weather events increasing. COP commitments falling short.', forecast: 'More frequent climate disasters expected. Watch for climate migration from vulnerable regions and food security impacts.', indicators: [{ text: 'Extreme Weather', dir: 'up' }, { text: 'Adaptation', dir: 'stable' }, { text: 'Emissions', dir: 'up' }] }
];

// ============================================================
// HORIZON - Upcoming Geopolitical Events (Feb 2026 - Feb 2027)
// ============================================================
const HORIZON_EVENTS = [
  { date: '2026-02-05', name: 'New START Treaty Expiration', location: 'Global', category: 'treaty', description: 'US-Russia nuclear arms treaty expires â€” first time since 1970s with no binding limits on strategic nuclear forces' },
  { date: '2026-02-12', name: 'Bangladesh Constitutional Referendum & Election', location: 'Dhaka, Bangladesh', category: 'election', description: 'Constitutional referendum on July Charter reforms and parliamentary election under interim government' },
  { date: '2026-02-12', name: 'EU Informal Leaders Retreat', location: 'Brussels, EU', category: 'summit', description: 'EU leaders convene to discuss single market strengthening and economic competitiveness strategy' },
  { date: '2026-02-14', name: 'African Union Assembly (39th Summit)', location: 'Addis Ababa, Ethiopia', category: 'summit', description: 'Annual AU heads-of-state summit focusing on Agenda 2063 development priorities across the continent' },
  { date: '2026-02-15', name: 'France Municipal Elections (Round 1)', location: 'France', category: 'election', description: 'First round of mayoral elections across French municipalities â€” key indicator ahead of 2027 presidential race' },
  { date: '2026-02-22', name: 'France Municipal Elections (Round 2)', location: 'France', category: 'election', description: 'Final round determining new mayors in major French cities with national political implications' },
  { date: '2026-02-23', name: 'ICC Duterte Confirmation Hearing', location: 'The Hague, Netherlands', category: 'treaty', description: 'International Criminal Court hearing on charges against former Philippine President Rodrigo Duterte' },
  { date: '2026-03-08', name: 'Colombia Parliamentary Elections', location: 'BogotÃ¡, Colombia', category: 'election', description: 'Election of 188 House members with primaries determining presidential candidates for May vote' },
  { date: '2026-03-19', name: 'European Council Summit', location: 'Brussels, EU', category: 'summit', description: 'Quarterly meeting of EU heads of state setting strategic direction on defense, trade, and enlargement' },
  { date: '2026-04-13', name: 'IMF / World Bank Spring Meetings', location: 'Washington D.C., USA', category: 'economic', description: 'Annual spring meetings addressing global economic outlook, debt sustainability, and development finance' },
  { date: '2026-04-27', name: 'NPT Review Conference Opens', location: 'New York, USA', category: 'treaty', description: 'Eleventh Nuclear Non-Proliferation Treaty review â€” critical amid New START expiration and rising nuclear tensions' },
  { date: '2026-05-08', name: '48th ASEAN Leaders Summit', location: 'Cebu, Philippines', category: 'summit', description: 'ASEAN summit under Philippine chairmanship addressing South China Sea disputes and economic integration' },
  { date: '2026-05-10', name: 'Lebanese Parliamentary Elections', location: 'Beirut, Lebanon', category: 'election', description: 'First parliamentary elections since Hezbollah\'s weakening â€” 128 seats contested amid political realignment' },
  { date: '2026-05-22', name: 'NPT Review Conference Concludes', location: 'New York, USA', category: 'treaty', description: 'Final negotiated outcome on nuclear disarmament and non-proliferation commitments for the next cycle' },
  { date: '2026-05-31', name: 'Colombia Presidential Election', location: 'BogotÃ¡, Colombia', category: 'election', description: 'Presidential vote where incumbent Petro is barred from re-election â€” direction of Latin American left at stake' },
  { date: '2026-06-01', name: 'Ethiopia General Election', location: 'Addis Ababa, Ethiopia', category: 'election', description: 'Seventh national election with digital voter registration amid ongoing post-Tigray recovery efforts' },
  { date: '2026-06-07', name: 'Armenia Parliamentary Election', location: 'Yerevan, Armenia', category: 'election', description: 'Parliamentary elections under PM Pashinyan â€” crucial for South Caucasus stability and Russia-West alignment' },
  { date: '2026-06-15', name: '52nd G7 Summit', location: 'Ã‰vian-les-Bains, France', category: 'summit', description: 'Leaders of advanced democracies convene on Ukraine, China trade, AI governance, and climate commitments' },
  { date: '2026-06-26', name: 'RIMPAC 2026 Begins', location: 'Hawaii, USA', category: 'military', description: 'World\'s largest multinational maritime exercise â€” 29 nations, 25,000+ personnel signaling Indo-Pacific readiness' },
  { date: '2026-06-30', name: 'UK-EU TCA Energy & Fishing Provisions Expire', location: 'Global', category: 'treaty', description: 'Brexit-era energy cooperation and fishing access provisions expire â€” renewal negotiations critical for both sides' },
  { date: '2026-07-01', name: 'USMCA Six-Year Review Window Opens', location: 'Global', category: 'economic', description: 'Mandatory review of US-Mexico-Canada free trade agreement begins â€” potential renegotiation of key provisions' },
  { date: '2026-07-07', name: 'NATO Summit', location: 'Ankara, Turkey', category: 'summit', description: 'Alliance leaders summit at BeÅŸtepe Presidential Complex addressing defense spending, Ukraine, and Arctic strategy' },
  { date: '2026-08-01', name: 'BRICS Summit (Expected)', location: 'New Delhi, India', category: 'summit', description: '18th BRICS leaders summit under Indian chairmanship â€” expanded bloc testing cohesion on trade and dedollarization' },
  { date: '2026-08-13', name: 'Zambia General Election', location: 'Lusaka, Zambia', category: 'election', description: 'Presidential, parliamentary, and local elections â€” test of democratic consolidation in Southern Africa' },
  { date: '2026-08-30', name: 'Haiti Presidential Election (Round 1)', location: 'Port-au-Prince, Haiti', category: 'election', description: 'Haiti\'s first general election in a decade amid ongoing gang violence and security crisis' },
  { date: '2026-09-13', name: 'Sweden General Election', location: 'Stockholm, Sweden', category: 'election', description: 'Riksdag election with 349 seats â€” test of right-wing coalition and NATO-era defense priorities' },
  { date: '2026-09-15', name: 'UN General Assembly (81st Session Opens)', location: 'New York, USA', category: 'summit', description: 'Annual UNGA high-level segment with world leaders addressing conflicts, climate, and reform of multilateral institutions' },
  { date: '2026-09-18', name: 'Russia State Duma Elections Begin', location: 'Moscow, Russia', category: 'election', description: 'Three-day voting for State Duma and 39 regional assemblies â€” managed elections amid ongoing Ukraine war' },
  { date: '2026-10-04', name: 'Brazil General Election (Round 1)', location: 'BrasÃ­lia, Brazil', category: 'election', description: 'Presidential, congressional, and gubernatorial elections â€” Lula seeks fourth term amid polarized electorate' },
  { date: '2026-10-09', name: 'IMF / World Bank Annual Meetings', location: 'Bangkok, Thailand', category: 'economic', description: 'Annual meetings addressing global financial stability, emerging market debt, and development priorities' },
  { date: '2026-10-09', name: 'EU Russia Sanctions Renewal Deadline', location: 'Brussels, EU', category: 'sanctions', description: 'Expiration deadline for EU restrictive measures on Russian destabilizing actions â€” renewal vote required' },
  { date: '2026-10-25', name: 'Brazil General Election (Runoff)', location: 'BrasÃ­lia, Brazil', category: 'election', description: 'Presidential and gubernatorial runoff if no first-round majority â€” could reshape Latin America\'s largest economy' },
  { date: '2026-10-31', name: 'EU ISIL/Al-Qaeda Sanctions Renewal', location: 'Brussels, EU', category: 'sanctions', description: 'Renewal deadline for EU counterterrorism sanctions regime targeting ISIL (Da\'esh) and Al-Qaeda networks' },
  { date: '2026-11-03', name: 'United States Midterm Elections', location: 'United States', category: 'election', description: 'All 435 House seats and 35 Senate seats contested â€” referendum on Trump\'s second term and Congressional control' },
  { date: '2026-11-09', name: 'COP31 Climate Conference Opens', location: 'Antalya, Turkey', category: 'summit', description: 'UN Climate Change Conference with Australia leading negotiations on emissions targets and climate finance' },
  { date: '2026-11-10', name: '49th ASEAN Leaders Summit', location: 'Manila, Philippines', category: 'summit', description: 'Second ASEAN summit of the year addressing regional security architecture and economic integration' },
  { date: '2026-11-18', name: 'APEC Economic Leaders Meeting', location: 'Shenzhen, China', category: 'summit', description: 'Asia-Pacific summit in China\'s tech hub â€” US-China dynamics and trade architecture in focus' },
  { date: '2026-11-20', name: 'COP31 Climate Conference Concludes', location: 'Antalya, Turkey', category: 'summit', description: 'Final negotiated climate commitments expected on emissions reduction timelines and developing nation finance' },
  { date: '2026-12-06', name: 'Haiti Presidential Election (Runoff)', location: 'Port-au-Prince, Haiti', category: 'election', description: 'Runoff round to determine Haiti\'s first elected president in years â€” stability of Caribbean at stake' },
  { date: '2026-12-14', name: 'G20 Leaders Summit', location: 'Miami, USA', category: 'summit', description: 'Summit of world\'s largest economies under US presidency â€” trade, AI regulation, and development on the agenda' },
  { date: '2027-01-01', name: 'EU Russian LNG Ban Takes Full Effect', location: 'EU', category: 'sanctions', description: 'Complete ban on Russian LNG imports for long-term contracts â€” reshapes European energy supply chains' },
  { date: '2027-02-07', name: 'Haiti Presidential Inauguration', location: 'Port-au-Prince, Haiti', category: 'election', description: 'Inauguration of newly elected Haitian president â€” first democratic transfer of power in over a decade' }
];

// NEWSLETTER SYSTEM
// Region mapping for news categorization
const NEWSLETTER_REGIONS = {
  'Europe': ['Ukraine', 'Russia', 'Belarus', 'Moldova', 'Poland', 'Romania', 'Hungary', 'Balkans', 'UK', 'Britain', 'France', 'Germany', 'Italy', 'Spain', 'NATO', 'EU', 'European', 'Serbia', 'Kosovo', 'Greece', 'Turkey', 'Ankara', 'Istanbul', 'Sweden', 'Finland', 'Norway', 'Denmark', 'Greenland', 'Arctic', 'Netherlands', 'Belgium', 'Austria', 'Switzerland', 'Czech', 'Slovakia', 'Croatia', 'Bulgaria', 'Portugal', 'Ireland'],
  'Asia': ['China', 'Taiwan', 'Japan', 'Korea', 'North Korea', 'South Korea', 'Hong Kong', 'Myanmar', 'Thailand', 'Vietnam', 'Philippines', 'Indonesia', 'Malaysia', 'Singapore', 'Cambodia', 'Laos', 'India', 'Pakistan', 'Bangladesh', 'Sri Lanka', 'Nepal', 'Afghanistan', 'Kabul', 'Delhi', 'Mumbai', 'Beijing', 'Tokyo', 'Seoul', 'Pyongyang', 'Manila', 'Jakarta', 'Bangkok'],
  'Middle East': ['Israel', 'Gaza', 'Palestine', 'Iran', 'Iraq', 'Syria', 'Lebanon', 'Yemen', 'Saudi', 'UAE', 'Qatar', 'Jordan', 'Egypt', 'Houthi', 'Hezbollah', 'Tehran', 'Baghdad', 'Damascus', 'Beirut', 'Riyadh', 'Dubai', 'Oman', 'Bahrain', 'Kuwait'],
  'Africa': ['Sudan', 'Somalia', 'Ethiopia', 'DRC', 'Congo', 'Nigeria', 'Kenya', 'South Africa', 'Mali', 'Niger', 'Burkina', 'Sahel', 'Libya', 'Algeria', 'Morocco', 'Tunisia', 'Mozambique', 'Rwanda', 'Uganda', 'Tanzania', 'Ghana', 'Senegal', 'Cameroon', 'Zimbabwe', 'Eritrea'],
  'Americas': ['United States', 'US', 'Brazil', 'Mexico', 'Venezuela', 'Colombia', 'Argentina', 'Haiti', 'Cuba', 'Canada', 'Chile', 'Peru', 'Ecuador', 'Bolivia', 'Panama', 'Guatemala', 'Honduras', 'El Salvador', 'Nicaragua', 'Dominican', 'Puerto Rico', 'Washington', 'Congress', 'White House']
};

// Source political bias ratings: L=Left, LC=Left-Center, C=Center, RC=Right-Center, R=Right
const SOURCE_BIAS = {
  // Left (AllSides: Left)
  'The Intercept': 'L', 'Democracy Now': 'L', 'Jacobin': 'L', 'Mother Jones': 'L', 'MSNBC': 'L', 'HuffPost': 'L', 'Vox': 'L', 'Slate': 'L', 'The Nation': 'L', 'Raw Story': 'L', 'The Wire': 'L', 'Middle East Monitor': 'L', 'The Guardian': 'L', 'Guardian': 'L', 'The Atlantic': 'L',
  // Left-Center (AllSides: Lean Left)
  'New York Times': 'LC', 'The New York Times': 'LC', 'NY Times': 'LC', 'Washington Post': 'LC', 'The Washington Post': 'LC', 'CNN': 'LC', 'BBC': 'LC', 'BBC World': 'LC', 'BBC News': 'LC', 'NPR': 'LC', 'NBC News': 'LC', 'CBS News': 'LC', 'ABC News': 'LC', 'Time': 'LC', 'TIME': 'LC', 'Politico': 'LC', 'Bloomberg': 'LC', 'The Independent': 'LC', 'BuzzFeed News': 'LC', 'BuzzFeed': 'LC', 'USA Today': 'LC', 'Los Angeles Times': 'LC', 'LA Times': 'LC', 'Daily Beast': 'LC', 'Mediaite': 'LC', 'Business Insider': 'LC', 'Insider': 'LC', 'The New Yorker': 'LC', 'NDTV': 'LC', 'India Today': 'LC', 'Hindustan Times': 'LC', 'The Print': 'LC', 'Scroll': 'LC', 'Firstpost': 'LC', 'Kyiv Independent': 'LC', 'Kyiv Post': 'LC', 'Le Monde': 'LC', 'Der Spiegel': 'LC', 'El PaÃ­s': 'LC', 'Middle East Eye': 'LC', 'Folha': 'LC', 'CNBC': 'LC', 'ABC Australia': 'LC', 'Sydney Morning Herald': 'LC', 'Politico EU': 'LC', 'Irish Times': 'LC', 'Deccan Herald': 'LC', 'Indian Express': 'LC', 'Asahi Shimbun': 'LC', 'Live Mint': 'LC', 'The Conversation': 'LC', 'Times of Israel': 'LC', 'Sky News': 'LC', 'Chicago Tribune': 'LC', 'Miami Herald': 'LC', 'Al Jazeera': 'LC', 'AP': 'LC', 'AP News': 'LC', 'Associated Press': 'LC', 'Axios': 'LC', 'Haaretz': 'LC',
  // Center (AllSides: Center / MBFC: Least Biased)
  'Reuters': 'C', 'France 24': 'C', 'France24': 'C', 'DW News': 'C', 'DW': 'C', 'Deutsche Welle': 'C', 'The Hill': 'C', 'PBS': 'C', 'Nikkei': 'C', 'Nikkei Asia': 'C', 'FT': 'C', 'Financial Times': 'C', 'UN News': 'C', 'The Hindu': 'LC', 'Korea Times': 'C', 'Korea Herald': 'C', 'SCMP': 'C', 'South China Morning Post': 'C', 'Euronews': 'C', 'UPI': 'C', 'PTI': 'C', 'ANI': 'C', 'IANS': 'C', 'DPA': 'C', 'EFE': 'C', 'ANSA': 'C', 'Dawn': 'C', 'Express Tribune': 'C', 'Geo News': 'C', 'Pakistan Today': 'C', 'The News': 'C', 'Straits Times': 'C', 'CNA': 'C', 'Japan Times': 'C', 'Bangkok Post': 'C', 'Bernama': 'C', 'VnExpress': 'C', 'NZ Herald': 'C', 'RNZ': 'C', 'RTÃ‰': 'C', 'Semafor': 'C', 'Foreign Policy': 'C', 'Foreign Affairs': 'C', 'Defense One': 'C', 'Defense News': 'C', 'Breaking Defense': 'C', 'ClarÃ­n': 'C', 'Premium Times': 'C', 'News24': 'C', 'Times Live': 'C', 'Mail & Guardian': 'C', 'East African': 'C', 'Standard Media': 'C', 'Daily Nation': 'C', 'PhilStar': 'C', 'Inquirer': 'C', 'Manila Times': 'C', 'The Star Malaysia': 'C', 'Stuff NZ': 'C', 'Nine News': 'C', 'Dutch News': 'C', 'The Local': 'C', 'WION': 'C', 'Economic Times': 'C', 'Money Control': 'C', 'MarketWatch': 'C', 'Fortune': 'C', 'Barrons': 'C', 'Seeking Alpha': 'C', 'Yonhap': 'C', 'Google News': 'LC', 'AFP': 'C', 'Newsweek': 'C', 'The Economist': 'C', 'Forbes': 'C',
  // Right-Center (AllSides: Lean Right)
  'Wall Street Journal': 'RC', 'The Wall Street Journal': 'RC', 'WSJ': 'RC', 'The Telegraph': 'RC', 'Washington Times': 'RC', 'New York Post': 'RC', 'The Dispatch': 'RC', 'RealClearPolitics': 'RC', 'Daily Mail': 'RC', 'Daily Mail UK': 'RC', 'Daily Express': 'RC', 'The Sun': 'RC', 'The Australian': 'RC', 'Jerusalem Post': 'RC', 'Daily Sabah': 'RC', 'TRT World': 'RC', 'Anadolu Agency': 'RC', 'Arab News': 'RC', 'Gulf News': 'RC', 'Al Arabiya': 'RC', 'Global Times': 'RC', 'O Globo': 'RC', 'La NaciÃ³n': 'RC', 'Times of India': 'RC', 'ARY News': 'RC', 'Metro UK': 'RC', 'Evening Standard': 'RC', 'Washington Examiner': 'RC',
  // Right (AllSides: Right)
  'Fox News': 'R', 'Daily Wire': 'R', 'Breitbart': 'R', 'The Blaze': 'R', 'Newsmax': 'R', 'Daily Caller': 'R', 'National Review': 'R', 'The Federalist': 'R', 'New York Sun': 'R', 'RT': 'R', 'TASS': 'R', 'Xinhua': 'R', 'China Daily': 'R', 'Tehran Times': 'R', 'Pravda': 'R', 'RIA Novosti': 'R'
};

function getSourceBias(source) {
  if (!source) return null;
  // Try exact match first
  if (SOURCE_BIAS[source]) return SOURCE_BIAS[source];
  // Partial match - prefer longest matching key, skip short keys to avoid false positives
  // (e.g., 'RT' matching inside 'Report', 'AP' inside 'Japan')
  const srcLower = source.toLowerCase();
  let bestKey = null, bestLen = 0;
  Object.keys(SOURCE_BIAS).forEach(k => {
    if (k.length < 4) return; // Short keys (RT, AP, FT, DW) only match exactly
    const kLower = k.toLowerCase();
    if (srcLower.includes(kLower) || kLower.includes(srcLower)) {
      if (k.length > bestLen) { bestLen = k.length; bestKey = k; }
    }
  });
  return bestKey ? SOURCE_BIAS[bestKey] : 'C';
}

function renderBiasTag(source) {
  const bias = getSourceBias(source);
  if (!bias) return '';
  const labels = { 'L': 'Left Leaning', 'LC': 'Slight Left Leaning', 'C': 'Unbiased', 'RC': 'Slight Right Leaning', 'R': 'Right Leaning' };
  const dotPos = { 'L': '8%', 'LC': '28%', 'C': '50%', 'RC': '72%', 'R': '92%' };
  const dotColor = { 'L': '#2563eb', 'LC': '#60a5fa', 'C': '#9ca3af', 'RC': '#f87171', 'R': '#dc2626' };
  const labelColor = { 'L': '#60a5fa', 'LC': '#93c5fd', 'C': '#9ca3af', 'RC': '#fca5a5', 'R': '#f87171' };
  return `<span style="display:inline-flex;align-items:center;gap:4px;margin-left:6px;vertical-align:middle;">`
    + `<span style="display:inline-block;width:48px;height:4px;border-radius:2px;background:linear-gradient(to right,#2563eb 0%,#60a5fa 20%,#93c5fd 35%,#d1d5db 50%,#fca5a5 65%,#f87171 80%,#dc2626 100%);position:relative;">`
    + `<span style="position:absolute;top:50%;left:${dotPos[bias]};width:8px;height:8px;border-radius:50%;background:#fff;border:2px solid ${dotColor[bias]};transform:translate(-50%,-50%);box-shadow:0 1px 3px rgba(0,0,0,0.4);"></span>`
    + `</span>`
    + `<span style="font-size:7px;color:${labelColor[bias]};font-weight:600;white-space:nowrap;">${labels[bias]}</span>`
    + `</span>`;
}

// Disperse bias clusters so no more than 2 consecutive same-direction articles
function disperseBiasArticles(articles) {
  if (articles.length < 4) return articles;

  function biasDir(source) {
    const b = getSourceBias(source);
    if (b === 'L' || b === 'LC') return 'left';
    if (b === 'RC' || b === 'R') return 'right';
    return 'center';
  }

  // Multiple passes to break up any clusters
  for (let pass = 0; pass < 3; pass++) {
    let changed = false;
    for (let i = 2; i < articles.length; i++) {
      const d0 = biasDir(articles[i - 2].source);
      const d1 = biasDir(articles[i - 1].source);
      const d2 = biasDir(articles[i].source);

      // 3 consecutive same direction (only break up left or right, center clusters are fine)
      if (d0 === d1 && d1 === d2 && d0 !== 'center') {
        // Find nearest article with different direction to swap with
        for (let j = i + 1; j < Math.min(i + 8, articles.length); j++) {
          if (biasDir(articles[j].source) !== d0) {
            [articles[i], articles[j]] = [articles[j], articles[i]];
            changed = true;
            break;
          }
        }
      }
    }
    if (!changed) break;
  }
  return articles;
}

// Store last newsletter data
let lastNewsletterData = null;
let lastNewsletterTime = null;

// Check if it's past 5pm EST (22:00 UTC in winter, 21:00 UTC in summer)
function isNewsletterTime() {
  const now = new Date();
  // Convert to EST (UTC-5)
  const estHour = (now.getUTCHours() - 5 + 24) % 24;
  return estHour >= 17; // 5pm EST or later
}

// Get the newsletter release time for today
function getNewsletterReleaseTime() {
  const now = new Date();
  // Create today at 5pm EST (22:00 UTC)
  const release = new Date(now);
  release.setUTCHours(22, 0, 0, 0);

  // If we're past that time, show it
  if (now >= release) {
    return release;
  }
  return null;
}

// Get time until next newsletter
function getTimeUntilNewsletter() {
  const now = new Date();
  const estHour = (now.getUTCHours() - 5 + 24) % 24;
  const estMinute = now.getUTCMinutes();

  if (estHour >= 17) {
    return null; // Already released
  }

  const hoursLeft = 16 - estHour;
  const minsLeft = 60 - estMinute;

  return { hours: hoursLeft, minutes: minsLeft };
}

// Categorize news by region
function categorizeNewsByRegion(articles) {
  const regionNews = {};

  // Initialize all regions
  Object.keys(NEWSLETTER_REGIONS).forEach(region => {
    regionNews[region] = [];
  });
  regionNews['Global'] = []; // For uncategorized news

  articles.forEach(article => {
    const text = (article.headline || article.title || '');
    let matched = false;

    for (const [region, keywords] of Object.entries(NEWSLETTER_REGIONS)) {
      // Use word-boundary matching to prevent "US" matching inside "suspect", "focus", etc.
      if (keywords.some(kw => {
        const rx = new RegExp('\\b' + kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'i');
        return rx.test(text);
      })) {
        regionNews[region].push(article);
        matched = true;
        break; // Only assign to first matching region
      }
    }

    if (!matched) {
      regionNews['Global'].push(article);
    }
  });

  return regionNews;
}

// ============================================================
// BRIEFING NARRATIVE ENGINE - Generate prose summaries from headlines
// ============================================================

// Extract key entities (countries, orgs) from headline text â€” word-boundary matching only
function extractEntities(text) {
  const entities = [];
  const allCountries = Object.keys(COUNTRIES);
  allCountries.forEach(c => {
    // Use word boundary regex to avoid substring matches (e.g. "Mali" inside "Somalia")
    const rx = new RegExp('\\b' + c.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'i');
    if (rx.test(text)) entities.push(c);
  });
  // Check common shorthand/orgs
  const orgs = { 'NATO': /\bNATO\b/i, 'EU': /\bEU\b|\bEuropean Union\b/i, 'UN': /\bUN\b|\bUnited Nations\b/i,
    'G7': /\bG7\b/i, 'BRICS': /\bBRICS\b/i, 'IMF': /\bIMF\b/i, 'OPEC': /\bOPEC\b/i };
  Object.entries(orgs).forEach(([name, rx]) => { if (rx.test(text)) entities.push(name); });
  return [...new Set(entities)];
}

// Filter entities to only those belonging to a specific region
function getRegionEntities(entities, region) {
  const regionCountries = NEWSLETTER_REGIONS[region] || [];
  return entities.filter(e => {
    // Check if entity is in this region's keyword list
    if (regionCountries.some(kw => kw.toLowerCase() === e.toLowerCase())) return true;
    // Also allow orgs that are relevant globally
    if (['NATO', 'EU', 'UN', 'G7', 'BRICS', 'IMF', 'OPEC'].includes(e)) return true;
    return false;
  });
}

// Classify a headline's tone/action
function classifyHeadline(headline) {
  const h = headline.toLowerCase();
  if (h.match(/attack|strike|bomb|shell|raid|kill|dead|casualt|wound|massacre|assault|shoot|shot|gunfire|stabbing|hostage|murder|execution|slain|slay|terror|explos|arson|ambush/)) return 'violence';
  if (h.match(/ceasefire|peace|truce|agreement|deal|negotiat|talks|summit|diplomat/)) return 'diplomacy';
  if (h.match(/protest|demonstrat|rally|unrest|riot|dissent|opposition/)) return 'unrest';
  if (h.match(/sanction|embargo|tariff|ban|restrict|penalt/)) return 'sanctions';
  if (h.match(/elect|vote|ballot|campaign|inaugurati|sworn|president|prime minister/)) return 'politics';
  if (h.match(/economy|market|stock|trade|gdp|inflation|recession|growth|rate/)) return 'economic';
  if (h.match(/humanitarian|refugee|famine|aid|crisis|disaster|flood|earthquake/)) return 'humanitarian';
  if (h.match(/military|troops|deploy|defense|weapon|missile|nuclear|navy|army/)) return 'military';
  if (h.match(/tech|ai |cyber|chip|data|digital|space/)) return 'technology';
  if (h.match(/climate|carbon|emission|energy|oil|gas|renewable/)) return 'energy';
  return 'general';
}

// Generate a narrative summary for a region
function generateRegionNarrative(region, articles) {
  if (articles.length === 0) return 'No significant developments were reported in this region over the past 24 hours.';

  // Strong deduplication: compare subject words with 50% overlap threshold
  const stopWords = new Set(['the','a','an','in','on','at','to','for','of','and','or','is','are','was','were','has','have','had','with','by','from','that','this','as','it','its','but','not','be','been','will','would','could','should','may','might','after','before','over','into','about','than','also','just','more','most','some','new','other','says','said','amid','during','between','reports','reported','report','latest','live','updates','happened']);
  const classified = [];
  const seenSubjects = [];

  articles.forEach(a => {
    const headline = a.headline || a.title || '';
    if (!headline) return;
    const subjectWords = headline.toLowerCase().replace(/[^a-z0-9\s]/g, '').split(/\s+/)
      .filter(w => w.length > 2 && !stopWords.has(w));
    // Check 50%+ word overlap with any already-seen headline
    const isDuplicate = seenSubjects.some(prev => {
      const overlap = subjectWords.filter(w => prev.includes(w)).length;
      return overlap >= Math.max(Math.min(subjectWords.length, prev.length) * 0.5, 2);
    });
    if (isDuplicate) return;
    seenSubjects.push(subjectWords);
    classified.push({
      headline, source: a.source || '', category: a.category || 'WORLD',
      importance: a.importance || 'medium', type: classifyHeadline(headline),
      entities: extractEntities(headline)
    });
  });

  if (classified.length === 0) return 'No significant developments were reported in this region over the past 24 hours.';

  const high = classified.filter(a => a.importance === 'high');
  const types = {};
  classified.forEach(a => { types[a.type] = (types[a.type] || 0) + 1; });
  const topTypes = Object.entries(types).sort((a, b) => b[1] - a[1]);
  // Only include entities that belong in this region
  const allEntities = getRegionEntities([...new Set(classified.flatMap(a => a.entities))], region);

  const sentences = [];
  const usedIdx = new Set();

  // Helper: format source name with "the" where appropriate
  function fmtSource(src) {
    if (!src) return '';
    const needsThe = /^(New York Times|Washington Post|Guardian|Wall Street Journal|Financial Times|Associated Press|Hindu|Telegraph|Economist|Independent|Atlantic|Intercept|Hill|Times|Sun|Mirror|Observer|Spectator|Globe and Mail|National Post|Japan Times|Jerusalem Post|Moscow Times)$/i;
    return needsThe.test(src) ? 'the ' + src : src;
  }

  // LEAD: Most important story
  const leadStory = high.length > 0 ? high[0] : classified[0];
  usedIdx.add(classified.indexOf(leadStory));
  const leadClean = cleanHeadlineForProse(leadStory.headline);
  if (leadStory.source) {
    sentences.push(`According to ${fmtSource(leadStory.source)}, ${leadClean}.`);
  } else {
    sentences.push(`${leadClean.charAt(0).toUpperCase() + leadClean.slice(1)}.`);
  }

  // SECOND STORY: Different type preferred
  const secondIdx = classified.findIndex((a, i) => !usedIdx.has(i) && a.type !== leadStory.type);
  const altIdx = classified.findIndex((a, i) => !usedIdx.has(i));
  const pickIdx = secondIdx >= 0 ? secondIdx : altIdx;
  if (pickIdx >= 0) {
    usedIdx.add(pickIdx);
    const s = classified[pickIdx];
    const sClean = cleanHeadlineForProse(s.headline);
    const bridge = s.type !== leadStory.type ? ({
      'violence': 'On the security front,', 'diplomacy': 'Diplomatically,', 'unrest': 'Domestically,',
      'sanctions': 'Regarding sanctions,', 'politics': 'Politically,', 'economic': 'Economically,',
      'humanitarian': 'On the humanitarian side,', 'military': 'In defense matters,',
      'technology': 'In technology,', 'energy': 'On energy,', 'general': 'Separately,'
    }[s.type] || 'Separately,') : 'Meanwhile,';
    const srcFmt = fmtSource(s.source);
    const src = s.source ? ` (${srcFmt.charAt(0).toUpperCase() + srcFmt.slice(1)})` : '';
    sentences.push(`${bridge} ${sClean}${src}.`);
  }

  // THIRD STORY: Only if genuinely different and enough stories
  const thirdIdx = classified.findIndex((a, i) => !usedIdx.has(i));
  if (thirdIdx >= 0 && classified.length >= 4) {
    const t = classified[thirdIdx];
    const tClean = cleanHeadlineForProse(t.headline);
    const srcFmt2 = fmtSource(t.source);
    const src = t.source ? ` (${srcFmt2.charAt(0).toUpperCase() + srcFmt2.slice(1)})` : '';
    sentences.push(`Additionally, ${tClean}${src}.`);
  }

  // WHY IT MATTERS: Use only region-relevant entities
  const dominantType = topTypes[0][0];
  const entityStr = allEntities.length >= 2 ? ` involving ${formatEntityList(allEntities.slice(0, 3))}` : (allEntities.length === 1 ? ` regarding ${allEntities[0]}` : '');
  if (classified.length >= 2) {
    const analysis = {
      'violence': `The active conflict situation${entityStr} risks further displacement, economic disruption, and potential external involvement.`,
      'diplomacy': `Whether these diplomatic efforts${entityStr} produce binding commitments will shape stability in ${fmtRegion(region)} over the coming weeks.`,
      'unrest': `This pattern of civil unrest${entityStr} points to structural pressures unlikely to resolve without substantive policy changes.`,
      'politics': `These political developments${entityStr} could shift governance trajectories and reshape international partnerships in ${fmtRegion(region)}.`,
      'economic': `These economic pressures${entityStr} carry implications beyond ${fmtRegion(region)}, as changes in monetary policy and market confidence tend to produce ripple effects across connected economies.`,
      'military': `This military activity${entityStr} raises the risk of miscalculation, particularly when multiple actors are increasing their posture simultaneously.`,
      'humanitarian': `The humanitarian situation${entityStr} demands international attention, as conditions are likely to deteriorate without adequate intervention.`,
      'sanctions': `These economic measures${entityStr} are reshaping trade relationships and pushing affected governments toward alternative partnerships.`,
      'technology': `Technology competition${entityStr} has direct implications for both economic positioning and national security in ${fmtRegion(region)}.`,
      'energy': `Energy developments${entityStr} affect global supply chains and pricing, making them relevant well beyond ${fmtRegion(region)}.`
    };
    sentences.push(analysis[dominantType] || `The range of developments${entityStr} reflects an evolving situation across ${fmtRegion(region)}.`);
  }

  // FORWARD LOOK
  if (high.length >= 3) {
    sentences.push(`The next several days will be important in determining whether these situations escalate or move toward resolution.`);
  } else if (high.length >= 1) {
    sentences.push(`These developments are worth monitoring as the situation continues to evolve.`);
  }

  // Post-process: add formal titles and grammar connectors
  return addThatConnector(addLeaderTitles(sentences.slice(0, 6).join(' ')));
}

// Convert Title Case headlines to sentence case for prose embedding
function toSentenceCase(text) {
  if (!text || text.length < 2) return text;
  // Detect Title Case: >60% of words with 4+ letters are capitalized
  const words = text.split(/\s+/);
  const longWords = words.filter(w => w.replace(/[^a-zA-Z]/g, '').length >= 4);
  const capsLongWords = longWords.filter(w => /^[A-Z]/.test(w));
  const isTitleCase = longWords.length >= 2 && (capsLongWords.length / longWords.length) > 0.6;
  if (!isTitleCase) return text;
  // Build set of words to keep capitalized
  const keepCaps = new Set();
  if (typeof COUNTRIES !== 'undefined') {
    Object.keys(COUNTRIES).forEach(name => {
      name.split(/\s+/).forEach(word => { if (word.length > 1) keepCaps.add(word); });
    });
  }
  ['President','Prime','Minister','King','Queen','Prince','Princess','Pope','Senator','Secretary','General','Admiral','Colonel','Governor','Chancellor','Ambassador',
   'Congress','Parliament','Senate','Pentagon','Kremlin','Vatican','Taliban','Hamas','Hezbollah','ISIS','Houthi','Houthis',
   'Republican','Democrat','Democratic','Labour','Conservative','Liberal','Tory','Tories',
   'European','African','Asian','American','Atlantic','Pacific','Arctic','Antarctic','Mediterranean','Caribbean',
   'Islamic','Muslim','Christian','Jewish','Hindu','Buddhist','Orthodox','Sunni','Shia',
   'Israeli','Iranian','Persian','Chinese','Russian','Ukrainian','Syrian','Iraqi','Afghan','Palestinian','Lebanese',
   'Yemeni','Somali','Sudanese','Libyan','Nigerian','Egyptian','Saudi','Turkish','Japanese','Korean',
   'Indian','Pakistani','Brazilian','Mexican','Cuban','Venezuelan','Colombian','British','French','German',
   'Italian','Spanish','Polish','Dutch','Swedish','Norwegian','Finnish','Danish','Greek','Portuguese',
   'Hungarian','Czech','Romanian','Serbian','Croatian','Bosnian','Albanian','Georgian','Armenian',
   'Canadian','Australian','Taiwanese','Greenlandic','Kurdish','Rohingya','Uyghur','Tibetan','Arab',
   'Trump','Biden','Putin','Xi','Macron','Zelensky','Netanyahu','Modi','Erdogan','Scholz','Starmer','Meloni','Kishida','Lula','Milei','Orban',
   'Wall','Street','Reuters','BBC','CNN','OPEC','WHO','IMF','NATO','BRICS',
   'Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday',
   'January','February','March','April','May','June','July','August','September','October','November','December',
   'Republic','Federation','Assembly','Union','Kingdom','Nations','Commonwealth',
   'Sea','Gulf','Strait','Red','Cross','Crescent','Bank','West','East','Horn','Sahel','Levant','Peninsula','Mount'
  ].forEach(w => keepCaps.add(w));
  return text.replace(/\S+/g, (word, offset) => {
    const cleanW = word.replace(/[^a-zA-Z]/g, '');
    // Keep acronyms (2+ uppercase chars like NATO, U.S., BBC, EU)
    if (/^[A-Z]{2,}\.?$/.test(cleanW)) return word;
    // Keep words with internal dots (U.S., U.K.)
    if (/[A-Z]\.[A-Z]/.test(word)) return word;
    // Keep mixed-case brand names (TikTok, iPhone, YouTube)
    if (/[a-z][A-Z]/.test(word)) return word;
    // Keep known proper nouns
    const base = word.replace(/^[^a-zA-Z]+|[^a-zA-Z]+$/g, '');
    if (keepCaps.has(base)) return word;
    // Keep possessives of proper nouns (Iran's, Trump's)
    const stem = base.replace(/'s$|'s$/i, '');
    if (stem !== base && keepCaps.has(stem)) return word;
    // Otherwise lowercase Title Case words
    if (word[0] === word[0].toUpperCase() && word.length > 1) {
      return word[0].toLowerCase() + word.slice(1);
    }
    return word;
  });
}

// Format region name with "the" where grammatically required
function fmtRegion(region) {
  const needsThe = /^(Middle East|Americas|United States|United Kingdom|Philippines|Netherlands|Balkans|Caucasus|Caribbean|Sahel|Horn of Africa|Levant|Czech Republic|Dominican Republic)$/i;
  return needsThe.test(region) ? 'the ' + region : region;
}

// Add formal titles to world leaders on first mention for professional prose
function addLeaderTitles(text) {
  const titles = [
    ['Trump', 'President'], ['Biden', 'President'], ['Putin', 'President'],
    ['Zelensky', 'President'], ['Xi Jinping', 'President'], ['Xi', 'President'],
    ['Macron', 'President'], ['Erdogan', 'President'], ['Lula', 'President'],
    ['Milei', 'President'], ['Sisi', 'President'], ['Assad', 'President'],
    ['Netanyahu', 'Prime Minister'], ['Modi', 'Prime Minister'],
    ['Starmer', 'Prime Minister'], ['Kishida', 'Prime Minister'],
    ['Scholz', 'Chancellor'], ['Meloni', 'Prime Minister'],
    ['Orban', 'Prime Minister'], ['Trudeau', 'Prime Minister']
  ];
  let result = text;
  for (const [name, title] of titles) {
    if (result.includes(`${title} ${name}`)) continue;
    const idx = result.indexOf(name);
    if (idx < 0) continue;
    const before = result.substring(Math.max(0, idx - 25), idx).toLowerCase();
    if (/\b(president|minister|chancellor|king|queen|pope|premier|secretary|prince|leader)\s*$/.test(before)) continue;
    result = result.replace(new RegExp(`\\b${name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`), `${title} ${name}`);
  }
  return result;
}

// Add "that" connector after reporting verbs for natural prose flow
function addThatConnector(text) {
  // After "tells/told [Titled Name]" + clause starting with proper noun, insert "that"
  text = text.replace(/\b(tells?|told)\s+((?:President|Prime Minister|Chancellor)\s+[\w]+)\s+(?!that\b)([A-Z])/g, '$1 $2 that $3');
  // After reporting verbs + clause starting with proper noun (not already followed by that/the/a/pronouns/prepositions)
  text = text.replace(/\b(says?|said|warns?|warned|claims?|claimed|announces?|announced|confirms?|confirmed|denies?|denied|suggests?|suggested|indicates?|indicated|signals?|signaled|reveals?|revealed|declares?|declared|states?|stated|acknowledges?|acknowledged|reports?|reported)\s+(?!that |the |a |an |it |he |she |they |this |these |there |his |her |its |to |in |on |at |for |of |with |from |no |not |more )([A-Z])/g, '$1 that $2');
  return text;
}

// Format a list with Oxford comma: ["A","B","C"] â†’ "A, B, and C"
function formatEntityList(items) {
  if (items.length === 0) return '';
  if (items.length === 1) return items[0];
  if (items.length === 2) return items[0] + ' and ' + items[1];
  return items.slice(0, -1).join(', ') + ', and ' + items[items.length - 1];
}

// Add missing articles (a/an/the) that headlines drop for brevity
function addMissingArticles(text) {
  // Add "the" before geographic features: Sea of X, Strait of X, Gulf of X, etc.
  text = text.replace(/\b(over|near|across|through|in|at|along|around|off|into|from|toward|towards|between|beyond|throughout)\s+((?:Sea|Gulf|Strait|Bay|Cape|Horn|Canal|Channel|Peninsula|Coast)\s+of\s+\w+)/gi, (m, prep, geo) => {
    return prep + ' the ' + geo;
  });
  // Named geographic features: Taiwan Strait, English Channel, Suez Canal, etc.
  text = text.replace(/\b(over|near|across|through|in|at|along|around|off|into|from|toward|towards|between|beyond)\s+(Taiwan Strait|English Channel|Suez Canal|Panama Canal|Korean Peninsula|Sinai Peninsula|Arabian Peninsula|Bering Strait|South China Sea|East China Sea|Yellow Sea|Red Sea|Black Sea|Caspian Sea|Dead Sea|Persian Gulf|Gulf of Aden|Gulf of Mexico|Indian Ocean|Pacific Ocean|Atlantic Ocean|Arctic Ocean|Mediterranean Sea|Sea of Japan|Strait of Hormuz|Strait of Malacca|Cape of Good Hope)/gi, (m, prep, geo) => {
    return prep + ' the ' + geo;
  });
  // Add "the" before standalone geographic nouns after prepositions
  // Capitalize proper features (Strait, Canal, Channel, Peninsula); keep common nouns lowercase (coast, border)
  const properGeoNouns = new Set(['strait','canal','channel','peninsula']);
  text = text.replace(/\b(over|near|across|through|along|around|off|into|from|toward|towards|beyond)\s+(strait|coast|border|peninsula|canal|channel|coastline|frontier)\b/gi, (m, prep, noun) => {
    const formatted = properGeoNouns.has(noun.toLowerCase()) ? noun.charAt(0).toUpperCase() + noun.slice(1).toLowerCase() : noun.toLowerCase();
    return prep + ' the ' + formatted;
  });
  // Add "a/an" after transitive verbs before adjective+noun phrases (headlineâ†’prose)
  const verbs = 'signals?|conducts?|launches?|announces?|proposes?|unveils?|signs?|stages?|holds?|tests?|fires?|strikes?|reaches?|orders?|declares?|faces?|seeks?|passes?|approves?|rejects?|adopts?|drafts?|releases?|presents?|issues?|begins?|starts?|opens?|plans?|builds?|creates?|forms?|calls?|makes?|sends?|sets?|targets?|secures?|deploys?|initiates?|negotiates?|brokers?';
  const adjectives = 'major|minor|new|key|massive|significant|potential|critical|large|joint|historic|landmark|formal|fresh|preliminary|strategic|sweeping|broad|controversial|surprise|bold|ambitious|record|emergency|special|temporary|permanent|bilateral|unilateral|ballistic|nuclear|diplomatic|military|ceasefire|peace|trade|economic|political|humanitarian|long-awaited|nationwide|partial|full|limited|comprehensive|retaliatory|preemptive|multinational';
  const regex = new RegExp('\\b(' + verbs + ')\\s+(' + adjectives + ')\\s+', 'gi');
  text = text.replace(regex, (match, verb, adj) => {
    const article = /^[aeiou]/i.test(adj) ? 'an' : 'a';
    return verb + ' ' + article + ' ' + adj + ' ';
  });
  return text;
}

// Clean a headline for embedding in prose
function cleanHeadlineForProse(headline) {
  if (!headline) return 'ongoing developments';
  let clean = headline;
  // Strip source prefixes like "Reuters: " or "BBC - "
  clean = clean.replace(/^[A-Z][A-Za-z\s]+[\-:]\s*/, '');
  // Strip live-blog suffixes: "â€“ as it happened", "| Live updates", "- live", etc.
  clean = clean.replace(/\s*[\-â€“|]+\s*(as it happened|live updates?|live blog|breaking|developing story|watch live|latest|updates?)\s*$/i, '');
  // Strip "(PHOTOS)", "(VIDEO)", "[WATCH]", etc.
  clean = clean.replace(/\s*[\(\[](photos?|videos?|watch|gallery|breaking|exclusive|updated?|opinion|analysis)[\)\]]\s*/gi, '');
  // Strip leading "BREAKING:" "EXCLUSIVE:" "WATCH:" "UPDATE:" etc.
  clean = clean.replace(/^(BREAKING|EXCLUSIVE|WATCH|UPDATE|JUST IN|ALERT|DEVELOPING|OPINION|ANALYSIS)\s*[:\-â€“]\s*/i, '');
  // Convert Title Case headlines to sentence case for natural prose
  clean = toSentenceCase(clean);
  // Add missing articles (a/an/the) that headlines drop for brevity
  clean = addMissingArticles(clean);
  // Remove trailing periods, dashes, pipes
  clean = clean.replace(/[\.\-â€“|]\s*$/, '').trim();
  return clean || 'ongoing developments';
}

// Generate a Global Ramifications section tying all regions together + uncategorized stories
function generateGlobalRamifications(regionData, globalArticles) {
  const allArticles = regionData.flatMap(([_, arts]) => arts);
  const uncategorized = globalArticles || [];
  const combined = [...allArticles, ...uncategorized];
  if (combined.length === 0) return '';

  // Deduplicate with 50% subject-word overlap
  const stopWords = new Set(['the','a','an','in','on','at','to','for','of','and','or','is','are','was','were','has','have','had','with','by','from','that','this','as','it','its','but','not','be','been','will','would','could','should','may','might','after','before','over','into','about','than','also','just','more','most','some','new','other','says','said','amid','during','between','reports','reported','report','latest','live','updates','happened']);
  const classified = [];
  const seenSubjects = [];
  combined.forEach(a => {
    const headline = a.headline || a.title || '';
    if (!headline) return;
    const subjectWords = headline.toLowerCase().replace(/[^a-z0-9\s]/g, '').split(/\s+/).filter(w => w.length > 2 && !stopWords.has(w));
    const isDuplicate = seenSubjects.some(prev => {
      const overlap = subjectWords.filter(w => prev.includes(w)).length;
      return overlap >= Math.max(Math.min(subjectWords.length, prev.length) * 0.5, 2);
    });
    if (isDuplicate) return;
    seenSubjects.push(subjectWords);
    classified.push({
      headline, source: a.source || '', type: classifyHeadline(headline),
      category: a.category || 'WORLD', importance: a.importance || 'medium',
      entities: extractEntities(headline)
    });
  });

  const high = classified.filter(a => a.importance === 'high');
  const types = {};
  classified.forEach(a => { types[a.type] = (types[a.type] || 0) + 1; });
  const topTypes = Object.entries(types).sort((a, b) => b[1] - a[1]);
  const activeRegions = regionData.filter(([_, arts]) => arts.length > 0).map(([r]) => r);
  const allEntities = [...new Set(classified.flatMap(a => a.entities))];
  const majorPowers = allEntities.filter(e => ['United States', 'China', 'Russia', 'EU', 'NATO', 'UN', 'United Kingdom', 'France', 'Germany', 'India', 'Iran', 'Israel', 'Saudi Arabia', 'Turkey', 'Japan'].includes(e));
  const conflictRegions = regionData.filter(([_, arts]) => arts.some(a => a.importance === 'high')).map(([r]) => r);

  const sentences = [];

  // PARAGRAPH 1: Set the scene â€” what kind of day was it globally
  if (high.length >= 5) {
    sentences.push(`Taking the regional developments together, the past 24 hours represented an elevated period for global risk. ${high.length} high-priority situations were tracked across ${activeRegions.length} regions, a concentration that places strain on international attention and response capacity.`);
  } else if (high.length >= 2) {
    sentences.push(`Viewed collectively, the past 24 hours produced a period of sustained geopolitical activity, with ${high.length} high-priority developments spread across ${activeRegions.length} regions. While no single event dominated the global stage, the combination of these developments paints a picture of an international system under consistent pressure.`);
  } else {
    sentences.push(`Across ${activeRegions.length} active regions, the past 24 hours reflected a measured but active news cycle. ${classified.length} developments were tracked in total, none of which individually rose to crisis level but which, taken together, suggest a baseline of tension that bears monitoring.`);
  }

  // PARAGRAPH 2: Cross-regional connections â€” the analytical core
  if (conflictRegions.length >= 2) {
    sentences.push(`The most consequential pattern in this cycle is the simultaneity of high-priority activity in ${formatEntityList(conflictRegions.slice(0, 4).map(fmtRegion))}. When crises unfold in multiple theaters at once, the practical effect is a stretching of diplomatic bandwidth and military readiness. Policymakers cannot give full attention to any one situation, and the risk increases that a secondary crisis escalates precisely because primary attention is directed elsewhere.`);
  } else if (activeRegions.length >= 3) {
    sentences.push(`Activity was spread across ${activeRegions.map(fmtRegion).join(', ')}, each contributing distinct threads. While the situations in these regions are not directly connected in most cases, they share an underlying dynamic: a global order under strain, where local instability increasingly has international dimensions and where the capacity for coordinated response has not kept pace with the number of active situations.`);
  }

  // PARAGRAPH 3: Major power dynamics
  if (majorPowers.length >= 3) {
    sentences.push(`Several major powers appeared across the day's developments, including ${majorPowers.slice(0, 4).join(', ')}. This is significant because the positions and actions of these actors set the parameters within which smaller conflicts and negotiations take place. When major powers are simultaneously engaged in multiple theaters, their leverage in any single negotiation tends to diminish, creating openings for regional actors to pursue independent agendas.`);
  } else if (majorPowers.length >= 1) {
    sentences.push(`${majorPowers[0]} was visible across multiple developments in this cycle. The decisions made by ${majorPowers[0]} in the coming days, particularly regarding resource allocation and diplomatic priorities, will influence how several of these situations evolve.`);
  }

  // PARAGRAPH 4: Uncategorized stories that didn't fit a continent
  const uncatDedupe = [];
  const uncatSeenSubjects = [];
  uncategorized.forEach(a => {
    const headline = a.headline || a.title || '';
    if (!headline) return;
    const sw = headline.toLowerCase().replace(/[^a-z0-9\s]/g, '').split(/\s+/).filter(w => w.length > 2 && !stopWords.has(w));
    const isDup = uncatSeenSubjects.some(prev => {
      const ov = sw.filter(w => prev.includes(w)).length;
      return ov >= Math.max(Math.min(sw.length, prev.length) * 0.5, 2);
    });
    if (!isDup) { uncatSeenSubjects.push(sw); uncatDedupe.push({ headline, source: a.source || '' }); }
  });
  if (uncatDedupe.length > 0) {
    const topGlobal = uncatDedupe[0];
    const sourceRef = topGlobal.source ? `, per ${topGlobal.source}` : '';
    sentences.push(`Beyond the regional analysis, developments at the global level included ${cleanHeadlineForProse(topGlobal.headline)}${sourceRef}. These cross-cutting issues often receive less attention than active conflicts but carry long-term consequences for the international system.`);
  }

  // PARAGRAPH 5: Forward look â€” grounded, not generic
  if (high.length >= 3) {
    sentences.push(`With ${high.length} unresolved high-priority situations across multiple regions, the next several days carry elevated risk. The key question is whether any of these situations produce a decisive shift, either toward resolution or escalation, that changes the broader calculus. Until that happens, the current posture of sustained tension is likely to persist.`);
  } else if (classified.length >= 10) {
    sentences.push(`The overall picture is one of managed instability. No single crisis is spiraling out of control, but the number of active situations means that the margin for error across the international system is thinner than it might appear on any given day. Sustained attention across these fronts remains necessary.`);
  } else {
    sentences.push(`While the global risk level is not at its highest, several of these threads have the potential to develop into more significant stories. The coming days will be worth watching, particularly where domestic pressures intersect with international dynamics.`);
  }

  return addThatConnector(addLeaderTitles(sentences.join(' ')));
}

// Render a single briefing's regional content (reusable for current + past)
function renderBriefingContent(articles) {
  if (!articles || articles.length === 0) {
    return `<div style="text-align:center;padding:20px;color:#6b7280;font-size:11px;">No articles available for this briefing.</div>`;
  }

  const regionNews = categorizeNewsByRegion(articles);

  // Separate continent regions from the 'Global' catch-all bucket
  const globalArticles = regionNews['Global'] || [];
  const continentRegions = Object.entries(regionNews)
    .filter(([name, arts]) => name !== 'Global' && arts.length > 0);

  // Sort regions by significance: high-priority count first, then total article count
  // This means the most eventful continent leads the briefing each day
  continentRegions.sort((a, b) => {
    const aScore = a[1].filter(x => x.importance === 'high').length * 10 + a[1].length;
    const bScore = b[1].filter(x => x.importance === 'high').length * 10 + b[1].length;
    return bScore - aScore;
  });

  if (continentRegions.length === 0 && globalArticles.length === 0) {
    return `<div style="text-align:center;padding:20px;color:#6b7280;font-size:11px;">No regional updates available.</div>`;
  }

  let html = '';

  // Regional narrative summaries â€” ordered by significance of the day
  continentRegions.forEach(([region, arts]) => {
    const highPriority = arts.filter(a => a.importance === 'high');
    const narrative = generateRegionNarrative(region, arts);

    html += `
      <div class="newsletter-region" style="margin-bottom:16px;">
        <div class="newsletter-region-header">
          <span class="newsletter-region-name">${region.toUpperCase()}</span>
          ${highPriority.length > 0 ? `<span style="font-size:8px;background:#7f1d1d;color:#fca5a5;padding:2px 6px;border-radius:3px;">${highPriority.length} CRITICAL</span>` : ''}
          <span class="newsletter-region-count">${arts.length} update${arts.length > 1 ? 's' : ''}</span>
        </div>
        <div style="font-size:11px;color:#c9cdd4;line-height:1.7;padding:8px 12px 12px;letter-spacing:0.01em;">
          ${narrative}
        </div>
      </div>
    `;
  });

  // Global Ramifications section â€” ties all regions together + absorbs uncategorized stories
  const ramifications = generateGlobalRamifications(continentRegions, globalArticles);
  if (ramifications) {
    html += `
      <div style="margin-top:8px;border-top:1px solid #1f2937;padding-top:14px;">
        <div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(90deg,rgba(6,182,212,0.12) 0%,transparent 100%);border-left:3px solid #06b6d4;margin-bottom:6px;">
          <span style="font-size:11px;font-weight:700;color:#06b6d4;letter-spacing:1px;">GLOBAL RAMIFICATIONS</span>
        </div>
        <div style="font-size:11px;color:#c9cdd4;line-height:1.7;padding:8px 12px 12px;letter-spacing:0.01em;">
          ${ramifications}
        </div>
      </div>
    `;
  }

  return html;
}

// Toggle past briefing dropdown in Brief tab
function toggleBriefDropdown(id) {
  const el = document.getElementById(id);
  const arrow = document.getElementById(id + '-arrow');
  if (el) {
    const isOpen = el.style.maxHeight && el.style.maxHeight !== '0px';
    el.style.maxHeight = isOpen ? '0px' : el.scrollHeight + 'px';
    el.style.opacity = isOpen ? '0' : '1';
    if (arrow) arrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
  }
}

// Render the newsletter / Brief tab
function renderNewsletter() {
  const now = new Date();
  const timeUntil = getTimeUntilNewsletter();
  const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

  // Build header â€” always visible, countdown inline when pending
  let html = `
    <div class="newsletter-header">
      <div class="newsletter-title">DAILY INTELLIGENCE BRIEFING</div>
      <div class="newsletter-meta">`;

  if (timeUntil) {
    // Before 5pm EST â€” show PENDING status with inline countdown
    html += `
        <span class="newsletter-status pending"><span style="display:inline-block;width:6px;height:6px;background:#f59e0b;border-radius:50%;margin-right:4px;"></span>PENDING</span>
        <span>Released daily at 5:00 PM EST</span>
        <span style="font-size:9px;color:#f59e0b;font-weight:600;font-family:monospace;background:rgba(245,158,11,0.1);padding:2px 6px;border-radius:4px;margin-left:4px;">Next in ${String(timeUntil.hours).padStart(2, '0')}:${String(timeUntil.minutes).padStart(2, '0')}</span>`;
  } else {
    // After 5pm EST â€” show LIVE status
    html += `
        <span class="newsletter-status live"><span style="display:inline-block;width:6px;height:6px;background:#22c55e;border-radius:50%;margin-right:4px;animation:pulse 1.5s infinite;"></span>LIVE</span>
        <span>${dateStr}</span>`;
  }

  html += `
      </div>
    </div>
  `;

  // Always show current briefing content (whether pending or live)
  html += renderBriefingContent(DAILY_BRIEFING);

  // Footer for current briefing
  html += `
    <div style="text-align:center;padding:12px;margin-top:8px;border-top:1px solid #1f2937;">
      <div style="font-size:9px;color:#6b7280;">Compiled from ${DAILY_BRIEFING.length} sources</div>
    </div>
  `;

  // Past briefings as collapsible dropdowns
  const pastBriefings = getPastBriefings();
  if (pastBriefings.length > 0) {
    html += `<div style="margin-top:6px;border-top:1px solid #1f2937;padding-top:12px;">
      <div style="font-size:9px;color:#6b7280;font-weight:600;letter-spacing:1px;margin-bottom:10px;padding:0 4px;">PREVIOUS BRIEFINGS</div>`;

    pastBriefings.forEach((briefing, index) => {
      const id = 'brief-history-' + index;
      const dateLabel = formatBriefingDate(briefing.date);
      const articleCount = briefing.articles ? briefing.articles.length : 0;

      html += `
        <div style="margin-bottom:8px;border:1px solid #1f2937;border-radius:8px;overflow:hidden;background:#0d0d14;">
          <div onclick="toggleBriefDropdown('${id}')" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer;transition:background 0.2s;background:#0d0d14;" onmouseover="this.style.background='#131320'" onmouseout="this.style.background='#0d0d14'">
            <div style="display:flex;align-items:center;gap:8px;">
              <span style="font-size:11px;font-weight:600;color:#9ca3af;">${dateLabel}'s Brief</span>
              <span style="font-size:8px;color:#6b7280;background:#1f2937;padding:2px 6px;border-radius:4px;">${articleCount} articles</span>
            </div>
            <span id="${id}-arrow" style="color:#6b7280;font-size:10px;transition:transform 0.3s ease;">â–¼</span>
          </div>
          <div id="${id}" style="max-height:0px;opacity:0;overflow:hidden;transition:max-height 0.4s ease, opacity 0.3s ease;">
            ${renderBriefingContent(briefing.articles)}
          </div>
        </div>`;
    });

    html += `</div>`;
  }

  return html;
}

// DAILY BRIEFING
// Fallback static news (used if API fails)
const DAILY_BRIEFING_FALLBACK = [
  { time: '1h ago', category: 'CONFLICT', importance: 'high', headline: 'Heavy fighting reported in eastern Ukraine as winter operations intensify', source: 'Reuters', url: '#' },
  { time: '2h ago', category: 'SECURITY', importance: 'high', headline: 'North Korea conducts ballistic missile test over Sea of Japan', source: 'AP News', url: '#' },
  { time: '3h ago', category: 'TECH', importance: 'medium', headline: 'US expands AI chip export restrictions to additional countries', source: 'WSJ', url: '#' },
  { time: '4h ago', category: 'ECONOMY', importance: 'high', headline: 'China signals major stimulus package amid property sector concerns', source: 'Financial Times', url: '#' },
  { time: '5h ago', category: 'POLITICS', importance: 'medium', headline: 'European leaders discuss expanded Ukraine military support', source: 'BBC', url: '#' },
  { time: '6h ago', category: 'SECURITY', importance: 'medium', headline: 'NATO allies agree to increase defense spending targets', source: 'Fox News', url: '#' },
  { time: '8h ago', category: 'CRISIS', importance: 'high', headline: 'Humanitarian agencies warn of famine conditions in Sudan', source: 'UN News', url: '#' },
  { time: '10h ago', category: 'DIPLOMACY', importance: 'medium', headline: 'UN Security Council holds emergency session on Middle East crisis', source: 'Al Jazeera', url: '#' },
  { time: '12h ago', category: 'ECONOMY', importance: 'medium', headline: 'Oil prices surge on Middle East supply concerns', source: 'Washington Times', url: '#' },
  { time: '14h ago', category: 'SECURITY', importance: 'medium', headline: 'Taiwan reports increased Chinese military activity near strait', source: 'Nikkei Asia', url: '#' },
  { time: '15h ago', category: 'POLITICS', importance: 'medium', headline: 'Venezuela opposition rejects latest government dialogue offer', source: 'Reuters', url: '#' },
  { time: '16h ago', category: 'CONFLICT', importance: 'high', headline: 'Gaza ceasefire negotiations continue amid escalating violence', source: 'New York Post', url: '#' },
  { time: '18h ago', category: 'CLIMATE', importance: 'medium', headline: 'Record temperatures recorded across Southeast Asia amid drought', source: 'The Guardian', url: '#' },
  { time: '20h ago', category: 'POLITICS', importance: 'medium', headline: 'South Korea opposition party gains momentum ahead of elections', source: 'Korea Times', url: '#' },
  { time: '22h ago', category: 'ECONOMY', importance: 'medium', headline: 'Federal Reserve signals cautious approach to rate cuts in 2026', source: 'Bloomberg', url: '#' },
  { time: '1d ago', category: 'SECURITY', importance: 'high', headline: 'Iran accelerates uranium enrichment, IAEA reports', source: 'Reuters', url: '#' },
  { time: '1d ago', category: 'DIPLOMACY', importance: 'medium', headline: 'India-Pakistan tensions rise over water sharing dispute', source: 'The Hindu', url: '#' },
  { time: '1d ago', category: 'CRISIS', importance: 'high', headline: 'Myanmar military launches major offensive against resistance forces', source: 'BBC', url: '#' },
  { time: '1d ago', category: 'ECONOMY', importance: 'medium', headline: 'Global shipping costs spike amid Red Sea disruptions', source: 'Financial Times', url: '#' },
  { time: '1d ago', category: 'WORLD', importance: 'medium', headline: 'Ethiopian government and Tigray rebels resume peace talks', source: 'France 24', url: '#' },
  { time: '2d ago', category: 'TECH', importance: 'medium', headline: 'EU announces new regulations for artificial intelligence systems', source: 'DW News', url: '#' },
  { time: '2d ago', category: 'CONFLICT', importance: 'high', headline: 'Fighting intensifies in eastern DRC as M23 advances', source: 'Reuters', url: '#' },
  { time: '2d ago', category: 'ECONOMY', importance: 'medium', headline: 'Japan intervenes to stabilize yen after sharp decline', source: 'Nikkei Asia', url: '#' },
  { time: '2d ago', category: 'POLITICS', importance: 'medium', headline: 'Brazilian congress passes controversial environmental reform', source: 'Reuters', url: '#' },
  { time: '2d ago', category: 'CRISIS', importance: 'high', headline: 'Haiti gang violence forces closure of main hospital', source: 'AP News', url: '#' }
];

// Live news storage
let DAILY_BRIEFING = [...DAILY_BRIEFING_FALLBACK];
let lastNewsUpdate = null;

// ============================================================
// BRIEFING HISTORY - Keep past 3 days of briefings
// ============================================================
const BRIEFING_HISTORY_KEY = 'hegemon_briefing_history';
const BRIEFING_MAX_HISTORY = 3;

function getBriefingDateKey() {
  const now = new Date();
  return now.toISOString().split('T')[0]; // YYYY-MM-DD
}

function formatBriefingDate(dateStr) {
  const date = new Date(dateStr + 'T12:00:00');
  const month = date.toLocaleString('en-US', { month: 'long' });
  const day = date.getDate();
  const suffix = day === 1 || day === 21 || day === 31 ? 'st' : day === 2 || day === 22 ? 'nd' : day === 3 || day === 23 ? 'rd' : 'th';
  return `${month} ${day}${suffix}`;
}

function loadBriefingHistory() {
  try {
    const stored = localStorage.getItem(BRIEFING_HISTORY_KEY);
    if (stored) {
      const history = JSON.parse(stored);
      // Clean out entries older than 4 days
      const cutoff = new Date();
      cutoff.setDate(cutoff.getDate() - 4);
      const cutoffStr = cutoff.toISOString().split('T')[0];
      const cleaned = {};
      Object.keys(history).filter(d => d >= cutoffStr).sort().reverse().slice(0, BRIEFING_MAX_HISTORY).forEach(d => {
        cleaned[d] = history[d];
      });
      return cleaned;
    }
  } catch (e) {
    console.warn('Failed to load briefing history:', e.message);
  }
  return {};
}

function saveBriefingSnapshot() {
  if (!DAILY_BRIEFING || DAILY_BRIEFING.length === 0) return;
  // Only save non-fallback data (check if we have real articles with real URLs)
  const hasRealArticles = DAILY_BRIEFING.some(a => a.url && a.url !== '#');
  if (!hasRealArticles) return;

  const todayKey = getBriefingDateKey();
  try {
    const history = loadBriefingHistory();

    // Save today's snapshot (overwrite if exists - keeps latest version)
    history[todayKey] = {
      date: todayKey,
      articles: DAILY_BRIEFING.slice(0, 50).map(a => ({
        time: a.time,
        category: a.category,
        importance: a.importance,
        headline: a.headline,
        source: a.source,
        url: a.url
      })),
      savedAt: new Date().toISOString(),
      articleCount: DAILY_BRIEFING.length
    };

    // Keep only the most recent entries (today + 3 past days)
    const allDates = Object.keys(history).sort().reverse();
    const trimmed = {};
    allDates.slice(0, BRIEFING_MAX_HISTORY + 1).forEach(d => { trimmed[d] = history[d]; });

    localStorage.setItem(BRIEFING_HISTORY_KEY, JSON.stringify(trimmed));
    console.log(`Briefing snapshot saved for ${todayKey} (${DAILY_BRIEFING.length} articles)`);
  } catch (e) {
    console.warn('Failed to save briefing snapshot:', e.message);
  }
}

function getPastBriefings() {
  const todayKey = getBriefingDateKey();
  const history = loadBriefingHistory();
  // Return past briefings (exclude today), sorted newest first
  return Object.keys(history)
    .filter(d => d !== todayKey)
    .sort()
    .reverse()
    .slice(0, BRIEFING_MAX_HISTORY)
    .map(d => history[d]);
}

function togglePastBriefing(id) {
  const el = document.getElementById(id);
  const arrow = document.getElementById(id + '-arrow');
  if (el) {
    const isOpen = el.style.maxHeight && el.style.maxHeight !== '0px';
    el.style.maxHeight = isOpen ? '0px' : el.scrollHeight + 'px';
    el.style.opacity = isOpen ? '0' : '1';
    if (arrow) arrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
  }
}

function renderPastBriefingsHTML() {
  const pastBriefings = getPastBriefings();
  if (pastBriefings.length === 0) return '';

  let html = `<div style="margin-top:20px;border-top:1px solid #1f2937;padding-top:14px;">
    <div style="font-size:9px;color:#6b7280;font-weight:600;letter-spacing:1px;margin-bottom:10px;padding:0 4px;">PREVIOUS BRIEFINGS</div>`;

  pastBriefings.forEach((briefing, index) => {
    const id = 'past-briefing-' + index;
    const dateLabel = formatBriefingDate(briefing.date);
    const articleCount = briefing.articles ? briefing.articles.length : 0;

    html += `
      <div style="margin-bottom:8px;border:1px solid #1f2937;border-radius:8px;overflow:hidden;background:#0d0d14;">
        <div onclick="togglePastBriefing('${id}')" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer;transition:background 0.2s;background:#0d0d14;" onmouseover="this.style.background='#131320'" onmouseout="this.style.background='#0d0d14'">
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-size:11px;font-weight:600;color:#9ca3af;">${dateLabel}'s Brief</span>
            <span style="font-size:8px;color:#6b7280;background:#1f2937;padding:2px 6px;border-radius:4px;">${articleCount} articles</span>
          </div>
          <span id="${id}-arrow" style="color:#6b7280;font-size:10px;transition:transform 0.3s ease;">â–¼</span>
        </div>
        <div id="${id}" style="max-height:0px;opacity:0;overflow-y:auto;transition:max-height 0.4s ease, opacity 0.3s ease;max-height:0;">`;

    if (briefing.articles && briefing.articles.length > 0) {
      // Show top stories first
      const topStories = briefing.articles.filter(a => a.importance === 'high' || ['CONFLICT', 'CRISIS', 'SECURITY'].includes(a.category)).slice(0, 3);
      const otherArticles = briefing.articles.filter(a => !topStories.includes(a)).slice(0, 12);

      if (topStories.length > 0) {
        html += `<div style="padding:4px 10px 2px;font-size:8px;color:#ef4444;font-weight:600;letter-spacing:0.5px;">TOP STORIES</div>`;
        html += topStories.map(a => `
          <div style="padding:6px 10px;border-bottom:1px solid #111827;">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px;">
              <span class="card-cat ${a.category}" style="font-size:6px;padding:1px 4px;">${a.category}</span>
              <span style="font-size:8px;color:#6b7280;">${a.source}</span>
            </div>
            <div style="font-size:10px;color:#d1d5db;line-height:1.4;">${a.headline}</div>
            ${a.url && a.url !== '#' ? `<a href="${a.url}" target="_blank" style="font-size:8px;color:#06b6d4;text-decoration:none;">Read more â†—</a>` : ''}
          </div>
        `).join('');
      }

      if (otherArticles.length > 0) {
        html += `<div style="padding:6px 10px 2px;font-size:8px;color:#3b82f6;font-weight:600;letter-spacing:0.5px;">ALL UPDATES</div>`;
        html += otherArticles.map(a => `
          <div style="padding:5px 10px;border-bottom:1px solid #111827;">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;">
              <span class="card-cat ${a.category}" style="font-size:6px;padding:1px 4px;">${a.category}</span>
              <span style="font-size:8px;color:#6b7280;">${a.source}</span>
            </div>
            <div style="font-size:9px;color:#9ca3af;line-height:1.4;">${a.headline}</div>
          </div>
        `).join('');
      }
    } else {
      html += `<div style="padding:12px;font-size:10px;color:#6b7280;text-align:center;">No articles available for this briefing.</div>`;
    }

    html += `</div></div>`;
  });

  html += `</div>`;
  return html;
}

// RSS Feed sources - FREE and UNLIMITED!
const RSS_FEEDS = {
  // Diverse world news RSS feeds - interleaved so no bias clusters together
  daily: [
    { url: 'https://feeds.reuters.com/Reuters/worldNews', source: 'Reuters' },             // Center
    { url: 'https://feeds.bbci.co.uk/news/world/rss.xml', source: 'BBC World' },           // Left-Center
    { url: 'https://feeds.a.dj.com/rss/RSSWorldNews.xml', source: 'Wall Street Journal' }, // Right-Center
    { url: 'https://rss.nytimes.com/services/xml/rss/nyt/World.xml', source: 'New York Times' }, // Left-Center
    { url: 'https://www.dailymail.co.uk/news/worldnews/index.rss', source: 'Daily Mail' }, // Right-Center
    { url: 'https://thehill.com/feed/', source: 'The Hill' },                               // Center
    { url: 'https://feeds.foxnews.com/foxnews/world', source: 'Fox News' },                // Right
    { url: 'https://www.aljazeera.com/xml/rss/all.xml', source: 'Al Jazeera' },            // Left-Center
    { url: 'https://nypost.com/feed/', source: 'New York Post' },                          // Right-Center
    { url: 'https://www.theguardian.com/world/rss', source: 'The Guardian' },               // Left
    { url: 'https://www.washingtontimes.com/rss/headlines/news/world/', source: 'Washington Times' } // Right-Center
  ],
  // Country-specific search will use Google News RSS
  search: (query) => `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=en-US&gl=US&ceid=US:en`
};

// RSS to JSON proxy (free tier: 10,000 req/day)
const RSS2JSON_API = 'https://api.rss2json.com/v1/api.json?rss_url=';

// Multiple backup News APIs for robust fallback
const NEWS_APIS = {
  newsdata: {
    key: 'pub_7c217680d0cb4730af5530a2e86e2474',
    buildUrl: (key, query) => `https://newsdata.io/api/1/news?apikey=${key}&language=en&q=${encodeURIComponent(query)}&size=30`,
    buildDailyUrl: (key) => `https://newsdata.io/api/1/news?apikey=${key}&language=en&category=world,politics,business,technology&size=50`,
    parseResults: (data) => data.status === 'success' ? data.results : null
  },
  gnews: {
    key: 'e67a04b89b39458db2aba2de73cd4e52',
    buildUrl: (key, query) => `https://gnews.io/api/v4/search?q=${encodeURIComponent(query)}&lang=en&max=15&apikey=${key}`,
    buildDailyUrl: (key) => `https://gnews.io/api/v4/top-headlines?lang=en&max=50&apikey=${key}`,
    parseResults: (data) => data.articles ? data.articles.map(a => ({
      title: a.title,
      description: a.description || '',
      link: a.url,
      source_id: a.source?.name || 'GNews',
      pubDate: a.publishedAt
    })) : null
  },
  mediastack: {
    key: 'a03d02da70b2f5e91f0d8e3c71e1f604',
    buildUrl: (key, query) => `https://api.mediastack.com/v1/news?access_key=${key}&keywords=${encodeURIComponent(query)}&languages=en&limit=15`,
    buildDailyUrl: (key) => `https://api.mediastack.com/v1/news?access_key=${key}&languages=en&categories=general,politics,business,technology&limit=50`,
    parseResults: (data) => data.data ? data.data.map(a => ({
      title: a.title,
      description: a.description || '',
      link: a.url,
      source_id: a.source || 'MediaStack',
      pubDate: a.published_at
    })) : null
  }
};

const NEWS_REFRESH_INTERVAL = 10 * 60 * 1000; // 10 minutes
let apiFailures = {}; // Track recent failures

// ============================================================
// NEWS CACHING - Avoid redundant API calls
// ============================================================
const NEWS_CACHE = {};
const NEWS_CACHE_TTL = 5 * 60 * 1000; // 5 minute cache per country

function getCachedNews(countryName) {
  const cached = NEWS_CACHE[countryName];
  if (cached && (Date.now() - cached.timestamp) < NEWS_CACHE_TTL) {
    console.log(`Using cached news for ${countryName} (${Math.round((Date.now() - cached.timestamp) / 1000)}s old)`);
    return cached.data;
  }
  return null;
}

function setCachedNews(countryName, data) {
  NEWS_CACHE[countryName] = { data, timestamp: Date.now() };
}

// Category detection based on keywords
function detectCategory(title, description) {
  const text = (title + ' ' + (description || '')).toLowerCase();
  if (text.match(/war|military|attack|strike|bomb|troops|fighting|conflict|invasion/)) return 'CONFLICT';
  if (text.match(/economy|market|stock|trade|gdp|inflation|bank|fed|rate|fiscal/)) return 'ECONOMY';
  if (text.match(/security|terror|missile|nuclear|defense|army|navy|weapon/)) return 'SECURITY';
  if (text.match(/diplomat|treaty|summit|negotiat|sanction|ambassador|un |nato/)) return 'DIPLOMACY';
  if (text.match(/elect|president|prime minister|parliament|vote|politic|government|congress/)) return 'POLITICS';
  if (text.match(/crisis|humanitarian|famine|refugee|disaster|emergency/)) return 'CRISIS';
  if (text.match(/tech|ai|chip|cyber|digital|software|data/)) return 'TECH';
  if (text.match(/climate|environment|emission|carbon|green|energy/)) return 'CLIMATE';
  return 'WORLD';
}

// ============================================================
// DYNAMIC RISK SYSTEM - Article Impact Scoring
// ============================================================

const ESCALATION_KEYWORDS = {
  'escalat': 1.5, 'deadly': 1.4, 'massacre': 1.5, 'catastroph': 1.5,
  'kill': 1.3, 'destroy': 1.3, 'collapse': 1.3, 'crisis': 1.2,
  'emergency': 1.2, 'threaten': 1.1, 'attack': 1.3, 'bomb': 1.4,
  'war': 1.3, 'conflict': 1.2, 'nuclear': 1.5, 'weapon': 1.2,
  'invasion': 1.4, 'siege': 1.3, 'famine': 1.3, 'genocide': 1.5,
  'casualt': 1.3, 'death toll': 1.4, 'militant': 1.2, 'terror': 1.4,
  'coup': 1.4, 'martial law': 1.4, 'crackdown': 1.2, 'shell': 1.3,
  'airstrike': 1.4, 'drone strike': 1.3, 'offensive': 1.2, 'hostage': 1.3
};

const DEESCALATION_KEYWORDS = {
  'ceasefire': -4, 'peace': -3, 'agreement': -2, 'deal': -2,
  'resolution': -3, 'treaty': -4, 'accord': -3, 'settle': -2,
  'release': -1.5, 'freed': -1.5, 'pardon': -1.5, 'amnesty': -2,
  'relief': -1, 'aid deliver': -1, 'reconcil': -2.5, 'dialogue': -1.5,
  'negotiat': -1.5, 'truce': -3.5, 'withdraw': -2, 'de-escalat': -3,
  'deescalat': -3, 'stabiliz': -2, 'rebuild': -1.5, 'reconstruct': -1.5,
  'democra': -1, 'election held': -1.5, 'peaceful protest': -1,
  'humanitarian corridor': -2, 'prisoner exchange': -2, 'diplomatic': -1.5
};

const CATEGORY_WEIGHTS = {
  'CONFLICT': 12, 'CRISIS': 10, 'SECURITY': 8,
  'POLITICS': 3, 'ECONOMY': 2, 'CLIMATE': 2,
  'DIPLOMACY': -3, 'TECH': 1, 'WORLD': 1
};

function scoreArticleImpact(article) {
  const text = ((article.headline || article.title || '') + ' ' + (article.description || '')).toLowerCase();
  const category = article.category || detectCategory(text, '');

  let baseImpact = CATEGORY_WEIGHTS[category] || 1;

  // Find highest severity multiplier from escalation keywords
  let severityMultiplier = 1;
  for (const kw in ESCALATION_KEYWORDS) {
    if (text.includes(kw)) {
      severityMultiplier = Math.max(severityMultiplier, ESCALATION_KEYWORDS[kw]);
    }
  }

  // Sum de-escalation bonuses (can stack, but capped)
  let deescalationBonus = 0;
  for (const kw in DEESCALATION_KEYWORDS) {
    if (text.includes(kw)) {
      deescalationBonus += DEESCALATION_KEYWORDS[kw];
    }
  }
  deescalationBonus = Math.max(-8, deescalationBonus); // Cap stacking

  // If article is fundamentally positive (diplomacy + peace keywords), flip base impact
  if (deescalationBonus < -3 && baseImpact > 0) {
    baseImpact = -Math.abs(baseImpact) * 0.5;
  }

  const riskDelta = Math.max(-5, Math.min(15, (baseImpact * severityMultiplier) + deescalationBonus));

  return {
    riskDelta,
    category,
    isDeescalation: deescalationBonus < -1,
    severity: severityMultiplier,
    headline: article.headline || article.title || ''
  };
}

// ============================================================
// DYNAMIC RISK SYSTEM - State Management
// ============================================================

const COUNTRY_RISK_STATE = {};
const RISK_LEVELS_ORDERED = ['clear', 'cloudy', 'stormy', 'severe', 'extreme', 'catastrophic'];

function riskLevelToValue(level) {
  const map = { 'catastrophic': 95, 'extreme': 78, 'severe': 62, 'stormy': 45, 'cloudy': 28, 'clear': 10 };
  return map[level] || 45;
}

function valueToRiskLevel(value) {
  if (value >= 88) return 'catastrophic';
  if (value >= 70) return 'extreme';
  if (value >= 54) return 'severe';
  if (value >= 36) return 'stormy';
  if (value >= 18) return 'cloudy';
  return 'clear';
}

function initializeRiskState() {
  for (const countryName in COUNTRIES) {
    const c = COUNTRIES[countryName];
    COUNTRY_RISK_STATE[countryName] = {
      baseRisk: c.risk,
      currentRisk: c.risk,
      riskValue: riskLevelToValue(c.risk),
      accumulatedScore: 0,
      newsHistory: [],
      changeLog: [],
      lastLevelChange: 0,
      overrideActive: false,
      overrideReason: ''
    };
  }
  console.log(`[RISK] Initialized dynamic risk state for ${Object.keys(COUNTRIES).length} countries`);
}

// ============================================================
// DYNAMIC RISK SYSTEM - Accumulator & Transition Engine
// ============================================================

function updateCountryRiskAccumulator(countryName, articles) {
  const state = COUNTRY_RISK_STATE[countryName];
  if (!state || state.overrideActive) return;

  const now = Date.now();

  // Prune history to 48h window
  state.newsHistory = state.newsHistory.filter(item => now - item.timestamp < 48 * 3600 * 1000);

  // Score each new article and add to history
  for (const article of articles) {
    const impact = scoreArticleImpact(article);
    state.newsHistory.push({
      timestamp: now,
      impact: impact.riskDelta,
      headline: impact.headline,
      category: impact.category,
      isDeescalation: impact.isDeescalation
    });
  }

  // Calculate weighted average (exponential decay, 24h half-life)
  let totalScore = 0;
  let totalWeight = 0;
  for (const item of state.newsHistory) {
    const ageHours = (now - item.timestamp) / 3600000;
    const weight = Math.exp(-ageHours / 24);
    totalScore += item.impact * weight;
    totalWeight += weight;
  }
  const avgImpact = totalWeight > 0 ? totalScore / totalWeight : 0;

  // Update accumulator with momentum damping (85% decay per cycle)
  state.accumulatedScore = state.accumulatedScore * 0.85 + avgImpact * 0.15;
  state.accumulatedScore = Math.max(-50, Math.min(50, state.accumulatedScore));
}

function calculateDynamicRisk(countryName) {
  const state = COUNTRY_RISK_STATE[countryName];
  if (!state || state.overrideActive) return COUNTRIES[countryName].risk;

  const baseValue = riskLevelToValue(state.baseRisk);
  const dynamicValue = Math.max(0, Math.min(100, baseValue + state.accumulatedScore));

  // Enforce max 1 level jump per cycle
  const currentLevel = state.currentRisk;
  const proposedLevel = valueToRiskLevel(dynamicValue);
  const currentIdx = RISK_LEVELS_ORDERED.indexOf(currentLevel);
  const proposedIdx = RISK_LEVELS_ORDERED.indexOf(proposedLevel);
  const stepDiff = proposedIdx - currentIdx;

  let newLevel;
  if (Math.abs(stepDiff) <= 1) {
    newLevel = proposedLevel;
  } else {
    // Constrain to 1 step
    newLevel = RISK_LEVELS_ORDERED[currentIdx + (stepDiff > 0 ? 1 : -1)];
  }

  // Enforce 6-hour cooldown between level changes
  const now = Date.now();
  const sixHours = 6 * 3600 * 1000;

  if (newLevel !== state.currentRisk) {
    if (state.lastLevelChange && (now - state.lastLevelChange) < sixHours) {
      // Still in cooldown â€” don't change level
      return state.currentRisk;
    }

    // Allow the change
    const oldRisk = state.currentRisk;
    state.currentRisk = newLevel;
    state.lastLevelChange = now;
    state.riskValue = riskLevelToValue(newLevel);

    // Log the transition
    const triggerArticle = state.newsHistory.length > 0
      ? state.newsHistory[state.newsHistory.length - 1].headline
      : 'Accumulated news impact';

    state.changeLog.push({
      timestamp: now,
      type: 'LEVEL_CHANGE',
      from: oldRisk,
      to: newLevel,
      trigger: triggerArticle,
      score: state.accumulatedScore.toFixed(1)
    });

    // Keep log manageable
    if (state.changeLog.length > 50) state.changeLog = state.changeLog.slice(-50);

    console.log(`[RISK] ${countryName}: ${oldRisk} â†’ ${newLevel} (score: ${state.accumulatedScore.toFixed(1)})`);
  }

  return state.currentRisk;
}

// ============================================================
// DYNAMIC RISK SYSTEM - Master Update Function
// ============================================================

async function updateDynamicRisks(articles) {
  if (!articles || articles.length === 0) return [];

  // Group articles by country using existing relevance matching
  const articlesByCountry = {};
  for (const countryName in COUNTRIES) {
    const relevant = articles.filter(article =>
      isRelevantToCountry(article.headline || article.title || '', article.description || '', countryName)
    );
    if (relevant.length > 0) {
      articlesByCountry[countryName] = relevant;
    }
  }

  // Update each country's risk accumulator and calculate new level
  const changedCountries = [];
  for (const countryName in articlesByCountry) {
    const oldRisk = COUNTRIES[countryName].risk;

    updateCountryRiskAccumulator(countryName, articlesByCountry[countryName]);
    const newRisk = calculateDynamicRisk(countryName);

    // Apply the new risk to the COUNTRIES object
    COUNTRIES[countryName].risk = newRisk;

    if (oldRisk !== newRisk) {
      changedCountries.push({ name: countryName, from: oldRisk, to: newRisk });
    }
  }

  // Batch UI refresh
  if (changedCountries.length > 0) {
    refreshRiskUI(changedCountries);
    console.log(`[RISK] ${changedCountries.length} countries changed risk level`);
  }

  const articleCount = Object.values(articlesByCountry).reduce((sum, arr) => sum + arr.length, 0);
  console.log(`[RISK] Analyzed ${articleCount} articles across ${Object.keys(articlesByCountry).length} countries`);

  return changedCountries;
}

// ============================================================
// DYNAMIC RISK SYSTEM - UI Refresh
// ============================================================

function refreshRiskUI(changedCountries) {
  // 1. Update stats
  refreshStats();

  // 2. Refresh sidebar (watchlist + current tab)
  renderSidebar();

  // 3. Show toast notification for changes
  if (changedCountries.length > 0) {
    const first = changedCountries[0];
    const upCount = changedCountries.filter(c => RISK_LEVELS_ORDERED.indexOf(c.to) > RISK_LEVELS_ORDERED.indexOf(c.from)).length;
    const downCount = changedCountries.length - upCount;
    let msg = '';
    if (changedCountries.length === 1) {
      const dir = RISK_LEVELS_ORDERED.indexOf(first.to) > RISK_LEVELS_ORDERED.indexOf(first.from) ? '&#9650;' : '&#9660;';
      msg = `${dir} ${first.name}: ${first.from} &rarr; ${first.to}`;
    } else {
      const parts = [];
      if (upCount > 0) parts.push(`${upCount} escalated`);
      if (downCount > 0) parts.push(`${downCount} de-escalated`);
      msg = `${changedCountries.length} risk changes: ${parts.join(', ')}`;
    }
    showRiskToast(msg);
  }
}

function refreshStats() {
  let critical = 0, high = 0, stable = 0;
  Object.values(COUNTRIES).forEach(c => {
    if (c.risk === 'catastrophic' || c.risk === 'extreme') critical++;
    else if (c.risk === 'severe' || c.risk === 'stormy') high++;
    else stable++;
  });

  const statCritical = document.getElementById('statCritical');
  const statHigh = document.getElementById('statHigh');
  const statStable = document.getElementById('statStable');
  if (statCritical) statCritical.textContent = critical;
  if (statHigh) statHigh.textContent = high;
  if (statStable) statStable.textContent = stable;
}

function showRiskToast(message) {
  let toast = document.getElementById('riskToast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'riskToast';
    toast.className = 'risk-toast';
    document.body.appendChild(toast);
  }
  toast.innerHTML = message;
  toast.classList.add('active');
  setTimeout(() => toast.classList.remove('active'), 5000);
}

// ============================================================
// SANCTIONS DATA & RENDERING
// ============================================================
// Structure: each country key maps to { severity, on: [...], by: [...] }
// severity: 'heavy' | 'moderate' | 'limited' | 'none'
// on: sanctions imposed ON this country   â†’ { by, reason, year }
// by: sanctions imposed BY this country   â†’ { target, reason, year }
// Easy to update manually; designed for future API hookup (OFAC, EU, UN)

const SANCTIONS_DATA = {
  // === MAJOR WESTERN SANCTIONERS ===
  'United States': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Ukraine invasion; energy sector; 400+ entities; shadow fleet', year: 2022 },
      { target: 'Iran', reason: 'Maximum pressure; nuclear program; terrorism support', year: 1979 },
      { target: 'North Korea', reason: 'WMD proliferation; cyber attacks; human rights', year: 2008 },
      { target: 'Cuba', reason: 'Full economic embargo; Helms-Burton Act', year: 1962 },
      { target: 'Venezuela', reason: 'Oil sector; Maduro regime; cartel FTO designations', year: 2015 },
      { target: 'China', reason: 'Uyghur rights; tech/chip export controls; Entity List', year: 2019 },
      { target: 'Syria', reason: 'Most lifted post-Assad fall; Caesar Act repealed Dec 2025', year: 2004 },
      { target: 'Yemen (Houthis)', reason: 'Re-designated FTO Mar 2025; illicit oil networks', year: 2024 },
      { target: 'Sudan', reason: 'Chemical weapons use; RSF/SAF conflict parties', year: 2023 },
      { target: 'Myanmar', reason: 'Military coup; Rohingya genocide; cyber scam networks', year: 2021 }
    ]
  },
  // === HEAVILY SANCTIONED ===
  'Russia': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Invasion of Ukraine; energy sector (Gazprom Neft, Surgutneftegas); 400+ entities; 180+ shadow fleet vessels sanctioned Jan 2025', year: 2022 },
      { by: 'EU', reason: '20 sanctions packages; full energy ban (LNG Apr 2026, pipeline gas Jun 2026); 640 shadow fleet vessels; crypto platforms restricted', year: 2022 },
      { by: 'UK', reason: 'Asset freezes, trade restrictions, oligarch sanctions; aligned with EU rounds', year: 2022 },
      { by: 'UN', reason: 'Limited measures; Russia vetoes broader Security Council action', year: 2014 },
      { by: 'Canada', reason: 'Trade bans, asset freezes, secondary sanctions on shadow fleet', year: 2022 },
      { by: 'Japan', reason: 'Export controls on semiconductors and tech; asset freezes', year: 2022 },
      { by: 'Australia', reason: 'Financial sanctions, travel bans, trade restrictions', year: 2022 },
      { by: 'Switzerland', reason: 'Adopted EU sanctions packages; asset freezes', year: 2022 }
    ],
    by: [
      { target: 'EU/Western nations', reason: 'Counter-sanctions on agricultural imports', year: 2014 },
      { target: 'Various', reason: 'Retaliatory bans on Western officials and entities', year: 2022 }
    ]
  },
  'Iran': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Maximum pressure policy (Trump Feb 2025); nuclear program; terrorism support; full enforcement', year: 1979 },
      { by: 'EU', reason: 'Nuclear proliferation; missile program; human rights; snapback reimposed', year: 2012 },
      { by: 'UN', reason: 'Snapback sanctions reimposed Sep 2025 after UK/France/Germany triggered mechanism; JCPOA terminated Oct 2025', year: 2006 },
      { by: 'UK', reason: 'Nuclear program; triggered JCPOA snapback Aug 2025', year: 2012 },
      { by: 'Canada', reason: 'State sponsor of terrorism designation; nuclear concerns', year: 2012 },
      { by: 'Australia', reason: 'Nuclear and missile proliferation concerns', year: 2008 }
    ],
    by: [
      { target: 'Israel', reason: 'Full trade and diplomatic embargo', year: 1979 },
      { target: 'US officials', reason: 'Retaliatory sanctions on government and military officials', year: 2020 },
      { target: 'UK officials', reason: 'Retaliatory sanctions on British officials', year: 2022 }
    ]
  },
  'North Korea': {
    severity: 'heavy',
    on: [
      { by: 'UN', reason: 'Nuclear/missile programs (multiple UNSC resolutions); monitoring panel disbanded Apr 2024 after Russia veto; multilateral enforcement continues', year: 2006 },
      { by: 'US', reason: 'WMD proliferation; human rights abuses; cyber attacks; DISRUPT Bill introduced 2025', year: 2008 },
      { by: 'EU', reason: 'Nuclear and missile programs; arms embargo', year: 2006 },
      { by: 'Japan', reason: 'Nuclear tests; abduction issue; full trade embargo', year: 2006 },
      { by: 'South Korea', reason: 'Military provocations; nuclear tests', year: 2010 },
      { by: 'Australia', reason: 'WMD proliferation; maritime enforcement coalition active 2025', year: 2006 }
    ],
    by: []
  },
  'Syria': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Most sanctions lifted Jun 2025 post-Assad fall; Caesar Act repealed Dec 2025; targeted sanctions on Assad family remain', year: 2025 },
      { by: 'EU', reason: 'Majority lifted Jun 2025 to support peaceful transition; some individual designations remain', year: 2025 },
      { by: 'UN', reason: 'Sanctions on interim president al-Sharaa lifted Nov 2025', year: 2025 }
    ],
    by: []
  },
  'Cuba': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Full embargo; Trump reversed Biden easing Jan 2025; national emergency declared Jan 2026; sanctions on Diaz-Canel; tariff threats on countries supplying Cuba oil', year: 1962 },
      { by: 'EU', reason: 'Common Position on human rights (partially lifted)', year: 1996 }
    ],
    by: []
  },
  'Venezuela': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Oil sanctions hardened; Chevron license revoked Feb 2025; Tren de Aragua designated FTO; Cartel de los Soles designated FTO Nov 2025; tankers blocked Dec 2025', year: 2015 },
      { by: 'EU', reason: 'Human rights violations; undermining democracy; arms embargo', year: 2017 },
      { by: 'Canada', reason: 'Human rights abuses; erosion of democratic institutions', year: 2017 },
      { by: 'Switzerland', reason: 'Adopted targeted sanctions on officials', year: 2018 }
    ],
    by: []
  },
  'Myanmar': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Military coup; Rohingya genocide; warlord Saw Chit Thu sanctioned May 2025 for cyber scams/trafficking; controversial rollback of 5 arms-trade designations Jul 2025', year: 2021 },
      { by: 'EU', reason: 'Military junta; arms embargo; renewed through Apr 2026; new measures on scam operations', year: 2021 },
      { by: 'UK', reason: 'Military coup; asset freezes on junta leaders', year: 2021 },
      { by: 'Canada', reason: '13 officials and 3 entities sanctioned Mar 2025', year: 2018 }
    ],
    by: []
  },
  'Belarus': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Election fraud; aiding Russia; potash sector sanctions partially eased Dec 2025 in exchange for 123 political prisoner releases', year: 2006 },
      { by: 'EU', reason: '25 individuals + 7 entities added Mar 2025; agricultural tariffs Jun 2025; hybrid threat sanctions Dec 2025', year: 2020 },
      { by: 'UK', reason: 'Complicity in Ukraine invasion; human rights abuses', year: 2022 },
      { by: 'Canada', reason: 'Serious human rights violations; support for Russian invasion', year: 2020 }
    ],
    by: [
      { target: 'EU', reason: 'Counter-sanctions on European officials', year: 2021 }
    ]
  },
  'Sudan': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Chemical weapons use in civil war (May 2025); RSF recruitment networks sanctioned; Islamist actors sanctioned Sep 2025', year: 2023 },
      { by: 'UN', reason: 'Arms embargo extended; targeted sanctions on conflict parties', year: 2004 },
      { by: 'EU', reason: '7 individuals designated Jan 2026 for El Fasher massacre (RSF and SAF)', year: 2004 },
      { by: 'UK', reason: '4 senior RSF commanders sanctioned for El Fasher massacre', year: 2025 }
    ],
    by: []
  },
  'Yemen': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Houthis re-designated FTO Mar 2025; largest-ever action Jun 2025 (4 individuals, 12 entities, 2 vessels); 32 entities + 4 vessels Sep 2025; >$2B/yr illicit oil targeted', year: 2024 },
      { by: 'UN', reason: 'Arms embargo; targeted sanctions on Houthi leaders', year: 2014 },
      { by: 'EU', reason: 'Targeted measures supporting UN sanctions', year: 2014 }
    ],
    by: []
  },
  'Afghanistan': {
    severity: 'heavy',
    on: [
      { by: 'UN', reason: 'Taliban regime; terrorism; asset freezes on Taliban leaders', year: 1999 },
      { by: 'US', reason: 'Taliban takeover; ~$7B central bank frozen; national emergency extended; policy under review', year: 2021 },
      { by: 'EU', reason: 'Taliban regime; travel bans; asset freezes', year: 2001 },
      { by: 'Australia', reason: 'New financial sanctions and travel bans on 4 Taliban officials Dec 2025 for oppression of women/minorities', year: 2025 }
    ],
    by: []
  },
  'Gaza': {
    severity: 'heavy',
    on: [
      { by: 'Israel', reason: 'Land/sea/air blockade on Hamas-governed territory', year: 2007 },
      { by: 'US', reason: 'Sanctions on Hamas as designated terrorist organization', year: 1997 },
      { by: 'EU', reason: 'Hamas listed as terrorist organization; funding restrictions', year: 2003 }
    ],
    by: []
  },
  'Lebanon': {
    severity: 'heavy',
    on: [
      { by: 'US', reason: 'Hezbollah financial facilitators sanctioned May + Nov 2025; $1B+ IRGC-to-Hezbollah transfers targeted; preventing rearmament after 2024 conflict', year: 2015 },
      { by: 'EU', reason: 'Targeted sanctions on officials blocking reform', year: 2021 },
      { by: 'Saudi Arabia', reason: 'Diplomatic rift; import bans over Hezbollah influence', year: 2021 }
    ],
    by: []
  },
  // === MODERATE ===
  'China': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'Uyghur human rights; tech/chip export controls; 125 Chinese entities added to Entity List for Russia support; sanctions expansion paused Oct 2025 after Trump-Xi meeting', year: 2019 },
      { by: 'EU', reason: 'Xinjiang human rights abuses (targeted individuals)', year: 2021 },
      { by: 'UK', reason: 'Xinjiang human rights; Hong Kong crackdown', year: 2021 },
      { by: 'Canada', reason: 'Uyghur human rights abuses; targeted officials', year: 2021 }
    ],
    by: [
      { target: 'US entities', reason: '28 US aerospace/defense entities added to export control list Jan 2025', year: 2020 },
      { target: 'Global', reason: 'Strictest-ever rare earth and permanent magnet export controls effective Dec 2025; lithium battery controls', year: 2025 },
      { target: 'EU officials', reason: 'Retaliatory sanctions on European Parliament members', year: 2021 }
    ]
  },
  'Libya': {
    severity: 'moderate',
    on: [
      { by: 'UN', reason: 'Arms embargo; asset freezes on spoilers of peace process', year: 2011 },
      { by: 'US', reason: 'Targeted sanctions on militia leaders obstructing governance', year: 2018 },
      { by: 'EU', reason: 'Arms embargo enforcement; migrant smuggling networks', year: 2011 }
    ],
    by: []
  },
  'Somalia': {
    severity: 'moderate',
    on: [
      { by: 'UN', reason: 'Al-Shabaab sanctions and arms embargo extended through Nov 2026; maritime interdiction reauthorized; panel of experts through Dec 2026', year: 1992 },
      { by: 'US', reason: 'Al-Shabaab terrorism designations; targeted individual sanctions', year: 2010 }
    ],
    by: []
  },
  'DRC': {
    severity: 'moderate',
    on: [
      { by: 'UN', reason: 'Arms embargo on eastern DRC armed groups; conflict minerals', year: 2003 },
      { by: 'US', reason: 'Targeted sanctions on militia leaders; conflict minerals (Dodd-Frank)', year: 2006 },
      { by: 'EU', reason: 'Arms embargo; targeted measures on armed group leaders', year: 2003 }
    ],
    by: []
  },
  'Haiti': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'Sanctions on gang leaders and corrupt elites; new authorities in FY2026 NDAA', year: 2022 },
      { by: 'UN', reason: 'Targeted sanctions on gang leaders destabilizing the country', year: 2022 },
      { by: 'Canada', reason: 'Sanctions on elites and gang leaders', year: 2022 }
    ],
    by: []
  },
  'Ethiopia': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'AGOA suspension extended through Sep 2026 by Trump executive order; national emergency renewed', year: 2022 },
      { by: 'EU', reason: 'Suspended budget support over Tigray conflict', year: 2021 }
    ],
    by: []
  },
  'Eritrea': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'Role in Tigray conflict; human rights abuses', year: 2021 },
      { by: 'EU', reason: 'Involvement in Tigray conflict; targeted sanctions', year: 2021 }
    ],
    by: []
  },
  'Nicaragua': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'Authoritarian crackdown; election fraud; human rights abuses', year: 2018 },
      { by: 'EU', reason: 'Democratic backsliding; repression of opposition', year: 2020 },
      { by: 'Canada', reason: 'Human rights violations; sham elections', year: 2018 }
    ],
    by: []
  },
  'Zimbabwe': {
    severity: 'moderate',
    on: [
      { by: 'US', reason: 'Governance; human rights; undermining democracy', year: 2003 },
      { by: 'EU', reason: 'Arms embargo; targeted sanctions (partially eased)', year: 2002 }
    ],
    by: []
  },
  'Central African Republic': {
    severity: 'moderate',
    on: [
      { by: 'UN', reason: 'Arms embargo; targeted sanctions on armed group leaders', year: 2013 },
      { by: 'US', reason: 'Targeted: individuals undermining peace process', year: 2014 }
    ],
    by: []
  },
  'South Sudan': {
    severity: 'moderate',
    on: [
      { by: 'UN', reason: 'Arms embargo; targeted sanctions on conflict parties', year: 2018 },
      { by: 'US', reason: 'Civil war; obstruction of peace process', year: 2014 },
      { by: 'EU', reason: 'Targeted sanctions on individuals undermining peace', year: 2014 }
    ],
    by: []
  },
  // === LIMITED ===
  'Israel': {
    severity: 'limited',
    on: [
      { by: 'Arab League (historic)', reason: 'Economic boycott (largely defunct; some members normalized)', year: 1948 },
      { by: 'EU (partial)', reason: 'Settlement product labeling; some investment restrictions', year: 2015 },
      { by: 'US (targeted)', reason: 'Sanctions on extremist settlers in West Bank', year: 2024 },
      { by: 'Turkey', reason: 'Total export/import ban imposed 2024 over Gaza conflict', year: 2024 }
    ],
    by: [
      { target: 'Gaza', reason: 'Blockade on goods and movement (with Egypt)', year: 2007 },
      { target: 'Iran/Hezbollah', reason: 'Enforcement of international sanctions; trade restrictions', year: 2010 }
    ]
  },
  'Turkey': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'CAATSA sanctions over S-400 purchase; defense sector restrictions', year: 2020 },
      { by: 'EU (partial)', reason: 'Arms export restrictions over Syria operations', year: 2019 }
    ],
    by: [
      { target: 'Israel', reason: 'Total export/import ban over Gaza conflict', year: 2024 },
      { target: 'Syria (historic)', reason: 'Economic sanctions during civil war (now easing)', year: 2011 }
    ]
  },
  'Iraq': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Targeted sanctions on Iran-aligned militias and corrupt officials', year: 2019 },
      { by: 'UN', reason: 'Residual measures from Saddam era (mostly lifted)', year: 2003 }
    ],
    by: []
  },
  'Pakistan': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Targeted: nuclear proliferation-related entities; terrorism financing concerns', year: 2004 }
    ],
    by: [
      { target: 'India', reason: 'Trade suspension over Kashmir dispute', year: 2019 }
    ]
  },
  'Nigeria': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Targeted: Boko Haram/ISWAP terrorism designations; visa restrictions', year: 2013 },
      { by: 'UK', reason: 'Targeted sanctions on corruption-linked individuals', year: 2021 }
    ],
    by: []
  },
  'Mexico': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Kingpin Act designations on cartel leaders; OFAC fentanyl trafficking network sanctions expanded 2023-2025', year: 2000 }
    ],
    by: []
  },
  'Saudi Arabia': {
    severity: 'limited',
    on: [
      { by: 'US (targeted)', reason: 'Magnitsky sanctions on individuals re: Khashoggi murder', year: 2018 },
      { by: 'Canada', reason: 'Arms export review after Khashoggi killing', year: 2018 }
    ],
    by: [
      { target: 'UN-mandated targets', reason: 'Enforces UN terrorism/proliferation sanctions through GCC', year: 2017 }
    ]
  },
  'Mali': {
    severity: 'limited',
    on: [
      { by: 'EU', reason: 'Military coup; use of Wagner mercenaries', year: 2022 },
      { by: 'US', reason: 'Targeted sanctions on junta leaders', year: 2022 }
    ],
    by: []
  },
  'Burkina Faso': {
    severity: 'limited',
    on: [
      { by: 'EU', reason: 'Suspended cooperation after military takeover', year: 2022 }
    ],
    by: []
  },
  'Niger': {
    severity: 'limited',
    on: [
      { by: 'EU', reason: 'Suspended cooperation after military coup', year: 2023 }
    ],
    by: []
  },
  'Guinea': {
    severity: 'limited',
    on: [
      { by: 'US', reason: 'Targeted sanctions on junta officials', year: 2022 }
    ],
    by: []
  },
  // === NONE (but impose sanctions on others) ===
  'Ukraine': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Trade restrictions and sanctions on Russian entities', year: 2022 }
    ]
  },
  'India': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Pakistan', reason: 'Trade restrictions; MFN status revoked post-Pulwama', year: 2019 },
      { target: 'China', reason: 'Banned 200+ Chinese apps; restricted Chinese investment', year: 2020 }
    ]
  },
  'South Korea': {
    severity: 'none',
    on: [],
    by: [
      { target: 'North Korea', reason: 'Full sanctions enforcement aligned with UN/US', year: 2010 }
    ]
  },
  'Japan': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Asset freezes; export controls; energy restrictions', year: 2022 },
      { target: 'North Korea', reason: 'Full trade embargo; ship entry bans', year: 2006 }
    ]
  },
  'Philippines': {
    severity: 'none',
    on: [],
    by: []
  },
  // === MAJOR WESTERN SANCTIONERS (no sanctions ON them) ===
  'United Kingdom': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: '28 autonomous sanctions regimes; aligned with EU rounds; unified UK Sanctions List Jan 2026', year: 2022 },
      { target: 'Iran', reason: 'Nuclear program; triggered JCPOA snapback Aug 2025', year: 2012 },
      { target: 'Myanmar', reason: 'Military coup; asset freezes on junta leaders', year: 2021 },
      { target: 'Belarus', reason: 'Complicity in Ukraine invasion; human rights', year: 2022 },
      { target: 'North Korea', reason: 'WMD programs; cyber threats', year: 2006 }
    ]
  },
  'Canada': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: '77 individuals + 39 entities + 201 vessels sanctioned Jun 2025; secondary sanctions', year: 2022 },
      { target: 'Iran', reason: '4 officials sanctioned Dec 2025 for human rights; SEMA regime', year: 2012 },
      { target: 'Myanmar', reason: '13 officials and 3 entities sanctioned Mar 2025', year: 2018 },
      { target: 'Belarus', reason: 'Human rights violations; support for Russian invasion', year: 2020 },
      { target: 'Haiti', reason: 'Gang leaders and corrupt elites', year: 2022 }
    ]
  },
  'Australia': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Over 50% of Australia sanctions focus; financial/trade restrictions', year: 2022 },
      { target: 'Afghanistan', reason: 'World-first autonomous framework Dec 2025; 4 Taliban officials designated for oppression of women', year: 2025 },
      { target: 'North Korea', reason: 'WMD proliferation; maritime enforcement coalition', year: 2006 },
      { target: 'Iran', reason: 'Nuclear program; UN sanctions enforcement', year: 2008 },
      { target: 'Myanmar', reason: 'Military coup; targeted sanctions', year: 2021 }
    ]
  },
  'Switzerland': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Implements EU packages; 16th package Feb 2025; 18th package Oct 2025; 28 sanctions regimes', year: 2022 },
      { target: 'Iran', reason: 'Expanded Dec 2025 following JCPOA snapback', year: 2012 },
      { target: 'Syria', reason: 'Lifted Jun 2025 aligned with EU', year: 2011 },
      { target: 'Belarus', reason: 'Implements EU measures; Oct 2025 package', year: 2022 }
    ]
  },
  'France': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements all EU sanctions; limited autonomous authority under Monetary and Financial Code for counter-terrorism', year: 2022 },
      { target: 'Terrorism-related', reason: 'Registre National Des Gels (National Freeze Registry) for domestic terror finance freezes', year: 2015 }
    ]
  },
  'Germany': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions only; no autonomous sanctions program; coalition revising foreign trade laws May 2025', year: 2022 }
    ]
  },
  'Taiwan': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Export restrictions on 77 machine tool items; increased penalties for military-linked sales; joined international sanctions 2022', year: 2022 }
    ]
  },
  // === OTHER COUNTRIES ===
  'UAE': {
    severity: 'none',
    on: [],
    by: [
      { target: 'UN-mandated targets', reason: 'Enforces UN sanctions; major financial compliance hub; anti-money laundering frameworks', year: 2020 }
    ]
  },
  'Singapore': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Rare Asian nation to impose autonomous sanctions on Russia; export controls on electronics/tech', year: 2022 },
      { target: 'North Korea', reason: 'UN sanctions enforcement; financial compliance', year: 2006 }
    ]
  },
  'Norway': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Aligned with EU sanctions as EEA member; energy sector restrictions', year: 2022 },
      { target: 'Belarus', reason: 'Aligned with EU measures', year: 2022 }
    ]
  },
  'Brazil': {
    severity: 'limited',
    on: [
      { by: 'US (targeted)', reason: 'Sanctions on Justice Alexandre de Moraes and family Jul 2025 for judicial overreach; 50% tariff increase on select goods', year: 2025 }
    ],
    by: []
  },
  'South Africa': {
    severity: 'limited',
    on: [
      { by: 'US (proposed)', reason: 'H.R.2633 bill targeting government/ANC officials; 30% tariff (highest Sub-Saharan Africa); additional bills re: antisemitic conduct', year: 2025 }
    ],
    by: []
  },
  'Hungary': {
    severity: 'limited',
    on: [
      { by: 'EU', reason: 'Rule-of-law conditionality; frozen EU recovery funds over democratic backsliding and judicial independence concerns', year: 2022 }
    ],
    by: []
  },
  'Serbia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Egypt': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Terrorism-related', reason: 'Maintains List of Terrorist Entities; implements UN sanctions; FATF compliant', year: 2020 }
    ]
  },
  'Bangladesh': {
    severity: 'none',
    on: [],
    by: []
  },
  'Argentina': {
    severity: 'none',
    on: [],
    by: []
  },
  'Kenya': {
    severity: 'none',
    on: [],
    by: []
  },
  'Colombia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Peru': {
    severity: 'none',
    on: [],
    by: []
  },
  'Thailand': {
    severity: 'none',
    on: [],
    by: []
  },
  'El Salvador': {
    severity: 'none',
    on: [],
    by: []
  },
  'Sri Lanka': {
    severity: 'none',
    on: [],
    by: []
  },
  'Bolivia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Guyana': {
    severity: 'none',
    on: [],
    by: []
  },
  'Italy': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions; active enforcement through Banca d\'Italia', year: 2022 }
    ]
  },
  'Poland': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Russia', reason: 'Implements EU sanctions; additional national restrictions on Russian transport and trade', year: 2022 }
    ]
  },
  'Spain': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Netherlands': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU sanctions; key ASML chip export controls affecting China', year: 2022 }
    ]
  },
  'Indonesia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Vietnam': {
    severity: 'none',
    on: [],
    by: []
  },
  'Malaysia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Romania': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Greece': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Sweden': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Finland': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Austria': {
    severity: 'none',
    on: [],
    by: [
      { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
    ]
  },
  'Chile': {
    severity: 'none',
    on: [],
    by: []
  },
  'Algeria': {
    severity: 'none',
    on: [],
    by: []
  },
  'Tunisia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Ecuador': {
    severity: 'none',
    on: [],
    by: []
  },
  'Georgia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Armenia': {
    severity: 'none',
    on: [],
    by: []
  },
  'Moldova': {
    severity: 'none',
    on: [],
    by: []
  },
  // === ADDITIONAL SANCTIONERS & EU MEMBERS ===
  'Estonia': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Among most hawkish EU members; implements EU measures; vocal advocate for stronger enforcement', year: 2022 }
  ]},
  'Latvia': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Implements EU sanctions; closed border crossings; expelled Russian diplomats', year: 2022 }
  ]},
  'Lithuania': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Implements EU sanctions; Kaliningrad transit restrictions; strong enforcement', year: 2022 },
    { target: 'China (targeted by)', reason: 'Subject to Chinese economic coercion over Taiwan office; EU backed Lithuania', year: 2021 }
  ]},
  'Denmark': { severity: 'none', on: [], by: [
    { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions; active on Russia maritime enforcement in Baltic', year: 2022 }
  ]},
  'Belgium': { severity: 'none', on: [], by: [
    { target: 'Various (via EU)', reason: 'EU headquarters; key role in sanctions coordination; hosts SWIFT messaging system', year: 2022 }
  ]},
  'Ireland': { severity: 'none', on: [], by: [
    { target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }
  ]},
  'Czech Republic': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Implements EU sanctions; expelled Russian diplomats over Vrbetice explosion', year: 2021 }
  ]},
  'New Zealand': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Autonomous Russia Sanctions Act 2022; travel bans; asset freezes; trade restrictions', year: 2022 },
    { target: 'North Korea', reason: 'UN sanctions enforcement', year: 2006 }
  ]},
  'Qatar': { severity: 'none', on: [], by: [
    { target: 'Terrorism-related', reason: 'Counter-terrorism financing framework; was subject to Saudi-led blockade 2017-2021 (resolved)', year: 2017 }
  ]},
  'Jordan': { severity: 'none', on: [], by: [
    { target: 'UN-mandated targets', reason: 'Implements UN sanctions; key anti-smuggling enforcement on Syria/Iraq borders', year: 2014 }
  ]},
  'Kazakhstan': { severity: 'none', on: [], by: [
    { target: 'Russia (compliance)', reason: 'Strengthened sanctions compliance to avoid secondary sanctions; restricted parallel imports to Russia', year: 2023 }
  ]},
  'Croatia': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }] },
  'Slovenia': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }] },
  'Slovakia': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }] },
  'Bulgaria': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }] },
  'Portugal': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU and UN sanctions', year: 2022 }] },
  'Luxembourg': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU sanctions; major financial center for asset freezes', year: 2022 }] },
  'Cyprus': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU sanctions; past scrutiny over Russian oligarch assets', year: 2022 }] },
  'Malta': { severity: 'none', on: [], by: [{ target: 'Various (via EU)', reason: 'Implements EU sanctions; shipping registry enforcement', year: 2022 }] },
  'Iceland': { severity: 'none', on: [], by: [{ target: 'Russia', reason: 'Aligned with EU sanctions as EEA member', year: 2022 }] },
  // === REMAINING COUNTRIES (no significant sanctions involvement) ===
  'Kuwait': { severity: 'none', on: [], by: [] },
  'Bahrain': { severity: 'none', on: [], by: [] },
  'Oman': { severity: 'none', on: [], by: [] },
  'Morocco': { severity: 'none', on: [], by: [] },
  'Senegal': { severity: 'none', on: [], by: [] },
  'Tanzania': { severity: 'none', on: [], by: [] },
  'Ghana': { severity: 'none', on: [], by: [] },
  'Ivory Coast': { severity: 'none', on: [], by: [] },
  'Cameroon': { severity: 'none', on: [], by: [] },
  'Uganda': { severity: 'none', on: [], by: [] },
  'Rwanda': { severity: 'none', on: [], by: [] },
  'Costa Rica': { severity: 'none', on: [], by: [] },
  'Panama': { severity: 'none', on: [], by: [] },
  'Uruguay': { severity: 'none', on: [], by: [] },
  'Dominican Republic': { severity: 'none', on: [], by: [] },
  'Jamaica': { severity: 'none', on: [], by: [] },
  'Guatemala': { severity: 'none', on: [], by: [] },
  'Honduras': { severity: 'none', on: [], by: [] },
  'Paraguay': { severity: 'none', on: [], by: [] },
  'Albania': { severity: 'none', on: [], by: [] },
  'North Macedonia': { severity: 'none', on: [], by: [] },
  'Montenegro': { severity: 'none', on: [], by: [] },
  'Kosovo': { severity: 'none', on: [], by: [] },
  'Bosnia and Herzegovina': { severity: 'none', on: [], by: [] },
  'Cambodia': { severity: 'none', on: [], by: [] },
  'Laos': { severity: 'none', on: [], by: [] },
  'Nepal': { severity: 'none', on: [], by: [] },
  'Uzbekistan': { severity: 'none', on: [], by: [] },
  'Botswana': { severity: 'none', on: [], by: [] },
  'Zambia': { severity: 'none', on: [], by: [] },
  'Mozambique': { severity: 'none', on: [], by: [] },
  'Angola': { severity: 'none', on: [], by: [] },
  'Namibia': { severity: 'none', on: [], by: [] },
  'Madagascar': { severity: 'none', on: [], by: [] },
  'Suriname': { severity: 'none', on: [], by: [] },
  'Belize': { severity: 'none', on: [], by: [] },
  'Brunei': { severity: 'none', on: [], by: [] },
  'Chad': { severity: 'none', on: [], by: [] },
  'Djibouti': { severity: 'none', on: [], by: [] },
  'Gabon': { severity: 'none', on: [], by: [] },
  'Mauritania': { severity: 'none', on: [], by: [] },
  'Mongolia': { severity: 'none', on: [], by: [] },
  'Turkmenistan': { severity: 'none', on: [], by: [] },
  'Tajikistan': { severity: 'none', on: [], by: [] },
  'Kyrgyzstan': { severity: 'none', on: [], by: [] },
  'Trinidad and Tobago': { severity: 'none', on: [], by: [] },
  'Bahamas': { severity: 'none', on: [], by: [] },
  'Barbados': { severity: 'none', on: [], by: [] },
  'Republic of Congo': { severity: 'limited', on: [
    { by: 'EU', reason: 'Arms embargo (conflict prevention)', year: 2023 }
  ], by: [] },
  'Equatorial Guinea': { severity: 'limited', on: [
    { by: 'US', reason: 'Corruption and human rights abuses (Magnitsky)', year: 2024 }
  ], by: [] },
  'Burundi': { severity: 'moderate', on: [
    { by: 'US', reason: 'Political repression and human rights abuses', year: 2023 },
    { by: 'EU', reason: 'Political crisis and violence', year: 2022 }
  ], by: [] },
  'Gambia': { severity: 'none', on: [], by: [] },
  'Guinea-Bissau': { severity: 'limited', on: [
    { by: 'UN', reason: 'Political instability and drug trafficking (travel ban on individuals)', year: 2023 }
  ], by: [] },
  'Sierra Leone': { severity: 'none', on: [], by: [] },
  'Liberia': { severity: 'none', on: [], by: [] },
  'Togo': { severity: 'none', on: [], by: [] },
  'Benin': { severity: 'none', on: [], by: [] },
  'Cape Verde': { severity: 'none', on: [], by: [] },
  'Mauritius': { severity: 'none', on: [], by: [] },
  'Seychelles': { severity: 'none', on: [], by: [] },
  'Malawi': { severity: 'none', on: [], by: [] },
  'Bhutan': { severity: 'none', on: [], by: [] },
  'Maldives': { severity: 'none', on: [], by: [] },
  'Timor-Leste': { severity: 'none', on: [], by: [] },
  'Papua New Guinea': { severity: 'none', on: [], by: [] },
  'Fiji': { severity: 'none', on: [], by: [] },
  'Solomon Islands': { severity: 'none', on: [], by: [] },
  'Vanuatu': { severity: 'none', on: [], by: [] },
  'Samoa': { severity: 'none', on: [], by: [] },
  'Tonga': { severity: 'none', on: [], by: [] },
  'Kiribati': { severity: 'none', on: [], by: [] },
  'Marshall Islands': { severity: 'none', on: [], by: [] },
  'Micronesia': { severity: 'none', on: [], by: [] },
  'Palau': { severity: 'none', on: [], by: [] },
  'Nauru': { severity: 'none', on: [], by: [] },
  'Tuvalu': { severity: 'none', on: [], by: [] },
  'Andorra': { severity: 'none', on: [], by: [] },
  'Antigua and Barbuda': { severity: 'none', on: [], by: [] },
  'Comoros': { severity: 'none', on: [], by: [] },
  'Dominica': { severity: 'none', on: [], by: [] },
  'Eswatini': { severity: 'none', on: [], by: [] },
  'Grenada': { severity: 'none', on: [], by: [] },
  'Lesotho': { severity: 'none', on: [], by: [] },
  'Liechtenstein': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Aligned with EU/Swiss sanctions on Russia-Ukraine war', year: 2022 },
    { target: 'Belarus', reason: 'Aligned with EU/Swiss sanctions', year: 2022 }
  ] },
  'Monaco': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Aligned with EU sanctions on Russia-Ukraine war', year: 2022 }
  ] },
  'San Marino': { severity: 'none', on: [], by: [
    { target: 'Russia', reason: 'Aligned with EU sanctions on Russia-Ukraine war', year: 2022 }
  ] },
  'Sao Tome and Principe': { severity: 'none', on: [], by: [] },
  'Saint Kitts and Nevis': { severity: 'none', on: [], by: [] },
  'Saint Lucia': { severity: 'none', on: [], by: [] },
  'Saint Vincent and the Grenadines': { severity: 'none', on: [], by: [] }
};

// Retrieve sanctions for a country; returns standardized object even if no data exists
function getSanctionsForCountry(countryName) {
  return SANCTIONS_DATA[countryName] || { severity: 'none', on: [], by: [] };
}

// Build the collapsible sanctions HTML for a country modal
function buildSanctionsSection(countryName) {
  const data = getSanctionsForCountry(countryName);
  const hasOn = data.on && data.on.length > 0;
  const hasBy = data.by && data.by.length > 0;
  const hasSanctions = hasOn || hasBy;

  const sectionId = 'sanctions-' + countryName.replace(/\s+/g, '-');

  let html = `<div class="sanctions-section">`;
  html += `<div class="sanctions-toggle" onclick="toggleSanctions('${sectionId}')">
    <div class="sanctions-toggle-left">
      <span class="sanctions-toggle-title">Sanctions</span>
    </div>
    <span class="sanctions-chevron" id="${sectionId}-chevron">&#9660;</span>
  </div>`;

  html += `<div class="sanctions-body" id="${sectionId}"><div class="sanctions-inner">`;

  if (hasOn) {
    html += `<div class="sanctions-group-title">Sanctions on ${countryName}</div>`;
    for (const s of data.on) {
      html += `<div class="sanction-item">
        <div class="sanction-header"><span class="sanction-by">${s.by}</span><span class="sanction-year">${s.year}</span></div>
        <div class="sanction-reason">${s.reason}</div>
      </div>`;
    }
  }

  if (hasBy) {
    html += `<div class="sanctions-group-title">Sanctions by ${countryName}</div>`;
    for (const s of data.by) {
      html += `<div class="sanction-item">
        <div class="sanction-header"><span class="sanction-by">${s.target}</span><span class="sanction-year">${s.year}</span></div>
        <div class="sanction-reason">${s.reason}</div>
      </div>`;
    }
  }

  if (!hasSanctions) {
    html += `<div class="sanctions-none">No active sanctions data for this country.</div>`;
  }

  html += `</div></div></div>`;
  return html;
}

function toggleSanctions(sectionId) {
  const body = document.getElementById(sectionId);
  const chevron = document.getElementById(sectionId + '-chevron');
  if (body) {
    body.classList.toggle('open');
    if (chevron) chevron.classList.toggle('open');
  }
}

// Format source name nicely
function formatSourceName(sourceId) {
  if (!sourceId) return 'News';
  const id = sourceId.toLowerCase();

  // Comprehensive source mapping
  const sourceMap = {
    // Major International
    'bbc': 'BBC News', 'reuters': 'Reuters', 'aljazeera': 'Al Jazeera', 'theguardian': 'The Guardian',
    'apnews': 'AP News', 'afp': 'AFP', 'dw': 'Deutsche Welle', 'france24': 'France 24',
    // US News
    'cnn': 'CNN', 'nytimes': 'NY Times', 'washingtonpost': 'Washington Post', 'wsj': 'Wall Street Journal',
    'usatoday': 'USA Today', 'latimes': 'LA Times', 'chicagotribune': 'Chicago Tribune',
    'abc': 'ABC News', 'nbc': 'NBC News', 'cbs': 'CBS News', 'fox': 'Fox News', 'foxnews': 'Fox News',
    'nypost': 'New York Post', 'newyorkpost': 'New York Post', 'newsmax': 'Newsmax',
    'npr': 'NPR', 'pbs': 'PBS', 'politico': 'Politico', 'thehill': 'The Hill', 'axios': 'Axios',
    'huffpost': 'HuffPost', 'buzzfeed': 'BuzzFeed', 'vox': 'Vox', 'slate': 'Slate',
    'yardbarker': 'Yardbarker', 'espn': 'ESPN', 'cbssports': 'CBS Sports', 'si': 'Sports Illustrated',
    // Business/Finance
    'bloomberg': 'Bloomberg', 'ft': 'Financial Times', 'economist': 'The Economist',
    'cnbc': 'CNBC', 'marketwatch': 'MarketWatch', 'forbes': 'Forbes', 'fortune': 'Fortune',
    'businessinsider': 'Business Insider', 'insider': 'Insider', 'barrons': 'Barrons',
    'benzinga': 'Benzinga', 'investorplace': 'InvestorPlace', 'seekingalpha': 'Seeking Alpha',
    'thestreet': 'TheStreet', 'investopedia': 'Investopedia', 'kiplinger': 'Kiplinger',
    'biztoc': 'BizToc', 'bizjournals': 'Biz Journals', 'ibtimes': 'IB Times',
    // UK News
    'sky': 'Sky News', 'telegraph': 'The Telegraph', 'independent': 'The Independent',
    'mirror': 'The Mirror', 'express': 'Daily Express', 'metro': 'Metro UK', 'thesun': 'The Sun',
    'dailymail': 'Daily Mail', 'dailymailuk': 'Daily Mail UK', 'eveningstandard': 'Evening Standard',
    'londonlovesbusiness': 'London Loves Business', 'cityam': 'City A.M.',
    // Middle East
    'dailysabah': 'Daily Sabah', 'jpost': 'Jerusalem Post', 'timesofisrael': 'Times of Israel',
    'haaretz': 'Haaretz', 'middleeastmonitor': 'Middle East Monitor', 'middleeasteye': 'Middle East Eye',
    'arabnews': 'Arab News', 'gulfnews': 'Gulf News', 'zawya': 'Zawya', 'alarabiya': 'Al Arabiya',
    'trtworld': 'TRT World', 'aa': 'Anadolu Agency', 'tehrantimes': 'Tehran Times',
    'menafn': 'MENAFN', 'albawaba': 'Al Bawaba', 'middleeaststar': 'Middle East Star',
    // Asia - Pakistan
    'tribune_pk': 'Express Tribune', 'expresstribune': 'Express Tribune', 'dawn': 'Dawn',
    'geo': 'Geo News', 'arynews': 'ARY News', 'thenews': 'The News', 'pakistantoday': 'Pakistan Today',
    // Asia - India
    'thehindu': 'The Hindu', 'hindustantimes': 'Hindustan Times', 'ndtv': 'NDTV',
    'indiatoday': 'India Today', 'mathrubhumi': 'Mathrubhumi', 'timesofindia': 'Times of India',
    'toi': 'Times of India', 'indianexpress': 'Indian Express', 'deccanherald': 'Deccan Herald',
    'theprint': 'The Print', 'thewire': 'The Wire', 'scroll': 'Scroll', 'firstpost': 'Firstpost',
    'livemint': 'Live Mint', 'moneycontrol': 'Money Control', 'economictimes': 'Economic Times',
    // Asia - Others
    'scmp': 'South China Morning Post', 'straitstimes': 'Straits Times', 'channelnewsasia': 'CNA',
    'nikkei': 'Nikkei Asia', 'japantimes': 'Japan Times', 'koreaherald': 'Korea Herald',
    'koreatimes': 'Korea Times', 'asahi': 'Asahi Shimbun', 'bangkokpost': 'Bangkok Post',
    'xinhua': 'Xinhua', 'globaltimes': 'Global Times', 'chinadaily': 'China Daily',
    'philstar': 'PhilStar', 'inquirer': 'Inquirer', 'manilatimes': 'Manila Times',
    'thestar': 'The Star Malaysia', 'bernama': 'Bernama', 'vnexpress': 'VnExpress',
    // Russia/Eastern Europe
    'rt': 'RT', 'tass': 'TASS', 'ria': 'RIA Novosti', 'pravda': 'Pravda',
    'kyivindependent': 'Kyiv Independent', 'kyivpost': 'Kyiv Post', 'unian': 'UNIAN',
    // Europe
    'efe': 'EFE', 'ansa': 'ANSA', 'dpa': 'DPA', 'lemonde': 'Le Monde', 'spiegel': 'Der Spiegel',
    'elpais': 'El PaÃ­s', 'rte': 'RTÃ‰', 'irishtimes': 'Irish Times', 'dutchnews': 'Dutch News',
    'thelocal': 'The Local', 'euronews': 'Euronews', 'politicoeu': 'Politico EU',
    'rmoutlook': 'RM Outlook', 'rmf24': 'RMF24', 'onet': 'Onet',
    // Africa
    'legit': 'Legit News', 'punch': 'Punch Nigeria', 'vanguard': 'Vanguard Nigeria',
    'dailynigerian': 'Daily Nigerian', 'premiumtimes': 'Premium Times', 'nation': 'The Nation',
    'iol': 'IOL', 'news24': 'News24', 'timeslive': 'Times Live', 'mg': 'Mail & Guardian',
    'theeastafrican': 'East African', 'standardmedia': 'Standard Media', 'nation_ke': 'Daily Nation',
    // Latin America
    'globo': 'O Globo', 'folha': 'Folha', 'clarin': 'ClarÃ­n', 'lanacion': 'La NaciÃ³n',
    'eluniversal': 'El Universal', 'milenio': 'Milenio', 'reforma': 'Reforma',
    // Australia/Oceania
    'abc_au': 'ABC Australia', 'smh': 'Sydney Morning Herald', 'theaustralian': 'The Australian',
    'nzherald': 'NZ Herald', 'stuff': 'Stuff NZ', 'rnz': 'RNZ', '9news': 'Nine News',
    // Tech News
    'techcrunch': 'TechCrunch', 'theverge': 'The Verge', 'wired': 'Wired', 'arstechnica': 'Ars Technica',
    'engadget': 'Engadget', 'cnet': 'CNET', 'zdnet': 'ZDNet', 'tomshardware': 'Toms Hardware',
    'gizmodo': 'Gizmodo', 'mashable': 'Mashable', 'venturebeat': 'VentureBeat',
    // Wire Services & Others
    'upi': 'UPI', 'pti': 'PTI', 'ani': 'ANI', 'ians': 'IANS',
    'report_az': 'Report Azerbaijan', 'spsrasd_info': 'Sahara Press', 'wionews': 'WION',
    // Aggregators & Others
    'newsweek': 'Newsweek', 'time': 'TIME', 'theatlantic': 'The Atlantic', 'newyorker': 'The New Yorker',
    'foreignpolicy': 'Foreign Policy', 'foreignaffairs': 'Foreign Affairs', 'theconversation': 'The Conversation',
    'defenseone': 'Defense One', 'defensenews': 'Defense News', 'breakingdefense': 'Breaking Defense',
    'oilprice': 'OilPrice', 'hellenicshippingnews': 'Hellenic Shipping', 'lloydslist': 'Lloyds List',
    'semafor': 'Semafor', 'puck': 'Puck', 'theintercept': 'The Intercept', 'motherjones': 'Mother Jones',
    'nationalreview': 'National Review', 'dailywire': 'Daily Wire', 'breitbart': 'Breitbart',
    'rawstory': 'Raw Story', 'mediaite': 'Mediaite', 'thedailybeast': 'Daily Beast'
  };

  if (sourceMap[id]) return sourceMap[id];

  // Smart formatting for unknown sources
  return sourceId
    .replace(/_/g, ' ')
    .replace(/([a-z])([A-Z])/g, '$1 $2')
    .split(' ')
    .map(word => {
      if (word.length <= 3 && word === word.toUpperCase()) return word;
      return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
    })
    .join(' ')
    .trim();
}

// Calculate time ago with cleaner display
function timeAgo(dateString) {
  if (!dateString) return 'Today';
  const date = new Date(dateString);
  if (isNaN(date.getTime())) return 'Today';

  const now = new Date();
  const diffMs = now - date;

  // Handle future dates or very recent
  if (diffMs < 60000) return 'Just now';

  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 60) return diffMins + 'm ago';
  if (diffHours < 6) return diffHours + 'h ago';
  if (diffHours < 24) return 'Today';
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return diffDays + ' days ago';
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Fetch RSS feed and convert to JSON
async function fetchRSS(feedUrl, sourceName) {
  try {
    const proxyUrl = RSS2JSON_API + encodeURIComponent(feedUrl);
    const response = await fetch(proxyUrl);
    if (!response.ok) return [];

    const data = await response.json();
    if (data.status !== 'ok' || !data.items) return [];

    return data.items.map(item => {
      let source = sourceName || data.feed?.title || 'News';
      let title = item.title;

      // Google News embeds real source in title: "Headline - Al Jazeera"
      if (source === 'Google News' && title) {
        const dashIdx = title.lastIndexOf(' - ');
        if (dashIdx > 0) {
          source = title.substring(dashIdx + 3).trim();
          title = title.substring(0, dashIdx).trim();
        }
      }

      return {
        title: title,
        description: item.description || item.content || '',
        link: item.link,
        source_id: source,
        pubDate: item.pubDate
      };
    });
  } catch (error) {
    console.warn(`RSS fetch failed for ${sourceName}:`, error.message);
    return [];
  }
}

// Fetch live news from RSS feeds (FREE and UNLIMITED!)
async function fetchLiveNews() {
  console.log('Fetching live news from RSS feeds...');

  // Update UI to show loading
  const timestampEl = document.getElementById('newsTimestamp');
  if (timestampEl) {
    timestampEl.innerHTML = `<span style="color:#eab308;">â—</span> Fetching latest news...`;
  }

  try {
    // Fetch from multiple RSS feeds in parallel
    const feedPromises = RSS_FEEDS.daily.map(feed => fetchRSS(feed.url, feed.source));
    const feedResults = await Promise.all(feedPromises);

    // Combine all results
    let allArticles = feedResults.flat();
    console.log(`RSS feeds returned ${allArticles.length} total articles`);

    if (allArticles.length > 0) {
      // Sort by date (newest first)
      allArticles.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

      // Filter out irrelevant articles
      const relevantArticles = allArticles.filter(article => {
        const text = ((article.title || '') + ' ' + (article.description || '')).toLowerCase();
        return !IRRELEVANT_KEYWORDS.some(kw => text.includes(kw));
      });

      // Remove duplicates by title similarity
      const seen = new Set();
      const uniqueArticles = relevantArticles.filter(article => {
        const key = article.title.toLowerCase().slice(0, 50);
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });

      DAILY_BRIEFING = uniqueArticles.slice(0, 50).map(article => {
        const category = detectCategory(article.title, article.description);
        const importance = ['CONFLICT', 'CRISIS', 'SECURITY'].includes(category) ? 'high' : 'medium';
        const sourceName = formatSourceName(article.source_id);

        return {
          time: timeAgo(article.pubDate),
          category: category,
          importance: importance,
          headline: article.title,
          source: sourceName,
          url: article.link || '#'
        };
      });

      // Ensure political diversity - inject RC/R fallback articles if live feeds lack them
      const rcCount = DAILY_BRIEFING.filter(a => { const b = getSourceBias(a.source); return b === 'RC' || b === 'R'; }).length;
      if (rcCount < 3) {
        const rightFallbacks = DAILY_BRIEFING_FALLBACK.filter(a => {
          const b = getSourceBias(a.source);
          return b === 'RC' || b === 'R';
        });
        const needed = Math.min(4 - rcCount, rightFallbacks.length);
        if (needed > 0) {
          const interval = Math.max(1, Math.floor(DAILY_BRIEFING.length / (needed + 1)));
          for (let i = 0; i < needed; i++) {
            const pos = Math.min((i + 1) * interval + i, DAILY_BRIEFING.length);
            DAILY_BRIEFING.splice(pos, 0, rightFallbacks[i]);
          }
          console.log(`Injected ${needed} right-leaning articles for bias balance`);
        }
      }

      // Disperse any same-direction bias clusters (max 2 consecutive)
      DAILY_BRIEFING = disperseBiasArticles(DAILY_BRIEFING);

      lastNewsUpdate = new Date();
      console.log('Live news updated:', DAILY_BRIEFING.length, 'articles from RSS feeds');

      // Save briefing snapshot for history
      saveBriefingSnapshot();

      if (currentTab === 'daily') {
        renderSidebar();
      }
      updateNewsTimestamp();
      checkBreakingNews(DAILY_BRIEFING);

      // Dynamic risk: analyze fetched articles
      if (typeof updateDynamicRisks === 'function') {
        updateDynamicRisks(DAILY_BRIEFING);
      }
      return;
    }
  } catch (error) {
    console.warn('RSS feeds failed:', error.message);
  }

  // Fallback: try each backup API in sequence
  const dailyApiOrder = ['gnews', 'newsdata', 'mediastack'];
  for (const apiName of dailyApiOrder) {
    try {
      const api = NEWS_APIS[apiName];
      if (!api || !api.key || !api.buildDailyUrl) continue;
      console.log(`Trying ${apiName} for daily briefing...`);
      const response = await fetch(api.buildDailyUrl(api.key));
      if (response.ok) {
        const data = await response.json();
        const results = api.parseResults(data);
        if (results && results.length > 0) {
          console.log(`Fallback to ${apiName}:`, results.length, 'articles');
          DAILY_BRIEFING = results.filter(article => {
            const text = ((article.title || '') + ' ' + (article.description || '')).toLowerCase();
            return !IRRELEVANT_KEYWORDS.some(kw => text.includes(kw));
          }).map(article => ({
            time: timeAgo(article.pubDate),
            category: detectCategory(article.title, article.description),
            importance: 'medium',
            headline: article.title,
            source: formatSourceName(article.source_id),
            url: article.link || '#'
          }));
          lastNewsUpdate = new Date();
          saveBriefingSnapshot();
          if (currentTab === 'daily') renderSidebar();
          updateNewsTimestamp();
          if (typeof updateDynamicRisks === 'function') {
            updateDynamicRisks(DAILY_BRIEFING);
          }
          return;
        }
      }
    } catch (e) {
      console.warn(`${apiName} fallback failed:`, e.message);
    }
  }

  // All sources failed - keep existing briefing or use fallback
  console.error('All news sources failed');
  if (DAILY_BRIEFING.length === 0) {
    DAILY_BRIEFING = [...DAILY_BRIEFING_FALLBACK];
  }
  if (timestampEl) {
    timestampEl.innerHTML = `<span style="color:#f97316;">â—</span> News temporarily unavailable Â· Using cached data`;
  }
}

// Update timestamp display
function updateNewsTimestamp() {
  const timestampEl = document.getElementById('newsTimestamp');
  if (timestampEl && lastNewsUpdate) {
    timestampEl.innerHTML = `<span style="color:#22c55e;">â—</span> Live Â· Updated ${lastNewsUpdate.toLocaleTimeString()} Â· <span style="color:#6b7280;">${DAILY_BRIEFING.length} articles</span>`;
  }
}

// Initialize dynamic risk state system
initializeRiskState();

// Seed briefing history if empty â€” save fallback data as yesterday's briefing
// so users see a past briefing immediately on first visit
(function seedBriefingHistory() {
  try {
    const history = loadBriefingHistory();
    const todayKey = getBriefingDateKey();
    const pastKeys = Object.keys(history).filter(d => d !== todayKey);
    if (pastKeys.length === 0) {
      // No past briefings exist yet â€” seed yesterday
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayKey = yesterday.toISOString().split('T')[0];
      history[yesterdayKey] = {
        date: yesterdayKey,
        articles: DAILY_BRIEFING_FALLBACK.map(a => ({
          time: a.time,
          category: a.category,
          importance: a.importance,
          headline: a.headline,
          source: a.source,
          url: a.url
        })),
        savedAt: new Date().toISOString(),
        articleCount: DAILY_BRIEFING_FALLBACK.length
      };
      localStorage.setItem(BRIEFING_HISTORY_KEY, JSON.stringify(history));
      console.log('Seeded briefing history with yesterday\'s briefing');
    }
  } catch (e) {
    console.warn('Could not seed briefing history:', e.message);
  }
})();

// Initialize live news and set up auto-refresh
fetchLiveNews();
setInterval(fetchLiveNews, NEWS_REFRESH_INTERVAL);

// Breaking news detection keywords
const BREAKING_KEYWORDS = ['breaking', 'just in', 'urgent', 'developing', 'explosion', 'earthquake', 'tsunami', 'coup', 'assassination', 'war declared', 'nuclear'];

// Check for breaking news - only shows for recent articles (within last 6 hours)
function checkBreakingNews(articles) {
  // Hide any existing banner first
  closeBanner();

  for (const article of articles) {
    const text = (article.headline || article.title || '').toLowerCase();
    const timeText = (article.time || '').toLowerCase();

    // Only trigger for recent news (contains "m ago" for minutes, or "h ago" with small number)
    const isRecent = timeText.includes('m ago') ||
                     (timeText.includes('h ago') && parseInt(timeText) <= 6);

    if (isRecent && BREAKING_KEYWORDS.some(kw => text.includes(kw))) {
      showBreakingBanner(article.headline || article.title);
      return;
    }
  }
}

// Show breaking news banner
function showBreakingBanner(text) {
  const banner = document.getElementById('breakingBanner');
  const textEl = document.getElementById('breakingText');
  if (banner && textEl) {
    textEl.textContent = text;
    banner.classList.add('active');
    document.body.classList.add('banner-active');
  }
}

// Close breaking news banner
function closeBanner() {
  const banner = document.getElementById('breakingBanner');
  if (banner) {
    banner.classList.remove('active');
    document.body.classList.remove('banner-active');
  }
}

// Words that indicate an article is NOT about geopolitics
const IRRELEVANT_KEYWORDS = [
  'sports', 'football', 'soccer', 'basketball', 'baseball', 'hockey', 'tennis', 'golf', 'nfl', 'nba', 'mlb',
  'celebrity', 'entertainment', 'movie', 'film', 'music', 'concert', 'album', 'netflix', 'streaming',
  'recipe', 'cooking', 'fashion', 'beauty', 'lifestyle', 'horoscope', 'zodiac',
  'dating', 'relationship', 'wedding', 'divorce', 'kardashian', 'influencer',
  'weight loss', 'diet', 'fitness', 'workout', 'yoga',
  'lottery', 'powerball', 'mega millions', 'jackpot',
  'figure skating', 'ice skating', 'world cup goal', 'super bowl',
  'tv show', 'reality tv', 'american idol', 'bachelor', 'bachelorette',
  'stock picks', 'buy now', 'shares up', 'otcmkts', 'penny stock'
];

// Check if article is relevant to the country and geopolitics
function isRelevantToCountry(title, description, countryName) {
  const text = ((title || '') + ' ' + (description || '')).toLowerCase();
  const titleLower = (title || '').toLowerCase();
  const descLower = (description || '').toLowerCase();
  const countryLower = countryName.toLowerCase();

  // Check for irrelevant keywords - reject these
  for (const kw of IRRELEVANT_KEYWORDS) {
    if (text.includes(kw)) return false;
  }

  // Comprehensive demonyms for ALL 195 countries
  const demonyms = {
    'Afghanistan': ['afghan', 'kabul', 'taliban'],
    'Albania': ['albanian', 'tirana'],
    'Algeria': ['algerian', 'algiers'],
    'Andorra': ['andorran'],
    'Angola': ['angolan', 'luanda'],
    'Antigua and Barbuda': ['antiguan', 'barbudan'],
    'Argentina': ['argentine', 'argentinian', 'buenos aires'],
    'Armenia': ['armenian', 'yerevan'],
    'Australia': ['australian', 'canberra', 'sydney', 'melbourne'],
    'Austria': ['austrian', 'vienna'],
    'Azerbaijan': ['azerbaijani', 'baku'],
    'Bahamas': ['bahamian', 'nassau'],
    'Bahrain': ['bahraini', 'manama'],
    'Bangladesh': ['bangladeshi', 'dhaka'],
    'Barbados': ['barbadian', 'bridgetown'],
    'Belarus': ['belarusian', 'minsk', 'lukashenko'],
    'Belgium': ['belgian', 'brussels'],
    'Benin': ['beninese', 'porto-novo', 'cotonou'],
    'Bhutan': ['bhutanese', 'thimphu'],
    'Bolivia': ['bolivian', 'la paz'],
    'Bosnia and Herzegovina': ['bosnian', 'sarajevo'],
    'Botswana': ['motswana', 'botswanan', 'gaborone'],
    'Brazil': ['brazilian', 'brasilia', 'rio', 'sao paulo', 'lula'],
    'Brunei': ['bruneian', 'bandar seri begawan'],
    'Bulgaria': ['bulgarian', 'sofia'],
    'Burkina Faso': ['burkinabe', 'ouagadougou'],
    'Burundi': ['burundian', 'bujumbura', 'gitega'],
    'Cambodia': ['cambodian', 'phnom penh'],
    'Cameroon': ['cameroonian', 'yaounde'],
    'Canada': ['canadian', 'ottawa', 'toronto', 'trudeau'],
    'Cape Verde': ['cape verdean', 'praia'],
    'Central African Republic': ['central african', 'bangui'],
    'Chad': ['chadian', "n'djamena"],
    'Chile': ['chilean', 'santiago'],
    'China': ['chinese', 'beijing', 'xi jinping', 'ccp', 'prc'],
    'Colombia': ['colombian', 'bogota'],
    'Comoros': ['comorian', 'moroni'],
    'Democratic Republic of Congo': ['congolese', 'kinshasa', 'drc'],
    'Republic of Congo': ['congo-brazzaville', 'brazzaville'],
    'Costa Rica': ['costa rican', 'san jose'],
    'Croatia': ['croatian', 'zagreb'],
    'Cuba': ['cuban', 'havana'],
    'Cyprus': ['cypriot', 'nicosia'],
    'Czech Republic': ['czech', 'prague'],
    'Denmark': ['danish', 'copenhagen'],
    'Greenland': ['greenlandic', 'nuuk', 'inuit'],
    'Djibouti': ['djiboutian'],
    'Dominica': ['dominican'],
    'Dominican Republic': ['dominican republic', 'santo domingo'],
    'Ecuador': ['ecuadorian', 'quito'],
    'Egypt': ['egyptian', 'cairo', 'sisi'],
    'El Salvador': ['salvadoran', 'san salvador', 'bukele'],
    'Equatorial Guinea': ['equatoguinean', 'malabo'],
    'Eritrea': ['eritrean', 'asmara'],
    'Estonia': ['estonian', 'tallinn'],
    'Eswatini': ['swazi', 'mbabane'],
    'Ethiopia': ['ethiopian', 'addis ababa'],
    'Fiji': ['fijian', 'suva'],
    'Finland': ['finnish', 'helsinki'],
    'France': ['french', 'paris', 'macron', 'Ã©lysÃ©e'],
    'Gabon': ['gabonese', 'libreville'],
    'Gambia': ['gambian', 'banjul'],
    'Georgia': ['georgian', 'tbilisi'],
    'Germany': ['german', 'berlin', 'scholz', 'bundestag'],
    'Ghana': ['ghanaian', 'accra'],
    'Greece': ['greek', 'athens'],
    'Grenada': ['grenadian'],
    'Guatemala': ['guatemalan'],
    'Guinea': ['guinean', 'conakry'],
    'Guinea-Bissau': ['bissau-guinean', 'bissau'],
    'Guyana': ['guyanese', 'georgetown'],
    'Haiti': ['haitian', 'port-au-prince'],
    'Honduras': ['honduran', 'tegucigalpa'],
    'Hungary': ['hungarian', 'budapest', 'orban'],
    'Iceland': ['icelandic', 'reykjavik'],
    'India': ['indian', 'delhi', 'mumbai', 'modi', 'bjp'],
    'Indonesia': ['indonesian', 'jakarta', 'jokowi'],
    'Iran': ['iranian', 'tehran', 'ayatollah', 'khamenei'],
    'Iraq': ['iraqi', 'baghdad', 'kurdish'],
    'Ireland': ['irish', 'dublin'],
    'Israel': ['israeli', 'tel aviv', 'jerusalem', 'netanyahu', 'gaza', 'idf'],
    'Italy': ['italian', 'rome', 'meloni'],
    'Ivory Coast': ['ivorian', 'abidjan', 'yamoussoukro'],
    'Jamaica': ['jamaican', 'kingston'],
    'Japan': ['japanese', 'tokyo', 'kishida'],
    'Jordan': ['jordanian', 'amman'],
    'Kazakhstan': ['kazakh', 'astana', 'almaty'],
    'Kenya': ['kenyan', 'nairobi'],
    'Kiribati': ['i-kiribati', 'tarawa'],
    'Kosovo': ['kosovar', 'pristina'],
    'Kuwait': ['kuwaiti', 'kuwait city'],
    'Kyrgyzstan': ['kyrgyz', 'bishkek'],
    'Laos': ['laotian', 'vientiane'],
    'Latvia': ['latvian', 'riga'],
    'Lebanon': ['lebanese', 'beirut', 'hezbollah'],
    'Lesotho': ['basotho', 'maseru'],
    'Liberia': ['liberian', 'monrovia'],
    'Libya': ['libyan', 'tripoli'],
    'Liechtenstein': ['liechtensteiner', 'vaduz'],
    'Lithuania': ['lithuanian', 'vilnius'],
    'Luxembourg': ['luxembourgish', 'luxembourger'],
    'Madagascar': ['malagasy', 'antananarivo'],
    'Malawi': ['malawian', 'lilongwe'],
    'Malaysia': ['malaysian', 'kuala lumpur'],
    'Maldives': ['maldivian', 'male'],
    'Mali': ['malian', 'bamako'],
    'Malta': ['maltese', 'valletta'],
    'Marshall Islands': ['marshallese', 'majuro'],
    'Mauritania': ['mauritanian', 'nouakchott'],
    'Mauritius': ['mauritian', 'port louis'],
    'Mexico': ['mexican', 'mexico city'],
    'Micronesia': ['micronesian', 'palikir'],
    'Moldova': ['moldovan', 'chisinau'],
    'Monaco': ['monegasque', 'monte carlo'],
    'Mongolia': ['mongolian', 'ulaanbaatar'],
    'Montenegro': ['montenegrin', 'podgorica'],
    'Morocco': ['moroccan', 'rabat', 'casablanca'],
    'Mozambique': ['mozambican', 'maputo'],
    'Myanmar': ['burmese', 'myanmar', 'yangon', 'junta'],
    'Namibia': ['namibian', 'windhoek'],
    'Nauru': ['nauruan'],
    'Nepal': ['nepali', 'nepalese', 'kathmandu'],
    'Netherlands': ['dutch', 'amsterdam', 'the hague'],
    'New Zealand': ['new zealand', 'kiwi', 'wellington'],
    'Nicaragua': ['nicaraguan', 'managua', 'ortega'],
    'Niger': ['nigerien', 'niamey'],
    'Nigeria': ['nigerian', 'lagos', 'abuja'],
    'North Korea': ['north korean', 'pyongyang', 'kim jong', 'dprk'],
    'North Macedonia': ['macedonian', 'skopje'],
    'Norway': ['norwegian', 'oslo'],
    'Oman': ['omani', 'muscat'],
    'Pakistan': ['pakistani', 'islamabad', 'karachi'],
    'Palau': ['palauan', 'ngerulmud'],
    'Palestine': ['palestinian', 'hamas', 'west bank', 'ramallah'],
    'Panama': ['panamanian', 'panama city'],
    'Papua New Guinea': ['papua new guinean', 'port moresby'],
    'Paraguay': ['paraguayan', 'asuncion'],
    'Peru': ['peruvian', 'lima'],
    'Philippines': ['filipino', 'philippine', 'manila', 'marcos'],
    'Poland': ['polish', 'warsaw'],
    'Portugal': ['portuguese', 'lisbon'],
    'Qatar': ['qatari', 'doha'],
    'Romania': ['romanian', 'bucharest'],
    'Russia': ['russian', 'moscow', 'kremlin', 'putin'],
    'Rwanda': ['rwandan', 'kigali'],
    'Saint Kitts and Nevis': ['kittitian', 'nevisian', 'basseterre'],
    'Saint Lucia': ['saint lucian', 'castries'],
    'Saint Vincent and the Grenadines': ['vincentian'],
    'Samoa': ['samoan', 'apia'],
    'San Marino': ['sammarinese'],
    'Sao Tome and Principe': ['santomean'],
    'Saudi Arabia': ['saudi', 'riyadh', 'mbs'],
    'Senegal': ['senegalese', 'dakar'],
    'Serbia': ['serbian', 'belgrade'],
    'Seychelles': ['seychellois', 'victoria'],
    'Sierra Leone': ['sierra leonean', 'freetown'],
    'Singapore': ['singaporean'],
    'Slovakia': ['slovak', 'bratislava'],
    'Slovenia': ['slovenian', 'ljubljana'],
    'Solomon Islands': ['solomon islander', 'honiara'],
    'Somalia': ['somali', 'mogadishu'],
    'South Africa': ['south african', 'johannesburg', 'pretoria', 'cape town'],
    'South Korea': ['south korean', 'seoul', 'korean'],
    'South Sudan': ['south sudanese', 'juba'],
    'Spain': ['spanish', 'madrid', 'barcelona'],
    'Sri Lanka': ['sri lankan', 'colombo'],
    'Sudan': ['sudanese', 'khartoum'],
    'Suriname': ['surinamese', 'paramaribo'],
    'Sweden': ['swedish', 'stockholm'],
    'Switzerland': ['swiss', 'bern', 'zurich', 'geneva'],
    'Syria': ['syrian', 'damascus', 'assad'],
    'Taiwan': ['taiwanese', 'taipei'],
    'Tajikistan': ['tajik', 'dushanbe'],
    'Tanzania': ['tanzanian', 'dodoma', 'dar es salaam'],
    'Thailand': ['thai', 'bangkok'],
    'Timor-Leste': ['timorese', 'east timor', 'dili'],
    'Togo': ['togolese', 'lome'],
    'Tonga': ['tongan', "nuku'alofa"],
    'Trinidad and Tobago': ['trinidadian', 'tobagonian', 'port of spain'],
    'Tunisia': ['tunisian', 'tunis'],
    'Turkey': ['turkish', 'ankara', 'istanbul', 'erdogan'],
    'Turkmenistan': ['turkmen', 'ashgabat'],
    'Tuvalu': ['tuvaluan', 'funafuti'],
    'Uganda': ['ugandan', 'kampala'],
    'Ukraine': ['ukrainian', 'kyiv', 'zelensky'],
    'United Arab Emirates': ['emirati', 'uae', 'dubai', 'abu dhabi'],
    'United Kingdom': ['british', 'uk', 'britain', 'london', 'parliament', 'westminster'],
    'United States': ['u.s.', 'american', 'washington', 'biden', 'trump', 'congress', 'white house', 'pentagon'],
    'Uruguay': ['uruguayan', 'montevideo'],
    'Uzbekistan': ['uzbek', 'tashkent'],
    'Vanuatu': ['ni-vanuatu', 'port vila'],
    'Venezuela': ['venezuelan', 'caracas', 'rodriguez', 'maduro'],
    'Vietnam': ['vietnamese', 'hanoi', 'ho chi minh'],
    'Yemen': ['yemeni', 'sanaa', 'houthi'],
    'Zambia': ['zambian', 'lusaka'],
    'Zimbabwe': ['zimbabwean', 'harare']
  };

  // Check if country name or demonym appears in title OR description
  const countryTerms = demonyms[countryName] || [countryLower];
  const allTerms = [countryLower, ...countryTerms];

  // Check title first (strongest signal)
  const inTitle = allTerms.some(term => titleLower.includes(term));
  if (inTitle) return true;

  // Also check description (weaker but still valid)
  const inDesc = allTerms.some(term => descLower.includes(term));
  return inDesc;
}

// Helper: format article array for display
function formatArticlesForDisplay(articles, countryName) {
  const relevant = articles.filter(a => isRelevantToCountry(a.title, a.description, countryName));
  const toUse = relevant.length > 0 ? relevant : articles;
  return toUse.slice(0, 15).map(article => ({
    headline: article.title,
    source: formatSourceName(article.source_id),
    time: timeAgo(article.pubDate),
    url: article.link || '#',
    category: detectCategory(article.title, article.description)
  }));
}

// Helper: try a news API with timeout
async function tryNewsAPI(apiName, url, parseResults, timeoutMs = 8000) {
  try {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), timeoutMs);
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeout);
    if (!response.ok) return null;
    const data = await response.json();
    const results = parseResults(data);
    if (results && results.length > 0) {
      console.log(`${apiName} returned ${results.length} results`);
      return results;
    }
  } catch (error) {
    console.warn(`${apiName} failed:`, error.message);
  }
  return null;
}

// Fetch country-specific news with smart caching and multi-source fallback
async function fetchCountryNews(countryName) {
  console.log(`Fetching news for ${countryName}...`);

  // 1. CHECK CACHE FIRST - avoid redundant API calls
  const cached = getCachedNews(countryName);
  if (cached) return cached;

  // 2. CHECK DAILY_BRIEFING - already-fetched global news may have relevant articles
  if (DAILY_BRIEFING && DAILY_BRIEFING.length > 0) {
    const briefingRelevant = DAILY_BRIEFING.filter(article =>
      isRelevantToCountry(article.title || article.headline, article.description || '', countryName)
    );
    if (briefingRelevant.length >= 2) {
      console.log(`Found ${briefingRelevant.length} relevant articles in DAILY_BRIEFING for ${countryName}`);
      const result = briefingRelevant.slice(0, 10).map(article => ({
        headline: article.title || article.headline,
        source: formatSourceName(article.source_id || article.source || 'News'),
        time: timeAgo(article.pubDate || article.time),
        url: article.link || article.url || '#',
        category: article.category || detectCategory(article.title || article.headline, article.description || '')
      }));
      setCachedNews(countryName, result);
      return result;
    }
  }

  // 3. Try Google News RSS (free, unlimited)
  try {
    const googleNewsUrl = RSS_FEEDS.search(countryName + ' news');
    const articles = await fetchRSS(googleNewsUrl, 'Google News');
    if (articles && articles.length > 0) {
      console.log(`Google News RSS returned ${articles.length} results for ${countryName}`);
      const result = formatArticlesForDisplay(articles, countryName);
      if (result.length > 0) { setCachedNews(countryName, result); return result; }
    }
  } catch (error) {
    console.warn('Google News RSS failed:', error.message);
  }

  // 4. Try backup APIs in sequence (with timeout protection)
  const apiOrder = ['gnews', 'newsdata', 'mediastack'];
  for (const apiName of apiOrder) {
    const api = NEWS_APIS[apiName];
    if (!api || !api.key) continue;

    // Skip APIs that recently failed (backoff for 5 minutes)
    if (apiFailures[apiName] && (Date.now() - apiFailures[apiName]) < 5 * 60 * 1000) continue;

    const url = api.buildUrl(api.key, countryName);
    const results = await tryNewsAPI(apiName, url, api.parseResults);

    if (results) {
      const formatted = formatArticlesForDisplay(results, countryName);
      if (formatted.length > 0) { setCachedNews(countryName, formatted); return formatted; }
    } else {
      apiFailures[apiName] = Date.now(); // Mark this API as temporarily failed
    }
  }

  // 5. Try broader regional search via Google News
  try {
    const countryData = COUNTRIES[countryName];
    if (countryData && countryData.region) {
      const regionQuery = `${countryName} ${countryData.region} news`;
      const regionUrl = RSS_FEEDS.search(regionQuery);
      const articles = await fetchRSS(regionUrl, 'Google News');
      if (articles && articles.length > 0) {
        const result = formatArticlesForDisplay(articles, countryName);
        if (result.length > 0) { setCachedNews(countryName, result); return result; }
      }
    }
  } catch (error) {
    console.warn('Regional search failed:', error.message);
  }

  // 6. Last resort: pull any DAILY_BRIEFING articles (even just 1)
  if (DAILY_BRIEFING && DAILY_BRIEFING.length > 0) {
    const anyRelevant = DAILY_BRIEFING.filter(article =>
      isRelevantToCountry(article.title || article.headline, article.description || '', countryName)
    );
    if (anyRelevant.length > 0) {
      const result = anyRelevant.slice(0, 10).map(article => ({
        headline: article.title || article.headline,
        source: formatSourceName(article.source_id || article.source || 'News'),
        time: timeAgo(article.pubDate || article.time),
        url: article.link || article.url || '#',
        category: article.category || detectCategory(article.title || article.headline, article.description || '')
      }));
      setCachedNews(countryName, result);
      return result;
    }
  }

  // 7. No news found from any source - cache the empty result too to avoid hammering APIs
  console.log(`No news found for ${countryName} from any source`);
  const emptyResult = [];
  setCachedNews(countryName, emptyResult);
  return emptyResult;
}

// Historical risk trends (Mar 2025 - Feb 2026) based on real events
// Values: 0-100 scale (100 = catastrophic)
const COUNTRY_TRENDS = {
  // Active conflicts - consistently high
  'Ukraine': [90, 92, 88, 90, 95, 92, 90, 88, 90, 92, 90, 92], // Ongoing war, fluctuates with offensives
  'Russia': [85, 88, 85, 88, 90, 88, 85, 88, 90, 88, 90, 92], // Tied to Ukraine war
  'Gaza': [95, 98, 95, 92, 90, 88, 85, 88, 92, 95, 92, 90], // Post-Oct 2023, gradually stabilizing
  'Israel': [80, 85, 82, 78, 75, 72, 70, 72, 75, 78, 75, 78], // Regional tensions persist
  'Sudan': [75, 80, 85, 90, 92, 95, 95, 95, 92, 92, 95, 95], // Civil war escalated Apr 2023
  'Myanmar': [70, 72, 75, 78, 80, 82, 85, 85, 88, 88, 85, 85], // Resistance gaining ground
  'Yemen': [80, 78, 80, 82, 85, 88, 85, 82, 80, 78, 80, 82], // Houthi Red Sea attacks
  'Haiti': [75, 78, 80, 85, 88, 90, 92, 92, 90, 88, 90, 92], // Gang violence worsening
  'Afghanistan': [85, 85, 82, 80, 82, 85, 85, 88, 85, 85, 88, 88], // Taliban control, humanitarian crisis
  'DRC': [78, 80, 82, 85, 88, 85, 82, 85, 88, 90, 88, 88], // M23 conflict ongoing
  'Somalia': [80, 78, 80, 82, 80, 78, 80, 82, 85, 82, 80, 82], // Al-Shabaab persistent

  // Major geopolitical hotspots
  'China': [55, 58, 55, 52, 55, 58, 60, 58, 55, 58, 60, 58], // Taiwan tensions, economic issues
  'Taiwan': [50, 55, 52, 50, 55, 58, 55, 52, 55, 58, 60, 58], // Cross-strait tensions
  'Iran': [65, 68, 70, 72, 75, 78, 75, 72, 70, 72, 75, 78], // Nuclear program, regional proxy wars
  'North Korea': [60, 62, 65, 68, 65, 62, 65, 68, 70, 68, 65, 68], // Missile tests continue
  'Venezuela': [55, 58, 60, 62, 65, 68, 70, 72, 75, 78, 85, 88], // Spiked after Maduro capture
  'Syria': [70, 68, 70, 72, 70, 68, 65, 62, 60, 58, 55, 52], // Assad fell, transitioning
  'Lebanon': [60, 62, 65, 68, 70, 75, 78, 75, 72, 68, 65, 62], // Post-war rebuilding

  // Political transitions
  'South Korea': [35, 38, 45, 55, 65, 70, 68, 65, 60, 55, 50, 48], // Political crisis peaked
  'Germany': [30, 32, 35, 40, 45, 50, 48, 45, 42, 38, 35, 32], // Coalition collapsed, new govt
  'France': [40, 42, 45, 48, 50, 52, 55, 52, 50, 48, 45, 48], // Political instability
  'Japan': [25, 28, 30, 35, 40, 45, 50, 48, 45, 42, 38, 35], // Snap election, new PM

  // Stable countries - low consistent values
  'United States': [35, 38, 35, 32, 35, 38, 40, 38, 35, 38, 40, 42], // Domestic tensions, foreign policy
  'United Kingdom': [25, 28, 25, 22, 25, 28, 30, 28, 25, 28, 25, 28], // Generally stable
  'Canada': [15, 18, 15, 12, 15, 18, 20, 18, 15, 18, 15, 18], // Stable democracy
  'Australia': [15, 18, 15, 18, 20, 18, 15, 18, 20, 18, 15, 18], // Stable
};

// Key risk indicators for countries
const COUNTRY_INDICATORS = {
  'Ukraine': [{ text: 'Conflict', dir: 'up' }, { text: 'Aid Flow', dir: 'stable' }, { text: 'Diplomacy', dir: 'down' }],
  'Russia': [{ text: 'Sanctions', dir: 'up' }, { text: 'Economy', dir: 'down' }, { text: 'Military', dir: 'stable' }],
  'Gaza': [{ text: 'Humanitarian', dir: 'up' }, { text: 'Ceasefire', dir: 'stable' }, { text: 'Rebuilding', dir: 'down' }],
  'Israel': [{ text: 'Security', dir: 'up' }, { text: 'Politics', dir: 'down' }, { text: 'Regional', dir: 'up' }],
  'Sudan': [{ text: 'Violence', dir: 'up' }, { text: 'Famine', dir: 'up' }, { text: 'Displacement', dir: 'up' }],
  'Myanmar': [{ text: 'Resistance', dir: 'up' }, { text: 'Junta Control', dir: 'down' }, { text: 'Refugees', dir: 'up' }],
  'Yemen': [{ text: 'Houthi Activity', dir: 'up' }, { text: 'Shipping', dir: 'down' }, { text: 'Peace Talks', dir: 'stable' }],
  'Haiti': [{ text: 'Gang Violence', dir: 'up' }, { text: 'Government', dir: 'down' }, { text: 'Migration', dir: 'up' }],
  'China': [{ text: 'Taiwan Tension', dir: 'up' }, { text: 'Economy', dir: 'down' }, { text: 'US Relations', dir: 'down' }],
  'Taiwan': [{ text: 'China Threat', dir: 'up' }, { text: 'US Support', dir: 'up' }, { text: 'Defense', dir: 'up' }],
  'Iran': [{ text: 'Nuclear', dir: 'up' }, { text: 'Sanctions', dir: 'stable' }, { text: 'Proxies', dir: 'up' }],
  'North Korea': [{ text: 'Missiles', dir: 'up' }, { text: 'Isolation', dir: 'stable' }, { text: 'Provocations', dir: 'up' }],
  'Venezuela': [{ text: 'Transition', dir: 'up' }, { text: 'Stability', dir: 'down' }, { text: 'US Pressure', dir: 'up' }],
  'Syria': [{ text: 'Rebuilding', dir: 'up' }, { text: 'Stability', dir: 'up' }, { text: 'Refugees Return', dir: 'stable' }],
  'South Korea': [{ text: 'Politics', dir: 'down' }, { text: 'Economy', dir: 'stable' }, { text: 'North Threat', dir: 'stable' }],
  'United States': [{ text: 'Polarization', dir: 'up' }, { text: 'Economy', dir: 'stable' }, { text: 'Global Role', dir: 'stable' }],
};

// Get trend data - use real data if available, otherwise generate based on risk level
function getTrendData(countryName, risk) {
  if (COUNTRY_TRENDS[countryName]) {
    return COUNTRY_TRENDS[countryName];
  }
  // Fallback: generate consistent data based on risk level
  const baseValues = { catastrophic: 85, extreme: 70, severe: 55, stormy: 40, cloudy: 25, clear: 10 };
  const base = baseValues[risk] || 50;
  const trends = [];
  for (let i = 0; i < 12; i++) {
    // Use country name as seed for consistent pseudo-random variation
    const seed = (countryName.charCodeAt(i % countryName.length) + i) % 20 - 10;
    trends.push(Math.max(5, Math.min(100, base + seed)));
  }
  return trends;
}

// Render risk trend chart with indicators
function renderTrendChart(countryName, risk) {
  const data = getTrendData(countryName, risk);
  const max = Math.max(...data);
  const indicators = COUNTRY_INDICATORS[countryName] || [];
  const months = ['Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'];

  return `
    <div style="display:flex;gap:16px;align-items:flex-start;">
      <div style="flex:1;">
        <div class="trend-chart">
          ${data.map((val, i) => {
            const height = (val / max) * 25 + 5;
            const trend = i > 0 ? (val > data[i-1] ? 'up' : val < data[i-1] ? 'down' : 'stable') : 'stable';
            return `<div class="trend-bar trend-${trend}" style="height:${height}px" title="${months[i]} 2025: ${val}"></div>`;
          }).join('')}
        </div>
        <div class="trend-label">Mar 2025 â†’ Feb 2026</div>
      </div>
      ${indicators.length > 0 ? `
        <div style="min-width:100px;">
          <div style="font-size:8px;color:#6b7280;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Key Indicators</div>
          ${indicators.map(ind => `
            <div style="font-size:9px;color:#d1d5db;margin-bottom:4px;display:flex;align-items:center;gap:4px;">
              <span style="color:${ind.dir === 'up' ? '#ef4444' : ind.dir === 'down' ? '#22c55e' : '#6b7280'}">${ind.dir === 'up' ? 'â†‘' : ind.dir === 'down' ? 'â†“' : 'â†’'}</span>
              ${ind.text}
            </div>
          `).join('')}
        </div>
      ` : ''}
    </div>
  `;
}

// Conflict zones data (lat, lng, radius, intensity)
const CONFLICT_ZONES = [
  { lat: 48.5, lng: 35.0, radius: 0.15, name: 'Ukraine-Russia', intensity: 1.0 },
  { lat: 31.5, lng: 34.5, radius: 0.08, name: 'Gaza', intensity: 1.0 },
  { lat: 15.5, lng: 32.5, radius: 0.12, name: 'Sudan', intensity: 0.9 },
  { lat: 21.0, lng: 96.0, radius: 0.10, name: 'Myanmar', intensity: 0.8 },
  { lat: 15.5, lng: 47.5, radius: 0.10, name: 'Yemen', intensity: 0.8 },
  { lat: 2.0, lng: 45.0, radius: 0.08, name: 'Somalia', intensity: 0.7 },
  { lat: -2.0, lng: 28.0, radius: 0.12, name: 'DRC East', intensity: 0.8 },
  { lat: 33.5, lng: 36.5, radius: 0.06, name: 'Syria', intensity: 0.7 },
  { lat: 18.5, lng: -72.3, radius: 0.04, name: 'Haiti', intensity: 0.7 },
  { lat: 17.0, lng: -3.0, radius: 0.10, name: 'Sahel', intensity: 0.8 }
];

// Add conflict zones to globe
function addConflictZones(globe) {
  CONFLICT_ZONES.forEach(zone => {
    // Create pulsing conflict zone circle
    const geometry = new THREE.RingGeometry(zone.radius * 0.5, zone.radius, 32);
    const material = new THREE.MeshBasicMaterial({
      color: 0xff3333,
      transparent: true,
      opacity: 0.3 * zone.intensity,
      side: THREE.DoubleSide
    });
    const ring = new THREE.Mesh(geometry, material);

    const pos = latLngToVector3(zone.lat, zone.lng, 1.01);
    ring.position.copy(pos);
    ring.lookAt(new THREE.Vector3(0, 0, 0));
    ring.userData = { isConflictZone: true, intensity: zone.intensity, baseOpacity: 0.3 * zone.intensity };

    globe.add(ring);

    // Add outer glow ring
    const glowGeom = new THREE.RingGeometry(zone.radius, zone.radius * 1.3, 32);
    const glowMat = new THREE.MeshBasicMaterial({
      color: 0xff6666,
      transparent: true,
      opacity: 0.15 * zone.intensity,
      side: THREE.DoubleSide
    });
    const glow = new THREE.Mesh(glowGeom, glowMat);
    glow.position.copy(pos);
    glow.lookAt(new THREE.Vector3(0, 0, 0));
    glow.userData = { isConflictZone: true, isGlow: true };
    globe.add(glow);
  });
}

// Animate conflict zones (pulsing effect)
function animateConflictZones() {
  if (!globe) return;
  const time = Date.now() * 0.002;

  globe.children.forEach(child => {
    if (child.userData && child.userData.isConflictZone && !child.userData.isGlow) {
      const pulse = 0.5 + 0.5 * Math.sin(time * child.userData.intensity);
      child.material.opacity = child.userData.baseOpacity * (0.5 + 0.5 * pulse);
    }
  });
}

// Set current date (updates automatically at midnight)
function updateDate() {
  document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}
updateDate();
// Check every minute and update if date changed
setInterval(updateDate, 60000);

// Calculate stats
let critical = 0, high = 0, stable = 0;
Object.values(COUNTRIES).forEach(c => {
  if (c.risk === 'catastrophic' || c.risk === 'extreme') critical++;
  else if (c.risk === 'severe' || c.risk === 'stormy') high++;
  else stable++;
});
document.getElementById('statCritical').textContent = critical;
document.getElementById('statHigh').textContent = high;
document.getElementById('statStable').textContent = stable;
document.getElementById('statTotal').textContent = Object.keys(COUNTRIES).length;

// Render watchlist
const watchlistEl = document.getElementById('watchlist');
const watchlistCountries = Object.entries(COUNTRIES)
  .filter(([_, c]) => c.risk === 'catastrophic' || c.risk === 'extreme')
  .sort((a, b) => {
    const tierDiff = ({ catastrophic: 0, extreme: 1 }[a[1].risk] - { catastrophic: 0, extreme: 1 }[b[1].risk]);
    return tierDiff !== 0 ? tierDiff : a[0].localeCompare(b[0]);
  });
watchlistEl.innerHTML = `<div class="watchlist-title">CRITICAL WATCHLIST</div>` +
  watchlistCountries.map(([name, c]) => `<div class="watchlist-item" onclick="openModal('${name}')"><span class="wl-country">${c.flag} ${name}</span><span class="wl-risk risk-${c.risk}">${c.risk.toUpperCase()}</span></div>`).join('');

// THREE.JS GLOBE WITH TEXTURE
let scene, camera, renderer, globe, countryMeshes = [], raycaster, mouse;
const tooltip = document.getElementById('tooltip');

function initGlobe() {
  const container = document.getElementById('globe');
  const width = container.clientWidth;
  const height = container.clientHeight;

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
  camera.position.z = 2.8;
  camera.position.x = -0.15; // Shift globe slightly left to center it

  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(width, height);
  renderer.setPixelRatio(window.devicePixelRatio);
  container.appendChild(renderer.domElement);

  // Lights
  const ambient = new THREE.AmbientLight(0xffffff, 0.8);
  scene.add(ambient);
  const directional = new THREE.DirectionalLight(0xffffff, 0.6);
  directional.position.set(5, 3, 5);
  scene.add(directional);

  // Earth sphere with texture
  const earthGeom = new THREE.SphereGeometry(1, 64, 64);

  // Load Earth texture
  const textureLoader = new THREE.TextureLoader();
  const hideLoader = () => { const el = document.getElementById('globeLoader'); if (el) { el.style.opacity = '0'; setTimeout(() => el.remove(), 800); } };
  const earthTexture = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg', hideLoader);
  const earthBump = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-topology.png');

  const earthMat = new THREE.MeshPhongMaterial({
    map: earthTexture,
    bumpMap: earthBump,
    bumpScale: 0.03,
    specular: new THREE.Color(0x333333),
    shininess: 5
  });

  globe = new THREE.Mesh(earthGeom, earthMat);
  scene.add(globe);

  // Atmosphere glow
  const glowGeom = new THREE.SphereGeometry(1.02, 64, 64);
  const glowMat = new THREE.MeshBasicMaterial({ color: 0x06b6d4, transparent: true, opacity: 0.08, side: THREE.BackSide });
  scene.add(new THREE.Mesh(glowGeom, glowMat));

  raycaster = new THREE.Raycaster();
  // Increase touch detection area on mobile for easier tapping
  if (window.innerWidth <= 768) {
    raycaster.params.Line = { threshold: 0.1 };
    raycaster.params.Points = { threshold: 0.1 };
  }
  mouse = new THREE.Vector2();

  // Draw country borders
  drawBorders();

  // Add country markers
  addCountryMarkers();

  // Add conflict zone overlays
  addConflictZones(globe);

  container.addEventListener('mousemove', onMouseMove);
  container.addEventListener('click', onClick);
  window.addEventListener('resize', onResize);

  animate();
}

function drawBorders() {
  // Simplified border coordinates for major countries (lat/lng outline points)
  const borderData = {
    // Adding comprehensive border outlines
    'USA': [[49,-125],[49,-67],[25,-80],[25,-97],[32,-117],[49,-125]],
    'Canada': [[49,-125],[49,-55],[60,-55],[70,-90],[60,-140],[49,-125]],
    'Mexico': [[32,-117],[32,-86],[15,-87],[15,-105],[32,-117]],
    'Brazil': [[-5,-74],[-5,-35],[-33,-53],[-33,-58],[-15,-74],[-5,-74]],
    'Argentina': [[-22,-66],[-22,-58],[-55,-68],[-55,-72],[-22,-66]],
    'Russia': [[70,30],[70,180],[45,135],[45,30],[70,30]],
    'China': [[53,73],[53,135],[18,110],[22,100],[35,73],[53,73]],
    'India': [[35,68],[35,97],[8,77],[8,68],[35,68]],
    'Australia': [[-10,113],[-10,154],[-44,147],[-35,115],[-10,113]],
    'EU': [[70,-10],[70,40],[35,40],[35,-10],[70,-10]],
    'Africa': [[37,-17],[37,51],[-35,20],[-35,-17],[37,-17]],
    'MiddleEast': [[42,25],[42,63],[12,43],[12,25],[42,25]]
  };

  // Draw regional borders as thicker cyan lines
  Object.entries(borderData).forEach(([region, coords]) => {
    const points = coords.map(([lat, lng]) => latLngToVector3(lat, lng, 1.002));
    points.push(points[0]); // Close the loop

    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const material = new THREE.LineBasicMaterial({
      color: 0x06b6d4,
      transparent: true,
      opacity: 0.4,
      linewidth: 2
    });
    const line = new THREE.Line(geometry, material);
    globe.add(line);
  });

  // Draw latitude/longitude grid
  for (let lat = -60; lat <= 60; lat += 30) {
    const points = [];
    for (let lng = -180; lng <= 180; lng += 5) {
      points.push(latLngToVector3(lat, lng, 1.001));
    }
    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const material = new THREE.LineBasicMaterial({ color: 0x1f2937, transparent: true, opacity: 0.3 });
    globe.add(new THREE.Line(geometry, material));
  }

  for (let lng = -180; lng < 180; lng += 30) {
    const points = [];
    for (let lat = -90; lat <= 90; lat += 5) {
      points.push(latLngToVector3(lat, lng, 1.001));
    }
    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const material = new THREE.LineBasicMaterial({ color: 0x1f2937, transparent: true, opacity: 0.3 });
    globe.add(new THREE.Line(geometry, material));
  }
}

function addCountryMarkers() {
  Object.entries(COUNTRIES).forEach(([name, data]) => {
    // Create marker sphere
    const size = data.risk === 'catastrophic' ? 0.025 : data.risk === 'extreme' ? 0.02 : 0.015;
    const markerGeom = new THREE.SphereGeometry(size, 16, 16);
    const markerMat = new THREE.MeshBasicMaterial({
      color: RISK_COLORS[data.risk]?.glow || 0x888888,
      transparent: true,
      opacity: 0.95
    });
    const marker = new THREE.Mesh(markerGeom, markerMat);

    const pos = latLngToVector3(data.lat, data.lng, 1.02);
    marker.position.copy(pos);
    marker.userData = { name, data };

    globe.add(marker);
    countryMeshes.push(marker);

    // Add pulsing ring for critical countries
    if (data.risk === 'catastrophic' || data.risk === 'extreme') {
      const ringGeom = new THREE.RingGeometry(size + 0.01, size + 0.025, 32);
      const ringMat = new THREE.MeshBasicMaterial({
        color: RISK_COLORS[data.risk].glow,
        transparent: true,
        opacity: 0.6,
        side: THREE.DoubleSide
      });
      const ring = new THREE.Mesh(ringGeom, ringMat);
      ring.position.copy(pos);
      ring.lookAt(new THREE.Vector3(0, 0, 0));
      globe.add(ring);
    }
  });
}

function latLngToVector3(lat, lng, radius) {
  const phi = (90 - lat) * (Math.PI / 180);
  const theta = (lng + 180) * (Math.PI / 180);
  return new THREE.Vector3(
    -radius * Math.sin(phi) * Math.cos(theta),
    radius * Math.cos(phi),
    radius * Math.sin(phi) * Math.sin(theta)
  );
}

// Convert a 3D world point on globe surface back to lat/lng
function vector3ToLatLng(worldPoint) {
  const lp = globe.worldToLocal(worldPoint.clone());
  const r = lp.length();
  const phi = Math.acos(Math.max(-1, Math.min(1, lp.y / r)));
  const theta = Math.atan2(lp.z, -lp.x);
  const lat = 90 - phi * (180 / Math.PI);
  const lng = ((theta * (180 / Math.PI) - 180 + 540) % 360) - 180;
  return { lat, lng };
}

// Find nearest tracked country to a lat/lng point
function findNearestCountry(lat, lng, maxDist) {
  maxDist = maxDist || 15;
  let nearest = null, minDist = Infinity;
  Object.entries(COUNTRIES).forEach(([name, data]) => {
    const dLat = data.lat - lat;
    let dLng = data.lng - lng;
    if (dLng > 180) dLng -= 360;
    if (dLng < -180) dLng += 360;
    const dist = Math.sqrt(dLat * dLat + dLng * dLng);
    if (dist < minDist) { minDist = dist; nearest = name; }
  });
  return minDist <= maxDist ? nearest : null;
}

function onMouseMove(event) {
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(countryMeshes);

  if (intersects.length > 0) {
    const { name, data } = intersects[0].object.userData;
    tooltip.style.display = 'block';
    tooltip.style.left = event.clientX + 15 + 'px';
    tooltip.style.top = event.clientY + 15 + 'px';
    tooltip.innerHTML = `
      <div class="tooltip-name">${data.flag} ${name} <span class="tooltip-risk risk-${data.risk}">${data.risk.toUpperCase()}</span></div>
      <div class="tooltip-region">${data.region} â€¢ ${data.title || ''}</div>
      <div class="tooltip-hint">Click for details</div>
    `;
    renderer.domElement.style.cursor = 'pointer';
  } else {
    // Check globe surface for nearby country
    const globeHits = raycaster.intersectObject(globe);
    if (globeHits.length > 0) {
      const { lat, lng } = vector3ToLatLng(globeHits[0].point);
      const country = findNearestCountry(lat, lng, 10);
      if (country) {
        const data = COUNTRIES[country];
        tooltip.style.display = 'block';
        tooltip.style.left = event.clientX + 15 + 'px';
        tooltip.style.top = event.clientY + 15 + 'px';
        tooltip.innerHTML = `
          <div class="tooltip-name">${data.flag} ${country} <span class="tooltip-risk risk-${data.risk}">${data.risk.toUpperCase()}</span></div>
          <div class="tooltip-region">${data.region} â€¢ ${data.title || ''}</div>
          <div class="tooltip-hint">Click for details</div>
        `;
        renderer.domElement.style.cursor = 'pointer';
      } else {
        tooltip.style.display = 'none';
        renderer.domElement.style.cursor = 'grab';
      }
    } else {
      tooltip.style.display = 'none';
      renderer.domElement.style.cursor = 'grab';
    }
  }
}

function onClick(event) {
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);

  // Priority: try marker dots first
  const intersects = raycaster.intersectObjects(countryMeshes);
  if (intersects.length > 0) {
    openModal(intersects[0].object.userData.name);
    return;
  }

  // Check if this was a drag (skip globe surface click after drag)
  if (globeClickStart) {
    const dx = Math.abs(event.clientX - globeClickStart.x);
    const dy = Math.abs(event.clientY - globeClickStart.y);
    if (dx > 5 || dy > 5) return;
  }

  // Try globe surface - find nearest tracked country
  const globeHits = raycaster.intersectObject(globe);
  if (globeHits.length > 0) {
    const { lat, lng } = vector3ToLatLng(globeHits[0].point);
    const country = findNearestCountry(lat, lng);
    if (country) openModal(country);
  }
}

function onResize() {
  const container = document.getElementById('globe');
  camera.aspect = container.clientWidth / container.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(container.clientWidth, container.clientHeight);
}

// Globe controls
let isDragging = false, prevMouse = { x: 0, y: 0 };
let globeClickStart = { x: 0, y: 0 };
let autoRotate = true;

function toggleRotation() {
  autoRotate = !autoRotate;
  const btn = document.getElementById('rotateToggle');
  if (btn) btn.classList.toggle('active', autoRotate);
}

// Drag rotation - Mouse events
document.getElementById('globe').addEventListener('mousedown', (e) => { isDragging = true; prevMouse = { x: e.clientX, y: e.clientY }; globeClickStart = { x: e.clientX, y: e.clientY }; });
document.addEventListener('mouseup', () => { isDragging = false; });
document.addEventListener('mousemove', (e) => {
  if (!isDragging || !globe) return;
  globe.rotation.y += (e.clientX - prevMouse.x) * 0.005;
  globe.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, globe.rotation.x + (e.clientY - prevMouse.y) * 0.005));
  prevMouse = { x: e.clientX, y: e.clientY };
});

// Touch events for mobile globe rotation
let touchStart = { x: 0, y: 0 };
document.getElementById('globe').addEventListener('touchstart', (e) => {
  if (e.touches.length === 1) {
    isDragging = true;
    touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    prevMouse = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  }
}, { passive: true });

document.addEventListener('touchend', () => { isDragging = false; });

document.addEventListener('touchmove', (e) => {
  if (!isDragging || !globe || e.touches.length !== 1) return;
  const touch = e.touches[0];
  globe.rotation.y += (touch.clientX - prevMouse.x) * 0.005;
  globe.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, globe.rotation.x + (touch.clientY - prevMouse.y) * 0.005));
  prevMouse = { x: touch.clientX, y: touch.clientY };
}, { passive: true });

// Touch tap on markers and globe surface for mobile
document.getElementById('globe').addEventListener('touchend', (e) => {
  // Only handle single tap (not after drag)
  if (e.changedTouches.length === 1) {
    const touch = e.changedTouches[0];
    const dx = Math.abs(touch.clientX - touchStart.x);
    const dy = Math.abs(touch.clientY - touchStart.y);
    // If minimal movement, treat as tap/click
    if (dx < 10 && dy < 10) {
      const container = document.getElementById('globe');
      const rect = container.getBoundingClientRect();
      mouse.x = ((touch.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((touch.clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      // Priority: try marker dots first
      const intersects = raycaster.intersectObjects(countryMeshes);
      if (intersects.length > 0) {
        openModal(intersects[0].object.userData.name);
        return;
      }
      // Try globe surface - find nearest tracked country
      const globeHits = raycaster.intersectObject(globe);
      if (globeHits.length > 0) {
        const { lat, lng } = vector3ToLatLng(globeHits[0].point);
        const country = findNearestCountry(lat, lng);
        if (country) openModal(country);
      }
    }
  }
}, { passive: true });

function animate() {
  requestAnimationFrame(animate);
  if (!isDragging && autoRotate && globe) globe.rotation.y += 0.0008;
  animateConflictZones(); // Pulse conflict zones
  renderer.render(scene, camera);
}

// Sidebar tabs
let currentTab = 'daily';
// Track how many news items to show
let newsDisplayCount = 20;

function renderSidebar() {
  const content = document.getElementById('sidebarContent');

  if (currentTab === 'daily') {
    // Separate high-importance and regular news
    const topStories = DAILY_BRIEFING.filter(item => item.importance === 'high' || ['CONFLICT', 'CRISIS', 'SECURITY'].includes(item.category)).slice(0, 5);
    const allNews = DAILY_BRIEFING.slice(0, newsDisplayCount);

    let html = '';

    // Top Stories section
    if (topStories.length > 0) {
      html += `<div class="section-header" style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(90deg,rgba(239,68,68,0.15) 0%,transparent 100%);border-left:3px solid #ef4444;margin-bottom:10px;"><span style="font-size:11px;font-weight:700;color:#ef4444;letter-spacing:1px;">TOP STORIES</span></div>`;
      html += topStories.map(item => `
        <div class="card" style="border-left:2px solid ${item.category === 'CONFLICT' ? '#ef4444' : item.category === 'CRISIS' ? '#f97316' : '#eab308'};">
          <div class="card-header"><span class="card-cat ${item.category}">${item.category}</span><span class="card-time">${item.time}</span></div>
          <div class="card-headline" style="font-weight:600;">${item.headline}</div>
          <div class="card-source"><a href="${item.url}" target="_blank">${item.source} â†—</a></div>
          <div style="margin-top:4px;">${renderBiasTag(item.source)}</div>
        </div>
      `).join('');
    }

    // All News section
    html += `<div class="section-header" style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(59,130,246,0.1);border-left:3px solid #3b82f6;margin:14px 0 10px 0;"><span style="font-size:11px;font-weight:700;color:#3b82f6;letter-spacing:1px;">LATEST UPDATES</span><span style="font-size:9px;color:#6b7280;">(${DAILY_BRIEFING.length} articles)</span></div>`;
    html += allNews.map(item => `
      <div class="card">
        <div class="card-header"><span class="card-cat ${item.category}">${item.category}</span><span class="card-time">${item.time}</span></div>
        <div class="card-headline">${item.headline}</div>
        <div class="card-source"><a href="${item.url}" target="_blank">${item.source} â†—</a></div>
        <div style="margin-top:4px;">${renderBiasTag(item.source)}</div>
      </div>
    `).join('');

    // Load More button
    if (newsDisplayCount < DAILY_BRIEFING.length) {
      html += `<button onclick="loadMoreNews()" style="width:100%;padding:12px;margin-top:10px;background:linear-gradient(135deg,#1f2937 0%,#111827 100%);border:1px solid #374151;border-radius:8px;color:#9ca3af;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">LOAD MORE (${DAILY_BRIEFING.length - newsDisplayCount} remaining)</button>`;
    }

    content.innerHTML = html;
  } else if (currentTab === 'forecast') {
    content.innerHTML = FORECASTS.map(f => `
      <div class="forecast-card">
        <div class="forecast-header"><span class="forecast-region">${f.region}</span><span class="forecast-risk risk-${f.risk}">${f.risk.toUpperCase()}</span></div>
        <div class="forecast-current">${f.current}</div>
        <div class="forecast-prediction"><div class="forecast-prediction-title">FORECAST</div><div class="forecast-prediction-text">${f.forecast}</div></div>
        <div class="forecast-indicators">${f.indicators.map(i => `<span class="forecast-indicator ${i.dir}">${i.dir === 'up' ? 'â†‘' : i.dir === 'down' ? 'â†“' : 'â†’'} ${i.text}</span>`).join('')}</div>
      </div>
    `).join('');
  } else if (currentTab === 'elections') {
    content.innerHTML = `<div style="font-size:9px;color:#22c55e;font-weight:600;letter-spacing:1px;margin-bottom:12px">RECENT RESULTS</div>` +
      RECENT_ELECTIONS.map(e => `
        <div class="election-card" onclick="openModal('${e.country}')" style="border-left:3px solid #22c55e">
          <div class="election-header"><span class="election-flag">${e.flag}</span><span class="election-country">${e.country}</span><span class="election-date" style="color:#22c55e">${e.date}</span></div>
          <div class="election-type">${e.type}</div>
          <div style="font-size:10px;color:#22c55e;font-weight:600;margin:4px 0">${e.winner}</div>
          <div class="election-stakes">${e.summary}</div>
        </div>
      `).join('') +
      `<div style="font-size:9px;color:#f97316;font-weight:600;letter-spacing:1px;margin:20px 0 12px">UPCOMING ELECTIONS</div>` +
      ELECTIONS.map(e => `
        <div class="election-card" onclick="openModal('${e.country}')" style="border-left:3px solid #f97316">
          <div class="election-header"><span class="election-flag">${e.flag}</span><span class="election-country">${e.country}</span><span class="election-date">${e.date}</span></div>
          <div class="election-type">${e.type}</div>
          <div class="election-stakes">${e.stakes}</div>
        </div>
      `).join('');
  } else if (currentTab === 'horizon') {
    const now = new Date();
    const todayStr = now.toISOString().split('T')[0];
    const upcoming = HORIZON_EVENTS.filter(e => e.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date));
    const past = HORIZON_EVENTS.filter(e => e.date < todayStr).sort((a, b) => b.date.localeCompare(a.date));

    const catColors = { summit: '#06b6d4', election: '#a78bfa', treaty: '#f59e0b', military: '#ef4444', economic: '#22c55e', sanctions: '#f97316' };

    function renderHorizonEvent(e, isPast) {
      const d = new Date(e.date + 'T12:00:00');
      const month = d.toLocaleString('en-US', { month: 'short' }).toUpperCase();
      const day = d.getDate();
      const color = catColors[e.category] || '#6b7280';
      const opacity = isPast ? 'opacity:0.5;' : '';

      // Days until/since
      const diffMs = new Date(e.date + 'T00:00:00') - new Date(todayStr + 'T00:00:00');
      const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));
      let countdown = '';
      if (diffDays === 0) countdown = '<span style="color:#22c55e;font-weight:700;font-size:8px;">TODAY</span>';
      else if (diffDays === 1) countdown = '<span style="color:#f59e0b;font-size:8px;">TOMORROW</span>';
      else if (diffDays > 1 && diffDays <= 7) countdown = `<span style="color:#f59e0b;font-size:8px;">${diffDays} Day${diffDays === 1 ? '' : 's'}</span>`;
      else if (diffDays > 7 && diffDays <= 30) { const w = Math.ceil(diffDays / 7); countdown = `<span style="color:#6b7280;font-size:8px;">${w} Week${w === 1 ? '' : 's'}</span>`; }
      else if (diffDays > 30) { const mo = Math.ceil(diffDays / 30); countdown = `<span style="color:#4b5563;font-size:8px;">${mo} Month${mo === 1 ? '' : 's'}</span>`; }
      else if (isPast) { const abs = Math.abs(diffDays); countdown = `<span style="color:#374151;font-size:8px;">${abs} Day${abs === 1 ? '' : 's'} Ago</span>`; }

      return `
        <div style="display:flex;gap:10px;padding:10px 8px;border-bottom:1px solid #111827;${opacity}">
          <div style="min-width:42px;text-align:center;">
            <div style="font-size:9px;font-weight:700;color:${color};letter-spacing:0.5px;">${month}</div>
            <div style="font-size:18px;font-weight:700;color:#e5e7eb;line-height:1.1;">${day}</div>
            <div style="margin-top:2px;">${countdown}</div>
          </div>
          <div style="flex:1;min-width:0;">
            <div style="display:flex;align-items:center;gap:5px;margin-bottom:3px;">
              <span style="font-size:10px;font-weight:600;color:#e5e7eb;line-height:1.3;">${e.name}</span>
            </div>
            <div style="font-size:9px;color:#9ca3af;margin-bottom:3px;">${e.location}</div>
            <div style="font-size:9px;color:#6b7280;line-height:1.5;">${e.description}</div>
          </div>
        </div>`;
    }

    let horizonHtml = '';

    // Header
    horizonHtml += `<div style="padding:8px 12px;background:linear-gradient(90deg,rgba(6,182,212,0.12) 0%,transparent 100%);border-left:3px solid #06b6d4;margin-bottom:12px;">
      <div style="font-size:11px;font-weight:700;color:#06b6d4;letter-spacing:1px;">GEOPOLITICAL HORIZON</div>
      <div style="font-size:9px;color:#6b7280;margin-top:2px;">${upcoming.length} upcoming events tracked</div>
    </div>`;

    // Category legend
    horizonHtml += `<div style="display:flex;flex-wrap:wrap;gap:6px;padding:0 8px 10px;border-bottom:1px solid #1f2937;margin-bottom:4px;">`;
    Object.entries(catColors).forEach(([cat, color]) => {
      horizonHtml += `<span style="font-size:8px;color:#6b7280;display:flex;align-items:center;gap:2px;"><span style="width:6px;height:6px;border-radius:50%;background:${color};display:inline-block;"></span>${cat.charAt(0).toUpperCase() + cat.slice(1)}</span>`;
    });
    horizonHtml += `</div>`;

    // Upcoming events
    if (upcoming.length > 0) {
      // Group by month
      let currentMonth = '';
      upcoming.forEach(e => {
        const d = new Date(e.date + 'T12:00:00');
        const monthYear = d.toLocaleString('en-US', { month: 'long', year: 'numeric' });
        if (monthYear !== currentMonth) {
          currentMonth = monthYear;
          horizonHtml += `<div style="font-size:9px;font-weight:700;color:#9ca3af;letter-spacing:1px;padding:10px 8px 4px;border-top:1px solid #1f2937;margin-top:4px;">${monthYear.toUpperCase()}</div>`;
        }
        horizonHtml += renderHorizonEvent(e, false);
      });
    }

    // Past events (collapsed)
    if (past.length > 0) {
      horizonHtml += `
        <div style="margin-top:12px;border-top:1px solid #1f2937;padding-top:10px;">
          <div onclick="toggleBriefDropdown('horizon-past')" style="display:flex;align-items:center;justify-content:space-between;padding:8px;cursor:pointer;background:#0d0d14;border-radius:6px;" onmouseover="this.style.background='#131320'" onmouseout="this.style.background='#0d0d14'">
            <span style="font-size:9px;font-weight:600;color:#6b7280;letter-spacing:0.5px;">PAST EVENTS (${past.length})</span>
            <span id="horizon-past-arrow" style="color:#6b7280;font-size:10px;transition:transform 0.3s;">â–¼</span>
          </div>
          <div id="horizon-past" style="max-height:0px;opacity:0;overflow:hidden;transition:max-height 0.4s ease, opacity 0.3s ease;">
            ${past.map(e => renderHorizonEvent(e, true)).join('')}
          </div>
        </div>`;
    }

    content.innerHTML = horizonHtml;
  } else if (currentTab === 'search') {
    content.innerHTML = `<div style="margin-bottom:12px"><input type="text" id="searchInput" placeholder="Search countries..." style="width:100%;padding:10px 12px;background:#0d0d12;border:1px solid #1f2937;border-radius:8px;color:#fff;font-size:12px;outline:none" oninput="searchCountries(this.value)"></div><div id="searchResults"><div style="color:#6b7280;font-size:11px;text-align:center;padding:20px">Type to search ${Object.keys(COUNTRIES).length} countries...</div></div>`;
  } else if (currentTab === 'newsletter') {
    content.innerHTML = renderNewsletter();
  }
}

function loadMoreNews() {
  newsDisplayCount += 15;
  renderSidebar();
}

function searchCountries(query) {
  const results = document.getElementById('searchResults');
  if (!query) { results.innerHTML = '<div style="color:#6b7280;font-size:11px;text-align:center;padding:20px">Type to search...</div>'; return; }
  const matches = Object.entries(COUNTRIES).filter(([name, c]) => name.toLowerCase().includes(query.toLowerCase()) || c.region.toLowerCase().includes(query.toLowerCase()) || (c.title && c.title.toLowerCase().includes(query.toLowerCase())));
  results.innerHTML = matches.length ? matches.map(([name, c]) => `<div class="card" onclick="openModal('${name}')" style="margin-bottom:4px"><div class="event-header" style="margin:0"><div class="event-dot" style="background:${RISK_COLORS[c.risk].hex}"></div><span class="event-country">${c.flag} ${name}</span><span class="event-risk risk-${c.risk}">${c.risk.toUpperCase()}</span></div></div>`).join('') : '<div style="color:#6b7280;font-size:11px;text-align:center;padding:20px">No countries found</div>';
}

document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    currentTab = tab.dataset.tab;
    renderSidebar();
  });
});

function openModal(name) {
  const c = COUNTRIES[name];
  if (!c) return;

  // Hide the tooltip when opening modal
  const tooltipEl = document.getElementById('tooltip');
  if (tooltipEl) tooltipEl.style.display = 'none';

  document.getElementById('modalFlag').textContent = c.flag;
  document.getElementById('modalTitle').textContent = name;
  const riskEl = document.getElementById('modalRisk');
  riskEl.textContent = c.risk.toUpperCase();
  riskEl.className = `modal-risk risk-${c.risk}`;
  document.getElementById('modalSubtitle').textContent = c.title || c.region;

  let html = `<div class="facts-grid"><div class="fact"><div class="fact-label">Region</div><div class="fact-value">${c.region}</div></div><div class="fact"><div class="fact-label">Population</div><div class="fact-value">${c.pop}</div></div><div class="fact"><div class="fact-label">GDP</div><div class="fact-value">${c.gdp}</div></div><div class="fact"><div class="fact-label">Leader</div><div class="fact-value">${c.leader}</div></div></div>`;

  // Add risk trend chart with indicators
  html += `<div class="section-title">Risk Trend & Indicators</div>${renderTrendChart(name, c.risk)}`;

  if (c.analysis) {
    html += `<div class="section-title">Situation Analysis</div>
      <div class="analysis-block"><div class="analysis-header"><div class="analysis-num n1">1</div><div class="analysis-title">What Happened</div></div><p class="analysis-text">${c.analysis.what}</p></div>
      <div class="analysis-block"><div class="analysis-header"><div class="analysis-num n2">2</div><div class="analysis-title">Why It Matters</div></div><p class="analysis-text">${c.analysis.why}</p></div>
      <div class="analysis-block"><div class="analysis-header"><div class="analysis-num n3">3</div><div class="analysis-title">What Might Happen</div></div><p class="analysis-text">${c.analysis.next}</p></div>`;
  }

  // Show cached news first
  if (c.news && c.news.length) {
    html += `<div class="section-title">Recent Coverage</div>`;
    c.news.forEach(n => { html += `<div class="news-item"><div class="news-meta"><span class="news-source">${n.source}</span><span class="news-time">${n.time}</span></div>${renderBiasTag(n.source)}<div class="news-headline">${n.headline}</div><a class="news-link" href="${n.url}" target="_blank">Read more â†—</a></div>`; });
  }

  // Add placeholder for live country news
  html += `<div class="country-news-section"><div class="country-news-title">LIVE NEWS FOR ${name.toUpperCase()}</div><div id="countryNewsContent" class="country-news-loading">Loading latest news...</div></div>`;

  // Sanctions section (collapsible, below news)
  html += buildSanctionsSection(name);

  document.getElementById('modalBody').innerHTML = html;
  document.getElementById('modalOverlay').classList.add('active');

  // Fetch live country-specific news
  fetchCountryNews(name).then(result => {
    const newsContainer = document.getElementById('countryNewsContent');
    if (newsContainer) {
      if (result && Array.isArray(result) && result.length > 0) {
        newsContainer.innerHTML = result.map(n => `
          <div class="news-item">
            <div class="news-meta">
              <span class="card-cat ${n.category}" style="font-size:7px;padding:1px 4px;">${n.category}</span>
              <span class="news-source">${n.source}</span>
              <span class="news-time">${n.time}</span>
            </div>
            ${renderBiasTag(n.source)}
            <div class="news-headline">${n.headline}</div>
            <a class="news-link" href="${n.url}" target="_blank">Read more â†—</a>
          </div>
        `).join('');
      } else if (result && result.error) {
        newsContainer.innerHTML = `<div style="color:#f59e0b;font-size:11px;">${result.error}</div>`;
      } else {
        newsContainer.innerHTML = '<div style="color:#6b7280;font-size:11px;">No major international news coverage for this country at this time. This typically indicates a period of relative stability.</div>';
      }
    }
  });
}

function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); }
document.getElementById('modalOverlay').addEventListener('click', e => { if (e.target.id === 'modalOverlay') closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeModal(); closeStatPopup(); } });

// Stat popup functions
function showStatPopup(category) {
  const popup = document.getElementById('statPopup');
  const title = document.getElementById('statPopupTitle');
  const content = document.getElementById('statPopupContent');

  let countries = [];
  let titleText = '';
  let titleColor = '#06b6d4';

  if (category === 'critical') {
    countries = Object.entries(COUNTRIES).filter(([_, c]) => c.risk === 'catastrophic' || c.risk === 'extreme');
    titleText = 'CRITICAL COUNTRIES';
    titleColor = '#ef4444';
  } else if (category === 'high') {
    countries = Object.entries(COUNTRIES).filter(([_, c]) => c.risk === 'severe' || c.risk === 'stormy');
    titleText = 'HIGH RISK COUNTRIES';
    titleColor = '#f97316';
  } else if (category === 'stable') {
    countries = Object.entries(COUNTRIES).filter(([_, c]) => c.risk === 'cloudy' || c.risk === 'clear');
    titleText = 'STABLE COUNTRIES';
    titleColor = '#22c55e';
  } else {
    countries = Object.entries(COUNTRIES);
    titleText = 'ALL COUNTRIES';
    titleColor = '#06b6d4';
  }

  // Sort by risk level, then alphabetically within each tier
  countries.sort((a, b) => {
    const order = { catastrophic: 0, extreme: 1, severe: 2, stormy: 3, cloudy: 4, clear: 5 };
    const tierDiff = order[a[1].risk] - order[b[1].risk];
    return tierDiff !== 0 ? tierDiff : a[0].localeCompare(b[0]);
  });

  title.textContent = titleText + ' (' + countries.length + ')';
  title.style.color = titleColor;

  content.innerHTML = countries.map(([name, c]) => `
    <div class="stat-popup-item" onclick="openModal('${name}'); closeStatPopup();">
      <span>${c.flag} ${name}</span>
      <span class="wl-risk risk-${c.risk}">${c.risk.toUpperCase()}</span>
    </div>
  `).join('');

  popup.classList.add('active');
}

function closeStatPopup() {
  document.getElementById('statPopup').classList.remove('active');
}

// Close stat popup when clicking/tapping outside
document.addEventListener('click', (e) => {
  const popup = document.getElementById('statPopup');
  const isStatCard = e.target.closest('.stat-card');
  const isPopup = e.target.closest('.stat-popup');
  if (popup.classList.contains('active') && !isStatCard && !isPopup) {
    closeStatPopup();
  }
});

// Also handle touch for mobile - close popup when tapping outside
document.addEventListener('touchstart', (e) => {
  const popup = document.getElementById('statPopup');
  const isStatCard = e.target.closest('.stat-card');
  const isPopup = e.target.closest('.stat-popup');
  if (popup.classList.contains('active') && !isStatCard && !isPopup) {
    closeStatPopup();
  }
}, { passive: true });

// Make stat cards work with touch on mobile
document.querySelectorAll('.stat-card').forEach(card => {
  card.addEventListener('touchend', (e) => {
    e.preventDefault();
    const onclick = card.getAttribute('onclick');
    if (onclick) {
      eval(onclick);
    }
  });
});

initGlobe();
renderSidebar();
</script>
</body>
</html>

