import{r as h,o as V,p as B,q as Y,s as K,j as e,t as _}from"./index-DKK_HY51.js";const D=[{key:"1D",range:"1d",interval:"5m"},{key:"1W",range:"5d",interval:"1h"},{key:"1M",range:"1mo",interval:"1d"},{key:"1Y",range:"1y",interval:"1wk"}];function q(n){if(n.length<2)return"";if(n.length===2)return`M${n[0].x},${n[0].y}L${n[1].x},${n[1].y}`;let g=`M${n[0].x},${n[0].y}`;for(let l=0;l<n.length-1;l++){const f=n[Math.max(0,l-1)],i=n[l],r=n[l+1],b=n[Math.min(n.length-1,l+2)],c=i.x+(r.x-f.x)/6,y=i.y+(r.y-f.y)/6,m=r.x-(b.x-i.x)/6,j=r.y-(b.y-i.y)/6;g+=`C${c},${y},${m},${j},${r.x},${r.y}`}return g}function Q(n){return Math.abs(n)>=1e4?n.toLocaleString("en-US",{maximumFractionDigits:0}):Math.abs(n)>=100?n.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}):n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function X(n,g){const l=new Date(n*1e3);switch(g){case"1D":return l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});case"1W":return l.toLocaleDateString("en-US",{weekday:"short"});case"1M":return l.toLocaleDateString("en-US",{month:"short",day:"numeric"});case"1Y":return l.toLocaleDateString("en-US",{month:"short",year:"2-digit"});default:return l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}function Z({chartData:n,rangeKey:g}){if(!n||!n.closes||n.closes.length<2)return e.jsx("div",{style:{height:"120px",display:"flex",alignItems:"center",justifyContent:"center",color:"#4b5563",fontSize:"10px"},children:"No chart data available"});const l=400,f=180,i={top:10,right:10,bottom:24,left:52},r=l-i.left-i.right,b=f-i.top-i.bottom,{closes:c,timestamps:y}=n,m=Math.min(...c),j=Math.max(...c),z=(j-m||1)*.06,C=m-z,M=j+z,o=M-C,p=c.map((s,x)=>({x:i.left+x/(c.length-1)*r,y:i.top+(1-(s-C)/o)*b})),W=q(p),L=i.top+b,T=W+`L${p[p.length-1].x},${L}L${p[0].x},${L}Z`,u=c[c.length-1]>=c[0]?"#22c55e":"#ef4444",k=[];for(let s=0;s<=3;s++){const x=i.top+s/3*b,v=M-s/3*o;k.push({y:x,label:Q(v)})}const S=[];if(y&&y.length>=2){const s=Math.min(5,y.length);for(let x=0;x<s;x++){const v=Math.floor(x*(y.length-1)/(s-1));S.push({x:i.left+v/(c.length-1)*r,label:X(y[v],g)})}}return e.jsxs("svg",{viewBox:`0 0 ${l} ${f}`,width:"100%",preserveAspectRatio:"xMidYMid meet",style:{display:"block"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"chartFill",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:u,stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:u,stopOpacity:"0.02"})]})}),k.map((s,x)=>e.jsxs("g",{children:[e.jsx("line",{x1:i.left,y1:s.y,x2:i.left+r,y2:s.y,stroke:"#1f2937",strokeWidth:"0.5"}),e.jsx("text",{x:i.left-5,y:s.y+3,textAnchor:"end",fontSize:"7",fill:"#4b5563",fontFamily:"system-ui, sans-serif",children:s.label})]},x)),e.jsx("path",{d:T,fill:"url(#chartFill)"}),e.jsx("path",{d:W,fill:"none",stroke:u,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("line",{x1:i.left,y1:p[p.length-1].y,x2:i.left+r,y2:p[p.length-1].y,stroke:u,strokeWidth:"0.5",strokeDasharray:"3,3",opacity:"0.4"}),S.map((s,x)=>e.jsx("text",{x:s.x,y:L+14,textAnchor:"middle",fontSize:"7",fill:"#4b5563",fontFamily:"system-ui, sans-serif",children:s.label},x))]})}function ee({country:n,stocksData:g,lastUpdated:l,isOpen:f,onClose:i}){const[r,b]=h.useState(0),[c,y]=h.useState("1W"),[m,j]=h.useState(null),[U,z]=h.useState(!1),[C,M]=h.useState(""),[o,p]=h.useState(null),[W,L]=h.useState(!1),[T,w]=h.useState(null),[u,k]=h.useState(!1),S=h.useCallback(async(t,a)=>{const d=D.find(H=>H.key===a)||D[1];z(!0);const N=await V(t,d.range,d.interval);j(N),z(!1)},[]);if(h.useEffect(()=>{if(!f||!n)return;const t=B.find(d=>d.country===n);if(!t)return;b(0),y("1W"),k(!1),p(null),M(""),w(null),j(null);const a=t.symbols[0]?.sym;a&&S(a,"1W")},[f,n,S]),h.useEffect(()=>{if(!f)return;const t=a=>{a.key==="Escape"&&i()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[f,i]),!f||!n)return null;const s=g?g.find(t=>t.country===n):null;if(!s)return null;const x=B.find(t=>t.country===n),v=_[n],$=Y(n),O=t=>{if(s.indices[t]?.noData)return;b(t),k(!1),p(null),w(null);const a=x?.symbols[t]?.sym;a&&S(a,c)},G=t=>{if(y(t),u&&o)S(o.symbol,t);else{const a=x?.symbols[r]?.sym;a&&S(a,t)}},P=async()=>{const t=C.trim();if(!t)return;L(!0),w(null);const a=D.find(N=>N.key===c)||D[1],d=await V(t.toUpperCase(),a.range,a.interval);if(d&&d.price){const N=d.changePct>=0;p({symbol:d.symbol,name:d.shortName||"",price:K(d.price),change:(N?"+":"")+d.changePct.toFixed(2)+"%",positive:N}),j(d),k(!0)}else w("Ticker not found");L(!1)};let R="",A="",E="",F=!0,I="";if(u&&o)R=o.symbol,A=o.price,E=o.change,F=o.positive,I=o.name;else if(m){R=m.symbol,A=K(m.price);const t=m.changePct;E=(t>=0?"+":"")+t.toFixed(2)+"%",F=t>=0,I=m.shortName||""}else if(s.indices[r]&&!s.indices[r].noData){const t=s.indices[r];R=x?.symbols[r]?.name||t.name,A=t.value,E=t.change,F=t.positive}return e.jsx("div",{className:"modal-overlay active",onClick:t=>{t.target===t.currentTarget&&i()},children:e.jsxs("div",{className:"modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"modal-flag",children:s.flag}),e.jsxs("div",{className:"modal-titles",children:[e.jsxs("div",{className:"modal-title",children:[n," Markets"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",fontSize:"10px",color:$.isOpen?"#22c55e":"#9ca3af",marginTop:"2px"},children:[e.jsx("span",{style:{width:"7px",height:"7px",borderRadius:"50%",display:"inline-block",background:$.isOpen?"#22c55e":"#ef4444",boxShadow:$.isOpen?"0 0 6px #22c55e":"none"}}),"Market ",$.label]})]}),e.jsx("button",{className:"modal-close",onClick:i,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{style:{background:"#08080f",borderRadius:"8px",padding:"12px",marginBottom:"16px",border:"1px solid #1f2937"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:"8px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:"#e5e7eb"},children:R}),I&&e.jsx("span",{style:{fontSize:"9px",color:"#6b7280",marginLeft:"6px"},children:I})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("span",{style:{fontSize:"14px",fontWeight:700,color:"#e5e7eb",fontVariantNumeric:"tabular-nums"},children:A}),e.jsx("span",{style:{fontSize:"11px",fontWeight:600,color:F?"#22c55e":"#ef4444",marginLeft:"8px",fontVariantNumeric:"tabular-nums"},children:E})]})]}),U?e.jsx("div",{style:{height:"130px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"loading-spinner"})}):e.jsx(Z,{chartData:m,rangeKey:c}),e.jsx("div",{style:{display:"flex",gap:"4px",marginTop:"8px",justifyContent:"center"},children:D.map(t=>e.jsx("button",{onClick:()=>G(t.key),style:{padding:"4px 14px",fontSize:"9px",fontWeight:600,background:c===t.key?"#1f2937":"transparent",border:`1px solid ${c===t.key?"#374151":"#1f293766"}`,borderRadius:"4px",color:c===t.key?"#e5e7eb":"#6b7280",cursor:"pointer",transition:"all 0.15s"},children:t.key},t.key))})]}),e.jsxs("div",{className:"stocks-section",children:[e.jsx("div",{className:"stocks-section-title",children:"Market Overview"}),s.indices.map((t,a)=>{if(t.noData)return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 0",borderBottom:"1px solid #1f293744"},children:[e.jsx("span",{style:{color:"#6b7280",fontSize:"11px",flex:1},children:t.name}),e.jsx("span",{style:{color:"#4b5563",fontSize:"10px"},children:"Unavailable"})]},a);const d=!u&&r===a;return e.jsxs("div",{onClick:()=>O(a),style:{display:"flex",alignItems:"center",padding:"6px 4px",borderBottom:"1px solid #1f293744",cursor:"pointer",borderRadius:"4px",background:d?"rgba(34,197,94,0.08)":"transparent",borderLeft:d?"2px solid #22c55e":"2px solid transparent",transition:"all 0.15s"},children:[e.jsx("span",{style:{color:d?"#e5e7eb":"#9ca3af",fontSize:"11px",flex:1,fontWeight:d?600:400},children:t.name}),e.jsx("span",{style:{color:"#e5e7eb",fontSize:"12px",fontWeight:600,textAlign:"right",minWidth:"70px",fontVariantNumeric:"tabular-nums"},children:t.value}),e.jsx("span",{style:{color:t.positive?"#22c55e":"#ef4444",fontSize:"11px",fontWeight:700,textAlign:"right",minWidth:"60px",fontVariantNumeric:"tabular-nums"},children:t.change})]},a)})]}),e.jsxs("div",{style:{marginTop:"16px",marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#9ca3af",fontWeight:600,letterSpacing:"0.5px",textTransform:"uppercase",marginBottom:"6px"},children:"Search Any Ticker"}),e.jsxs("div",{style:{display:"flex",gap:"4px"},children:[e.jsx("input",{type:"text",placeholder:"Ticker (e.g. AAPL, TSLA, MSFT)",value:C,onChange:t=>M(t.target.value.toUpperCase()),onKeyDown:t=>{t.key==="Enter"&&P()},style:{flex:1,padding:"6px 10px",fontSize:"11px",background:"#111827",border:"1px solid #374151",borderRadius:"4px",color:"#e5e7eb",outline:"none"}}),e.jsx("button",{onClick:P,disabled:W,style:{padding:"6px 14px",fontSize:"10px",fontWeight:600,background:"#1f2937",border:"1px solid #374151",borderRadius:"4px",color:"#9ca3af",cursor:"pointer"},children:W?"...":"GO"})]}),T&&e.jsx("div",{style:{fontSize:"10px",color:"#ef4444",marginTop:"4px"},children:T}),o&&e.jsx("div",{style:{marginTop:"8px",padding:"8px 10px",background:u?"rgba(34,197,94,0.08)":"#0d0d14",borderRadius:"6px",border:`1px solid ${u?"#22c55e44":"#1f2937"}`,cursor:"pointer",transition:"all 0.15s"},onClick:()=>{k(!0),S(o.symbol,c)},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",fontWeight:700,color:"#e5e7eb"},children:o.symbol}),o.name&&e.jsx("span",{style:{fontSize:"9px",color:"#6b7280",marginLeft:"6px"},children:o.name})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",fontWeight:700,color:"#e5e7eb",fontVariantNumeric:"tabular-nums"},children:o.price}),e.jsx("span",{style:{fontSize:"10px",fontWeight:600,color:o.positive?"#22c55e":"#ef4444",marginLeft:"6px",fontVariantNumeric:"tabular-nums"},children:o.change})]})]})})]}),v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stocks-section",children:[e.jsx("div",{className:"stocks-section-title",children:"Why It Matters"}),e.jsx("p",{style:{fontSize:"11px",color:"#9ca3af",lineHeight:1.6},children:v.whyMatters})]}),e.jsxs("div",{className:"stocks-section",children:[e.jsx("div",{className:"stocks-section-title",children:"Outlook"}),e.jsx("p",{style:{fontSize:"11px",color:"#9ca3af",lineHeight:1.6},children:v.outlook}),e.jsx("p",{style:{fontSize:"9px",color:"#6b7280",marginTop:"8px",fontStyle:"italic"},children:"Not financial advice. Data may be delayed up to 15 minutes."})]})]}):e.jsx("div",{style:{fontSize:"9px",color:"#6b7280",padding:"8px 0",fontStyle:"italic"},children:"Data may be delayed up to 15 minutes. Not financial advice."}),e.jsxs("div",{style:{fontSize:"8px",color:"#374151",textAlign:"right",marginTop:"8px"},children:["Last updated: ",l?l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"N/A"]})]})]})})}export{ee as default};
