(function(){"use strict";const R=[{time:"1h ago",category:"CONFLICT",importance:"high",headline:"Heavy fighting reported in eastern Ukraine as winter operations intensify",source:"Reuters",url:"#"},{time:"2h ago",category:"SECURITY",importance:"high",headline:"North Korea conducts ballistic missile test over Sea of Japan",source:"AP News",url:"#"},{time:"3h ago",category:"TECH",importance:"medium",headline:"US expands AI chip export restrictions to additional countries",source:"WSJ",url:"#"},{time:"4h ago",category:"ECONOMY",importance:"high",headline:"China signals major stimulus package amid property sector concerns",source:"Financial Times",url:"#"},{time:"5h ago",category:"POLITICS",importance:"medium",headline:"European leaders discuss expanded Ukraine military support",source:"BBC",url:"#"},{time:"6h ago",category:"SECURITY",importance:"medium",headline:"NATO allies agree to increase defense spending targets",source:"Fox News",url:"#"},{time:"8h ago",category:"CRISIS",importance:"high",headline:"Humanitarian agencies warn of famine conditions in Sudan",source:"UN News",url:"#"},{time:"10h ago",category:"DIPLOMACY",importance:"medium",headline:"UN Security Council holds emergency session on Middle East crisis",source:"Al Jazeera",url:"#"},{time:"12h ago",category:"ECONOMY",importance:"medium",headline:"Oil prices surge on Middle East supply concerns",source:"Washington Times",url:"#"},{time:"14h ago",category:"SECURITY",importance:"medium",headline:"Taiwan reports increased Chinese military activity near strait",source:"Nikkei Asia",url:"#"},{time:"15h ago",category:"POLITICS",importance:"medium",headline:"Venezuela opposition rejects latest government dialogue offer",source:"Reuters",url:"#"},{time:"16h ago",category:"CONFLICT",importance:"high",headline:"Gaza ceasefire negotiations continue amid escalating violence",source:"New York Post",url:"#"},{time:"18h ago",category:"CLIMATE",importance:"medium",headline:"Record temperatures recorded across Southeast Asia amid drought",source:"The Guardian",url:"#"},{time:"20h ago",category:"POLITICS",importance:"medium",headline:"South Korea opposition party gains momentum ahead of elections",source:"Korea Times",url:"#"},{time:"22h ago",category:"ECONOMY",importance:"medium",headline:"Federal Reserve signals cautious approach to rate cuts in 2026",source:"Bloomberg",url:"#"},{time:"1d ago",category:"SECURITY",importance:"high",headline:"Iran accelerates uranium enrichment, IAEA reports",source:"Reuters",url:"#"},{time:"1d ago",category:"DIPLOMACY",importance:"medium",headline:"India-Pakistan tensions rise over water sharing dispute",source:"The Hindu",url:"#"},{time:"1d ago",category:"CRISIS",importance:"high",headline:"Myanmar military launches major offensive against resistance forces",source:"BBC",url:"#"},{time:"1d ago",category:"ECONOMY",importance:"medium",headline:"Global shipping costs spike amid Red Sea disruptions",source:"Financial Times",url:"#"},{time:"1d ago",category:"WORLD",importance:"medium",headline:"Ethiopian government and Tigray rebels resume peace talks",source:"France 24",url:"#"},{time:"2d ago",category:"TECH",importance:"medium",headline:"EU announces new regulations for artificial intelligence systems",source:"DW News",url:"#"},{time:"2d ago",category:"CONFLICT",importance:"high",headline:"Fighting intensifies in eastern DRC as M23 advances",source:"Reuters",url:"#"},{time:"2d ago",category:"ECONOMY",importance:"medium",headline:"Japan intervenes to stabilize yen after sharp decline",source:"Nikkei Asia",url:"#"},{time:"2d ago",category:"POLITICS",importance:"medium",headline:"Brazilian congress passes controversial environmental reform",source:"Reuters",url:"#"},{time:"2d ago",category:"CRISIS",importance:"high",headline:"Haiti gang violence forces closure of main hospital",source:"AP News",url:"#"}];[...R];const H=["sports","football","soccer","basketball","baseball","hockey","tennis","golf","cricket","rugby","boxing","mma","ufc","wrestling","volleyball","swimming","marathon","triathlon","nfl","nba","mlb","nhl","mls","epl","la liga","serie a","bundesliga","ligue 1","premier league","champions league","world series","playoff","playoffs","touchdown","super bowl","world cup goal","hat trick","slam dunk","home run","grand slam","figure skating","ice skating","formula 1","f1 race","nascar","grand prix","knicks","lakers","celtics","warriors","yankees","dodgers","cowboys","patriots","manchester united","real madrid","barcelona fc","man city","olympian","olympic medal","olympic athlete","gold medalist","silver medalist","celebrity","entertainment","movie","film review","box office","blockbuster","music","concert","album","grammy","oscar","emmy","golden globe","netflix","streaming","hulu","disney+","hbo max","prime video","tv show","reality tv","american idol","bachelor","bachelorette","survivor","kardashian","influencer","tiktok star","instagram","viral video","went viral","red carpet","paparazzi","tabloid","gossip","scandal","actor dies","actor dead","actor passes","actress dies","actress dead","actress passes","star dies","star dead","star passes","celebrity death","celebrity dies","als battle","als diagnosis","tv star dies","tv star dead","film star dies","hollywood star","sitcom","soap opera","game show","talent show","grey's anatomy","eric dane","mcsteamy","euphoria","emmy winner dies","oscar winner dies","grammy winner dies","beloved actor","beloved actress","remembered for","tributes pour","recipe","cooking","fashion","beauty","lifestyle","horoscope","zodiac","dating","relationship advice","wedding","divorce","weight loss","diet","fitness","workout","yoga","skincare","makeup","hairstyle","lottery","powerball","mega millions","jackpot","casino","stock picks","buy now","shares up","otcmkts","penny stock","crypto pump","fans react","fans are","fans say","fans think","fan base","best dressed","worst dressed","who wore it","style guide","feel-good","heartwarming","uplifting","adorable","cute video","good samaritan","random act of kindness","local hero","community hero","odd news","weird news","quirky","bizarre video","caught on camera","puppy","kitten","rescue dog","rescue cat","pet owner","slipped into","fell into a","falls into","arrested for","charged with","sentenced to","mugshot","car crash","traffic accident","house fire","apartment fire","missing person","amber alert","silver alert","weather forecast","pollen count","snow day","beach advisory","best deals","black friday","prime day","coupon","clearance sale","product review","buyer's guide","top picks","gift guide","slams","slammed","claps back","destroyed by","owned by","stumped by","shocked after","shocked by","stunned by","rips into","torches","blasts","fifth-grade","goes viral","epic response","mic drop","walk of shame","gop lawmaker","dem lawmaker","liberal tears","conservative meltdown","twitter feud","social media feud","online backlash","cancel culture","hot take","opinion:","op-ed:","column:","commentary:","dear abby","ask amy","advice column","agony aunt","dear ann","miss manners","carolyn hax","dan savage","relationship expert","you won't believe","jaw-dropping","mind-blowing","insane video","shocking photo","unbelievable","craziest","wildest","side hustle","passive income","work from home","make money fast","zodiac sign","spirit animal","personality test","iq test","mugshot","florida man","karen","entitled","neighbor from hell","baby name","gender reveal","wedding disaster","bridezilla","food hack","life hack","cleaning hack","ikea hack","ranked worst","ranked best","top 10","listicle","royal family","meghan markle","prince harry","kate middleton","quarterback","rushing yards","fantasy football","draft pick","free agent","batting average","wide receiver","tight end","linebacker","cornerback","running back","transfer window","injury report","jaxson dart","callahan traits","philanthropic","philanthropy","donate his fortune","charitable foundation","cookbook","fashion week","baby bump","engagement ring","album review","movie review","netflix series","red lobster","restaurant closing","shuttering","sewage spill","megyn kelly","randy fine","streamer","coach denies","college offer","mistrial","antifa protest","t-shirt","frontbench team","warns over dissent","full bigot","colbert","kimmel","fallon","hannity","maddow","carlson","tucker","megyn kelly","joe rogan","bill maher","john oliver","late night","talk show","late show","tonight show","spiked interview","body camera","body cam","fcc","school board","zoning","parking ticket","HOA","city council","school district","murder trial","manslaughter","on trial for","climber","hit and run","drunk driving","dui","shoplifting","woke","anti-woke","dei","faith and flag","prayer in school","drag queen","book ban","critical race","funding fight","filibuster","committee hearing","oversight hearing","subpoena","contempt of congress","floor vote","winter olympics","summer olympics","olympics","olympic games","runaway dog","cross country race","hu-ski","interrupting","interrupts","ufo","ufos","alien","aliens","extraterrestrial","ufo files","ufo hearing","nvidia","openai deal","stranded women","stranded woman","unidentified aerial","flying saucer","roswell","chicago bears","stadium relocation","extorting crypto","cryptocurrency extortion","lifeline medic","county governor","epstein files","superstar singer","death threats and fans","prince andrew","king charles brother","police extorting","crypto scam","crypto fraud","county board","suspends board","city manager","township","local election","school superintendent","fire chief","caught between","caught on tape","leaked video","leaked photo","plastic surgery","weight gain","weight loss journey","leukemia","leukaemia","cancer battle","cancer diagnosis","klatham party","ballot barcodes","chinatown beating","palm oil","royal arrest","slavery exhibit","independence mall","crypto extortion","bitcoin scam","bitcoin fraud","stadium deal","sports arena","arena funding","dog show","cat show","spelling bee","hot dog eating","beauty pageant","miss universe","miss america"],W=["war","military operation","military strike","military force","military base","military deployment","military aid","military buildup","troops","missile","nuclear","invasion","ceasefire","airstrike","drone strike","ballistic","warhead","enrichment","proliferation","chemical weapons","biological weapons","arms deal","defense spending","proxy war","airspace","naval","strait","blockade","embargo","uranium","centrifuge","intercontinental","tactical nuclear","iron dome","cold war","insurgent","militia","separatist","regime","coup","junta","idf","houthi","hezbollah","wagner","hamas","taliban","isis","sanctions","nato","united nations","treaty","diplomatic","summit","bilateral","multilateral","alliance","geopolit","sovereignty","territorial","annexation","occupation","liberation","peacekeeping","deterrence","escalation","provocation","espionage","cyber attack","election interference","pentagon","kremlin","beijing","tehran","pyongyang","european union","african union","g7","g20","iaea","opec","world bank","imf","brics","asean","south china sea","taiwan strait","strait of hormuz","gaza","donbas","crimea","humanitarian crisis","refugee crisis","famine","genocide","ethnic cleansing","war crime","displacement","siege","trade war","tariff","debt crisis","oil price","energy crisis","gas pipeline","supply chain","rare earth","food security","civil war","independence","disinformation","propaganda","hypersonic","submarine","aircraft carrier","chip export","tech ban"],G=["nuclear","missile","genocide","ceasefire","sanctions","nato","invasion","airstrike","drone strike","chemical weapons","biological weapons","war crime","ethnic cleansing","ballistic","warhead","famine","coup","siege","proxy war","tactical nuclear","uranium","enrichment","hamas","hezbollah","houthi","wagner","taliban","isis","idf","south china sea","taiwan strait","strait of hormuz","gaza","donbas","crimea"],z=[/\b(colbert|kimmel|fallon|hannity|maddow|carlson|tucker)\b.*\b(republican|democrat|gop|dnc|congress)\b/i,/\b(republican|democrat|gop|dnc)\b.*\b(colbert|kimmel|fallon|hannity|maddow|carlson|tucker)\b/i,/\b(cbs|nbc|abc|fox news|msnbc|cnn)\b.*\b(spiked|ratings|anchor|host|segment)\b/i,/\b(spiked|ratings|anchor|host|segment)\b.*\b(cbs|nbc|abc|fox news|msnbc|cnn)\b/i,/\b(body cam|bodycam|body camera)\b.*\b(congress|dhs|police|officer)\b/i,/\b(congress|dhs)\b.*\b(body cam|bodycam|body camera)\b/i,/\b(olympic)\b.*\b(culture|woke|spectacle|controversy|boycott)\b/i,/\b(school board|zoning|parking|HOA)\b.*\b(vote|meeting|decision|ruling)\b/i],x={Afghanistan:["afghan","kabul","taliban"],Albania:["albanian","tirana"],Algeria:["algerian","algiers"],Andorra:["andorran"],Angola:["angolan","luanda"],"Antigua and Barbuda":["antiguan","barbudan"],Argentina:["argentine","argentinian","buenos aires"],Armenia:["armenian","yerevan"],Australia:["australian","canberra","sydney","melbourne"],Austria:["austrian","vienna"],Azerbaijan:["azerbaijani","baku"],Bahamas:["bahamian","nassau"],Bahrain:["bahraini","manama"],Bangladesh:["bangladeshi","dhaka"],Barbados:["barbadian","bridgetown"],Belarus:["belarusian","minsk","lukashenko"],Belgium:["belgian","brussels"],Benin:["beninese","porto-novo","cotonou"],Bhutan:["bhutanese","thimphu"],Bolivia:["bolivian","la paz"],"Bosnia and Herzegovina":["bosnian","sarajevo"],Botswana:["motswana","botswanan","gaborone"],Brazil:["brazilian","brasilia","rio","sao paulo","lula"],Brunei:["bruneian","bandar seri begawan"],Bulgaria:["bulgarian","sofia"],"Burkina Faso":["burkinabe","ouagadougou"],Burundi:["burundian","bujumbura","gitega"],Cambodia:["cambodian","phnom penh"],Cameroon:["cameroonian","yaounde"],Canada:["canadian","ottawa","toronto","trudeau"],"Cape Verde":["cape verdean","praia"],"Central African Republic":["central african","bangui"],Chad:["chadian","n'djamena"],Chile:["chilean","santiago"],China:["chinese","beijing","xi jinping","ccp","prc"],Colombia:["colombian","bogota"],Comoros:["comorian","moroni"],"Democratic Republic of Congo":["congolese","kinshasa","drc"],"Republic of Congo":["congo-brazzaville","brazzaville"],"Costa Rica":["costa rican","san jose"],Croatia:["croatian","zagreb"],Cuba:["cuban","havana"],Cyprus:["cypriot","nicosia"],"Czech Republic":["czech","prague"],Denmark:["danish","copenhagen"],Greenland:["greenlandic","nuuk","inuit"],Djibouti:["djiboutian"],Dominica:["dominican"],"Dominican Republic":["dominican republic","santo domingo"],Ecuador:["ecuadorian","quito"],Egypt:["egyptian","cairo","sisi"],"El Salvador":["salvadoran","san salvador","bukele"],"Equatorial Guinea":["equatoguinean","malabo"],Eritrea:["eritrean","asmara"],Estonia:["estonian","tallinn"],Eswatini:["swazi","mbabane"],Ethiopia:["ethiopian","addis ababa"],Fiji:["fijian","suva"],Finland:["finnish","helsinki"],France:["french","paris","macron","élysée"],Gabon:["gabonese","libreville"],Gambia:["gambian","banjul"],Georgia:["georgian","tbilisi"],Germany:["german","berlin","scholz","bundestag"],Ghana:["ghanaian","accra"],Greece:["greek","athens"],Grenada:["grenadian"],Guatemala:["guatemalan"],Guinea:["guinean","conakry"],"Guinea-Bissau":["bissau-guinean","bissau"],Guyana:["guyanese","georgetown"],Haiti:["haitian","port-au-prince"],Honduras:["honduran","tegucigalpa"],Hungary:["hungarian","budapest","orban"],Iceland:["icelandic","reykjavik"],India:["indian","delhi","mumbai","modi","bjp"],Indonesia:["indonesian","jakarta","jokowi"],Iran:["iranian","tehran","ayatollah","khamenei"],Iraq:["iraqi","baghdad","kurdish"],Ireland:["irish","dublin"],Israel:["israeli","tel aviv","jerusalem","netanyahu","idf"],Italy:["italian","rome","meloni"],"Ivory Coast":["ivorian","abidjan","yamoussoukro"],Jamaica:["jamaican","kingston"],Japan:["japanese","tokyo","kishida"],Jordan:["jordanian","amman"],Kazakhstan:["kazakh","astana","almaty"],Kenya:["kenyan","nairobi"],Kiribati:["i-kiribati","tarawa"],Kosovo:["kosovar","pristina"],Kuwait:["kuwaiti","kuwait city"],Kyrgyzstan:["kyrgyz","bishkek"],Laos:["laotian","vientiane"],Latvia:["latvian","riga"],Lebanon:["lebanese","beirut","hezbollah"],Lesotho:["basotho","maseru"],Liberia:["liberian","monrovia"],Libya:["libyan","tripoli"],Liechtenstein:["liechtensteiner","vaduz"],Lithuania:["lithuanian","vilnius"],Luxembourg:["luxembourgish","luxembourger"],Madagascar:["malagasy","antananarivo"],Malawi:["malawian","lilongwe"],Malaysia:["malaysian","kuala lumpur"],Maldives:["maldivian","male"],Mali:["malian","bamako"],Malta:["maltese","valletta"],"Marshall Islands":["marshallese","majuro"],Mauritania:["mauritanian","nouakchott"],Mauritius:["mauritian","port louis"],Mexico:["mexican","mexico city"],Micronesia:["micronesian","palikir"],Moldova:["moldovan","chisinau"],Monaco:["monegasque","monte carlo"],Mongolia:["mongolian","ulaanbaatar"],Montenegro:["montenegrin","podgorica"],Morocco:["moroccan","rabat","casablanca"],Mozambique:["mozambican","maputo"],Myanmar:["burmese","myanmar","yangon","junta"],Namibia:["namibian","windhoek"],Nauru:["nauruan"],Nepal:["nepali","nepalese","kathmandu"],Netherlands:["dutch","amsterdam","the hague"],"New Zealand":["new zealand","kiwi","wellington"],Nicaragua:["nicaraguan","managua","ortega"],Niger:["nigerien","niamey"],Nigeria:["nigerian","lagos","abuja"],"North Korea":["north korean","pyongyang","kim jong","dprk"],"North Macedonia":["macedonian","skopje"],Norway:["norwegian","oslo"],Oman:["omani","muscat"],Pakistan:["pakistani","islamabad","karachi"],Palau:["palauan","ngerulmud"],Palestine:["gaza","palestinian","west bank","ramallah","hamas","fatah","pa ","palestinian authority"],Panama:["panamanian","panama city"],"Papua New Guinea":["papua new guinean","port moresby"],Paraguay:["paraguayan","asuncion"],Peru:["peruvian","lima"],Philippines:["filipino","philippine","manila","marcos"],Poland:["polish","warsaw"],Portugal:["portuguese","lisbon"],Qatar:["qatari","doha"],Romania:["romanian","bucharest"],Russia:["russian","moscow","kremlin","putin"],Rwanda:["rwandan","kigali"],"Saint Kitts and Nevis":["kittitian","nevisian","basseterre"],"Saint Lucia":["saint lucian","castries"],"Saint Vincent and the Grenadines":["vincentian"],Samoa:["samoan","apia"],"San Marino":["sammarinese"],"Sao Tome and Principe":["santomean"],"Saudi Arabia":["saudi","riyadh","mbs"],Senegal:["senegalese","dakar"],Serbia:["serbian","belgrade"],Seychelles:["seychellois","victoria"],"Sierra Leone":["sierra leonean","freetown"],Singapore:["singaporean"],Slovakia:["slovak","bratislava"],Slovenia:["slovenian","ljubljana"],"Solomon Islands":["solomon islander","honiara"],Somalia:["somali","mogadishu"],"South Africa":["south african","johannesburg","pretoria","cape town"],"South Korea":["south korean","seoul","korean"],"South Sudan":["south sudanese","juba"],Spain:["spanish","madrid","barcelona"],"Sri Lanka":["sri lankan","colombo"],Sudan:["sudanese","khartoum"],Suriname:["surinamese","paramaribo"],Sweden:["swedish","stockholm"],Switzerland:["swiss","bern","zurich","geneva"],Syria:["syrian","damascus","assad"],Taiwan:["taiwanese","taipei"],Tajikistan:["tajik","dushanbe"],Tanzania:["tanzanian","dodoma","dar es salaam"],Thailand:["thai","bangkok"],"Timor-Leste":["timorese","east timor","dili"],Togo:["togolese","lome"],Tonga:["tongan","nuku'alofa"],"Trinidad and Tobago":["trinidadian","tobagonian","port of spain"],Tunisia:["tunisian","tunis"],Turkey:["turkish","ankara","istanbul","erdogan"],Turkmenistan:["turkmen","ashgabat"],Tuvalu:["tuvaluan","funafuti"],Uganda:["ugandan","kampala"],Ukraine:["ukrainian","kyiv","zelensky"],"United Arab Emirates":["emirati","uae","dubai","abu dhabi"],"United Kingdom":["british","uk","britain","london","parliament","westminster"],"United States":["u.s.","american","washington","biden","trump","congress","white house","pentagon"],Uruguay:["uruguayan","montevideo"],Uzbekistan:["uzbek","tashkent"],Vanuatu:["ni-vanuatu","port vila"],Venezuela:["venezuelan","caracas","rodriguez","maduro"],Vietnam:["vietnamese","hanoi","ho chi minh"],Yemen:["yemeni","sanaa","houthi"],Zambia:["zambian","lusaka"],Zimbabwe:["zimbabwean","harare"]};function I(e){if(!e)return"";let a=e.trim();return a=a.replace(/\s*[\u2014\u2013\u2015\u00AD—–|]\s*[A-Z][\w\s.&'\u2019,]{0,25}$/,""),a=a.replace(/\s+-\s+[A-Z][\w.&'\u2019]{0,15}(?:\s+[A-Z][\w.&'\u2019]+){0,3}\s*$/,""),a=a.replace(/\s*:\s+[A-Z][\w.&'\u2019]{0,15}(?:\s+[A-Z][\w.&'\u2019]+){0,2}\s*$/,""),a=a.replace(/^(BREAKING|EXCLUSIVE|DEVELOPING|JUST IN|WATCH|UPDATE|OPINION|ANALYSIS|EDITORIAL|LIVE)\s*[:\-–—|]\s*/i,""),a=a.replace(/[\s|—–\-:]+$/,"").trim(),a}const B=new Set(["united states","united kingdom","china","russia"]),S=new Set(["united states","u.s.","american","washington","trump","biden","white house","congress","pentagon","state department","united kingdom","british","uk","britain","london","china","chinese","beijing","russia","russian","moscow","kremlin","putin","un","parliament","white house"]),Y=["nuclear","military","war","peace","trade","sanctions","election","protest","economy","climate","summit","ceasefire","genocide","humanitarian","missile","troops","invasion","airstrike","bombing","reconstruction","occupation","territorial","coup","hostage","refugee","famine","weapons","enrichment","blockade","drone","assassination","espionage","cyber","treaty","alliance","diplomatic","tariff","embargo","deployment"];function K(e){const a=e.toLowerCase(),n=new Set;for(const i of Y)a.includes(i)&&n.add(i);return n}function q(e,a){let n=0;for(const i of e)a.has(i)&&n++;return n}const $={gaza:"palestine","west bank":"palestine",rafah:"palestine","khan younis":"palestine","golan heights":"israel",golan:"israel",negev:"israel",galilee:"israel",donbas:"ukraine",donetsk:"ukraine",luhansk:"ukraine",crimea:"ukraine",zaporizhzhia:"ukraine",kherson:"ukraine",mariupol:"ukraine",bakhmut:"ukraine",avdiivka:"ukraine",kharkiv:"ukraine",odesa:"ukraine",darfur:"sudan",khartoum:"sudan",tigray:"ethiopia",amhara:"ethiopia",xinjiang:"china",tibet:"china","hong kong":"china",kashmir:"india",aleppo:"syria",idlib:"syria",raqqa:"syria",mosul:"iraq",kirkuk:"iraq",sinai:"egypt",kabul:"afghanistan",kandahar:"afghanistan",helmand:"afghanistan",pyongyang:"north korea",dmz:"north korea","strait of hormuz":"iran",hormuz:"iran","taiwan strait":"taiwan",kurdistan:"iraq",kurdish:"iraq","suez canal":"egypt","board of peace":"palestine"},J=new Set(["the","a","an","in","on","at","to","for","of","and","or","but","is","are","was","were","has","have","had","be","been","with","by","from","as","its","it","this","that","over","after","new","says","said","could","may","will","not","no","more","than","about","up","out","into","amid","what","how","why","who","all","also","his","her","their","does","do","just","now","being","most","some","trump","says","news","report","world","global","international"]);function V(e){return new Set(e.toLowerCase().split(/\W+/).filter(a=>a.length>2&&!J.has(a)))}function Z(e,a){if(e.size===0||a.size===0)return 0;let n=0;for(const i of e)a.has(i)&&n++;return n/Math.min(e.size,a.size)}let C=null;function _(){if(C)return C;C=[];for(const[e,a]of Object.entries(x)){const n=e.toLowerCase();C.push({name:n,terms:[n,...a]})}return C}function X(e){const a=(e||"").toLowerCase();if(!a)return null;for(const[i,t]of Object.entries($))if(a.includes(i)&&!S.has(t))return t;const n=_();for(const{name:i,terms:t}of n)if(!S.has(i)){for(const r of t)if(!S.has(r)){if(r.length<=3){if(new RegExp("\\b"+r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\b").test(a))return i}else if(a.includes(r))return i}}for(const[i]of Object.entries(x)){const t=i.toLowerCase();if(!B.has(t))continue;const r=x[i];for(const l of[t,...r])if(a.includes(l))return"_stop_"+t}return null}function Q(e){const a=e.toLowerCase(),n=new Set,i=_();for(const{name:t,terms:r}of i)for(const l of r)if(a.includes(l)){n.add(t);break}return n}const ee={reuters:10,ap:10,"ap news":10,"associated press":10,bbc:9,"bbc world":9,"bbc news":9,"wall street journal":8,wsj:8,"new york times":8,nyt:8,"financial times":8,ft:8,"the guardian":7,guardian:7,"al jazeera":7,bloomberg:7,"the economist":7,"washington post":7,"foreign policy":7,"france 24":6,france24:6,"deutsche welle":6,dw:6,"south china morning post":6,scmp:6,politico:6,"nhk world":6,nhk:6,"kyodo news":6,kyodo:6,yonhap:6,"anadolu agency":5,cgtn:5,tass:5,"times of india":5,"the hill":5,"fox news":5,rt:4,xinhua:4,"mehr news":4,"the telegraph":6,telegraph:6,"cbc news":6,cbc:6,"abc australia":6,"irish times":6,"the hindu":5,haaretz:6,"times of israel":5,"nikkei asia":6,nikkei:6,"straits times":6,cna:6,"jakarta post":5,"the jakarta post":5,"africa news":5,africanews:5,"nation kenya":4,"daily nation":4,"the independent":5,independent:5,"globe and mail":5,"sydney morning herald":5,smh:5,dawn:5,"middle east eye":5,folha:5,"taipei times":4,"korea herald":5,"the national":4,"vietnam news":3,rappler:4,"buenos aires herald":3,"premium times":4,"mail & guardian":4,tempo:3,"daily star":3,"daily mail":3,"new york post":3,"ny post":3};function T(e){if(!e)return 1;const a=e.toLowerCase();for(const[n,i]of Object.entries(ee))if(a.includes(n))return i;return 4}const ae=["military","nuclear","invasion","missile","troops","airstrikes","airstrike","bombing","war crime","genocide","ethnic cleansing","weapons","arsenal","enrichment","warhead","siege","blockade","offensive"],ne=["ceasefire","peace","peace talks","sanctions","territorial","coup","escalat","buildup","hostage","humanitarian crisis","reconstruction","occupation"];function ie(e){const a=((e.headline||"")+" "+(e.articles||[]).map(n=>n.headline||"").join(" ")).toLowerCase();return ae.some(n=>a.includes(n))?1:ne.some(n=>a.includes(n))?2:3}function P(e){const n=(4-ie(e))*5,i=Math.min(e.sourceCount,40)*3,t=e.importance==="high"?5:0;return n+i+t}const E=40;function v(){return typeof requestAnimationFrame!="function"?Promise.resolve():new Promise(e=>requestAnimationFrame(e))}async function te(e){if(!e||e.length===0)return[];const a=[];for(let o=0;o<e.length;o++){const s=e[o],u=s.headline||s.title||"",w=u+" "+(s.description||"");a.push({...s,_idx:o,_headline:u,_headlineWords:V(u),_primaryCountry:X(u),_topics:K(w),_allCountries:Q(w)}),o>0&&o%20===0&&await v()}const n=new Map,i=new Map,t=[];for(let o=0;o<a.length;o++){const s=a[o]._primaryCountry;if(!s)t.push(o);else if(s.startsWith("_stop_")){const u=s.replace("_stop_","");i.has(u)||i.set(u,[]),i.get(u).push(o)}else n.has(s)||n.set(s,[]),n.get(s).push(o)}const r=[];await v();for(const[o,s]of n.entries())if(s.length<=E)r.push(s);else{const u=j(a,s);for(const w of u)r.push(w)}await v();for(const[o,s]of i.entries()){const u=j(a,s);for(const w of u)r.push(w)}if(t.length>0){const o=re(a,t,.4);for(const s of o)r.push(s)}await v();const l=r.map(o=>se(a,o)),c=oe(l);c.sort((o,s)=>s._score-o._score);for(const o of c)delete o._score;const g=c.filter(o=>o.sourceCount>1).length,f=c.filter(o=>o.sourceCount===1).length,k=c.reduce((o,s)=>Math.max(o,s.sourceCount),0),b=c.length>0?(e.length/c.length).toFixed(1):0;console.log(`[Hegemon] Clustering: ${e.length} articles → ${c.length} events (${g} multi-source, ${f} single, avg ${b} src/evt, max ${k})`);const y={};for(const o of c){const s=o.sourceCount;y[s]=(y[s]||0)+1}return console.log("[Hegemon] Distribution:",Object.entries(y).sort(([o],[s])=>Number(o)-Number(s)).map(([o,s])=>`${o}src:${s}`).join(", ")),c.slice(0,8).forEach(o=>console.log(`  [${o.sourceCount} src] [${o.category}] ${o.headline}`)),c}function j(e,a){const n=[],i=[...a].sort((t,r)=>T(e[r].source)-T(e[t].source));for(const t of i){const r=e[t];let l=!1;for(const c of n)if(!(c.members.length>=E)&&q(r._topics,c.topics)>=1){c.members.push(t);for(const g of r._topics)c.topics.add(g);l=!0;break}l||n.push({topics:new Set(r._topics),members:[t]})}return n.map(t=>t.members)}function re(e,a,n){const i=[];for(const t of a){const r=e[t];let l=!1;for(const c of i){if(c.members.length>=E)continue;if(Z(r._headlineWords,c.seedWords)>=n){c.members.push(t),l=!0;break}}l||i.push({seedWords:r._headlineWords,members:[t]})}return i.map(t=>t.members)}function se(e,a){const n=a.map(s=>e[s]),i=[...n].sort((s,u)=>T(u.source)-T(s.source)),t=i.slice(0,Math.min(3,i.length)),r=t.reduce((s,u)=>{const w=(u._headline||"").trim(),L=(s._headline||"").trim();return w.length>0&&w.length<L.length?u:s},t[0]),l=new Set;for(const s of n)for(const u of s._allCountries)S.has(u)||l.add(u);const c={};for(const s of n){const u=s._primaryCountry;u&&!u.startsWith("_stop_")&&(c[u]=(c[u]||0)+1)}const g=Object.entries(c).sort((s,u)=>u[1]-s[1])[0]?.[0]||null,f={};for(const s of n){const u=s.category||"WORLD";f[u]=(f[u]||0)+1}const k=Object.entries(f).sort((s,u)=>u[1]-s[1])[0][0],b=n.some(s=>s.importance==="high")||["CONFLICT","CRISIS","SECURITY"].includes(k)?"high":"medium",y=n.map(s=>{const{_idx:u,_headline:w,_headlineWords:L,_primaryCountry:d,_allCountries:h,_topics:p,...m}=s;return m.headline&&(m.headline=I(m.headline)),m.title&&(m.title=I(m.title)),m}),o={id:`evt-${r._idx}`,headline:I(r._headline||""),category:k,importance:b,sourceCount:n.length,time:r.time||n[0].time,articles:y,entities:[...l],_primaryCountry:g,summary:null,summaryLoading:!1,summaryError:!1};return o._score=P(o),o}function oe(e){const a=new Map,n=[],i=new Set;for(let t=0;t<e.length;t++){const r=e[t]._primaryCountry;r&&!B.has(r)&&(a.has(r)||a.set(r,[]),a.get(r).push(t))}for(const[t,r]of a.entries()){if(r.length<=1)continue;r.sort((c,g)=>e[g]._score-e[c]._score);const l=e[r[0]];for(let c=1;c<r.length;c++){const g=e[r[c]];l.articles.push(...g.articles);for(const f of g.entities)l.entities.includes(f)||l.entities.push(f);i.add(r[c])}l.sourceCount=l.articles.length,l._score=P(l),console.log(`[Hegemon] Merged ${r.length} ${t} events → ${l.sourceCount} sources`)}for(let t=0;t<e.length;t++)i.has(t)||n.push(e[t]);return n}const le="https://hegemon-rss-proxy.hegemonglobal.workers.dev",ce={daily:[{url:"https://news.google.com/rss/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRGx1YlY4U0FtVnVHZ0pWVXlnQVAB?hl=en-US&gl=US&ceid=US:en",source:"Google News World"},{url:"https://news.google.com/rss/search?q=world+news+today&hl=en-US&gl=US&ceid=US:en",source:"Google News"},{url:"https://feeds.bbci.co.uk/news/world/rss.xml",source:"BBC World"},{url:"https://feeds.a.dj.com/rss/RSSWorldNews.xml",source:"Wall Street Journal"},{url:"https://rss.nytimes.com/services/xml/rss/nyt/World.xml",source:"New York Times"},{url:"https://news.google.com/rss/search?q=site:reuters.com+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Reuters"},{url:"https://news.google.com/rss/search?q=site:apnews.com+when:1d&hl=en-US&gl=US&ceid=US:en",source:"AP News"},{url:"https://www.politico.com/rss/politico-world-news.xml",source:"Politico"},{url:"https://www.economist.com/international/rss.xml",source:"The Economist"},{url:"https://foreignpolicy.com/feed/",source:"Foreign Policy"},{url:"https://feeds.bloomberg.com/politics/news.rss",source:"Bloomberg"},{url:"https://moxie.foxnews.com/google-publisher/world.xml",source:"Fox News"},{url:"https://www.theguardian.com/world/rss",source:"The Guardian"},{url:"https://www.dailymail.co.uk/news/worldnews/index.rss",source:"Daily Mail"},{url:"https://nypost.com/feed/",source:"New York Post"},{url:"https://thehill.com/feed/",source:"The Hill"},{url:"https://www.washingtontimes.com/rss/headlines/news/world/",source:"Washington Times"},{url:"https://news.google.com/rss/search?q=site:telegraph.co.uk+when:1d&hl=en-US&gl=US&ceid=US:en",source:"The Telegraph"},{url:"https://www.ft.com/rss/home",source:"Financial Times"},{url:"https://www.cbc.ca/webfeed/rss/rss-world",source:"CBC News"},{url:"https://www.abc.net.au/news/feed/2942460/rss.xml",source:"ABC Australia"},{url:"https://www.irishtimes.com/cmlink/news-1.1319192",source:"Irish Times"},{url:"https://www.aljazeera.com/xml/rss/all.xml",source:"Al Jazeera"},{url:"https://www3.nhk.or.jp/rss/news/cat0.xml",source:"NHK World"},{url:"https://en.yna.co.kr/RSS/news.xml",source:"Yonhap"},{url:"http://www.news.cn/english/rss/worldrss.xml",source:"Xinhua"},{url:"https://www.rt.com/rss/news/",source:"RT"},{url:"https://www.france24.com/en/rss",source:"France 24"},{url:"https://rss.dw.com/rdf/rss-en-world",source:"Deutsche Welle"},{url:"https://www.aa.com.tr/en/rss/default?cat=world",source:"Anadolu Agency"},{url:"https://news.google.com/rss/search?q=site:english.kyodonews.net+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Kyodo News"},{url:"https://en.mehrnews.com/rss",source:"Mehr News"},{url:"https://www.cgtn.com/subscribe/rss/section/world.xml",source:"CGTN"},{url:"https://timesofindia.indiatimes.com/rssfeeds/296589292.cms",source:"Times of India"},{url:"https://tass.com/rss/v2.xml",source:"TASS"},{url:"https://www.scmp.com/rss/91/feed",source:"South China Morning Post"},{url:"https://www.thehindu.com/news/international/feeder/default.rss",source:"The Hindu"},{url:"https://www.timesofisrael.com/feed/",source:"Times of Israel"},{url:"https://www.africanews.com/feed/",source:"Africa News"},{url:"https://news.google.com/rss/search?q=site:asia.nikkei.com+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Nikkei Asia"},{url:"https://www.channelnewsasia.com/api/v1/rss-outbound-feed?_format=xml&category=6311",source:"CNA"},{url:"https://www.straitstimes.com/news/world/rss.xml",source:"Straits Times"},{url:"https://news.google.com/rss/search?q=site:haaretz.com+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Haaretz"},{url:"https://news.google.com/rss/search?q=site:thejakartapost.com+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Jakarta Post"},{url:"https://www.bangkokpost.com/rss/data/topstories.xml",source:"Bangkok Post"},{url:"https://news.google.com/rss/search?q=site:nation.africa+when:1d&hl=en-US&gl=US&ceid=US:en",source:"Nation Kenya"},{url:"https://www.independent.co.uk/news/world/rss",source:"The Independent"},{url:"https://www.theglobeandmail.com/arc/outboundfeeds/rss/category/world/",source:"Globe and Mail"},{url:"https://www.smh.com.au/rss/world.xml",source:"Sydney Morning Herald"},{url:"https://www.dawn.com/feeds/home",source:"Dawn"},{url:"https://www.thedailystar.net/top-news/rss.xml",source:"Daily Star Bangladesh"},{url:"https://rss.tempo.co/en",source:"Tempo"},{url:"https://www.premiumtimesng.com/feed",source:"Premium Times"},{url:"https://mg.co.za/feed/",source:"Mail & Guardian"},{url:"https://www.middleeasteye.net/rss",source:"Middle East Eye"},{url:"https://news.google.com/rss/search?q=site:thenationalnews.com&hl=en",source:"Google News"},{url:"https://feeds.folha.uol.com.br/mundo/rss091.xml",source:"Folha"},{url:"https://buenosairesherald.com/feed/",source:"Buenos Aires Herald"},{url:"https://www.taipeitimes.com/xml/index.rss",source:"Taipei Times"},{url:"https://news.google.com/rss/search?q=site:koreaherald.com+when:7d&hl=en",source:"Google News"},{url:"https://e.vnexpress.net/rss/news.rss",source:"VnExpress"},{url:"https://www.rappler.com/feed/",source:"Rappler"}]};function O(e){return e&&e.replace(/&#39;/g,"'").replace(/&#x27;/g,"'").replace(/&apos;/g,"'").replace(/&#8217;/g,"’").replace(/&#8216;/g,"‘").replace(/&#8220;/g,"“").replace(/&#8221;/g,"”").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x2F;/g,"/").replace(/&nbsp;/g," ").replace(/&#(\d+);/g,(a,n)=>String.fromCharCode(n)).replace(/&#x([0-9a-fA-F]+);/g,(a,n)=>String.fromCharCode(parseInt(n,16)))}function D(e){if(!e)return"News";const a=e.toLowerCase(),n={bbc:"BBC News",reuters:"Reuters",aljazeera:"Al Jazeera",theguardian:"The Guardian",apnews:"AP News",afp:"AFP",dw:"Deutsche Welle",france24:"France 24",cnn:"CNN",nytimes:"NY Times",washingtonpost:"Washington Post",wsj:"Wall Street Journal",usatoday:"USA Today",latimes:"LA Times",chicagotribune:"Chicago Tribune",abc:"ABC News",nbc:"NBC News",cbs:"CBS News",fox:"Fox News",foxnews:"Fox News",nypost:"New York Post",newyorkpost:"New York Post",newsmax:"Newsmax",npr:"NPR",pbs:"PBS",politico:"Politico",thehill:"The Hill",axios:"Axios",huffpost:"HuffPost",buzzfeed:"BuzzFeed",vox:"Vox",slate:"Slate",bloomberg:"Bloomberg",ft:"Financial Times",economist:"The Economist",cnbc:"CNBC",marketwatch:"MarketWatch",forbes:"Forbes",fortune:"Fortune",businessinsider:"Business Insider",insider:"Insider",sky:"Sky News",telegraph:"The Telegraph",independent:"The Independent",mirror:"The Mirror",express:"Daily Express",metro:"Metro UK",thesun:"The Sun",dailymail:"Daily Mail",dailymailuk:"Daily Mail UK",dailysabah:"Daily Sabah",jpost:"Jerusalem Post",timesofisrael:"Times of Israel",haaretz:"Haaretz",middleeastmonitor:"Middle East Monitor",middleeasteye:"Middle East Eye",arabnews:"Arab News",gulfnews:"Gulf News",alarabiya:"Al Arabiya",trtworld:"TRT World",aa:"Anadolu Agency",tehrantimes:"Tehran Times",tribune_pk:"Express Tribune",dawn:"Dawn",geo:"Geo News",arynews:"ARY News",thehindu:"The Hindu",hindustantimes:"Hindustan Times",ndtv:"NDTV",indiatoday:"India Today",timesofindia:"Times of India",toi:"Times of India",scmp:"South China Morning Post",straitstimes:"Straits Times",channelnewsasia:"CNA",nikkei:"Nikkei Asia",japantimes:"Japan Times",koreaherald:"Korea Herald",bangkokpost:"Bangkok Post",xinhua:"Xinhua",globaltimes:"Global Times",chinadaily:"China Daily",cgtn:"CGTN",nhk:"NHK World",nhkworld:"NHK World",kyodo:"Kyodo News",kyodonews:"Kyodo News",mehrnews:"Mehr News",jakartapost:"Jakarta Post",thejakartapost:"Jakarta Post",africanews:"Africa News",nationkenya:"Nation Kenya",rappler:"Rappler",taipeitimes:"Taipei Times",vietnamnews:"Vietnam News",thenational:"The National",thenationalnews:"The National",tempo:"Tempo",dailystar:"Daily Star Bangladesh",thedailystar:"Daily Star Bangladesh",globeandmail:"Globe and Mail",theglobeandmail:"Globe and Mail",buenosairesherald:"Buenos Aires Herald",rt:"RT",tass:"TASS",ria:"RIA Novosti",pravda:"Pravda",kyivindependent:"Kyiv Independent",kyivpost:"Kyiv Post",cbc:"CBC News",cbcnews:"CBC News",abc_au:"ABC Australia",smh:"Sydney Morning Herald",newsweek:"Newsweek",time:"TIME",theatlantic:"The Atlantic",foreignpolicy:"Foreign Policy",foreignaffairs:"Foreign Affairs",semafor:"Semafor",yonhap:"Yonhap"};return n[a]?n[a]:e.replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(i=>i.length<=3&&i===i.toUpperCase()?i:i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ").trim()}function ue(e){if(!e)return"Recent";const a=new Date(e);if(isNaN(a.getTime()))return"Recent";const i=new Date-a;if(i<6e4)return"Just now";const t=Math.floor(i/6e4),r=Math.floor(i/36e5),l=Math.floor(i/864e5);return t<60?t+"m ago":r<6?r+"h ago":r<24?"Today":l===1?"Yesterday":l<7?l+" days ago":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const N={"The Intercept":"L","Democracy Now":"L",Jacobin:"L","Mother Jones":"L",MSNBC:"L",HuffPost:"L",Vox:"L",Slate:"L","The Nation":"L","Raw Story":"L","The Wire":"L","Middle East Monitor":"L","The Guardian":"L",Guardian:"L","The Atlantic":"L","New York Times":"LC","The New York Times":"LC","NY Times":"LC","Washington Post":"LC","The Washington Post":"LC",CNN:"LC",BBC:"LC","BBC World":"LC","BBC News":"LC",NPR:"LC","NBC News":"LC","CBS News":"LC","ABC News":"LC",Time:"LC",TIME:"LC",Politico:"LC",Bloomberg:"LC","The Independent":"LC","USA Today":"LC","Los Angeles Times":"LC","LA Times":"LC","Daily Beast":"LC","Business Insider":"LC",Insider:"LC",CNBC:"LC","ABC Australia":"LC","Sydney Morning Herald":"LC","Irish Times":"LC","Times of Israel":"LC","Al Jazeera":"LC",AP:"LC","AP News":"LC","Associated Press":"LC",Axios:"LC",Haaretz:"LC",CBC:"LC","CBC News":"LC","Google News":"LC","Middle East Eye":"LC",Folha:"LC","Globe and Mail":"LC",Rappler:"LC",Reuters:"C","France 24":"C",France24:"C","DW News":"C",DW:"C","Deutsche Welle":"C","The Hill":"C",PBS:"C",Nikkei:"C","Nikkei Asia":"C",FT:"C","Financial Times":"C","The Hindu":"LC","Korea Herald":"C",SCMP:"C","South China Morning Post":"C",Dawn:"C","Straits Times":"C",CNA:"C","Bangkok Post":"C",VnExpress:"C","Africa News":"C",Africanews:"C","Jakarta Post":"C","The Jakarta Post":"C","Nation Kenya":"C","Foreign Policy":"C","Foreign Affairs":"C",Yonhap:"C","NHK World":"C",NHK:"C","Kyodo News":"C",Kyodo:"C",AFP:"C",Newsweek:"C","The Economist":"C",Forbes:"C",Semafor:"C","Daily Star Bangladesh":"C","Daily Star":"C",Tempo:"C","Buenos Aires Herald":"C","Taipei Times":"C","Premium Times":"C","Mail & Guardian":"C","Wall Street Journal":"RC","The Wall Street Journal":"RC",WSJ:"RC","The Telegraph":"RC","Washington Times":"RC","New York Post":"RC","Daily Mail":"RC","Daily Mail UK":"RC","Anadolu Agency":"RC","Times of India":"RC","The National":"RC","The National UAE":"RC","Fox News":"R","Daily Wire":"R",Breitbart:"R",Newsmax:"R",RT:"R",TASS:"R",Xinhua:"R","China Daily":"R",CGTN:"R","Mehr News":"R","Vietnam News":"R"};function M(e){if(!e)return null;if(N[e])return N[e];const a=e.toLowerCase();let n=null,i=0;return Object.keys(N).forEach(t=>{if(t.length<4)return;const r=t.toLowerCase();(a.includes(r)||r.includes(a))&&t.length>i&&(i=t.length,n=t)}),n?N[n]:"C"}function de(e){if(e.length<4)return e;function a(n){const i=M(n);return i==="L"||i==="LC"?"left":i==="RC"||i==="R"?"right":"center"}for(let n=0;n<3;n++){let i=!1;for(let t=2;t<e.length;t++){const r=a(e[t-2].source),l=a(e[t-1].source),c=a(e[t].source);if(r===l&&l===c&&r!=="center"){for(let g=t+1;g<Math.min(t+8,e.length);g++)if(a(e[g].source)!==r){[e[t],e[g]]=[e[g],e[t]],i=!0;break}}}if(!i)break}return e}const me=new Set(["cgtn","xinhua","china daily","global times","south china morning post","scmp","tass","rt","ria novosti","pravda","times of india","ndtv","hindustan times","indian express","the hindu","the print","the wire","scroll","firstpost","india today","live mint","economic times","wion","al jazeera","al arabiya","arab news","gulf news","daily sabah","trt world","anadolu agency","tehran times","press tv","middle east monitor","middle east eye","mehr news","dawn","geo news","ary news","express tribune","nhk world","nhk","kyodo news","kyodo","nikkei asia","japan times","korea herald","korea times","asahi shimbun","yonhap","straits times","cna","bangkok post","bernama","vnexpress","france 24","france24","deutsche welle","dw","dw news","o globo","folha","clarín","la nación","the hindu","times of israel","africa news","africanews","haaretz","jakarta post","the jakarta post","nation kenya","daily nation","daily star bangladesh","daily star","the daily star","tempo","the national","the national uae","buenos aires herald","taipei times","vietnam news","rappler","premium times","mail & guardian","mail and guardian"]);function he(e){let a=e.source||"";const n=e.headline||e.title||"";if(a.includes("Google News")&&n){const i=n.lastIndexOf(" - ");i>0&&(a=n.substring(i+3).trim())}return a}function ge(e){return e?me.has(e.toLowerCase()):!1}function pe(e){if(e.length<4)return e;const a=[],n=[];for(const l of e){const c=he(l);ge(c)?n.push(l):a.push(l)}if(n.length===0||a.length===0)return e;const i=[];let t=0,r=0;for(;t<a.length||r<n.length;)t<a.length&&i.push(a[t++]),t<a.length&&i.push(a[t++]),r<n.length&&i.push(n[r++]);return i}function U(e,a){const n=(e+" "+(a||"")).toLowerCase();return n.match(/\b(nfl|nba|mlb|nhl|mls|quarterback|touchdown|rushing|draft pick|playoff|playof|super bowl|world series|slam dunk|hat trick|grand slam|home run|batting|wide receiver|tight end|linebacker|cornerback|running back|premier league|champions league|soccer|basketball|baseball|hockey|tennis|cricket|rugby|boxing|ufc|mma|formula 1|nascar|grand prix)\b/)?"SPORTS":n.match(/\b(war|military|attack|strike|bomb|troops|fighting|conflict|invasion)\b/)?"CONFLICT":n.match(/\b(economy|market|stock|trade|gdp|inflation|bank|fiscal)\b/)?"ECONOMY":n.match(/\b(terror|missile|nuclear|defense|army|navy|weapon)\b/)?"SECURITY":n.match(/\b(diplomat|treaty|summit|negotiat|sanction|ambassador|nato)\b/)?"DIPLOMACY":n.match(/\b(elect|president|prime minister|parliament|vote|politic|government|congress)\b/)?"POLITICS":n.match(/\b(crisis|humanitarian|famine|refugee|emergency|natural disaster|humanitarian disaster|disaster relief|disaster zone|disaster response|disaster aid)\b/)?"CRISIS":n.match(/\b(cyber|chip export|tech ban|surveillance)\b/)?"TECH":n.match(/\b(climate|emission|carbon|renewable)\b/)?"CLIMATE":"WORLD"}const fe=["congress","senate hearing","house vote","gop","democrat","republican","dnc","rnc","fbi","doj","irs","atf","school board","governor","mayor","sheriff","district attorney","state legislature","supreme court ruling","amendment","fox news","msnbc","cnn host","anchor"];function we(e){const a=e.toLowerCase();let n=0;for(const i of W)a.includes(i)&&(n+=1);for(const i of G)a.includes(i)&&(n+=1);for(const i of fe)a.includes(i)&&(n-=1);for(const i of z)i.test(e)&&(n-=2);return n}async function be(e,a){try{const n="https://api.rss2json.com/v1/api.json?rss_url="+encodeURIComponent(e),i=await fetch(n);if(i.ok){const t=await i.json();if(t.status==="ok"&&t.items&&t.items.length>0)return F(t,a)}}catch{}try{const n=`${le}/rss?url=${encodeURIComponent(e)}`,i=await fetch(n);if(!i.ok)return[];const t=await i.json();return t.status!=="ok"||!t.items||t.items.length===0?[]:F(t,a)}catch{return[]}}function F(e,a){return e.items.map(n=>{let i=a||e.feed?.title||"News",t=O(n.title);if(i.includes("Google News")&&t){const r=t.lastIndexOf(" - ");r>0&&(i=t.substring(r+3).trim(),t=t.substring(0,r).trim())}return{title:t,description:O(n.description||n.content||""),link:n.link,source_id:i,pubDate:n.pubDate}})}const ye=2880*60*1e3;function ke(e){return e.pubDate?Date.now()-new Date(e.pubDate).getTime()<ye:!0}function Ce(e){const a=e.title||"",n=(a+" "+(e.description||"")).toLowerCase();if(H.some(r=>n.includes(r))||U(a,e.description)==="SPORTS")return!1;const i=a+" "+(e.description||"");if(z.some(r=>r.test(i)))return!1;const t=(a.match(/[^\x00-\x7F]/g)||[]).length;return!(a.length>10&&t/a.length>.15||/\b(de|del|los|las|por|para|avec|dans|und|der|die|dari|dan|yang|pada)\b/i.test(a)&&!/\b(de facto|del rio|de gaulle)\b/i.test(a)&&(a.match(/\b(de|del|los|las|por|para|avec|dans|und|der|die|dari|dan|yang|pada|dari|untuk|dengan|atau|ini|itu|comme|sont|nous|leur)\b/gi)||[]).length>=2||we(i)<1)}function Se(e){return(e||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\b(the|a|an|in|on|at|to|for|of|and|is|are|was|were|has|have|had|with|from|by)\b/g,"").replace(/\s+/g," ").trim()}function Te(e,a,n){if(n.some(i=>i.normalized===e))return!0;for(const i of n)if(e.length>20&&i.normalized.length>20){const t=new Set(e.split(" ")),r=new Set(i.normalized.split(" "));let l=0;for(const f of t)r.has(f)&&l++;const c=Math.max(t.size,r.size),g=i.source===a?.7:.95;if(c>0&&l/c>=g)return!0}return!1}async function ve(){const n=ce.daily,i=[],t=[];let r=0,l=0,c=0,g=0,f=0;function k(d){for(const h of d){if(r++,!ke(h)||(l++,!Ce(h)))continue;c++;const p=D(h.source_id),m=Se(h.title);Te(m,p,i)||(i.push({normalized:m,source:p}),t.push(h))}}for(let d=0;d<n.length;d+=10){const h=n.slice(d,d+10),p=await Promise.all(h.map(m=>be(m.url,m.source)));for(let m=0;m<p.length;m++){const A=p[m]||[];A.length>0?g++:f++,k(A)}d+10<n.length&&await new Promise(m=>setTimeout(m,200))}if(console.log(`[Worker] RSS feeds: ${g} working, ${f} failed, ${r} total articles`),t.length===0)return{briefing:R,events:[]};t.sort((d,h)=>new Date(h.pubDate)-new Date(d.pubDate)),console.log(`[Worker] Pipeline: ${r} raw → ${l} fresh → ${c} relevant → ${t.length} unique`);const b=t.slice(0,200).map(d=>{const h=U(d.title,d.description),p=["CONFLICT","CRISIS","SECURITY"].includes(h)?"high":"medium",m=D(d.source_id);return{time:ue(d.pubDate),category:h,importance:p,headline:d.title,description:d.description||"",source:m,url:d.link||""}}),y=b.filter(d=>{const h=M(d.source);return h==="RC"||h==="R"}).length;if(y<3){const d=R.filter(p=>{const m=M(p.source);return m==="RC"||m==="R"}),h=Math.min(4-y,d.length);if(h>0){const p=Math.max(1,Math.floor(b.length/(h+1)));for(let m=0;m<h;m++){const A=Math.min((m+1)*p+m,b.length);b.splice(A,0,d[m])}}}const o=de(b),s=pe(o),u=["switzerland","swiss","nightclub","club fire","nightlife"];for(let d=0;d<Math.min(10,s.length);d++){const h=(s[d].headline||"").toLowerCase();if(u.some(p=>h.includes(p))){const[p]=s.splice(d,1),m=Math.min(14,s.length);s.splice(m,0,p),d--}}const w=["new york post","ny post","daily mail"];for(let d=0;d<Math.min(5,s.length);d++){const h=(s[d].source||"").toLowerCase();if(w.some(p=>h.includes(p))){const[p]=s.splice(d,1),m=Math.min(s.length,5);s.splice(m,0,p),d--}}const L=await te(s);return{briefing:s,events:L}}self.onmessage=async e=>{if(e.data.type==="fetchNews")try{const a=await ve();self.postMessage({type:"result",briefing:a.briefing,events:a.events})}catch(a){self.postMessage({type:"error",message:a.message||"Worker processing failed"})}}})();
